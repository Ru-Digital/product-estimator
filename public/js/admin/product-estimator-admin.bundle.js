(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t){var i=function(t){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:i+""}function n(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,i(a.key),a)}}function a(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,a,o,r,s=[],d=!0,c=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;d=!1}else for(;!(d=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);d=!0);}catch(t){c=!0,a=t}finally{try{if(!d&&null!=i.return&&(r=i.return(),Object(r)!==r))return}finally{if(c)throw a}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=!1;function c(){var t,e,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!d&&null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug?(i?console.groupCollapsed("[ProductEstimator] Logs"):console.group("[ProductEstimator] Logs"),d=!0):null!==(e=window.productEstimatorVars)&&void 0!==e&&e.debug}function l(t){var e="[".concat(t,"]");return{log:function(){var t;if(null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){var i;c();for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];(i=console).log.apply(i,[e].concat(a)),window.debug&&window.debug.trace&&console.trace()}},warn:function(){var t;if(null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){var i;c();for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];(i=console).warn.apply(i,[e].concat(a)),window.debug&&window.debug.trace&&console.trace()}},error:function(){var t;if(null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){var i;c(!1);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];(i=console).error.apply(i,[e].concat(a)),window.debug&&window.debug.trace&&console.trace()}},group:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Details",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){c();var a="".concat(e," ").concat(i);n?console.groupCollapsed(a):console.group(a)}},groupEnd:function(){var t;null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug&&d&&console.groupEnd()}}}function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h=l("UtilsAjax");function f(t){var e,i=jQuery,n=g(g({},{url:(null===(e=window.productEstimatorVars)||void 0===e?void 0:e.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),type:"POST",dataType:"json"}),t);return new Promise((function(t,e){i.ajax(g(g({},n),{},{success:function(i){if(i.success)t(i.data);else{var n,a=new Error((null===(n=i.data)||void 0===n?void 0:n.message)||"Unknown error");a.data=i.data,e(a)}},error:function(t,i,n){h.error("AJAX error:",i,n),e(new Error(n))}}))}))}function m(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=document.createElement(t);return Object.entries(i).forEach((function(t){var i=r(t,2),n=i[0],o=i[1];"className"===n?a.className=o:"dataset"===n?Object.entries(o).forEach((function(t){var e=r(t,2),i=e[0],n=e[1];a.dataset[i]=n})):"style"===n&&"object"===e(o)?Object.entries(o).forEach((function(t){var e=r(t,2),i=e[0],n=e[1];a.style[i]=n})):a.setAttribute(n,o)})),"string"==typeof n?a.textContent=n:Array.isArray(n)&&n.forEach((function(t){"string"==typeof t?a.appendChild(document.createTextNode(t)):t instanceof Node&&a.appendChild(t)})),a}function p(t){return!!t&&/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}function v(t,e){var i=jQuery;if(t){var n=t instanceof jQuery?t:i(t);b(n);var a=i('<span class="field-error">'.concat(e,"</span>"));n.after(a),n.addClass("error")}}function b(t){var e=jQuery;if(t){var i=t instanceof jQuery?t:e(t);i.next(".field-error").remove(),i.removeClass("error")}}function w(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,i=jQuery;if(i){for(var n=i('<div class="notice notice-'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",' is-dismissible"><p>').concat(t,"</p></div>")),a=[i(".wrap h1"),i(".product-estimator-form-container"),i("#wpbody-content")],o=null,r=0;r<a.length;r++)if(a[r].length){o=a[r];break}if(o?o.after(n):i("body").prepend(n),window.wp&&window.wp.notices)window.wp.notices.init();else{var s=i('<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>');n.append(s),s.on("click",(function(){n.fadeOut(100,(function(){n.remove()}))}))}setTimeout((function(){n.fadeOut(500,(function(){return n.remove()}))}),e)}else alert(t)}l("UtilsDom");var y=function(t){var e;if(null!==(e=window.productEstimatorVars)&&void 0!==e&&e.debug){var i;c();for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];(i=console).log.apply(i,["[".concat(t,"]")].concat(a))}},_=l,S=p,T=v,C=b,E=_("ProductEstimatorAdmin");function I(t,i){if(i&&("object"==e(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}function M(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&P(t,e)}new(function(){return a((function e(){var i=this;t(this,e),jQuery(document).ready((function(){i.initializeVariables(),i.bindEvents(),i.isSettingsPage()||i.initializeTabs()}))}),[{key:"isSettingsPage",value:function(){var t=new URLSearchParams(window.location.search).get("page");return t&&t.indexOf("-settings")>-1}},{key:"initializeVariables",value:function(){this.formChanged=!1,this.currentTab="",this.reportData=null,this.chart=null}},{key:"bindEvents",value:function(){var t=jQuery;this.isSettingsPage()||t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.initializeValidation(),t(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"initializeTabs",value:function(){var t=jQuery,e=t(".nav-tab:first"),i=e.data("tab")||"tab-1";t(".tab-content").hide(),t("#".concat(i)).show(),e.addClass("nav-tab-active"),this.currentTab=i;var n=new URLSearchParams(window.location.search).get("tab");n&&this.switchTab(n)}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged?confirm(productEstimatorAdmin.i18n.unsavedChanges)&&this.switchTab(e):this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery;e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show(),this.currentTab=t;var i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),"reports"!==t||this.reportData||this.loadInitialReport()}},{key:"initializeValidation",value:function(){if(!this.isSettingsPage()){var t=jQuery,e=t(".product-estimator-form");e.find('input[type="email"]').on("change",(function(e){var i=t(e.currentTarget),n=i.val();n&&!S(n)?T(i,productEstimatorAdmin.i18n.invalidEmail):C(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(e.currentTarget),n=parseInt(i.val()),a=parseInt(i.attr("min")),o=parseInt(i.attr("max"));n<a||n>o?T(i,productEstimatorAdmin.i18n.numberRange.replace("%min%",a).replace("%max%",o)):C(i)}))}}},{key:"handleBeforeUnload",value:function(t){if(this.formChanged)return t.preventDefault(),productEstimatorAdmin.i18n.unsavedChanges}},{key:"loadInitialReport",value:function(){E.log("Loading initial report data")}}])}());var j=l("UtilsTinyMCEPreserver");function A(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?A(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var D=function(){return a((function e(){var i=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,e),this.$=jQuery,this.baseClassLogger=_(this.constructor.name),n&&n.isModule?(this.settingsObjectName=n.settingsObjectName,this.defaultTabId=n.defaultTabId,this._initializeModuleSpecificSettings(this.settingsObjectName,this.defaultTabId),this.$(document).ready((function(){i._finalizeModuleSettings(i.settingsObjectName),"function"==typeof i.moduleInit?i.moduleInit():i.baseClassLogger.warn("Module does not implement moduleInit():",n.settingsObjectName)}))):(this.formChanged=!1,this.currentTab="",this.formChangeTrackers={},this.ensureGlobalVariables(),this.$(document).ready((function(){i.mainInit()})))}),[{key:"_initializeModuleSpecificSettings",value:function(t,e){var i=window[t]||{};this.settings=x({},i),this.settings.ajaxUrl=i.ajaxUrl||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),this.settings.nonce=i.nonce||window.productEstimatorSettings&&window.productEstimatorSettings.nonce||"";var n=window.productEstimatorSettings&&window.productEstimatorSettings.actions||{};this.settings.actions=x(x({},n),i.actions||{}),!this.settings.actions.save_settings&&e&&(this.settings.actions.save_settings="save_".concat(e,"_settings"));var a=window.productEstimatorSettings&&window.productEstimatorSettings.selectors||{};this.settings.selectors=x(x({},a),i.selectors||{}),this.settings.i18n=x(x({},window.productEstimatorSettings&&window.productEstimatorSettings.i18n),i.i18n||{}),this.settings.tab_id=i.tab_id||e,this.settings.settingsObjectName=t,void 0===this.settings.option_name&&this.baseClassLogger.warn("'option_name' is missing from localizedSettings for ".concat(t,". This is usually critical.")),void 0===i.actions&&this.baseClassLogger.warn("Original 'actions' object was missing from localizedSettings for ".concat(t,". Defaulted/merged.")),void 0===i.selectors&&this.baseClassLogger.warn("Original 'selectors' object was missing from localizedSettings for ".concat(t,". Defaulted/merged.")),this.baseClassLogger.log("Base module settings initialized for ".concat(t,". Effective settings:"),JSON.stringify(this.settings))}},{key:"_finalizeModuleSettings",value:function(t){var e=window[t]||{};e.nonce&&(this.settings.nonce=e.nonce,this.baseClassLogger.log("Nonce updated for ".concat(t," via _finalizeModuleSettings")))}},{key:"ensureGlobalVariables",value:function(){window.featureSwitchesSettings=window.featureSwitchesSettings||{tab_id:"feature_switches",i18n:{}},window.generalSettings=window.generalSettings||{tab_id:"general",i18n:{}},window.netsuiteSettings=window.netsuiteSettings||{tab_id:"netsuite",i18n:{}},window.notificationSettings=window.notificationSettings||{tab_id:"notifications",i18n:{}},window.pricingRulesSettings=window.pricingRulesSettings||{tab_id:"pricing_rules",i18n:{}},window.productAdditionsSettings=window.productAdditionsSettings||{tab_id:"product_additions",i18n:{}},window.productUpgradesSettings=window.productUpgradesSettings||{tab_id:"product_upgrades",i18n:{}},window.similarProductsSettings=window.similarProductsSettings||{tab_id:"similar_products",i18n:{}},window.labelSettings=window.labelSettings||{tab_id:"labels",i18n:{}},window.productEstimatorSettings=window.productEstimatorSettings||{ajax_url:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:"",i18n:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave this tab?",saveSuccess:"Settings saved successfully.",saveError:"Error saving settings.",saving:"Saving..."}}}},{key:"mainInit",value:function(){y("ProductEstimatorSettings","Initializing Settings Manager Orchestrator...");var t=this.getTabFromUrl();this.currentTab=null!==t?t:"general",this.$(".tab-content").hide(),this.$("#".concat(this.currentTab)).show(),this.$(".nav-tab").removeClass("nav-tab-active"),this.$('.nav-tab[data-tab="'.concat(this.currentTab,'"]')).addClass("nav-tab-active"),this.bindMainEvents(),this.initFormChangeTracking(),this.initializeValidation(),y("ProductEstimatorSettings","Settings manager orchestrator initialized with tab:",this.currentTab)}},{key:"bindMainEvents",value:function(){var t=this;this.$(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.$(document).on("submit","form.product-estimator-form",(function(e){var i=t.$(e.currentTarget);i.hasClass("pe-vtabs-tab-form")&&i.attr("data-sub-tab-id")?y("ProductEstimatorSettings","Orchestrator: Form is vtab, letting specialized handler process.",i[0]):(y("ProductEstimatorSettings","Orchestrator: Processing form submission.",i[0]),e.preventDefault(),t.handleAjaxFormSubmit(e,i))})),this.$(window).on("beforeunload",this.handleBeforeUnload.bind(this)),y("ProductEstimatorSettings","Orchestrator events bound")}},{key:"handleAjaxFormSubmit",value:function(t,e){var i=this,n=(e=e||this.$(t.target)).closest(".tab-content").attr("id")||e.data("tab"),a=e.serialize(),o=window.createLogger?window.createLogger("PES-Orchestrator:".concat(n||"unknown_tab")):console;o.log("Serialized form data (orchestrator):",a),e.find('input[type="checkbox"]').each((function(t,e){var n=i.$(e);if(!n.is(":checked")){var o=n.attr("name");if(o){var r=new RegExp("(^|&)".concat(encodeURIComponent(o).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"(?:=[^&]*)?"));null===a.match(r)&&(a+="&".concat(encodeURIComponent(o),"=0"))}}})),a=a.replace(/^&+/,"").replace(/&&+/g,"&"),this.showFormLoading(e),o.log("Submitting form for tab: ".concat(n));var r="save_".concat(n,"_settings"),s=window.productEstimatorSettings||{nonce:"",ajax_url:ajaxurl,i18n:{}},d={action:r,nonce:s.nonce,form_data:a};o.log("Orchestrator sending AJAX with payload:",d),f({url:s.ajax_url,type:"POST",data:d}).then((function(t){i.showNotice(t.message||s.i18n.saveSuccess,"success"),i.formChangeTrackers&&(i.formChangeTrackers[n]=!1),n===i.currentTab&&(i.formChanged=!1),o.log("Settings saved successfully for tab: ".concat(n," (via orchestrator)"))})).catch((function(t){var e=t&&t.message?t.message:s.i18n.saveError;i.showNotice(e,"error"),o.error("Error saving settings for tab ".concat(n," (via orchestrator):"),t)})).finally((function(){i.hideFormLoading(e)}))}},{key:"showFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!0).addClass("loading"),e.data("original-text",e.val());var i=window.productEstimatorSettings&&window.productEstimatorSettings.i18n&&window.productEstimatorSettings.i18n.saving?window.productEstimatorSettings.i18n.saving:"Saving...";e.val(i)}},{key:"hideFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!1).removeClass("loading"),e.data("original-text")&&e.val(e.data("original-text"))}},{key:"initFormChangeTracking",value:function(){var t=this;this.$(".tab-content").each((function(){var e=t.$(this).attr("id");t.formChangeTrackers&&(t.formChangeTrackers[e]=!1),t.$("#".concat(e," :input")).on("change input",(function(){t.formChangeTrackers&&(t.formChangeTrackers[e]=!0),e===t.currentTab&&(t.formChanged=!0)}))})),y("ProductEstimatorSettings","Orchestrator form change tracking initialized")}},{key:"initializeValidation",value:function(){var t=this;this.$(".product-estimator-form").each((function(e,i){var n=t.$(i);n.data("module-managed-validation")||(n.find('input[type="email"]').on("change",(function(e){var i=t.$(e.currentTarget);i.val()&&!p(i.val())?t.showFieldError(i,window.productEstimatorSettings.i18n.invalidEmail||"Invalid email address"):t.clearFieldError(i)})),n.find('input[type="number"]').on("change",(function(e){var i=t.$(e.currentTarget),n=parseInt(i.val(),10),a=parseInt(i.attr("min")||0,10),o=parseInt(i.attr("max")||9999,10),r=window.productEstimatorSettings&&window.productEstimatorSettings.i18n;if(isNaN(n)||n<a||n>o){var s=r&&r.numberRange?r.numberRange.replace("%min%",a).replace("%max%",o):"Value must be between ".concat(a," and ").concat(o);t.showFieldError(i,s)}else t.clearFieldError(i)})))})),y("ProductEstimatorSettings","Orchestrator form validation initialized")}},{key:"getTabFromUrl",value:function(){return new URLSearchParams(window.location.search).get("tab")}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=this.$(t.currentTarget).data("tab"),i=window.productEstimatorSettings&&window.productEstimatorSettings.i18n;this.formChanged&&!confirm(i.unsavedChanges||"You have unsaved changes. Are you sure?")||this.switchTab(e)}},{key:"switchTab",value:function(t){var e=new URL(window.location.href);e.searchParams.set("tab",t),window.history.pushState({},"",e.toString()),this.$(".nav-tab").removeClass("nav-tab-active"),this.$('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),this.$(".tab-content").hide(),this.$("#".concat(t)).show();var i=this.currentTab;this.currentTab=t,this.formChanged=this.formChangeTrackers&&this.formChangeTrackers[t]||!1,this.$(document).trigger("product_estimator_tab_changed",[t,i]),y("ProductEstimatorSettings","Orchestrator switched to tab: ".concat(t," from ").concat(i))}},{key:"handleBeforeUnload",value:function(t){var e=!1;if(this.formChangeTrackers)for(var i in this.formChangeTrackers)if(this.formChangeTrackers[i]){e=!0;break}if(e){var n=(window.productEstimatorSettings&&window.productEstimatorSettings.i18n).unsavedChanges||"You have unsaved changes. Are you sure?";return t.returnValue=n,n}}},{key:"clearSubTabFromUrl",value:function(){var t=new URL(window.location.href);t.searchParams.has("sub_tab")&&(t.searchParams.delete("sub_tab"),window.history.replaceState({},"",t.toString()),this.baseClassLogger.log("Cleared sub_tab from URL."))}},{key:"showFieldError",value:function(t,e){v(this.$(t),e)}},{key:"clearFieldError",value:function(t){b(this.$(t))}},{key:"showNotice",value:function(t){w(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success")}}])}();jQuery(document).ready((function(){window.ProductEstimatorSettingsInstance||(window.ProductEstimatorSettingsInstance=new D)}));const O=D;function F(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(F=function(){return!!t})()}var N=_("GeneralSettingsModule"),R=function(e){function i(){var e,n,a,o;return t(this,i),n=this,o=[{isModule:!0,settingsObjectName:"generalSettings",defaultTabId:"general"}],a=k(a=i),(e=I(n,F()?Reflect.construct(a,o||[],k(n).constructor):a.apply(n,o))).validateMarkup=e.validateMarkup.bind(e),e.validateExpiryDays=e.validateExpiryDays.bind(e),e.handleFileUpload=e.handleFileUpload.bind(e),e.handleFileRemove=e.handleFileRemove.bind(e),e.handleTabChanged=e.handleTabChanged.bind(e),e}return M(i,e),a(i,[{key:"moduleInit",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupValidation(),this.setupWpEditors(),N.log("General Settings Module Initialized")}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged),this.$(".select-file-button").on("click",this.handleFileUpload),this.$(".remove-file-button").on("click",this.handleFileRemove)}},{key:"setupWpEditors",value:function(){(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",i=jQuery;if(0!==i(e).length){j.log("Setting up rich text editors with <br> tag preservation"),window._originalEditorContent=window._originalEditorContent||{};var n=function(t){return t.replace(/<br\s*\/?>/gi,"<br>â€‹")},a=function(t){return t.replace(/\u200B/g,"")},o=function(){if("undefined"!=typeof tinyMCE&&tinyMCE.editors){var e=!0;return t.forEach((function(t){(function(t){if(!tinyMCE||!tinyMCE.get(t))return!1;var e=tinyMCE.get(t);e.settings.wpautop=!1,e.settings.forced_root_block="",e.settings.valid_elements="*[*]",e.settings.entity_encoding="raw",e.settings.verify_html=!1,e.settings.br_in_pre=!1,e.settings.keep_styles=!0,e.settings.remove_linebreaks=!1,e.settings.convert_newlines_to_brs=!0,e.settings.remove_redundant_brs=!1;var o=i("#".concat(t));if(o.length){var r=o.val();window._originalEditorContent[t]=r,setTimeout((function(){var t=n(r);e.setContent(t,{format:"raw"})}),100)}return e.on("BeforeSetContent",(function(e){e.content&&(e.content=n(e.content)),(e.initial||e.source_view)&&(window._originalEditorContent[t]=e.content)})),e.on("GetContent",(function(t){t.content&&(t.content=a(t.content))})),e.on("init",(function(){var i=e.getContent({format:"raw"});window._originalEditorContent[t]=a(i),j.log("Editor ".concat(t," initialized with content length: ").concat(i.length))})),i('.wp-editor-tabs button[data-wp-editor-id="'.concat(t,'"]')).on("click",(function(){var e=i(this).hasClass("switch-html"),o=i(this).hasClass("switch-tmce");if(e&&tinyMCE.get(t)){var r=tinyMCE.get(t).getContent({format:"raw"}),s=a(r);window._originalEditorContent[t]=s,i("#".concat(t)).val(s)}o&&setTimeout((function(){if(tinyMCE.get(t)&&window._originalEditorContent[t]){var e=n(window._originalEditorContent[t]);tinyMCE.get(t).setContent(e,{format:"raw"})}}),100)})),j.log("Editor ".concat(t," configured with <br> tag protection")),!0})(t)||(e=!1)})),e}return!1};if(!o())var r=0,s=setInterval((function(){r++,(o()||r>20)&&clearInterval(s)}),300);t.forEach((function(t){i("#".concat(t)).on("input change",(function(){window._originalEditorContent[t]=i(this).val()}))})),i("".concat(e," form")).off("submit.htmlPreservation").on("submit.htmlPreservation",(function(){return t.forEach((function(t){var e="";if(tinyMCE.get(t)&&tinyMCE.get(t).isHidden()){var n=i("#".concat(t));n.length&&(e=n.val())}else if(tinyMCE.get(t)){var o=tinyMCE.get(t).getContent({format:"raw"});e=a(o)}!e&&window._originalEditorContent[t]&&(e=window._originalEditorContent[t]),e&&(i("#".concat(t)).val(e),j.log("Form submission: Updated ".concat(t," with content length: ").concat(e.length)))})),!0}))}})(["pdf_footer_text","pdf_footer_contact_details_content"],"#general"),N.log("WP Editors setup/refreshed for General Settings.")}},{key:"handleFileUpload",value:function(t){var e=this;t.preventDefault();var i=this.$(t.currentTarget),n=i.data("field-id"),a=i.data("accept")||"";this.mediaFrame||(this.mediaFrame=wp.media({title:"Select or Upload PDF Template",button:{text:"Use this file"},multiple:!1,library:{type:a?[a.split("/")[0]]:null}}),this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON();N.log("Selected attachment:",t),t&&t.id?e.$("#".concat(n)).val(t.id).trigger("change"):N.error("Attachment or attachment.id is missing!",t),i.siblings(".file-preview-wrapper").html('<p class="file-preview"><a href="'.concat(t.url,'" target="_blank">').concat(t.filename,"</a></p>")),i.siblings(".remove-file-button").removeClass("hidden")}))),this.mediaFrame.open()}},{key:"handleFileRemove",value:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.data("field-id");this.$("#".concat(i)).val("").trigger("change"),e.siblings(".file-preview-wrapper").empty(),e.addClass("hidden")}},{key:"setupValidation",value:function(){this.$("#default_markup").on("change input",this.validateMarkup),this.$("#estimate_expiry_days").on("change input",this.validateExpiryDays)}},{key:"validateMarkup",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=parseInt(e.attr("min")||0,10),a=parseInt(e.attr("max")||100,10),o=window.generalSettings&&window.generalSettings.i18n||this.settings.i18n||{};return isNaN(i)||i<n||i>a?(this.showFieldError(e,o.validationErrorMarkup||"Value must be between ".concat(n," and ").concat(a,".")),!1):(this.clearFieldError(e),!0)}},{key:"validateExpiryDays",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=parseInt(e.attr("min")||1,10),a=parseInt(e.attr("max")||365,10),o=window.generalSettings&&window.generalSettings.i18n||this.settings.i18n||{};return isNaN(i)||i<n||i>a?(this.showFieldError(e,o.validationErrorExpiry||"Value must be between ".concat(n," and ").concat(a,".")),!1):(this.clearFieldError(e),!0)}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.setupWpEditors(),N.log("General Settings tab activated, refreshing editors.")),this.clearSubTabFromUrl()}},{key:"saveEditorContent",value:function(){"undefined"!=typeof tinyMCE&&(["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(t){var e=tinyMCE.get(t);e&&e.save()})),N.log("TinyMCE editor content saved."))}},{key:"validateAllFields",value:function(){var t=!0;return this.saveEditorContent(),this.validateMarkup({currentTarget:this.$("#default_markup")[0]})||(t=!1),this.validateExpiryDays({currentTarget:this.$("#estimate_expiry_days")[0]})||(t=!1),N.log("All fields validation result:",t),t}}])}(O);function U(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(U=function(){return!!t})()}jQuery(document).ready((function(){jQuery("#general").length&&(window.GeneralSettingsModuleInstance=new R)}));var B=_("NetsuiteSettingsModule"),z=function(e){function i(){var e,n,a,o;return t(this,i),n=this,o=[{isModule:!0,settingsObjectName:"netsuiteSettings",defaultTabId:"netsuite"}],a=k(a=i),(e=I(n,U()?Reflect.construct(a,o||[],k(n).constructor):a.apply(n,o))).testNetsuiteConnection=e.testNetsuiteConnection.bind(e),e.toggleNetsuiteFields=e.toggleNetsuiteFields.bind(e),e.validateUrl=e.validateUrl.bind(e),e.validateRequestLimit=e.validateRequestLimit.bind(e),e.validateCacheTime=e.validateCacheTime.bind(e),e.handleTabChanged=e.handleTabChanged.bind(e),e}return M(i,e),a(i,[{key:"moduleInit",value:function(){B.log("Initializing NetSuite Settings Module"),this.bindEvents(),this.setupDependentFields()}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged),this.$("#test-netsuite-connection").on("click",this.testNetsuiteConnection),this.$("#netsuite_enabled").on("change",this.toggleNetsuiteFields),this.$("#netsuite_api_url, #netsuite_token_url").on("blur",this.validateUrl),this.$("#netsuite_request_limit").on("blur",this.validateRequestLimit),this.$("#netsuite_cache_time").on("blur",this.validateCacheTime)}},{key:"setupDependentFields",value:function(){this.toggleNetsuiteFields(),B.log("NetSuite dependent fields setup complete.")}},{key:"toggleNetsuiteFields",value:function(){var t=this.$("#netsuite_enabled").is(":checked"),e=this.$("#netsuite_client_id, #netsuite_client_secret, #netsuite_api_url, #netsuite_token_url, #netsuite_request_limit, #netsuite_cache_time").closest("tr"),i=this.$("#test-netsuite-connection").closest("p");t?(e.fadeIn(200),i.fadeIn(200)):(e.fadeOut(200),i.fadeOut(200)),B.log("NetSuite fields visibility toggled: ".concat(t))}},{key:"testNetsuiteConnection",value:function(){var t=this.$("#test-netsuite-connection"),e=this.$("#connection-result");if(!t.prop("disabled")){var i=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};t.prop("disabled",!0),e.html('<span style="color:#666;">'.concat(i.testing||"Testing connection...","</span>")),B.log("Testing NetSuite connection..."),f({url:this.settings.ajaxUrl,type:"POST",data:{action:"test_netsuite_connection",nonce:this.settings.nonce}}).then((function(t){var i=t.data&&t.data.message?t.data.message:t.message;e.html('<span style="color:green;">'.concat(i||"Connection successful.","</span>")),B.log("Connection test successful:",t)})).catch((function(t){var n=t&&t.message?t.message:i.error||"Error";e.html('<span style="color:red;">'.concat(n,"</span>")),B.error("Connection test failed:",t)})).finally((function(){t.prop("disabled",!1)}))}}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.toggleNetsuiteFields(),B.log("NetSuite Settings tab activated, refreshing fields.")),this.clearSubTabFromUrl()}},{key:"validateUrl",value:function(t){var e=this.$(t.currentTarget),i=e.val().trim(),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return i&&!this.isValidUrl(i)?(this.showFieldError(e,n.invalidUrl||"Please enter a valid URL."),!1):(this.clearFieldError(e),!0)}},{key:"isValidUrl",value:function(t){try{return new URL(t),!0}catch(t){return!1}}},{key:"validateRequestLimit",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return isNaN(i)||i<1||i>100?(this.showFieldError(e,n.requestLimitError||"Request limit must be between 1 and 100."),!1):(this.clearFieldError(e),!0)}},{key:"validateCacheTime",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return isNaN(i)||i<0?(this.showFieldError(e,n.cacheTimeError||"Cache time must be at least 0."),!1):(this.clearFieldError(e),!0)}},{key:"addInfoSection",value:function(t){var e=this.$("#netsuite-settings-table");if(e.length&&t){this.$(".netsuite-info-section").remove();var i=m("div",{className:"netsuite-info-section notice notice-info",style:{padding:"10px",marginBottom:"15px"},innerHTML:t});e.before(i),B.log("Added dynamic info section to NetSuite settings.")}}}])}(O);function V(){return V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(arguments.length<3?t:i):a.value}},V.apply(null,arguments)}function L(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(L=function(){return!!t})()}jQuery(document).ready((function(){jQuery("#netsuite").length&&(window.NetsuiteSettingsModuleInstance=new z)}));var Q=_("VerticalTabbedModule");const q=function(i){function n(e){var i,a,o,r;return t(this,n),a=this,o=n,r=[{isModule:!0,settingsObjectName:e.localizedDataName,defaultTabId:e.mainTabId}],o=k(o),(i=I(a,L()?Reflect.construct(o,r||[],k(a).constructor):o.apply(a,r))).vtmConfig={defaultSubTabId:e.defaultSubTabId,ajaxActionPrefix:e.ajaxActionPrefix},i.$container=null,i.vtmConfig.defaultSubTabId&&i.vtmConfig.ajaxActionPrefix||Q.error("VerticalTabbedModule: Missing critical VTM-specific configuration (defaultSubTabId or ajaxActionPrefix). Halting initialization for this instance.",i.vtmConfig),i}return M(n,i),a(n,[{key:"moduleInit",value:function(){var t=this;if(this.$container=this.$("#".concat(this.settings.tab_id)),!this.$container.length)return Q.error("VerticalTabbedModule: Main container #".concat(this.settings.tab_id," not found. Module not initialized further.")),void(window.ProductEstimatorSettingsInstance&&window.ProductEstimatorSettingsInstance.showNotice("Error: UI container for '".concat(this.settings.tab_id,"' settings not found. Some features might be unavailable."),"error"));Q.log("VerticalTabbedModule: moduleInit() called for main tab #".concat(this.settings.tab_id,".")),this.bindCommonVTMEvents(),this.bindModuleSpecificEvents();var e=window.ProductEstimatorSettingsInstance;e&&e.currentTab===this.settings.tab_id&&(Q.log("VerticalTabbedModule: Main tab #".concat(this.settings.tab_id," is currently active. Setting up vertical tabs and calling onMainTabActivated.")),setTimeout((function(){t.setupVerticalTabs(),t.onMainTabActivated()}),100))}},{key:"bindCommonVTMEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleMainTabChanged.bind(this)),this.$container.on("submit.vtm","form.pe-vtabs-tab-form",this.handleVTMFormSubmit.bind(this)),this.$container.on("click.vtm",".pe-vtabs-nav-list a, .vertical-tabs-nav a",this.handleVerticalTabClick.bind(this)),Q.log("[".concat(this.settings.tab_id,"] Common VTM events bound."))}},{key:"bindModuleSpecificEvents",value:function(){Q.log("[".concat(this.settings.tab_id,"] Base bindModuleSpecificEvents() called."))}},{key:"onMainTabActivated",value:function(){Q.log("[".concat(this.settings.tab_id,"] Base onMainTabActivated() called."))}},{key:"onMainTabDeactivated",value:function(){Q.log("[".concat(this.settings.tab_id,"] Base onMainTabDeactivated() called."))}},{key:"setupVerticalTabs",value:function(){if(this.$container&&this.$container.length){Q.log("[".concat(this.settings.tab_id,"] Setting up vertical tabs."));var t=this.$container.find(".pe-vtabs-nav-list, .vertical-tabs-nav"),e=this.$container.find(".pe-vtabs-tab-panel, .vertical-tab-content");if(t.length&&e.length){var i=this.vtmConfig.defaultSubTabId,n=new URLSearchParams(window.location.search).get("sub_tab");if(n&&t.find('a[data-tab="'.concat(n,'"]')).length)i=n;else{var a=t.find(".pe-vtabs-nav-item.active a, .tab-item.active a");a.length&&(i=a.data("tab"))}if(!t.find('a[data-tab="'.concat(i,'"]')).length){Q.warn("[".concat(this.settings.tab_id,'] Determined active/default sub-tab "').concat(i,'" not valid. Falling back to first available.'));var o=t.find("a[data-tab]").first();if(!o.length)return void Q.error("[".concat(this.settings.tab_id,"] No valid sub-tabs found. Cannot initialize vertical tabs."));i=o.data("tab")}Q.log("[".concat(this.settings.tab_id,"] Initial active sub-tab ID to show: ").concat(i)),this.showVerticalTab(i,!1),this.adjustTabContentHeight(),this.$(window).off("resize.vtm.".concat(this.settings.tab_id)).on("resize.vtm.".concat(this.settings.tab_id),this.adjustTabContentHeight.bind(this))}else Q.warn("[".concat(this.settings.tab_id,"] Vertical tab navigation or content panels not found. Vertical tabs may not function."))}else Q.warn("[".concat(this.settings.tab_id,"] Cannot setup vertical tabs, $container not found."))}},{key:"handleVerticalTabClick",value:function(t){t.preventDefault();var e=this.$(t.currentTarget).data("tab");e?this.showVerticalTab(e,!0):Q.warn("[".concat(this.settings.tab_id,"] Vertical tab link clicked but no subTabId found in data-tab attribute."))}},{key:"adjustTabContentHeight",value:function(){if(this.$container&&this.$container.length){var t=this.$container.find(".pe-vtabs-nav-area, .vertical-tabs"),e=this.$container.find(".pe-vtabs-content-area, .vertical-tabs-content");if(t.length&&e.length){var i=t.outerHeight();i&&e.css("min-height",i+"px")}}}},{key:"showVerticalTab",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.$container&&this.settings.tab_id&&t){var i=this.$container.find(".pe-vtabs-nav-list, .vertical-tabs-nav"),n=this.$container.find(".pe-vtabs-tab-panel, .vertical-tab-content");i.find(".pe-vtabs-nav-item, .tab-item").removeClass("active"),i.find('a[data-tab="'.concat(t,'"]')).closest(".pe-vtabs-nav-item, .tab-item").addClass("active"),n.hide().removeClass("active");var a=this.$container.find("#".concat(t.replace(/[^a-zA-Z0-9-_]/g,"")));if(a.length?a.show().addClass("active"):Q.warn("[".concat(this.settings.tab_id,'] Content panel for sub-tab ID "').concat(t,'" not found.')),e){var o=new URL(window.location.href);o.searchParams.set("page",o.searchParams.get("page")||"product-estimator-settings"),o.searchParams.set("tab",this.settings.tab_id),o.searchParams.set("sub_tab",t),window.history.pushState({mainTabId:this.settings.tab_id,subTabId:t},"",o.toString())}this.$(document).trigger("pe_sub_tab_changed_".concat(this.settings.tab_id),[t])}else{var r;Q.warn("VerticalTabbedModule: Cannot show vertical tab due to missing container, mainTabId, or subTabId.",{containerExists:!(null===(r=this.$container)||void 0===r||!r.length),mainTabId:this.settings.tab_id,subTabId:t})}}},{key:"handleMainTabChanged",value:function(t,e,i){var n=this;e===this.settings.tab_id?(Q.log("VerticalTabbedModule: Main tab #".concat(this.settings.tab_id," activated.")),this.$container&&this.$container.length||(this.$container=this.$("#".concat(this.settings.tab_id))),this.$container.length?setTimeout((function(){n.setupVerticalTabs(),n.onMainTabActivated()}),100):Q.warn("VerticalTabbedModule: Main container #".concat(this.settings.tab_id," not found when trying to reactivate tab."))):i===this.settings.tab_id&&(Q.log("VerticalTabbedModule: Main tab #".concat(this.settings.tab_id," deactivated.")),this.onMainTabDeactivated())}},{key:"handleVTMFormSubmit",value:function(t){var i=this,n=this.$(t.currentTarget);t.preventDefault(),Q.log('VTM Form submission for main tab "'.concat(this.settings.tab_id,'", form:'),n[0]);var a=n.find('.save-settings, button[type="submit"], input[type="submit"]'),o=n.find(".spinner").first();"undefined"!=typeof tinyMCE&&n.find(".wp-editor-area").each((function(t,e){var n=tinyMCE.get(i.$(e).attr("id"));n&&n.save()}));var r=n.serialize(),s=n.attr("data-sub-tab-id");if(!s||""===String(s).trim())return Q.error("[".concat(this.settings.tab_id,"] CRITICAL - 'data-sub-tab-id' attribute is missing or empty on the submitted form. Form:"),n[0]),void this.showNotice('Error: Could not save settings. Form configuration is missing "data-sub-tab-id".',"error");n.find('input[type="checkbox"]').each((function(t,e){var n=i.$(e),a=n.attr("name");a&&!n.is(":checked")&&(new RegExp("(^|&)".concat(encodeURIComponent(a).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"=")).test(r)||(r+="&".concat(encodeURIComponent(a),"=0")))})),r=r.replace(/^&+/,"").replace(/&&+/g,"&"),a.prop("disabled",!0),o.addClass("is-active");var d={action:"".concat(this.vtmConfig.ajaxActionPrefix,"_settings"),nonce:this.settings.nonce,form_data:r,sub_tab_id:s.trim(),main_tab_id:this.settings.tab_id};Q.log("[".concat(this.settings.tab_id,"] Sending AJAX with payload:"),d),f({url:this.settings.ajaxUrl,type:"POST",data:d}).then((function(t){Q.log("[".concat(i.settings.tab_id,"] AJAX success response:"),t);var n=t&&t.message||i.settings.i18n&&i.settings.i18n.saveSuccess||"Settings saved successfully.";i.showNotice(n,"success");var a=window.ProductEstimatorSettingsInstance;a&&"object"===e(a.formChangeTrackers)&&(a.formChangeTrackers[i.settings.tab_id]=!1,a.currentTab===i.settings.tab_id&&(a.formChanged=!1))})).catch((function(t){Q.error("[".concat(i.settings.tab_id,"] AJAX error response:"),t);var e=t&&t.message?t.message:i.settings.i18n&&i.settings.i18n.saveError||"Error saving settings.";i.showNotice(e,"error")})).finally((function(){a.prop("disabled",!1),o.removeClass("is-active"),Q.log("[".concat(i.settings.tab_id,"] AJAX request finalized."))}))}}])}(O);function J(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(J=function(){return!!t})()}function W(t,e,i,n){var a=V(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}var X=_("NotificationSettings"),H=function(e){function i(){var e,n,a,o;return t(this,i),n=this,o=[{mainTabId:"notifications",defaultSubTabId:"notifications-general",ajaxActionPrefix:"save_notifications",localizedDataName:"notificationSettings"}],a=k(a=i),(e=I(n,J()?Reflect.construct(a,o||[],k(n).constructor):a.apply(n,o))).mediaFrame=null,e}return M(i,e),a(i,[{key:"bindModuleSpecificEvents",value:function(){W(i,"bindModuleSpecificEvents",this,3)([]),this.$container&&this.$container.length&&(jQuery,this.$container.on("change","#enable_notifications",this.handleToggleAllNotifications.bind(this)),this.$container.on("change",'input[id^="notification_"][id$="_enabled"]',this.handleToggleSingleNotification.bind(this)),this.$container.on("click",".image-upload-button",this.handleImageUpload.bind(this)),this.$container.on("click",".image-remove-button",this.handleImageRemove.bind(this)),this.$container.on("change",'input[type="email"]',this.handleEmailValidation.bind(this)),X.log("NotificationSettingsModule specific events bound."))}},{key:"onMainTabActivated",value:function(){W(i,"onMainTabActivated",this,3)([]),this.setupDependentFieldsState(),this.setupNotificationEditors(),X.log("Notifications main tab activated - specific setup executed.")}},{key:"setupNotificationEditors",value:function(){this.$container&&this.localizedData&&X.log("Setting up rich text editors for notifications.")}},{key:"setupDependentFieldsState",value:function(){var t=this;this.$container&&this.$container.length&&(this.handleToggleAllNotifications(),this.$container.find('input[id^="notification_"][id$="_enabled"]').each((function(e,i){var n=jQuery(i);t.toggleSingleNotificationFields(n)})))}},{key:"handleToggleAllNotifications",value:function(){var t=this;if(this.$container&&this.$container.length){jQuery;var e=this.$container.find("#enable_notifications");if(e.length){var i=e.is(":checked"),n=this.$container.find(".pe-vtabs-nav-list, .vertical-tabs-nav"),a=this.$container.find('.pe-vtabs-tab-form[data-tab-id*="notification_type_"]');X.log("Global notifications toggle: ".concat(i)),i?(n.removeClass("pe-vtabs-nav-disabled"),this.$container.find('input[id^="notification_"][id$="_enabled"]').each((function(e,i){t.toggleSingleNotificationFields(jQuery(i))}))):(n.addClass("pe-vtabs-nav-disabled"),a.find("input, textarea, button, select").not(".save-settings").prop("disabled",!0),a.find(".wp-editor-area").each((function(){var t=tinyMCE.get(jQuery(this).attr("id"));t&&t.setMode("readonly")})))}else X.warn("#enable_notifications checkbox not found.")}}},{key:"handleToggleSingleNotification",value:function(t){this.toggleSingleNotificationFields(jQuery(t.currentTarget))}},{key:"toggleSingleNotificationFields",value:function(t){if(this.$container&&this.$container.length){var e=jQuery,i=t.is(":checked"),n=t.attr("id").replace("notification_","").replace("_enabled",""),a=this.$container.find('.pe-vtabs-tab-form[data-sub-tab-id="notification-type-'.concat(n,'"]'));if(a.length){var o=this.$container.find("#enable_notifications");!o.length||o.is(":checked")?(a.find("input, textarea, button, select").not(t).not(".save-settings").prop("disabled",!i),a.find(".wp-editor-area").each((function(){var t=tinyMCE.get(e(this).attr("id"));t&&t.setMode(i?"design":"readonly")}))):X.log("Global notifications are disabled, individual toggles have no effect on field state.")}else X.warn("Form for notification type ".concat(n," not found."))}}},{key:"handleImageUpload",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.currentTarget).data("field-id");if(this.mediaFrame)this.mediaFrame.off("select");else{if("undefined"==typeof wp||!wp.media)return void X.error("WordPress Media Library not available");this.mediaFrame=wp.media({title:this.localizedData.i18n.selectImage||"Select Image",button:{text:this.localizedData.i18n.useThisImage||"Use this image"},multiple:!1,library:{type:"image"}})}this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON(),n=e.$container.find("#".concat(i)),a=n.closest("td").find(".image-preview-wrapper"),o=n.closest("td").find(".image-remove-button");n.val(t.id).trigger("change"),a.html('<img src="'.concat(t.sizes.thumbnail?t.sizes.thumbnail.url:t.url,'" alt="Preview" />')),o.removeClass("hidden")})),this.mediaFrame.open()}},{key:"handleImageRemove",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget),i=e.data("field-id"),n=this.$container.find("#".concat(i)),a=n.closest("td").find(".image-preview-wrapper");n.val("").trigger("change"),a.empty(),e.addClass("hidden")}},{key:"handleEmailValidation",value:function(t){var e=jQuery(t.target);if(e.closest(this.$container).length){var i=e.val().trim(),n=this.localizedData&&this.localizedData.i18n||{};return i&&!p(i)?(this.showFieldError(e,n.validationErrorEmail||"Please enter a valid email address."),!1):(this.clearFieldError(e),!0)}}}])}(q);function G(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Y(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Y(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw o}}}}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function K(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function tt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tt=function(){return!!t})()}function et(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(et=function(){return!!t})()}function it(t,e,i,n){var a=V(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(){jQuery("#notifications").length&&(window.ProductEstimatorNotificationSettingsModule=new H)}));var nt=function(e){function i(){var e,n,a,o;return t(this,i),n=this,o=[{mainTabId:"product_additions",localizedDataName:"productAdditionsSettings"}],a=k(a=i),(e=I(n,et()?Reflect.construct(a,o||[],k(n).constructor):a.apply(n,o))).productSearchTimeout=null,e.$(document).on("admin_table_manager_ready_".concat(e.config.mainTabId),(function(){e.logger.log("Base AdminTableManager is ready. Initializing ProductAdditions specifics."),e._cacheProductAdditionsDOM(),e._bindSpecificEvents(),e._initializeSelect2(),e.logger.log("ProductAdditionsSettingsModule specific features initialized.")})),e.logger.log("ProductAdditionsSettingsModule constructor completed."),e}return M(i,e),a(i,[{key:"_cacheProductAdditionsDOM",value:function(){if(this.settings&&this.settings.selectors){var t=this.settings.selectors;this.dom.relationTypeSelect=this.$container.find(t.relationTypeSelect),this.dom.sourceCategorySelect=this.$container.find(t.sourceCategorySelect),this.dom.targetCategorySelect=this.$container.find(t.targetCategorySelect),this.dom.targetCategoryRow=this.$container.find(t.targetCategoryRow),this.dom.productSearchInput=this.$container.find(t.productSearchInput),this.dom.productSearchRow=this.$container.find(t.productSearchRow),this.dom.productSearchResults=this.$container.find(t.productSearchResults),this.dom.selectedProductIdInput=this.$container.find(t.selectedProductIdInput),this.dom.selectedProductDisplay=this.$container.find(t.selectedProductDisplay),this.dom.clearProductButton=this.$container.find(t.clearProductButton),this.dom.noteTextInput=this.$container.find(t.noteTextInput),this.dom.noteRow=this.$container.find(t.noteRow),this.logger.log("Product Additions specific DOM elements cached.")}else this.logger.warn("Cannot cache Product Additions specific DOM elements: this.settings.selectors not available.")}},{key:"_bindSpecificEvents",value:function(){var t,e,i,n;this.dom.form&&this.dom.form.length?(this.dom.form.on("click.productAdditions",".product-result-item",this._handleProductResultClick.bind(this)),null===(t=this.dom.relationTypeSelect)||void 0===t||t.on("change.productAdditions",this._handleRelationTypeChange.bind(this)),null===(e=this.dom.targetCategorySelect)||void 0===e||e.on("change.productAdditions",this._handleTargetCategoryChange.bind(this)),null===(i=this.dom.productSearchInput)||void 0===i||i.on("keyup.productAdditions",this._handleProductSearchKeyup.bind(this)),null===(n=this.dom.clearProductButton)||void 0===n||n.on("click.productAdditions",this._handleClearProduct.bind(this)),this.logger.log("Product Additions specific events bound.")):this.logger.error("ProductAdditions: Form DOM element not found, cannot bind specific events.")}},{key:"_initializeSelect2",value:function(){var t=this,e=function(e,i){e&&e.length&&t.$.fn.select2?e.select2({placeholder:i,width:"resolve",allowClear:!0,dropdownCssClass:"product-estimator-dropdown"}).val(null).trigger("change"):e&&!e.length?t.logger.warn("Select2 target element not found:",e.selector):e||t.logger.warn("Select2 target element is undefined (likely missing from DOM cache).")};setTimeout((function(){e(t.dom.sourceCategorySelect,t.settings.i18n&&t.settings.i18n.selectSourceCategories||"Select source categories"),e(t.dom.targetCategorySelect,t.settings.i18n&&t.settings.i18n.selectTargetCategory||"Select a category"),t.logger.log("Select2 components initialized for Product Additions.")}),100)}},{key:"onMainTabActivated",value:function(){it(i,"onMainTabActivated",this,3)([]),this.logger.log("Product Additions main tab activated."),this.dom.sourceCategorySelect&&this.dom.sourceCategorySelect.hasClass("select2-hidden-accessible")}},{key:"_handleRelationTypeChange",value:function(){var t,e,i,n,a,o,r,s=null===(t=this.dom.relationTypeSelect)||void 0===t?void 0:t.val();if(this.logger.log("Relation type changed to:",s),null===(e=this.dom.targetCategoryRow)||void 0===e||e.hide(),null===(i=this.dom.productSearchRow)||void 0===i||i.hide(),null===(n=this.dom.noteRow)||void 0===n||n.hide(),null===(a=this.dom.targetCategorySelect)||void 0===a||a.val(null).trigger("change.select2"),this._clearProductSelectionFields(),null===(o=this.dom.noteTextInput)||void 0===o||o.val(""),"auto_add_by_category"===s)null===(r=this.dom.targetCategoryRow)||void 0===r||r.show();else if("auto_add_note_by_category"===s){var d;null===(d=this.dom.noteRow)||void 0===d||d.show()}else if("suggest_products_by_category"===s){var c;this.settings.feature_flags&&this.settings.feature_flags.suggested_products_enabled?null===(c=this.dom.targetCategoryRow)||void 0===c||c.show():this.logger.warn("Suggest products feature is disabled, target category row for this type will not be shown.")}}},{key:"_handleTargetCategoryChange",value:function(){var t,e,i,n,a=null===(t=this.dom.targetCategorySelect)||void 0===t?void 0:t.val(),o=null===(e=this.dom.relationTypeSelect)||void 0===e?void 0:e.val();this.logger.log("Target category changed to:",a,"Action type:",o),this._clearProductSelectionFields(),a&&"auto_add_by_category"===o?null===(i=this.dom.productSearchRow)||void 0===i||i.show():null===(n=this.dom.productSearchRow)||void 0===n||n.hide()}},{key:"_clearProductSelectionFields",value:function(){var t,e,i,n;null===(t=this.dom.productSearchInput)||void 0===t||t.val(""),null===(e=this.dom.productSearchResults)||void 0===e||e.empty().hide(),null===(i=this.dom.selectedProductIdInput)||void 0===i||i.val(""),null===(n=this.dom.selectedProductDisplay)||void 0===n||n.hide().find(".selected-product-info").empty()}},{key:"_handleProductSearchKeyup",value:function(t){var e,i,n,a,o=this,r=(null===(e=this.$(t.target).val())||void 0===e?void 0:e.trim())||"",s=null===(i=this.dom.targetCategorySelect)||void 0===i?void 0:i.val();clearTimeout(this.productSearchTimeout),r.length<3||!s?null===(a=this.dom.productSearchResults)||void 0===a||a.empty().hide():(null===(n=this.dom.productSearchResults)||void 0===n||n.html("<p>".concat(this.settings.i18n&&this.settings.i18n.searching||"Searching...","</p>")).show(),this.productSearchTimeout=setTimeout((function(){o._searchProducts(r,s)}),500))}},{key:"_searchProducts",value:function(t,e){var i,n=this;if(this.logger.log("Searching products with term:",t,"in category:",e),!this.settings.actions||!this.settings.actions.search_products)return this.logger.error("Product search AJAX action not defined in settings.actions."),void(null===(i=this.dom.productSearchResults)||void 0===i||i.html("<p>".concat(this.settings.i18n&&this.settings.i18n.errorSearching||"Error: Search action not configured.","</p>")).show());f({url:this.settings.ajaxUrl,data:{action:this.settings.actions.search_products,nonce:this.settings.nonce,search:t,category:e}}).then((function(t){n.logger.log("Raw response from ajax.ajaxRequest for product search:",t);var e=null;if(t&&t.success&&t.data&&Array.isArray(t.data.products)?e=t.data.products:t&&Array.isArray(t.products)&&(e=t.products),e){var i;n.logger.log("Product data found. Processing products array.");var a="";e.length>0?(a='<ul class="product-results-list">',e.forEach((function(t){var e=n.$("<div>").text(t.name||"").html();a+='<li class="product-result-item" data-id="'.concat(t.id,'" data-name="').concat(e,'">').concat(e||"Unnamed Product"," (ID: ").concat(t.id,")</li>")})),a+="</ul>"):a="<p>".concat(n.settings.i18n&&n.settings.i18n.noProductsFound||"No products found","</p>"),null===(i=n.dom.productSearchResults)||void 0===i||i.html(a).show()}else{var o;n.logger.error("Product search failed or returned invalid/unexpected data structure:",t),null===(o=n.dom.productSearchResults)||void 0===o||o.html("<p>".concat(n.settings.i18n&&n.settings.i18n.errorSearching||"Error searching products","</p>")).show()}})).catch((function(t){var e;n.logger.error("Product search AJAX request failed:",t),null===(e=n.dom.productSearchResults)||void 0===e||e.html("<p>".concat(n.settings.i18n&&n.settings.i18n.errorSearching||"Error searching products","</p>")).show()}))}},{key:"_handleProductResultClick",value:function(t){var e,i,n,a,o,r=this.$(t.currentTarget),s=r.data("id"),d=r.data("name");this.logger.log("Product selected from search:",s,d),null===(e=this.dom.selectedProductIdInput)||void 0===e||e.val(s),null===(i=this.dom.selectedProductDisplay)||void 0===i||i.find(".selected-product-info").html("<strong>".concat(d,"</strong> (ID: ").concat(s,")")),null===(n=this.dom.selectedProductDisplay)||void 0===n||n.show(),null===(a=this.dom.productSearchInput)||void 0===a||a.val(""),null===(o=this.dom.productSearchResults)||void 0===o||o.empty().hide(),this.formModified=!0}},{key:"_handleClearProduct",value:function(){var t;this.logger.log("Clear product selection."),this._clearProductSelectionFields(),null===(t=this.dom.productSearchInput)||void 0===t||t.focus(),this.formModified=!0}},{key:"resetForm",value:function(){var t,e,n,a,o,r;it(i,"resetForm",this,3)([]),null===(t=this.dom.relationTypeSelect)||void 0===t||t.val("").trigger("change.productAdditions"),null===(e=this.dom.sourceCategorySelect)||void 0===e||e.val(null).trigger("change.select2"),this._clearProductSelectionFields(),null===(n=this.dom.noteTextInput)||void 0===n||n.val(""),null===(a=this.dom.targetCategoryRow)||void 0===a||a.hide(),null===(o=this.dom.productSearchRow)||void 0===o||o.hide(),null===(r=this.dom.noteRow)||void 0===r||r.hide(),this.logger.log("Product Additions form fields specifically reset.")}},{key:"populateFormWithData",value:function(t){var e,n=this;it(i,"populateFormWithData",this,3)([t]),this.logger.log("Populating Product Additions form with full item data:",t);var a=t.relation_type||"",o=t.source_category||[],r=t.target_category||"",s=t.product_id||"",d=t.note_text||"";null===(e=this.dom.relationTypeSelect)||void 0===e||e.val(a).trigger("change.productAdditions"),setTimeout((function(){var e,i;if(null===(e=n.dom.sourceCategorySelect)||void 0===e||e.val(o).trigger("change.select2"),"auto_add_by_category"===a){if(null===(i=n.dom.targetCategorySelect)||void 0===i||i.val(r).trigger("change.select2"),s&&t.product_name){var c,l,u;null===(c=n.dom.selectedProductIdInput)||void 0===c||c.val(s);var g=n.$("<div>").text(t.product_name).html();null===(l=n.dom.selectedProductDisplay)||void 0===l||l.find(".selected-product-info").html("<strong>".concat(g,"</strong> (ID: ").concat(s,")")),null===(u=n.dom.selectedProductDisplay)||void 0===u||u.show()}else if(s){var h,f,m;n.logger.warn("Product ID present but product_name missing in data for edit form population."),null===(h=n.dom.selectedProductIdInput)||void 0===h||h.val(s),null===(f=n.dom.selectedProductDisplay)||void 0===f||f.find(".selected-product-info").html("Product ID: ".concat(s," (Name not available)")),null===(m=n.dom.selectedProductDisplay)||void 0===m||m.show()}}else if("suggest_products_by_category"===a){var p;n.settings.feature_flags&&n.settings.feature_flags.suggested_products_enabled&&(null===(p=n.dom.targetCategorySelect)||void 0===p||p.val(r).trigger("change.select2"))}else if("auto_add_note_by_category"===a){var v;null===(v=n.dom.noteTextInput)||void 0===v||v.val(d)}n.formModified=!1}),150)}},{key:"validateForm",value:function(){var t,e,n,a,o,r,s,d=it(i,"validateForm",this,3)([]);this.logger.log("Validating Product Additions form.");var c,l,u=null===(t=this.dom.relationTypeSelect)||void 0===t?void 0:t.val(),g=null===(e=this.dom.sourceCategorySelect)||void 0===e?void 0:e.val(),h=null===(n=this.dom.targetCategorySelect)||void 0===n?void 0:n.val(),f=null===(a=this.dom.selectedProductIdInput)||void 0===a?void 0:a.val(),m=(null===(o=this.dom.noteTextInput)||void 0===o||null===(o=o.val())||void 0===o?void 0:o.trim())||"",p=this.settings.i18n||{};if(this.clearFieldError(this.dom.relationTypeSelect),this.clearFieldError(null===(r=this.dom.sourceCategorySelect)||void 0===r?void 0:r.next(".select2-container")),this.clearFieldError(null===(s=this.dom.targetCategorySelect)||void 0===s?void 0:s.next(".select2-container")),this.clearFieldError(this.dom.productSearchInput),this.clearFieldError(this.dom.noteTextInput),u||(this.showFieldError(this.dom.relationTypeSelect,p.selectAction||"Please select an action type."),d=!1),g&&0!==g.length||(this.showFieldError(null===(c=this.dom.sourceCategorySelect)||void 0===c?void 0:c.next(".select2-container"),p.selectSourceCategories||"Please select source categories."),d=!1),"auto_add_by_category"===u){if(h||(this.showFieldError(null===(l=this.dom.targetCategorySelect)||void 0===l?void 0:l.next(".select2-container"),p.selectTargetCategory||"Please select a target category."),d=!1),!f){var v,b=null!==(v=this.dom.selectedProductDisplay)&&void 0!==v&&v.is(":visible")?this.dom.selectedProductDisplay:this.dom.productSearchInput;this.showFieldError(b,p.selectProduct||"Please select a product."),d=!1}}else if("suggest_products_by_category"===u){var w;this.settings.feature_flags&&this.settings.feature_flags.suggested_products_enabled&&(h||(this.showFieldError(null===(w=this.dom.targetCategorySelect)||void 0===w?void 0:w.next(".select2-container"),p.selectTargetCategory||"Please select a target category."),d=!1))}else"auto_add_note_by_category"===u&&(m||(this.showFieldError(this.dom.noteTextInput,p.noteTextRequired||"Note text is required."),d=!1));return this.logger.log("Product Additions form validation result:",d),d}},{key:"populateColumn_source_categories",value:function(t,e){t.text(e.source_category_display||"N/A")}},{key:"populateColumn_action_type",value:function(t,e){var i=this.$("<span></span>").addClass("relation-type pe-relation-".concat(e.relation_type||"unknown")).text(e.action_type_display||e.relation_type||"N/A");t.append(i)}},{key:"populateColumn_target_details",value:function(t,e){t.text(e.target_details_display||"N/A")}},{key:"bindCustomActionButtons",value:function(){this.dom.listTableBody&&this.dom.listTableBody.length&&(this.dom.listTableBody.on("click.productAdditions",".pe-view-product-button",this.handleViewProduct.bind(this)),this.logger.log("Product Additions custom action buttons bound"))}},{key:"handleViewProduct",value:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.data("id"),n=e.data("product-id");if(this.logger.log("View Product button clicked for item ID:",i,"Product ID:",n),n){var a=window.ajaxurl?window.ajaxurl.replace("admin-ajax.php",""):"/wp-admin/",o="".concat(a,"post.php?post=").concat(n,"&action=edit");window.open(o,"_blank")}else this.showNotice("Error: Could not determine the product to view.","error")}}])}(function(i){function n(e){var i;t(this,n);var a,o,r,s=K(K({},e),{},{defaultSubTabId:e.mainTabId+"-atm-default-subcontent",ajaxActionPrefix:"atm_form_save_".concat(e.mainTabId)});a=this,r=[s],o=k(o=n),(i=I(a,tt()?Reflect.construct(o,r||[],k(a).constructor):o.apply(a,r))).$=jQuery,i.config=e;var d="AdminTableManager:".concat(e.mainTabId||"Generic");return i.logger=_(d),i.logger=_("".concat(e.mainTabId||"Generic")),i.settings&&i.settings.tab_id||i.logger.error("AdminTableManager Critical Error: this.settings.tab_id (mainTabId) is missing after super() call. This indicates a problem with config propagation or parent constructor.",{passedConfigToVTM:s,effectiveSettings:i.settings}),i.formModified=!1,i.isEditMode=!1,i.currentItemId=null,i}return M(n,i),a(n,[{key:"_validateSettings",value:function(){if(!this.settings||void 0===this.settings.tab_id)throw this.logger.error("AdminTableManager Critical Error: this.settings or this.settings.tab_id is undefined. This usually means ProductEstimatorSettings/VerticalTabbedModule constructor failed to initialize it. Config used by AdminTableManager:",{vtmConfigUsedForSuper:this.vtmConfig}),new Error("AdminTableManager: Essential property 'this.settings.tab_id' was not initialized by the parent class. Cannot validate settings.");if(0===Object.keys(this.settings).length){var t="AdminTableManager: Settings (this.settings) is an empty object";throw this.settingsObjectName&&(t+=" (expected from window.".concat(this.settingsObjectName,"). This might happen if the global object is empty or not correctly populated.")),this.logger.error(t),new Error(t+' Cannot proceed with empty settings for tab "'.concat(this.settings.tab_id,'".'))}var e=!0;if(void 0===this.settings.ajaxUrl&&(this.logger.error("Missing required setting: ajaxUrl"),e=!1),void 0===this.settings.nonce&&(this.logger.error("Missing required setting: nonce"),e=!1),void 0===this.settings.option_name&&(this.logger.error("Missing required setting: option_name"),e=!1),this.settings.actions){var i,n=G(["add_item","update_item","delete_item"]);try{for(n.s();!(i=n.n()).done;){var a=i.value;void 0===this.settings.actions[a]&&(this.logger.error("Missing required action: actions.".concat(a," (expected in ").concat(this.settingsObjectName,') for tab "').concat(this.settings.tab_id,'"')),e=!1)}}catch(t){n.e(t)}finally{n.f()}}else this.logger.error("Required setting object 'actions' is missing from settings for tab \"".concat(this.settings.tab_id,'".')),e=!1;if(this.settings.selectors){var o,r=G(["formContainer","form","addButton","listTableBody","editButton","deleteButton","idInput","saveButton","cancelButton","noItemsMessage","formTitle","listItemRow","listTableContainer","listTable"]);try{for(r.s();!(o=r.n()).done;){var s=o.value;void 0===this.settings.selectors[s]&&(this.logger.error("Missing required selector: selectors.".concat(s," (expected in ").concat(this.settingsObjectName,') for tab "').concat(this.settings.tab_id,'"')),e=!1)}}catch(t){r.e(t)}finally{r.f()}}else this.logger.error("Required setting object 'selectors' is missing from settings for tab \"".concat(this.settings.tab_id,'".')),e=!1;if(this.settings.i18n){var d,c=G(["confirmDelete","itemSavedSuccess","itemDeletedSuccess","errorSavingItem","errorDeletingItem","addItemButtonLabel","editItemFormTitle","saving","deleting","editButtonLabel","deleteButtonLabel"]);try{for(c.s();!(d=c.n()).done;){var l=d.value;void 0===this.settings.i18n[l]&&this.logger.warn("Potentially missing i18n string: i18n.".concat(l," (in ").concat(this.settingsObjectName,') for tab "').concat(this.settings.tab_id,'"'))}}catch(t){c.e(t)}finally{c.f()}}else this.logger.error("Required setting object 'i18n' is missing from settings for tab \"".concat(this.settings.tab_id,'".')),e=!1;if(!e)throw new Error('AdminTableManager: Settings validation failed due to missing critical settings in this.settings for tab "'.concat(this.settings.tab_id,'". Check console for details.'));this.logger.log("Settings (this.settings) validated successfully for tab:",this.settings.tab_id)}},{key:"moduleInit",value:function(){var t,e,i;if((t=n,e=this,"function"==typeof(i=V(k(1&3?t.prototype:t),"moduleInit",e))?function(t){return i.apply(e,t)}:i)([]),this.logger.log("AdminTableManager: Overridden moduleInit() called for tab:",this.settings.tab_id),!this.$container||!this.$container.length)return this.logger.error("AdminTableManager: Main container #".concat(this.settings.tab_id," not found after super.moduleInit(). Module will not initialize further.")),void(window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Critical error: Table manager UI container #".concat(this.settings.tab_id," missing."),"error"));try{this._validateSettings()}catch(t){return this.logger.error('AdminTableManager: Settings validation failed for tab "'.concat(this.settings.tab_id,'". Halting init.'),t),void(window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Error initializing table manager for ".concat(this.settings.tab_id,": Configuration validation failed. Check console. Details: ").concat(t.message),"error"))}if(this.cacheDOM(),this._checkEssentialDOM())this.bindEvents(),this.updateNoItemsMessageVisibility(),this.logger.log("AdminTableManager specific setup completed for tab:",this.settings.tab_id),this.$(document).trigger("admin_table_manager_ready_".concat(this.settings.tab_id),[this]);else if(this.logger.error("AdminTableManager initialization failed: missing essential DOM elements for tab:",this.settings.tab_id),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice){var a=this.settings.tab_id;window.ProductEstimatorSettingsInstance.showNotice("Error initializing UI components for ".concat(a,". Some parts may not work. Check console for missing DOM elements."),"error")}}},{key:"_checkEssentialDOM",value:function(){var t=!0;if(!this.settings||!this.settings.selectors)return this.logger.error("AdminTableManager _checkEssentialDOM: Invariant violated - this.settings or this.settings.selectors missing after _validateSettings."),!1;for(var e=0,i=["formContainer","form","addButton","listTableBody","listTableContainer","listTable","noItemsMessage","formTitle","idInput","saveButton","cancelButton"];e<i.length;e++){var n=i[e];this.dom[n]&&this.dom[n].length||(this.logger.error("Essential DOM element for AdminTableManager not found using selector key '".concat(n,"': Expected selector string was \"").concat(this.settings.selectors[n],'" within container #').concat(this.settings.tab_id,".")),t=!1)}return t}},{key:"cacheDOM",value:function(){if(this.dom={},this.settings&&this.settings.selectors){if(this.$container&&this.$container.length)for(var t in this.settings.selectors)Object.prototype.hasOwnProperty.call(this.settings.selectors,t)&&(this.dom[t]=this.$container.find(this.settings.selectors[t]));else this.logger.error("AdminTableManager cacheDOM: this.$container is not available or empty. DOM elements cannot be cached.");this.logger.log("DOM elements cached for tab:",this.settings.tab_id)}else this.logger.error("AdminTableManager cacheDOM: Invariant violated - this.settings or this.settings.selectors missing after _validateSettings.")}},{key:"bindEvents",value:function(){var t,e,i,n,a,o,r=this;if(this.dom&&0!==Object.keys(this.dom).length){null===(t=this.dom.addButton)||void 0===t||t.on("click.adminTableManager",this.handleAddNew.bind(this));var s=null===(e=this.settings.selectors)||void 0===e?void 0:e.editButton,d=null===(i=this.settings.selectors)||void 0===i?void 0:i.deleteButton;this.dom.listTableBody&&this.dom.listTableBody.length?(s?this.dom.listTableBody.on("click.adminTableManager",s,this.handleEdit.bind(this)):this.logger.warn("Edit button selector (settings.selectors.editButton) is undefined. Skipping bind for edit."),d?this.dom.listTableBody.on("click.adminTableManager",d,this.handleDelete.bind(this)):this.logger.warn("Delete button selector (settings.selectors.deleteButton) is undefined. Skipping bind for delete."),this.bindCustomActionButtons()):this.logger.warn("listTableBody DOM element not found for tab:",this.settings.tab_id,"- Edit/delete events for items not bound."),null===(n=this.dom.form)||void 0===n||n.on("submit.adminTableManager",this.handleSubmit.bind(this)),null===(a=this.dom.cancelButton)||void 0===a||a.on("click.adminTableManager",this.handleCancel.bind(this)),null===(o=this.dom.form)||void 0===o||o.on("change.adminTableManager input.adminTableManager",":input",(function(){r.formModified=!0})),this.logger.log("AdminTableManager common events bound for tab:",this.settings.tab_id)}else this.logger.error("AdminTableManager bindEvents: DOM elements not cached (this.dom is empty/undefined). Cannot bind events.")}},{key:"bindCustomActionButtons",value:function(){}},{key:"handleAddNew",value:function(t){var e,i,n,a;t.preventDefault(),this.logger.log("Add New clicked for tab:",this.settings.tab_id),this.isEditMode=!1,this.currentItemId=null,this.resetForm(),null===(e=this.dom.formTitle)||void 0===e||e.text(this.settings.i18n.addItemFormTitle||"Add New Item"),null===(i=this.dom.saveButton)||void 0===i||i.text(this.settings.i18n.addItemButtonLabel||this.settings.i18n.saveChangesButton||"Save Item"),null===(n=this.dom.formContainer)||void 0===n||n.slideDown(),null===(a=this.dom.addButton)||void 0===a||a.hide()}},{key:"handleEdit",value:function(t){var i,n,a=this;t.preventDefault();var o=this.$(t.currentTarget),r=o.closest(this.settings.selectors.listItemRow).data("id");if(this.logger.log("Edit clicked for item ID:",r,"on tab:",this.settings.tab_id),!r)return this.logger.error("Could not find item ID for editing on tab:",this.settings.tab_id),void this.showNotice("Error: Could not determine the item to edit.","error");if(this.isEditMode=!0,this.currentItemId=r,this.resetForm(),this.dom.idInput&&this.dom.idInput.length?this.dom.idInput.val(this.currentItemId):this.logger.warn("Hidden ID input (dom.idInput) not found in form. Item ID might not be set correctly for submission during edit."),null===(i=this.dom.formTitle)||void 0===i||i.text(this.settings.i18n.editItemFormTitle||"Edit Item #".concat(r)),null===(n=this.dom.saveButton)||void 0===n||n.text(this.settings.i18n.updateChangesButton||"Update Item"),this.settings.actions&&this.settings.actions.get_item)this.showFormLoadingSpinner(!0,this.dom.saveButton),f({url:this.settings.ajaxUrl,data:{action:this.settings.actions.get_item,nonce:this.settings.nonce,item_id:r,option_name:this.settings.option_name,tab_id:this.settings.tab_id}}).then((function(t){if(t&&t.item&&"object"===e(t.item)){var i,n;a.populateFormWithData(t.item),null===(i=a.dom.formContainer)||void 0===i||i.slideDown(),null===(n=a.dom.addButton)||void 0===n||n.hide()}else{var o=t&&t.message?t.message:a.settings.i18n.errorLoadingItem||"Error loading item details.";a.showNotice(o,"error"),a.logger.error("Error loading item details for edit:",t)}})).catch((function(t){a.showNotice(t.message||a.settings.i18n.errorLoadingItem||"AJAX error loading item.","error"),a.logger.error("AJAX error loading item for editing:",t)})).finally((function(){a.showFormLoadingSpinner(!1,a.dom.saveButton)}));else{var s,d;this.logger.warn("No 'get_item' action defined in settings.actions for tab \"".concat(this.settings.tab_id,'".'));var c=o.data();Object.keys(c).length>1?(c.id=r,this.populateFormWithData(c)):(this.logger.log("Button data attributes did not yield sufficient data for form population."),this.showNotice("Note: Full item details might not be loaded. Displaying basic form for editing.","info")),null===(s=this.dom.formContainer)||void 0===s||s.slideDown(),null===(d=this.dom.addButton)||void 0===d||d.hide()}}},{key:"handleDelete",value:function(t){var e=this;t.preventDefault();var i=this.$(t.currentTarget),n=i.closest(this.settings.selectors.listItemRow),a=n.data("id");if(this.logger.log("Delete clicked for item ID:",a,"on tab:",this.settings.tab_id),!a)return this.logger.error("Could not find item ID for deletion on tab:",this.settings.tab_id),void this.showNotice("Error: Could not determine item to delete.","error");if(confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this item?")){var o=i.text();i.prop("disabled",!0).text(this.settings.i18n.deleting||"Deleting..."),f({url:this.settings.ajaxUrl,data:{action:this.settings.actions.delete_item,nonce:this.settings.nonce,item_id:a,option_name:this.settings.option_name,tab_id:this.settings.tab_id}}).then((function(t){t&&(!0===t.success||t.itemId&&t.message)?(e.showNotice(t.data&&t.data.message||t.message||e.settings.i18n.itemDeletedSuccess||"Item deleted.","success"),n.fadeOut(300,(function(){n.remove(),e.updateNoItemsMessageVisibility()}))):(e.showNotice(t&&t.message||t&&t.data&&t.data.message||e.settings.i18n.errorDeletingItem||"Error deleting item.","error"),i.prop("disabled",!1).text(o))})).catch((function(t){e.showNotice(t.message||e.settings.i18n.errorDeletingItem||"AJAX error deleting item.","error"),e.logger.error("AJAX error deleting item:",t),i.prop("disabled",!1).text(o)}))}}},{key:"handleSubmit",value:function(t){var e=this;if(t.preventDefault(),this.logger.log("Form submitted. Edit mode:",this.isEditMode,"Current Item ID:",this.currentItemId),!this.validateForm())return this.logger.warn("Form validation failed for tab:",this.settings.tab_id),void this.showNotice(this.settings.i18n.validationFailed||"Please correct the errors in the form.","error");this.showFormLoadingSpinner(!0,this.dom.saveButton);var i=this.isEditMode?this.settings.actions.update_item:this.settings.actions.add_item;if(!i)return this.logger.error("Form submission action (add_item or update_item) is not defined in settings.actions for tab:",this.settings.tab_id),this.showNotice(this.settings.i18n.errorSavingItem||"Configuration error: Save action not defined.","error"),void this.showFormLoadingSpinner(!1,this.dom.saveButton);var n={action:i,nonce:this.settings.nonce,option_name:this.settings.option_name,tab_id:this.settings.tab_id,item_data:{}};this.dom.form.serializeArray().forEach((function(t){var e=t.name,i=t.value;if(e.endsWith("[]")){var a=e.slice(0,-2);n.item_data[a]||(n.item_data[a]=[]),n.item_data[a].push(i)}else n.item_data[e]=i})),this.isEditMode&&this.currentItemId&&(n.item_id=this.currentItemId),this.logger.log("AJAX data payload for save:",n),f({url:this.settings.ajaxUrl,data:n}).then((function(t){if(e.logger.log("AJAX save response received:",t),t&&t.item){var i,n;e.showNotice(t.message||e.settings.i18n.itemSavedSuccess||"Item saved.","success"),e.isEditMode?e.updateTableRow(t.item):e.addTableRow(t.item),null===(i=e.dom.formContainer)||void 0===i||i.slideUp(),null===(n=e.dom.addButton)||void 0===n||n.show(),e.resetForm(),e.isEditMode=!1,e.currentItemId=null,e.updateNoItemsMessageVisibility(),e.formModified=!1}else{var a=t&&t.message?t.message:e.settings.i18n.errorSavingItem||"Error saving item or response format incorrect.",o=t&&t.errors?"<br><pre>".concat(JSON.stringify(t.errors,null,2),"</pre>"):"";e.showNotice(a+o,"error"),e.logger.error("Error saving item or item data missing/invalid in response structure:",t)}})).catch((function(t){var i=t.message||e.settings.i18n.errorSavingItem||"AJAX error during save.";e.showNotice(i,"error"),e.logger.error("AJAX error during save operation:",t)})).finally((function(){e.showFormLoadingSpinner(!1,e.dom.saveButton)}))}},{key:"handleCancel",value:function(t){var e,i;t.preventDefault(),this.logger.log("Cancel form clicked for tab:",this.settings.tab_id),this.formModified&&!confirm(this.settings.i18n.confirmCancelEditing||"You have unsaved changes. Are you sure you want to cancel?")||(null===(e=this.dom.formContainer)||void 0===e||e.slideUp(),null===(i=this.dom.addButton)||void 0===i||i.show(),this.resetForm(),this.isEditMode=!1,this.currentItemId=null,this.formModified=!1)}},{key:"resetForm",value:function(){var t,e,i;null===(t=this.dom.form[0])||void 0===t||t.reset(),this.dom.idInput&&this.dom.idInput.length&&this.dom.idInput.val(""),this.formModified=!1,null===(e=this.dom.form)||void 0===e||e.find(".error").removeClass("error"),null===(i=this.dom.form)||void 0===i||i.find(".field-error").remove(),this.logger.log("Form reset for tab:",this.settings.tab_id)}},{key:"populateFormWithData",value:function(t){this.logger.log("Populating form with data (base method) for tab:",this.settings.tab_id,"Item Data:",t),t&&t.id?this.dom.idInput&&this.dom.idInput.length?this.dom.idInput.val(t.id):this.logger.warn("AdminTableManager: dom.idInput (hidden item ID field) not found during populateFormWithData."):this.logger.warn("AdminTableManager: populateFormWithData called without itemData or itemData.id. Hidden ID field not populated.",t),this.formModified=!1}},{key:"validateForm",value:function(){var t,e,i,n=this;this.logger.log("Validating form (base method) for tab:",this.settings.tab_id);var a=!0;return null===(t=this.dom.form)||void 0===t||t.find(".error").removeClass("error"),null===(e=this.dom.form)||void 0===e||e.find(".field-error").remove(),null===(i=this.dom.form)||void 0===i||i.find('[data-is-required="true"], .is-required').each((function(t,e){var i=n.$(e),o=i.val();i.is(":checkbox")?i.is(":checked")||(n.showFieldError(i.closest("label").length?i.closest("label"):i,n.settings.i18n.fieldRequired||"This field must be checked."),a=!1):("string"==typeof o&&(o=o.trim()),(null==o||""===o||i.is("select")&&!o)&&(n.showFieldError(i,n.settings.i18n.fieldRequired||"This field is required."),a=!1))})),a}},{key:"addTableRow",value:function(t){this.logger.log("Adding table row for tab:",this.settings.tab_id,t);var e=this.createTableRow(t);e&&this.dom.listTableBody&&this.dom.listTableBody.length?(this.dom.listTableBody.append(e),this.updateNoItemsMessageVisibility()):this.logger.error("Failed to add table row: createTableRow returned invalid value or listTableBody not found for tab:",this.settings.tab_id)}},{key:"updateTableRow",value:function(t){var e;if(this.logger.log("Updating table row for tab:",this.settings.tab_id,t),t.id)if(this.settings.selectors&&this.settings.selectors.listItemRow){var i=null===(e=this.dom.listTableBody)||void 0===e?void 0:e.find("".concat(this.settings.selectors.listItemRow,'[data-id="').concat(t.id,'"]'));if(i&&i.length){var n=this.createTableRow(t);n?i.replaceWith(n):this.logger.error("Failed to update table row: createTableRow returned null for tab:",this.settings.tab_id)}else this.logger.warn("Could not find row to update with ID:",t.id,"- Appending as new for tab:",this.settings.tab_id),this.addTableRow(t)}else this.logger.error("Cannot update table row: listItemRow selector missing in settings.selectors.");else this.logger.error("Cannot update table row: itemData missing ID for tab:",this.settings.tab_id,t)}},{key:"createTableRow",value:function(t){var e=this;if(this.logger.log("AdminTableManager: Creating table row with data:",t),!t||!t.id){var i;this.logger.error("Cannot create table row: itemData or itemData.id is missing.");var n=(null===(i=this.dom.listTable)||void 0===i?void 0:i.find("thead th").length)||4;return this.$('<tr><td colspan="'.concat(n,'">Error: Invalid item data provided to createTableRow.</td></tr>'))}var a=this.settings.table_columns||{};if(0===Object.keys(a).length){var o;this.logger.error("Table columns data is missing in settings. Settings must include table_columns data.");var s=(null===(o=this.dom.listTable)||void 0===o?void 0:o.find("thead th").length)||4;return this.$('<tr><td colspan="'.concat(s,'">Error: table_columns data missing in settings for ').concat(this.settings.tab_id,".</td></tr>"))}var d=this.settings.selectors||{},c=d.listItemRow||"tr",l=(d.editButton||".pe-edit-item-button").replace(/^\./,""),u=(d.deleteButton||".pe-delete-item-button").replace(/^\./,""),g=this.settings.i18n||{},h=this.$("<".concat(c.split(".")[0],' data-id="').concat(t.id,'"></').concat(c.split(".")[0],">"));return c.includes(".")&&h.addClass(c.substring(c.indexOf(".")+1).replace(/\./g," ")),Object.entries(a).forEach((function(i){var n=r(i,2),a=n[0],o=n[1],s=e.$("<td></td>").addClass("column-".concat(a)).attr("data-colname",o),d="populateColumn_".concat(a.replace(/[^a-zA-Z0-9_]/g,"_"));if("function"==typeof e[d])e[d](s,t,a);else if("item_actions"===a||a.endsWith("_actions")){s.addClass("actions");var c=e.$("<button></button>").attr("type","button").addClass("button button-small ".concat(l)).text(g.editButtonLabel||"Edit").data("id",t.id),f=e.$("<button></button>").attr("type","button").addClass("button button-small ".concat(u)).text(g.deleteButtonLabel||"Delete").data("id",t.id);s.append(c," ",f)}else{var m="".concat(a,"_display");s.text(t[m]||t[a]||"")}h.append(s)})),"function"==typeof this.afterRowCreated&&this.afterRowCreated(h,t),h}},{key:"updateNoItemsMessageVisibility",value:function(){if(this.settings.selectors&&this.settings.selectors.listItemRow)if(this.dom.noItemsMessage&&this.dom.noItemsMessage.length&&this.dom.listTableBody&&this.dom.listTable){var t=this.dom.listTableBody.find(this.settings.selectors.listItemRow).length>0;t?(this.dom.noItemsMessage.hide(),this.dom.listTable.show()):(this.dom.noItemsMessage.show(),this.dom.listTable.hide()),this.logger.log('"No items" message visibility updated for tab:',this.settings.tab_id,"Has items:",t)}else this.logger.warn('Cannot update "no items" message visibility: one or more DOM elements (noItemsMessage, listTableBody, listTable) are missing for tab:',this.settings.tab_id);else this.logger.warn('Cannot update "no items" message: listItemRow selector missing in settings.selectors.')}},{key:"showFormLoadingSpinner",value:function(t,e){var i=e||this.dom.saveButton;if(i&&i.length){var n="original-text",a=this.settings.i18n&&this.settings.i18n.saving||"Saving...";if(t){if(i.prop("disabled",!0).addClass("pe-loading"),!i.data(n)){var o=i.is("input, textarea, select")?i.val():i.text();i.data(n,o)}i.is("input, textarea, select")?i.val(a):i.text(a)}else if(i.prop("disabled",!1).removeClass("pe-loading"),i.data(n)){var r=i.data(n);i.is("input, textarea, select")?i.val(r):i.text(r),i.removeData(n)}}}}])}(q));function at(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(at=function(){return!!t})()}function ot(t,e,i,n){var a=V(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(t){var e="product_additions",i="productAdditionsSettings";if(t("#".concat(e)).length)if(window[i]){if(!window.ProductAdditionsSettingsModuleInstance)try{window.ProductAdditionsSettingsModuleInstance=new nt,_("ProductAdditionsInit").log("ProductAdditionsSettingsModule instance initiated.")}catch(t){_("ProductAdditionsInit").error("Error instantiating ProductAdditionsSettingsModule:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Product Additions settings. Check console for errors.","error")}}else _("ProductAdditionsInit").error('Localized data object "'.concat(i,'" not found for tab: ').concat(e,". Module cannot be initialized.")),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice('Configuration data for Product Additions ("'.concat(i,'") is missing. Module disabled.'),"error");else _("ProductAdditionsInit").warn("Main container #".concat(e," not found. ProductAdditionsSettingsModule will not be initialized."))}));var rt=_("LabelSettings"),st=function(e){function i(){var e,n,a,o;return t(this,i),n=this,o=[{mainTabId:"labels",defaultSubTabId:"labels-general",ajaxActionPrefix:"save_labels",localizedDataName:"labelsSettings"}],a=k(a=i),e=I(n,at()?Reflect.construct(a,o||[],k(n).constructor):a.apply(n,o)),rt.log("LabelSettingsModule instance created."),e}return M(i,e),a(i,[{key:"bindModuleSpecificEvents",value:function(){ot(i,"bindModuleSpecificEvents",this,3)([]),this.$container&&this.$container.length?rt.log("LabelSettingsModule specific events bound (if any)."):rt.warn("LabelSettingsModule: $container not available in bindModuleSpecificEvents.")}},{key:"onMainTabActivated",value:function(){ot(i,"onMainTabActivated",this,3)([]),rt.log("Labels main tab activated - specific setup can go here.")}}])}(q);function dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(dt=function(){return!!t})()}jQuery(document).ready((function(t){if(t("#labels").length){if(!window.ProductEstimatorLabelSettingsModuleInstance)try{window.ProductEstimatorLabelSettingsModuleInstance=new st,rt.log("LabelSettingsModule instance successfully created and assigned to window.")}catch(t){rt.error("Error instantiating LabelSettingsModule:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Label Settings. Check console for errors.","error")}}else rt.warn("Main container #labels not found. LabelSettingsModule will not be initialized.")}));var ct=_("FeatureSwitchesSettingsModule"),lt=function(e){function i(){return t(this,i),e=this,a=[{isModule:!0,settingsObjectName:"featureSwitchesSettings",defaultTabId:"feature_switches"}],n=k(n=i),I(e,dt()?Reflect.construct(n,a||[],k(e).constructor):n.apply(e,a));var e,n,a}return M(i,e),a(i,[{key:"moduleInit",value:function(){ct.log("Initializing Feature Switches Settings Module"),this.bindEvents()}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this))}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&ct.log("Feature Switches tab activated"),this.clearSubTabFromUrl()}}])}(O);jQuery(document).ready((function(){jQuery("#feature_switches").length&&(window.FeatureSwitchesSettingsModuleInstance=new lt)}));var ut=_("ProductUpgradesSettings"),gt=function(){return a((function e(){var i=this;t(this,e),$=jQuery;var n=window.productUpgradesSettings||{};this.settings={ajaxUrl:n.ajaxUrl||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:n.nonce||"",i18n:n.i18n||{},tab_id:n.tab_id||"product_upgrades"},this.formModified=!1,$(document).ready((function(){var t=window.productUpgradesSettings||{};t.nonce&&(i.settings.nonce=t.nonce),i.init()}))}),[{key:"init",value:function(){ut.log("Initializing Product Upgrades Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initUpgradeHandlers(),e("#product-upgrade-form").on("change input","input, select, textarea",(function(){t.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initUpgradeHandlers",value:function(){var t=jQuery,e=(t(".product-estimator-upgrades"),t("#product-upgrade-form")),i=t(".product-upgrades-form"),n=t(".add-new-upgrade");t("#base_categories").select2({placeholder:"Select base categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),t("#upgrade_categories").select2({placeholder:"Select upgrade categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),n.on("click",function(){ut.log("Add New Upgrade Configuration button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Upgrade Configuration"),t(".save-upgrade").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),e.on("submit",this.handleFormSubmission.bind(this)),t(".product-upgrades-list").on("click",".edit-upgrade",this.handleEditUpgrade.bind(this)),t(".product-upgrades-list").on("click",".delete-upgrade",this.handleDeleteUpgrade.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)));var i=new URL(window.location.href);i.searchParams.delete("sub_tab"),window.history.replaceState({},"",i)}},{key:"resetForm",value:function(){var t=jQuery;t("#product-upgrade-form")[0].reset(),t("#upgrade_id").val(""),t("#base_categories").val(null).trigger("change"),t("#upgrade_categories").val(null).trigger("change"),t("#display_mode").val("dropdown").trigger("change"),t("#upgrade_title").val(""),t("#upgrade_description").val(""),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#product-upgrade-form"),n=i.find(".save-upgrade"),a=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!t),n.prop("disabled",!t),a.prop("disabled",!t),t?n.text(e("#upgrade_id").val()?"Update Configuration":"Save Configuration"):n.text("Saving..."),t?(e("#base_categories").prop("disabled",!1).trigger("change"),e("#upgrade_categories").prop("disabled",!1).trigger("change")):(e("#base_categories").prop("disabled",!0).trigger("change"),e("#upgrade_categories").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,n=i("#base_categories").val(),a=i("#upgrade_categories").val(),o=i("#display_mode").val(),r=i("#upgrade_title").val(),s=i("#upgrade_description").val();if(n&&0!==n.length)if(a&&0!==a.length){this.toggleFormState(!1);var d={action:"save_product_upgrade",nonce:this.settings.nonce,upgrade_id:i("#upgrade_id").val(),base_categories:n,upgrade_categories:a,display_mode:o,upgrade_title:r,upgrade_description:s};ut.log("Sending form data:",d),f({url:this.settings.ajaxUrl,data:d}).then((function(t){if(ut.log("Response received:",t),e.showMessage("success",t.message),d.upgrade_id){ut.log("Updating existing upgrade:",d.upgrade_id);var n=i(".product-upgrades-list").find('tr[data-id="'.concat(d.upgrade_id,'"]'));n.length?n.replaceWith(e.createUpgradeRow(t.upgrade)):e.appendUpgradeRow(t.upgrade)}else e.appendUpgradeRow(t.upgrade);i(".product-upgrades-form").slideUp(),e.resetForm();var a=i(".product-upgrades-list").find(".no-items");if(a.length&&(a.remove(),!i(".product-upgrades-list").find("table").length)){var o='\n              <table class="wp-list-table widefat fixed striped product-upgrades-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Base Categories",'</th>\n                    <th scope="col">',"Upgrade Categories",'</th>\n                    <th scope="col">',"Display Mode",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-upgrades-list").find("h3").after(o)}e.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(t){e.showMessage("error",t.message||"Error saving upgrade configuration. Please try again."),ut.error("Error saving upgrade configuration:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectUpgradeCategories||"Please select at least one upgrade category");else alert(this.settings.i18n.selectBaseCategories||"Please select at least one base category")}},{key:"handleEditUpgrade",value:function(t){var e=jQuery,i=e(t.currentTarget),n=i.data("id"),a=String(i.data("base")||"").split(",").filter(Boolean),o=String(i.data("upgrade")||"").split(",").filter(Boolean),r=i.data("mode"),s=i.data("title"),d=i.data("description");ut.log("Edit upgrade:",n,a,o,r,s,d),this.resetForm(),e("#upgrade_id").val(n),e("#display_mode").val(r||"dropdown").trigger("change"),e("#upgrade_title").val(s||""),e("#upgrade_description").val(d||""),setTimeout((function(){e("#base_categories").val(a).trigger("change"),e("#upgrade_categories").val(o).trigger("change")}),100),e(".form-title").text("Edit Upgrade Configuration"),e(".save-upgrade").text("Update Configuration"),e(".product-upgrades-form").slideDown(),e("html, body").animate({scrollTop:e(".product-upgrades-form").offset().top-50},300)}},{key:"handleDeleteUpgrade",value:function(t){var e=this,i=jQuery,n=i(t.currentTarget),a=n.data("id");if(ut.log("Delete upgrade:",a),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this upgrade configuration?")){n.prop("disabled",!0).text("Deleting...");var o={action:"delete_product_upgrade",nonce:this.settings.nonce,upgrade_id:a};f({url:this.settings.ajaxUrl,data:o}).then((function(t){ut.log("Delete response:",t);var a=n.closest("tr");a.fadeOut(300,(function(){a.remove(),i(".product-upgrades-list").find("tbody tr").length||(i(".product-upgrades-list").find("table").remove(),i(".product-upgrades-list").append('<div class="no-items">No upgrade configurations have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting upgrade configuration. Please try again."),n.prop("disabled",!1).text("Delete"),ut.error("Error deleting upgrade configuration:",t)}))}}},{key:"createUpgradeRow",value:function(t){var e=jQuery;if(!t||!t.id)return ut.log("Invalid upgrade data",t),e('<tr><td colspan="4">Error: Invalid upgrade data</td></tr>');var i=e("<tr></tr>").attr("data-id",t.id),n=t.base_category_names||"";i.append(e("<td></td>").text(n));var a=t.upgrade_category_names||"";i.append(e("<td></td>").text(a));var o={dropdown:"Dropdown",radio:"Radio Buttons",tiles:"Image Tiles"}[t.display_mode]||"Dropdown";i.append(e("<td></td>").text(o));var r=e("<td></td>").addClass("actions"),s=m("button",{className:"button button-small edit-upgrade",type:"button",dataset:{id:t.id,base:Array.isArray(t.base_categories)?t.base_categories.join(","):"",upgrade:Array.isArray(t.upgrade_categories)?t.upgrade_categories.join(","):"",mode:t.display_mode||"dropdown",title:t.title||"",description:t.description||""}},"Edit"),d=m("button",{className:"button button-small delete-upgrade",type:"button",dataset:{id:t.id}},"Delete");return r.append(e(s)," ",e(d)),i.append(r),i}},{key:"appendUpgradeRow",value:function(t){var e=jQuery;if(t&&t.id){var i=e(".product-upgrades-table");if(i.length){var n=i.find("tbody");if(n.length){var a=this.createUpgradeRow(t);n.append(a)}else ut.log("Cannot append row: Table body not found")}else ut.log("Cannot append row: Table not found")}else ut.log("Cannot append row: Invalid upgrade data",t)}},{key:"showMessage",value:function(t,e){var i=jQuery(".product-estimator-upgrades");if(i.length){var n=i.find(".notice");n.length&&n.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice?w(e,t):ProductEstimatorSettings.showNotice(e,t)}else ut.log("Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var t=jQuery("#product_upgrades");if(t.length&&t.is(":visible")){var e=new gt;window.ProductUpgradesSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"product_upgrades"===e&&setTimeout((function(){var t=new gt;window.ProductUpgradesSettingsModule=t}),100)}))})),console.log("Product Estimator Admin initialized")})();
//# sourceMappingURL=product-estimator-admin.bundle.js.map