(()=>{"use strict";var t,e={693:(t,e,i)=>{var n=i(29),a=i(901),o=i(284),s=i(296),r=i(467),c=i(16);function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){(0,r.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var u=c.h("UtilsAjax");function h(t){var e,i=jQuery,n=d(d({},{url:(null===(e=window.productEstimatorVars)||void 0===e?void 0:e.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),type:"POST",dataType:"json"}),t);return new Promise((function(t,e){i.ajax(d(d({},n),{},{success:function(i){if(i.success)t(i.data);else{var n,a=new Error((null===(n=i.data)||void 0===n?void 0:n.message)||"Unknown error");a.data=i.data,e(a)}},error:function(t,i,n){u.error("AJAX error:",i,n),e(new Error(n))}}))}))}var g=i(690);function f(t){return!!t&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}function m(t,e){var i=jQuery;if(t){var n=t instanceof jQuery?t:i(t);v(n);var a=i('<span class="field-error">'.concat(e,"</span>"));n.after(a),n.addClass("error")}}function v(t){var e=jQuery;if(t){var i=t instanceof jQuery?t:e(t);i.next(".field-error").remove(),i.removeClass("error")}}c.Rm,c.R8,c.z3;var p=c.h,b=(c.El,g.n,g.SL,g.kp,g.LF,g.ai,g.eV,g.WH,g.Nz,g.L$,f),y=m,w=v,S=p("ProductEstimatorAdmin");function _(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_(Object(i),!0).forEach((function(e){(0,r.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}new(function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),jQuery(document).ready((function(){e.initializeVariables(),e.bindEvents(),e.isSettingsPage()||e.initializeTabs()}))}),[{key:"isSettingsPage",value:function(){var t=new URLSearchParams(window.location.search).get("page");return t&&t.indexOf("-settings")>-1}},{key:"initializeVariables",value:function(){this.formChanged=!1,this.currentTab="",this.reportData=null,this.chart=null}},{key:"bindEvents",value:function(){var t=jQuery;this.isSettingsPage()||t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.initializeValidation(),t(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"initializeTabs",value:function(){var t=jQuery,e=t(".nav-tab:first"),i=e.data("tab")||"tab-1";t(".tab-content").hide(),t("#".concat(i)).show(),e.addClass("nav-tab-active"),this.currentTab=i;var n=new URLSearchParams(window.location.search).get("tab");n&&this.switchTab(n)}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged?confirm(productEstimatorAdmin.i18n.unsavedChanges)&&this.switchTab(e):this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery;e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show(),this.currentTab=t;var i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),"reports"!==t||this.reportData||this.loadInitialReport()}},{key:"initializeValidation",value:function(){if(!this.isSettingsPage()){var t=jQuery,e=t(".product-estimator-form");e.find('input[type="email"]').on("change",(function(e){var i=t(e.currentTarget),n=i.val();n&&!b(n)?y(i,productEstimatorAdmin.i18n.invalidEmail):w(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(e.currentTarget),n=parseInt(i.val()),a=parseInt(i.attr("min")),o=parseInt(i.attr("max"));n<a||n>o?y(i,productEstimatorAdmin.i18n.numberRange.replace("%min%",a).replace("%max%",o)):w(i)}))}}},{key:"handleBeforeUnload",value:function(t){if(this.formChanged)return t.preventDefault(),productEstimatorAdmin.i18n.unsavedChanges}},{key:"loadInitialReport",value:function(){}}])}()),S.log("ProductEstimatorAdmin initialized");var T=function(){return(0,a.A)((function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,n.A)(this,t),this.$=jQuery,this.baseClassLogger=p(this.constructor.name),i&&i.isModule?(this.settingsObjectName=i.settingsObjectName,this.defaultTabId=i.defaultTabId,this._initializeModuleSpecificSettings(this.settingsObjectName,this.defaultTabId),this.$(document).ready((function(){e._finalizeModuleSettings(e.settingsObjectName),"function"==typeof e.moduleInit&&e.moduleInit()}))):(this.formChanged=!1,this.currentTab="",this.formChangeTrackers={},this.ensureGlobalVariables(),this.$(document).ready((function(){e.mainInit()})))}),[{key:"_initializeModuleSpecificSettings",value:function(t,e){var i=window[t]||{};this.settings=C({},i),this.settings.ajaxUrl=i.ajaxUrl||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),this.settings.nonce=i.nonce||window.productEstimatorSettings&&window.productEstimatorSettings.nonce||"";var n=window.productEstimatorSettings&&window.productEstimatorSettings.actions||{};this.settings.actions=C(C({},n),i.actions||{}),!this.settings.actions.save_settings&&e&&(this.settings.actions.save_settings="save_".concat(e,"_settings"));var a=window.productEstimatorSettings&&window.productEstimatorSettings.selectors||{};this.settings.selectors=C(C({},a),i.selectors||{}),this.settings.i18n=C(C({},window.productEstimatorSettings&&window.productEstimatorSettings.i18n),i.i18n||{}),this.settings.tab_id=i.tab_id||e,this.settings.settingsObjectName=t,this.settings.option_name,void 0===i.actions&&this.logger.warn("ProductEstimatorSettings: actions is undefined in localizedSettings"),void 0===i.selectors&&this.logger.warn("ProductEstimatorSettings: selectors is undefined in localizedSettings")}},{key:"_finalizeModuleSettings",value:function(t){var e=window[t]||{};e.nonce&&(this.settings.nonce=e.nonce)}},{key:"ensureGlobalVariables",value:function(){window.featureSwitchesSettings=window.featureSwitchesSettings||{tab_id:"feature_switches",i18n:{}},window.generalSettings=window.generalSettings||{tab_id:"general",i18n:{}},window.netsuiteSettings=window.netsuiteSettings||{tab_id:"netsuite",i18n:{}},window.notificationSettings=window.notificationSettings||{tab_id:"notifications",i18n:{}},window.pricingRulesSettings=window.pricingRulesSettings||{tab_id:"pricing_rules",i18n:{}},window.productAdditionsSettings=window.productAdditionsSettings||{tab_id:"product_additions",i18n:{}},window.productUpgradesSettings=window.productUpgradesSettings||{tab_id:"product_upgrades",i18n:{}},window.similarProductsSettings=window.similarProductsSettings||{tab_id:"similar_products",i18n:{}},window.labelSettings=window.labelSettings||{tab_id:"labels",i18n:{}},window.productEstimatorSettings=window.productEstimatorSettings||{ajax_url:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:"",i18n:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave this tab?",saveSuccess:"Settings saved successfully.",saveError:"Error saving settings.",saving:"Saving..."}}}},{key:"mainInit",value:function(){var t=this.getTabFromUrl();this.currentTab=null!==t?t:"general",this.$(".tab-content").hide(),this.$("#".concat(this.currentTab)).show(),this.$(".nav-tab").removeClass("nav-tab-active"),this.$('.nav-tab[data-tab="'.concat(this.currentTab,'"]')).addClass("nav-tab-active"),this.bindMainEvents(),this.initFormChangeTracking(),this.initializeValidation()}},{key:"bindMainEvents",value:function(){var t=this;this.$(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.$(document).on("submit","form.product-estimator-form",(function(e){var i=t.$(e.currentTarget);i.hasClass("pe-vtabs-tab-form")&&i.attr("data-sub-tab-id")||(e.preventDefault(),t.handleAjaxFormSubmit(e,i))})),this.$(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"handleAjaxFormSubmit",value:function(t,e){var i=this,n=(e=e||this.$(t.target)).closest(".tab-content").attr("id")||e.data("tab"),a=e.serialize();e.find('input[type="checkbox"]').each((function(t,e){var n=i.$(e);if(!n.is(":checked")){var o=n.attr("name");if(o){var s=new RegExp("(^|&)".concat(encodeURIComponent(o).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"(?:=[^&]*)?"));null===a.match(s)&&(a+="&".concat(encodeURIComponent(o),"=0"))}}})),a=a.replace(/^&+/,"").replace(/&&+/g,"&"),this.showFormLoading(e);var o="save_".concat(n,"_settings"),s=window.productEstimatorSettings||{nonce:"",ajax_url:ajaxurl,i18n:{}},r={action:o,nonce:s.nonce,form_data:a};h({url:s.ajax_url,type:"POST",data:r}).then((function(t){i.showNotice(t.message||s.i18n.saveSuccess,"success"),i.formChangeTrackers&&(i.formChangeTrackers[n]=!1),n===i.currentTab&&(i.formChanged=!1)})).catch((function(t){var e=t&&t.message?t.message:s.i18n.saveError;i.showNotice(e,"error")})).finally((function(){i.hideFormLoading(e)}))}},{key:"showFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!0).addClass("loading"),e.data("original-text",e.val());var i=window.productEstimatorSettings&&window.productEstimatorSettings.i18n&&window.productEstimatorSettings.i18n.saving?window.productEstimatorSettings.i18n.saving:"Saving...";e.val(i)}},{key:"hideFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!1).removeClass("loading"),e.data("original-text")&&e.val(e.data("original-text"))}},{key:"initFormChangeTracking",value:function(){var t=this;this.$(".tab-content").each((function(){var e=t.$(this).attr("id");t.formChangeTrackers&&(t.formChangeTrackers[e]=!1),t.$("#".concat(e," :input")).on("change input",(function(){t.formChangeTrackers&&(t.formChangeTrackers[e]=!0),e===t.currentTab&&(t.formChanged=!0)}))}))}},{key:"initializeValidation",value:function(){var t=this;this.$(".product-estimator-form").each((function(e,i){var n=t.$(i);n.data("module-managed-validation")||(n.find('input[type="email"]').on("change",(function(e){var i=t.$(e.currentTarget);i.val()&&!f(i.val())?t.showFieldError(i,window.productEstimatorSettings.i18n.invalidEmail||"Invalid email address"):t.clearFieldError(i)})),n.find('input[type="number"]').on("change",(function(e){var i=t.$(e.currentTarget),n=parseInt(i.val(),10),a=parseInt(i.attr("min")||0,10),o=parseInt(i.attr("max")||9999,10),s=window.productEstimatorSettings&&window.productEstimatorSettings.i18n;if(isNaN(n)||n<a||n>o){var r=s&&s.numberRange?s.numberRange.replace("%min%",a).replace("%max%",o):"Value must be between ".concat(a," and ").concat(o);t.showFieldError(i,r)}else t.clearFieldError(i)})))}))}},{key:"getTabFromUrl",value:function(){return new URLSearchParams(window.location.search).get("tab")}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=this.$(t.currentTarget).data("tab"),i=window.productEstimatorSettings&&window.productEstimatorSettings.i18n;this.formChanged&&!confirm(i.unsavedChanges||"You have unsaved changes. Are you sure?")||this.switchTab(e)}},{key:"switchTab",value:function(t){var e=new URL(window.location.href);e.searchParams.set("tab",t),window.history.pushState({},"",e.toString()),this.$(".nav-tab").removeClass("nav-tab-active"),this.$('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),this.$(".tab-content").hide(),this.$("#".concat(t)).show();var i=this.currentTab;this.currentTab=t,this.formChanged=this.formChangeTrackers&&this.formChangeTrackers[t]||!1,this.$(document).trigger("product_estimator_tab_changed",[t,i])}},{key:"handleBeforeUnload",value:function(t){var e=!1;if(this.formChangeTrackers)for(var i in this.formChangeTrackers)if(this.formChangeTrackers[i]){e=!0;break}if(e){var n=(window.productEstimatorSettings&&window.productEstimatorSettings.i18n).unsavedChanges||"You have unsaved changes. Are you sure?";return t.returnValue=n,n}}},{key:"clearSubTabFromUrl",value:function(){var t=new URL(window.location.href);t.searchParams.has("sub_tab")&&(t.searchParams.delete("sub_tab"),window.history.replaceState({},"",t.toString()))}},{key:"showFieldError",value:function(t,e){m(this.$(t),e)}},{key:"clearFieldError",value:function(t){v(this.$(t))}},{key:"showNotice",value:function(t){!function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,i=jQuery;if(i){for(var n=i('<div class="notice notice-'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",' is-dismissible"><p>').concat(t,"</p></div>")),a=[i(".wrap h1"),i(".product-estimator-form-container"),i("#wpbody-content")],o=null,s=0;s<a.length;s++)if(a[s].length){o=a[s];break}if(o?o.after(n):i("body").prepend(n),window.wp&&window.wp.notices)window.wp.notices.init();else{var r=i('<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>');n.append(r),r.on("click",(function(){n.fadeOut(100,(function(){n.remove()}))}))}setTimeout((function(){n.fadeOut(500,(function(){return n.remove()}))}),e)}else alert(t)}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success")}},{key:"initSelect2",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||!t.length)return null;if(!this.$||!this.$.fn.select2)return null;var n=C(C({},{placeholder:e||"Select an option",width:"resolve",allowClear:!0,dropdownCssClass:"product-estimator-dropdown"}),i);try{return t.select2(n),i.clearInitial&&t.val(null).trigger("change"),t}catch(t){return null}}},{key:"initializeSelect2Dropdowns",value:function(t){var e=this,i=t.elements,n=void 0===i?[]:i,a=t.i18n,o=void 0===a?this.settings.i18n||{}:a,s=t.moduleName,r=void 0===s?this.settings.tab_id||"Module":s,c=t.delay,l=void 0===c?100:c;this.$&&this.$.fn.select2?setTimeout((function(){n.forEach((function(t){if(t&&t.element){var i=o[t.placeholderKey]||t.fallbackText||"Select ".concat(t.name);e.initSelect2(t.element,i,t.config||{})}}))}),l):p(r).warn("Select2 not available for ".concat(r))}},{key:"refreshSelect2",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||!t.length)return null;try{var i=e.placeholder||t.data("placeholder")||"";return t.select2("destroy"),this.initSelect2(t,i,e)}catch(t){return null}}}])}();jQuery(document).ready((function(){window.ProductEstimatorSettingsInstance||(window.ProductEstimatorSettingsInstance=new T)}));const I=T;function E(t,e){if(e&&("object"==(0,o.A)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}function M(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&P(t,e)}var A=(0,c.h)("UtilsTinyMCEPreserver");function $(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return($=function(){return!!t})()}var F=p("GeneralSettingsModule"),x=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{isModule:!0,settingsObjectName:"generalSettings",defaultTabId:"general"}],a=k(a=e),(t=E(i,$()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).validateMarkup=t.validateMarkup.bind(t),t.validateExpiryDays=t.validateExpiryDays.bind(t),t.handleFileUpload=t.handleFileUpload.bind(t),t.handleFileRemove=t.handleFileRemove.bind(t),t.handleTabChanged=t.handleTabChanged.bind(t),t}return M(e,t),(0,a.A)(e,[{key:"moduleInit",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupValidation(),this.setupWpEditors()}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged),this.$(".select-file-button").on("click",this.handleFileUpload),this.$(".remove-file-button").on("click",this.handleFileRemove)}},{key:"setupWpEditors",value:function(){!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",i=jQuery;if(0!==i(e).length){A.log("Setting up rich text editors with <br> tag preservation"),window._originalEditorContent=window._originalEditorContent||{};var n=function(t){return t.replace(/<br\s*\/?>/gi,"<br>â€‹")},a=function(t){return t.replace(/\u200B/g,"")},o=function(){if("undefined"!=typeof tinyMCE&&tinyMCE.editors){var e=!0;return t.forEach((function(t){(function(t){if(!tinyMCE||!tinyMCE.get(t))return!1;var e=tinyMCE.get(t);e.settings.wpautop=!1,e.settings.forced_root_block="",e.settings.valid_elements="*[*]",e.settings.entity_encoding="raw",e.settings.verify_html=!1,e.settings.br_in_pre=!1,e.settings.keep_styles=!0,e.settings.remove_linebreaks=!1,e.settings.convert_newlines_to_brs=!0,e.settings.remove_redundant_brs=!1;var o=i("#".concat(t));if(o.length){var s=o.val();window._originalEditorContent[t]=s,setTimeout((function(){var t=n(s);e.setContent(t,{format:"raw"})}),100)}return e.on("BeforeSetContent",(function(e){e.content&&(e.content=n(e.content)),(e.initial||e.source_view)&&(window._originalEditorContent[t]=e.content)})),e.on("GetContent",(function(t){t.content&&(t.content=a(t.content))})),e.on("init",(function(){var i=e.getContent({format:"raw"});window._originalEditorContent[t]=a(i),A.log("Editor ".concat(t," initialized with content length: ").concat(i.length))})),i('.wp-editor-tabs button[data-wp-editor-id="'.concat(t,'"]')).on("click",(function(){var e=i(this).hasClass("switch-html"),o=i(this).hasClass("switch-tmce");if(e&&tinyMCE.get(t)){var s=tinyMCE.get(t).getContent({format:"raw"}),r=a(s);window._originalEditorContent[t]=r,i("#".concat(t)).val(r)}o&&setTimeout((function(){if(tinyMCE.get(t)&&window._originalEditorContent[t]){var e=n(window._originalEditorContent[t]);tinyMCE.get(t).setContent(e,{format:"raw"})}}),100)})),A.log("Editor ".concat(t," configured with <br> tag protection")),!0})(t)||(e=!1)})),e}return!1};if(!o())var s=0,r=setInterval((function(){s++,(o()||s>20)&&clearInterval(r)}),300);t.forEach((function(t){i("#".concat(t)).on("input change",(function(){window._originalEditorContent[t]=i(this).val()}))})),i("".concat(e," form")).off("submit.htmlPreservation").on("submit.htmlPreservation",(function(){return t.forEach((function(t){var e="";if(tinyMCE.get(t)&&tinyMCE.get(t).isHidden()){var n=i("#".concat(t));n.length&&(e=n.val())}else if(tinyMCE.get(t)){var o=tinyMCE.get(t).getContent({format:"raw"});e=a(o)}!e&&window._originalEditorContent[t]&&(e=window._originalEditorContent[t]),e&&(i("#".concat(t)).val(e),A.log("Form submission: Updated ".concat(t," with content length: ").concat(e.length)))})),!0}))}}(["pdf_footer_text","pdf_footer_contact_details_content"],"#general")}},{key:"handleFileUpload",value:function(t){var e=this;t.preventDefault();var i=this.$(t.currentTarget),n=i.data("target-input"),a=i.data("target-preview");this.mediaFrame||(this.mediaFrame=wp.media({title:"Select or Upload PDF Template",button:{text:"Use this file"},multiple:!1,library:{type:"application/pdf"}}),this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON();t&&t.id?n?e.$(n).val(t.id).trigger("change"):F.warn("No target input selector found for file upload"):F.warn("Invalid attachment selected from media library");var o=a?e.$(a):i.siblings(".file-preview-wrapper"),s=e._formatFileSize(t.filesizeInBytes||0);o.html('\n        <div class="file-preview">\n          <span class="file-icon dashicons dashicons-pdf"></span>\n          <div class="file-details">\n            <span class="file-name">\n              <a href="'.concat(t.url,'" target="_blank">\n                ').concat(t.filename,"\n              </a>\n               ").concat(s?"(".concat(s," PDF Document)"):"","\n            </span>\n          </div>\n        </div>\n      ")),e.$(".upload-instructions").length||o.after('<span class="upload-instructions">Upload a PDF template file (optional) *<br>Accepted format: application/pdf</span>'),i.siblings(".remove-file-button").removeClass("hidden"),i.text("Replace File")}))),this.mediaFrame.open()}},{key:"handleFileRemove",value:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.data("target-input"),n=e.data("target-preview"),a=e.siblings(".select-file-button");i&&this.$(i).val("").trigger("change"),n?this.$(n).empty():e.siblings(".file-preview-wrapper").empty(),e.addClass("hidden"),a.length&&a.text("Upload File"),this.$(".upload-instructions").remove()}},{key:"setupValidation",value:function(){this.$("#default_markup").on("change input",this.validateMarkup),this.$("#estimate_expiry_days").on("change input",this.validateExpiryDays)}},{key:"validateMarkup",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=parseInt(e.attr("min")||0,10),a=parseInt(e.attr("max")||100,10),o=window.generalSettings&&window.generalSettings.i18n||this.settings.i18n||{};return isNaN(i)||i<n||i>a?(this.showFieldError(e,o.validationErrorMarkup||"Value must be between ".concat(n," and ").concat(a,".")),!1):(this.clearFieldError(e),!0)}},{key:"validateExpiryDays",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=parseInt(e.attr("min")||1,10),a=parseInt(e.attr("max")||365,10),o=window.generalSettings&&window.generalSettings.i18n||this.settings.i18n||{};return isNaN(i)||i<n||i>a?(this.showFieldError(e,o.validationErrorExpiry||"Value must be between ".concat(n," and ").concat(a,".")),!1):(this.clearFieldError(e),!0)}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&this.setupWpEditors(),this.clearSubTabFromUrl()}},{key:"saveEditorContent",value:function(){"undefined"!=typeof tinyMCE&&["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(t){var e=tinyMCE.get(t);e&&e.save()}))}},{key:"validateAllFields",value:function(){var t=!0;return this.saveEditorContent(),this.validateMarkup({currentTarget:this.$("#default_markup")[0]})||(t=!1),this.validateExpiryDays({currentTarget:this.$("#estimate_expiry_days")[0]})||(t=!1),t}},{key:"_formatFileSize",value:function(t){if(0===t)return"0 Bytes";var e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]}}])}(I);function j(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(j=function(){return!!t})()}jQuery(document).ready((function(){jQuery("#general").length&&(window.GeneralSettingsModuleInstance=new x)}));var O=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{isModule:!0,settingsObjectName:"netsuiteSettings",defaultTabId:"netsuite"}],a=k(a=e),(t=E(i,j()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).testNetsuiteConnection=t.testNetsuiteConnection.bind(t),t.toggleNetsuiteFields=t.toggleNetsuiteFields.bind(t),t.validateUrl=t.validateUrl.bind(t),t.validateRequestLimit=t.validateRequestLimit.bind(t),t.validateCacheTime=t.validateCacheTime.bind(t),t.handleTabChanged=t.handleTabChanged.bind(t),t}return M(e,t),(0,a.A)(e,[{key:"moduleInit",value:function(){this.bindEvents(),this.setupDependentFields()}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged),this.$("#test-netsuite-connection").on("click",this.testNetsuiteConnection),this.$("#netsuite_enabled").on("change",this.toggleNetsuiteFields),this.$("#netsuite_api_url, #netsuite_token_url").on("blur",this.validateUrl),this.$("#netsuite_request_limit").on("blur",this.validateRequestLimit),this.$("#netsuite_cache_time").on("blur",this.validateCacheTime)}},{key:"setupDependentFields",value:function(){this.toggleNetsuiteFields()}},{key:"toggleNetsuiteFields",value:function(){var t=this.$("#netsuite_enabled").is(":checked"),e=this.$("#netsuite_client_id, #netsuite_client_secret, #netsuite_api_url, #netsuite_token_url, #netsuite_request_limit, #netsuite_cache_time").closest("tr"),i=this.$("#test-netsuite-connection").closest("p");t?(e.fadeIn(200),i.fadeIn(200)):(e.fadeOut(200),i.fadeOut(200))}},{key:"testNetsuiteConnection",value:function(){var t=this.$("#test-netsuite-connection"),e=this.$("#connection-result");if(!t.prop("disabled")){var i=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};t.prop("disabled",!0),e.html('<span style="color:#666;">'.concat(i.testing||"Testing connection...","</span>")),h({url:this.settings.ajaxUrl,type:"POST",data:{action:"test_netsuite_connection",nonce:this.settings.nonce}}).then((function(t){var i=t.data&&t.data.message?t.data.message:t.message;e.html('<span style="color:green;">'.concat(i||"Connection successful.","</span>"))})).catch((function(t){var n=t&&t.message?t.message:i.error||"Error";e.html('<span style="color:red;">'.concat(n,"</span>"))})).finally((function(){t.prop("disabled",!1)}))}}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&this.toggleNetsuiteFields(),this.clearSubTabFromUrl()}},{key:"validateUrl",value:function(t){var e=this.$(t.currentTarget),i=e.val().trim(),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return i&&!this.isValidUrl(i)?(this.showFieldError(e,n.invalidUrl||"Please enter a valid URL."),!1):(this.clearFieldError(e),!0)}},{key:"isValidUrl",value:function(t){try{return new URL(t),!0}catch(t){return!1}}},{key:"validateRequestLimit",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return isNaN(i)||i<1||i>100?(this.showFieldError(e,n.requestLimitError||"Request limit must be between 1 and 100."),!1):(this.clearFieldError(e),!0)}},{key:"validateCacheTime",value:function(t){var e=this.$(t.currentTarget),i=parseInt(e.val(),10),n=this.settings.i18n||window.netsuiteSettings&&window.netsuiteSettings.i18n||{};return isNaN(i)||i<0?(this.showFieldError(e,n.cacheTimeError||"Cache time must be at least 0."),!1):(this.clearFieldError(e),!0)}},{key:"addInfoSection",value:function(t){var e=this.$("#netsuite-settings-table");if(e.length&&t){this.$(".netsuite-info-section").remove();var i=(0,g.n)("div",{className:"netsuite-info-section notice notice-info",style:{padding:"10px",marginBottom:"15px"},innerHTML:t});e.before(i)}}}])}(I);function N(){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(arguments.length<3?t:i):a.value}},N.apply(null,arguments)}function R(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(R=function(){return!!t})()}jQuery(document).ready((function(){jQuery("#netsuite").length&&(window.NetsuiteSettingsModuleInstance=new O)}));var D=p("VerticalTabbedModule");const B=function(t){function e(t){var i,a,o,s;return(0,n.A)(this,e),a=this,o=e,s=[{isModule:!0,settingsObjectName:t.localizedDataName,defaultTabId:t.mainTabId}],o=k(o),(i=E(a,R()?Reflect.construct(o,s||[],k(a).constructor):o.apply(a,s))).vtmConfig={defaultSubTabId:t.defaultSubTabId,ajaxActionPrefix:t.ajaxActionPrefix},i.$container=null,!i.vtmConfig.defaultSubTabId||i.vtmConfig.ajaxActionPrefix,i}return M(e,t),(0,a.A)(e,[{key:"moduleInit",value:function(){var t=this;if(this.$container=this.$("#".concat(this.settings.tab_id)),this.$container.length){this.bindCommonVTMEvents(),this.bindModuleSpecificEvents();var e=window.ProductEstimatorSettingsInstance;e&&e.currentTab===this.settings.tab_id&&setTimeout((function(){t.setupVerticalTabs(),t.onMainTabActivated()}),100)}else window.ProductEstimatorSettingsInstance&&window.ProductEstimatorSettingsInstance.showNotice("Error: UI container for '".concat(this.settings.tab_id,"' settings not found. Some features might be unavailable."),"error")}},{key:"bindCommonVTMEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleMainTabChanged.bind(this)),this.$container.on("submit.vtm","form.pe-vtabs-tab-form",this.handleVTMFormSubmit.bind(this));var t=this.settings.selectors.verticalTabNav||".pe-vtabs-nav-list, .vertical-tabs-nav";this.$container.on("click.vtm","".concat(t," a, .pe-vtabs-nav-item a, .tab-item a"),this.handleVerticalTabClick.bind(this)),this.setTabAttributesOnLinks()}},{key:"setTabAttributesOnLinks",value:function(){var t=this,e=this.settings.selectors.verticalTabNav||".pe-vtabs-nav-list, .vertical-tabs-nav";this.$container.find("".concat(e," a")).each((function(e,i){var n=t.$(i),a=n.attr("href")||"";if(!n.attr("data-tab")&&a.includes("sub_tab=")){var o=a.match(/[?&]sub_tab=([^&#]*)/i);if(o&&o[1]){var s=decodeURIComponent(o[1].replace(/\+/g," "));n.attr("data-tab",s)}}}))}},{key:"bindModuleSpecificEvents",value:function(){}},{key:"onMainTabActivated",value:function(){}},{key:"onMainTabDeactivated",value:function(){}},{key:"setupVerticalTabs",value:function(){if(this.$container&&this.$container.length){var t=this.settings.selectors.verticalTabNav||".pe-vtabs-nav-list, .vertical-tabs-nav",e=this.settings.selectors.verticalTabPane||".pe-vtabs-tab-panel, .vertical-tab-content",i=this.$container.find(t),n=this.$container.find(e);if(i.length&&n.length){this.setTabAttributesOnLinks();var a=this.vtmConfig.defaultSubTabId,o=new URLSearchParams(window.location.search).get("sub_tab");if(o&&i.find('a[data-tab="'.concat(o,'"]')).length)a=o;else{var s=i.find(".pe-vtabs-nav-item.active a, .tab-item.active a");s.length&&(a=s.data("tab"))}if(!i.find('a[data-tab="'.concat(a,'"]')).length){var r=i.find("a[data-tab]").first();if(!r.length)return;a=r.data("tab")}this.showVerticalTab(a,!1),this.adjustTabContentHeight(),this.$(window).off("resize.vtm.".concat(this.settings.tab_id)).on("resize.vtm.".concat(this.settings.tab_id),this.adjustTabContentHeight.bind(this))}}}},{key:"handleVerticalTabClick",value:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=null,n=e[0],a=n?n.getAttribute("data-tab"):null;if(a?i=a:n&&n.hasAttribute("data-tabid")&&(i=n.getAttribute("data-tabid")),i)this.showVerticalTab(i,!0);else{var o=e.attr("href");if(o){var s=o.match(/[?&]sub_tab=([^&#]*)/i);if(s&&s[1]){var r=decodeURIComponent(s[1].replace(/\+/g," "));return this.showVerticalTab(r,!0),void e.attr("data-tab",r)}if(o.includes("sub_tab="))try{var c=new URL(o,window.location.origin).searchParams.get("sub_tab");if(c)return this.showVerticalTab(c,!0),void e.attr("data-tab",c)}catch(t){try{var l=o.split("?")[1];if(l){var d=new URLSearchParams(l).get("sub_tab");if(d)return this.showVerticalTab(d,!0),void e.attr("data-tab",d)}}catch(t){D.error("Error parsing URL or query string:",t)}}}}}},{key:"adjustTabContentHeight",value:function(){if(this.$container&&this.$container.length){var t=this.settings.selectors.verticalTabNavArea||".pe-vtabs-nav-area, .vertical-tabs",e=this.settings.selectors.verticalTabContentArea||".pe-vtabs-content-area, .vertical-tabs-content",i=this.$container.find(t),n=this.$container.find(e);if(i.length&&n.length){var a=i.outerHeight();a&&n.css("min-height",a+"px")}}}},{key:"showVerticalTab",value:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.$container&&this.settings.tab_id&&t){var n=this.settings.selectors.verticalTabNav||".pe-vtabs-nav-list, .vertical-tabs-nav",a=this.settings.selectors.verticalTabPane||".pe-vtabs-tab-panel, .vertical-tab-content",o=this.settings.selectors.verticalTabNavItem||".pe-vtabs-nav-item, .tab-item",s=this.$container.find(n),r=this.$container.find(a);s.find(o).removeClass("active");var c=s.find('a[data-tab="'.concat(t,'"]'));c.length||(c=s.find('a[href*="sub_tab='.concat(t,'"]'))).length||s.find("a").each((function(i,n){var a=e.$(n);(a.attr("href")||"").includes(t)&&(c=a,a.attr("data-tab",t))})),c.length&&c.closest(o).addClass("active"),r.hide().removeClass("active");var l=t.replace(/[^a-zA-Z0-9-_]/g,""),d=this.$container.find("#".concat(l));if(d.length||(d=this.$container.find(".pe-vtabs-tab-panel-".concat(l,', [data-tab-id="').concat(l,'"], [data-tab-content="').concat(l,'"]'))),d.length||(d=this.$container.find('[id*="'.concat(l,'"], [class*="').concat(l,'"]')).filter(".pe-vtabs-tab-panel, .vertical-tab-content")),d.length)d.show().addClass("active");else{var u=[];this.$container.find(a).each((function(t,i){var n=e.$(i),a=n.attr("id")||"",o=n.attr("class")||"";(a.includes(l.substring(0,5))||o.includes(l.substring(0,5)))&&u.push(n)})),(1===u.length||u.length>1)&&u[0].show().addClass("active")}if(i){var h=new URL(window.location.href);h.searchParams.set("page",h.searchParams.get("page")||"product-estimator-settings"),h.searchParams.set("tab",this.settings.tab_id),h.searchParams.set("sub_tab",t),window.history.pushState({mainTabId:this.settings.tab_id,subTabId:t},"",h.toString())}this.$(document).trigger("pe_sub_tab_changed_".concat(this.settings.tab_id),[t])}else{var g;D.warn("VerticalTabbedModule: Cannot show vertical tab due to missing container, mainTabId, or subTabId.",{containerExists:!(null===(g=this.$container)||void 0===g||!g.length),mainTabId:this.settings.tab_id,subTabId:t})}}},{key:"handleMainTabChanged",value:function(t,e,i){var n=this;e===this.settings.tab_id?(this.$container&&this.$container.length||(this.$container=this.$("#".concat(this.settings.tab_id))),this.$container.length?setTimeout((function(){n.setupVerticalTabs(),n.onMainTabActivated()}),100):this.logger.warn("VerticalTabbedModule: Container for tab '".concat(this.settings.tab_id,"' not found when activating main tab"))):i===this.settings.tab_id&&this.onMainTabDeactivated()}},{key:"handleVTMFormSubmit",value:function(t){var e=this,i=this.$(t.currentTarget);t.preventDefault();var n=i.find('.save-settings, button[type="submit"], input[type="submit"]'),a=i.find(".spinner").first();"undefined"!=typeof tinyMCE&&i.find(".wp-editor-area").each((function(t,i){var n=tinyMCE.get(e.$(i).attr("id"));n&&n.save()}));var s=i.serialize(),r=i.attr("data-sub-tab-id");if(r&&""!==String(r).trim()){i.find('input[type="checkbox"]').each((function(t,i){var n=e.$(i),a=n.attr("name");a&&!n.is(":checked")&&(new RegExp("(^|&)".concat(encodeURIComponent(a).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"=")).test(s)||(s+="&".concat(encodeURIComponent(a),"=0")))})),s=s.replace(/^&+/,"").replace(/&&+/g,"&"),n.prop("disabled",!0),a.addClass("is-active");var c={action:"".concat(this.vtmConfig.ajaxActionPrefix,"_settings"),nonce:this.settings.nonce,form_data:s,sub_tab_id:r.trim(),main_tab_id:this.settings.tab_id};h({url:this.settings.ajaxUrl,type:"POST",data:c}).then((function(t){var i=t&&t.message||e.settings.i18n&&e.settings.i18n.saveSuccess||"Settings saved successfully.";e.showNotice(i,"success");var n=window.ProductEstimatorSettingsInstance;n&&"object"===(0,o.A)(n.formChangeTrackers)&&(n.formChangeTrackers[e.settings.tab_id]=!1,n.currentTab===e.settings.tab_id&&(n.formChanged=!1))})).catch((function(t){var i=t&&t.message?t.message:e.settings.i18n&&e.settings.i18n.saveError||"Error saving settings.";e.showNotice(i,"error")})).finally((function(){n.prop("disabled",!1),a.removeClass("is-active")}))}else this.showNotice('Error: Could not save settings. Form configuration is missing "data-sub-tab-id".',"error")}}])}(I);function U(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(U=function(){return!!t})()}function L(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}var z=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{mainTabId:"notifications",defaultSubTabId:"notifications-general",ajaxActionPrefix:"save_notifications",localizedDataName:"notificationSettings"}],a=k(a=e),(t=E(i,U()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).mediaFrame=null,t}return M(e,t),(0,a.A)(e,[{key:"bindModuleSpecificEvents",value:function(){L(e,"bindModuleSpecificEvents",this,3)([]),this.$container&&this.$container.length&&(this.$container.on("change","#enable_notifications",this.handleToggleAllNotifications.bind(this)),this.$container.on("change",'input[id^="notification_"][id$="_enabled"]',this.handleToggleSingleNotification.bind(this)),this.$container.on("click",".image-upload-button",this.handleImageUpload.bind(this)),this.$container.on("click",".image-remove-button",this.handleImageRemove.bind(this)),this.$container.on("change",'input[type="email"]',this.handleEmailValidation.bind(this)))}},{key:"onMainTabActivated",value:function(){L(e,"onMainTabActivated",this,3)([]),this.setupDependentFieldsState(),this.setupNotificationEditors()}},{key:"setupNotificationEditors",value:function(){this.$container&&this.localizedData}},{key:"setupDependentFieldsState",value:function(){var t=this;this.$container&&this.$container.length&&(this.handleToggleAllNotifications(),this.$container.find('input[id^="notification_"][id$="_enabled"]').each((function(e,i){var n=jQuery(i);t.toggleSingleNotificationFields(n)})))}},{key:"handleToggleAllNotifications",value:function(){var t=this;if(this.$container&&this.$container.length){var e=this.$container.find("#enable_notifications");if(e.length){var i=e.is(":checked"),n=this.$container.find(".pe-vtabs-nav-list, .vertical-tabs-nav"),a=this.$container.find('.pe-vtabs-tab-form[data-tab-id*="notification_type_"]');i?(n.removeClass("pe-vtabs-nav-disabled"),this.$container.find('input[id^="notification_"][id$="_enabled"]').each((function(e,i){t.toggleSingleNotificationFields(jQuery(i))}))):(n.addClass("pe-vtabs-nav-disabled"),a.find("input, textarea, button, select").not(".save-settings").prop("disabled",!0),a.find(".wp-editor-area").each((function(){var t=tinyMCE.get(jQuery(this).attr("id"));t&&t.setMode("readonly")})))}}}},{key:"handleToggleSingleNotification",value:function(t){this.toggleSingleNotificationFields(jQuery(t.currentTarget))}},{key:"toggleSingleNotificationFields",value:function(t){if(this.$container&&this.$container.length){var e=jQuery,i=t.is(":checked"),n=t.attr("id").replace("notification_","").replace("_enabled",""),a=this.$container.find('.pe-vtabs-tab-form[data-sub-tab-id="notification-type-'.concat(n,'"]'));if(a.length){var o=this.$container.find("#enable_notifications");o.length&&!o.is(":checked")||(a.find("input, textarea, button, select").not(t).not(".save-settings").prop("disabled",!i),a.find(".wp-editor-area").each((function(){var t=tinyMCE.get(e(this).attr("id"));t&&t.setMode(i?"design":"readonly")})))}}}},{key:"handleImageUpload",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.currentTarget).data("field-id");if(this.mediaFrame)this.mediaFrame.off("select");else{if("undefined"==typeof wp||!wp.media)return;this.mediaFrame=wp.media({title:this.localizedData.i18n.selectImage||"Select Image",button:{text:this.localizedData.i18n.useThisImage||"Use this image"},multiple:!1,library:{type:"image"}})}this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON(),n=e.$container.find("#".concat(i)),a=n.closest("td").find(".image-preview-wrapper"),o=n.closest("td").find(".image-remove-button");n.val(t.id).trigger("change"),a.html('<img src="'.concat(t.sizes.thumbnail?t.sizes.thumbnail.url:t.url,'" alt="Preview" />')),o.removeClass("hidden")})),this.mediaFrame.open()}},{key:"handleImageRemove",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget),i=e.data("field-id"),n=this.$container.find("#".concat(i)),a=n.closest("td").find(".image-preview-wrapper");n.val("").trigger("change"),a.empty(),e.addClass("hidden")}},{key:"handleEmailValidation",value:function(t){var e=jQuery(t.target);if(e.closest(this.$container).length){var i=e.val().trim(),n=this.localizedData&&this.localizedData.i18n||{};return i&&!f(i)?(this.showFieldError(e,n.validationErrorEmail||"Please enter a valid email address."),!1):(this.clearFieldError(e),!0)}}}])}(B);function V(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Q(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw o}}}}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function W(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?W(Object(i),!0).forEach((function(e){(0,r.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):W(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function K(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(K=function(){return!!t})()}jQuery(document).ready((function(){jQuery("#notifications").length&&(window.ProductEstimatorNotificationSettingsModule=new z)}));const H=function(t){function e(t){var i,a,o,s;(0,n.A)(this,e),a=this,s=[q(q({},t),{},{defaultSubTabId:t.defaultSubTabId||t.mainTabId+"_table",ajaxActionPrefix:"atm_form_save_".concat(t.mainTabId)})],o=k(o=e),(i=E(a,K()?Reflect.construct(o,s||[],k(a).constructor):o.apply(a,s))).$=jQuery,i.config=t;var r="AdminTableManager:".concat(t.mainTabId||"Generic");return i.logger=p(r),i.settings&&i.settings.tab_id||i.logger.warn("AdminTableManager: No tab_id found in settings."),i.formModified=!1,i.isEditMode=!1,i.currentItemId=null,i}return M(e,t),(0,a.A)(e,[{key:"_validateSettings",value:function(){if(!this.settings||void 0===this.settings.tab_id)throw new Error("AdminTableManager: Essential property 'this.settings.tab_id' was not initialized by the parent class. Cannot validate settings.");if(0===Object.keys(this.settings).length){var t="AdminTableManager: Settings (this.settings) is an empty object";throw this.settingsObjectName&&(t+=" (expected from window.".concat(this.settingsObjectName,"). This might happen if the global object is empty or not correctly populated.")),new Error(t+' Cannot proceed with empty settings for tab "'.concat(this.settings.tab_id,'".'))}var e=!0;if(void 0===this.settings.ajaxUrl&&(e=!1),void 0===this.settings.nonce&&(e=!1),void 0===this.settings.option_name&&(e=!1),this.settings.actions){var i,n=V(["add_item","update_item","delete_item"]);try{for(n.s();!(i=n.n()).done;){var a=i.value;void 0===this.settings.actions[a]&&(e=!1)}}catch(t){n.e(t)}finally{n.f()}}else e=!1;if(this.settings.selectors){var o,s=V(["formContainer","form","addButton","listTableBody","editButton","deleteButton","idInput","saveButton","cancelButton","noItemsMessage","formTitle","listItemRow","listTableContainer","listTable"]);try{for(s.s();!(o=s.n()).done;){var r=o.value;void 0===this.settings.selectors[r]&&(e=!1)}}catch(t){s.e(t)}finally{s.f()}}else e=!1;if(this.settings.i18n){var c,l=V(["confirmDelete","itemSavedSuccess","itemDeletedSuccess","errorSavingItem","errorDeletingItem","addItemButtonLabel","editItemFormTitle","saving","deleting","editButtonLabel","deleteButtonLabel"]);try{for(l.s();!(c=l.n()).done;){var d=c.value;void 0===this.settings.i18n[d]&&(this.logger.warn("AdminTableManager: Missing i18n key '".concat(d,"' in settings.i18n")),e=!1)}}catch(t){l.e(t)}finally{l.f()}}else e=!1;if(!e)throw new Error('AdminTableManager: Settings validation failed due to missing critical settings in this.settings for tab "'.concat(this.settings.tab_id,'". Check console for details.'))}},{key:"moduleInit",value:function(){var t,i,n;if((t=e,i=this,"function"==typeof(n=N(k(1&3?t.prototype:t),"moduleInit",i))?function(t){return n.apply(i,t)}:n)([]),this.$container&&this.$container.length){try{this._validateSettings()}catch(t){return void(window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Error initializing table manager for ".concat(this.settings.tab_id,": Configuration validation failed. Check console. Details: ").concat(t.message),"error"))}if(this.cacheDOM(),this._checkEssentialDOM())this.bindEvents(),this.updateNoItemsMessageVisibility(),this.$(document).trigger("admin_table_manager_ready_".concat(this.settings.tab_id),[this]);else if(window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice){var a=this.settings.tab_id;window.ProductEstimatorSettingsInstance.showNotice("Error initializing UI components for ".concat(a,". Some parts may not work. Check console for missing DOM elements."),"error")}}else window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Critical error: Table manager UI container #".concat(this.settings.tab_id," missing."),"error")}},{key:"_checkEssentialDOM",value:function(){var t=!0;if(!this.settings||!this.settings.selectors)return!1;for(var e=0,i=["formContainer","form","addButton","listTableBody","listTableContainer","listTable","noItemsMessage","formTitle","idInput","saveButton","cancelButton"];e<i.length;e++){var n=i[e];this.dom[n]&&this.dom[n].length||(t=!1)}return t}},{key:"cacheDOM",value:function(){if(this.dom={},this.settings&&this.settings.selectors)if(this.$container&&this.$container.length)for(var t in this.settings.selectors)Object.prototype.hasOwnProperty.call(this.settings.selectors,t)&&(this.dom[t]=this.$container.find(this.settings.selectors[t]));else this.logger.warn("AdminTableManager: Container for '".concat(this.settings.tab_id,"' not found or has no length."))}},{key:"bindEvents",value:function(){var t,e,i,n,a,o,s=this;if(this.dom&&0!==Object.keys(this.dom).length){null===(t=this.dom.addButton)||void 0===t||t.on("click.adminTableManager",this.handleAddNew.bind(this));var r=null===(e=this.settings.selectors)||void 0===e?void 0:e.editButton,c=null===(i=this.settings.selectors)||void 0===i?void 0:i.deleteButton;this.dom.listTableBody&&this.dom.listTableBody.length?(r?this.dom.listTableBody.on("click.adminTableManager",r,this.handleEdit.bind(this)):this.logger.warn("AdminTableManager: No edit button selector defined for '".concat(this.settings.tab_id,"'.")),c?this.dom.listTableBody.on("click.adminTableManager",c,this.handleDelete.bind(this)):this.logger.warn("AdminTableManager: No delete button selector defined for '".concat(this.settings.tab_id,"'.")),this.bindCustomActionButtons()):this.logger.warn("AdminTableManager: List table body not found for '".concat(this.settings.tab_id,"'.")),null===(n=this.dom.form)||void 0===n||n.on("submit.adminTableManager",this.handleSubmit.bind(this)),null===(a=this.dom.cancelButton)||void 0===a||a.on("click.adminTableManager",this.handleCancel.bind(this)),null===(o=this.dom.form)||void 0===o||o.on("change.adminTableManager input.adminTableManager",":input",(function(){s.formModified=!0}))}}},{key:"bindCustomActionButtons",value:function(){}},{key:"handleAddNew",value:function(t){var e,i,n,a;t.preventDefault(),this.isEditMode=!1,this.currentItemId=null,this.resetForm(),null===(e=this.dom.formTitle)||void 0===e||e.text(this.settings.i18n.addItemFormTitle||"Add New Item"),null===(i=this.dom.saveButton)||void 0===i||i.text(this.settings.i18n.addItemButtonLabel||this.settings.i18n.saveChangesButton||"Save Item"),null===(n=this.dom.formContainer)||void 0===n||n.slideDown(),null===(a=this.dom.addButton)||void 0===a||a.hide()}},{key:"handleEdit",value:function(t){var e,i,n=this;t.preventDefault();var a=this.$(t.currentTarget),s=a.closest(this.settings.selectors.listItemRow).data("id");if(s)if(this.isEditMode=!0,this.currentItemId=s,this.resetForm(),this.dom.idInput&&this.dom.idInput.length?this.dom.idInput.val(this.currentItemId):this.logger.warn("AdminTableManager: ID input field not found for '".concat(this.settings.tab_id,"'.")),null===(e=this.dom.formTitle)||void 0===e||e.text(this.settings.i18n.editItemFormTitle||"Edit Item #".concat(s)),null===(i=this.dom.saveButton)||void 0===i||i.text(this.settings.i18n.updateChangesButton||"Update Item"),this.settings.actions&&this.settings.actions.get_item)this.showFormLoadingSpinner(!0,this.dom.saveButton),h({url:this.settings.ajaxUrl,data:{action:this.settings.actions.get_item,nonce:this.settings.nonce,item_id:s,option_name:this.settings.option_name,tab_id:this.settings.tab_id}}).then((function(t){if(t&&t.item&&"object"===(0,o.A)(t.item)){var e,i;n.populateFormWithData(t.item),null===(e=n.dom.formContainer)||void 0===e||e.slideDown(),null===(i=n.dom.addButton)||void 0===i||i.hide()}else{var a=t&&t.message?t.message:n.settings.i18n.errorLoadingItem||"Error loading item details.";n.showNotice(a,"error")}})).catch((function(t){n.showNotice(t.message||n.settings.i18n.errorLoadingItem||"AJAX error loading item.","error")})).finally((function(){n.showFormLoadingSpinner(!1,n.dom.saveButton)}));else{var r,c,l=a.data();Object.keys(l).length>1?(l.id=s,this.populateFormWithData(l)):this.showNotice("Note: Full item details might not be loaded. Displaying basic form for editing.","info"),null===(r=this.dom.formContainer)||void 0===r||r.slideDown(),null===(c=this.dom.addButton)||void 0===c||c.hide()}else this.showNotice("Error: Could not determine the item to edit.","error")}},{key:"handleDelete",value:function(t){var e=this;t.preventDefault();var i=this.$(t.currentTarget),n=i.closest(this.settings.selectors.listItemRow),a=n.data("id");if(a){if(confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this item?")){var o=i.text();i.prop("disabled",!0).text(this.settings.i18n.deleting||"Deleting..."),h({url:this.settings.ajaxUrl,data:{action:this.settings.actions.delete_item,nonce:this.settings.nonce,item_id:a,option_name:this.settings.option_name,tab_id:this.settings.tab_id}}).then((function(t){t&&(!0===t.success||t.itemId&&t.message)?(e.showNotice(t.data&&t.data.message||t.message||e.settings.i18n.itemDeletedSuccess||"Item deleted.","success"),n.fadeOut(300,(function(){n.remove(),e.updateNoItemsMessageVisibility()}))):(e.showNotice(t&&t.message||t&&t.data&&t.data.message||e.settings.i18n.errorDeletingItem||"Error deleting item.","error"),i.prop("disabled",!1).text(o))})).catch((function(t){e.showNotice(t.message||e.settings.i18n.errorDeletingItem||"AJAX error deleting item.","error"),i.prop("disabled",!1).text(o)}))}}else this.showNotice("Error: Could not determine item to delete.","error")}},{key:"handleSubmit",value:function(t){var e=this;if(t.preventDefault(),this.validateForm()){this.showFormLoadingSpinner(!0,this.dom.saveButton);var i=this.isEditMode?this.settings.actions.update_item:this.settings.actions.add_item;if(!i)return this.showNotice(this.settings.i18n.errorSavingItem||"Configuration error: Save action not defined.","error"),void this.showFormLoadingSpinner(!1,this.dom.saveButton);var n={action:i,nonce:this.settings.nonce,option_name:this.settings.option_name,tab_id:this.settings.tab_id,item_data:{}};this.dom.form.serializeArray().forEach((function(t){var e=t.name,i=t.value;if(e.endsWith("[]")){var a=e.slice(0,-2);n.item_data[a]||(n.item_data[a]=[]),n.item_data[a].push(i)}else n.item_data[e]=i})),this.isEditMode&&this.currentItemId&&(n.item_id=this.currentItemId),h({url:this.settings.ajaxUrl,data:n}).then((function(t){if(t)if(t&&t.item){var i,n;e.showNotice(t.message||e.settings.i18n.itemSavedSuccess||"Item saved.","success");var a=!e.dom.listTableBody.find("tr").length;e.isEditMode?e.updateTableRow(t.item):(e.addTableRow(t.item),a&&(e.dom.listTable.show(),e.dom.noItemsMessage.hide(),e.dom.listTable[0].offsetHeight)),null===(i=e.dom.formContainer)||void 0===i||i.slideUp(),null===(n=e.dom.addButton)||void 0===n||n.show(),e.resetForm(),e.isEditMode=!1,e.currentItemId=null,e.formModified=!1}else{var o=t&&t.message?t.message:e.settings.i18n.errorSavingItem||"Error saving item or response format incorrect.",s=t&&t.errors?"<br><pre>".concat(JSON.stringify(t.errors,null,2),"</pre>"):"";e.showNotice(o+s,"error")}else e.showNotice(e.settings.i18n.errorSavingItem||"Error: Empty response from server","error")})).catch((function(t){var i=t.message||e.settings.i18n.errorSavingItem||"AJAX error during save.";e.showNotice(i,"error")})).finally((function(){e.showFormLoadingSpinner(!1,e.dom.saveButton)}))}else this.showNotice(this.settings.i18n.validationFailed||"Please correct the errors in the form.","error")}},{key:"handleCancel",value:function(t){var e,i;t.preventDefault(),this.formModified&&!confirm(this.settings.i18n.confirmCancelEditing||"You have unsaved changes. Are you sure you want to cancel?")||(null===(e=this.dom.formContainer)||void 0===e||e.slideUp(),null===(i=this.dom.addButton)||void 0===i||i.show(),this.resetForm(),this.isEditMode=!1,this.currentItemId=null,this.formModified=!1)}},{key:"resetForm",value:function(){var t,e,i;null===(t=this.dom.form[0])||void 0===t||t.reset(),this.dom.idInput&&this.dom.idInput.length&&this.dom.idInput.val(""),this.formModified=!1,null===(e=this.dom.form)||void 0===e||e.find(".error").removeClass("error"),null===(i=this.dom.form)||void 0===i||i.find(".field-error").remove()}},{key:"populateFormWithData",value:function(t){t&&t.id?this.dom.idInput&&this.dom.idInput.length?this.dom.idInput.val(t.id):this.logger.warn("AdminTableManager: ID input field not found when populating form data for '".concat(this.settings.tab_id,"'.")):this.logger.warn("AdminTableManager: Invalid item data (missing ID) when populating form for '".concat(this.settings.tab_id,"'.")),this.formModified=!1}},{key:"validateForm",value:function(){var t,e,i,n=this,a=!0;return null===(t=this.dom.form)||void 0===t||t.find(".error").removeClass("error"),null===(e=this.dom.form)||void 0===e||e.find(".field-error").remove(),null===(i=this.dom.form)||void 0===i||i.find('[data-is-required="true"], .is-required').each((function(t,e){var i=n.$(e),o=i.val();i.is(":checkbox")?i.is(":checked")||(n.showFieldError(i.closest("label").length?i.closest("label"):i,n.settings.i18n.fieldRequired||"This field must be checked."),a=!1):("string"==typeof o&&(o=o.trim()),(null==o||""===o||i.is("select")&&!o)&&(n.showFieldError(i,n.settings.i18n.fieldRequired||"This field is required."),a=!1))})),a}},{key:"addTableRow",value:function(t){var e=this.createTableRow(t);e&&this.dom.listTableBody&&this.dom.listTableBody.length?(this.dom.listTableBody.append(e),this.dom.listTable&&this.dom.listTable.show(),this.dom.noItemsMessage&&this.dom.noItemsMessage.hide()):this.logger.warn("AdminTableManager: Could not add table row - either row creation failed or table body not found for '".concat(this.settings.tab_id,"'."))}},{key:"updateTableRow",value:function(t){var e;if(t.id&&this.settings.selectors&&this.settings.selectors.listItemRow){var i=null===(e=this.dom.listTableBody)||void 0===e?void 0:e.find("".concat(this.settings.selectors.listItemRow,'[data-id="').concat(t.id,'"]'));if(i&&i.length){var n=this.createTableRow(t);n?i.replaceWith(n):this.logger.warn("AdminTableManager: Failed to create replacement row for item #".concat(t.id," in '").concat(this.settings.tab_id,"'."))}else this.addTableRow(t)}}},{key:"createTableRow",value:function(t){var e=this;if(!t||!t.id){var i,n=(null===(i=this.dom.listTable)||void 0===i?void 0:i.find("thead th").length)||4;return this.$('<tr><td colspan="'.concat(n,'">Error: Invalid item data provided to createTableRow.</td></tr>'))}var a=this.settings.table_columns||{};if(0===Object.keys(a).length){var o,r=(null===(o=this.dom.listTable)||void 0===o?void 0:o.find("thead th").length)||4;return this.$('<tr><td colspan="'.concat(r,'">Error: table_columns data missing in settings for ').concat(this.settings.tab_id,".</td></tr>"))}var c=this.settings.selectors||{},l=c.listItemRow||"tr",d=(c.editButton||".pe-edit-item-button").replace(/^\./,""),u=(c.deleteButton||".pe-delete-item-button").replace(/^\./,""),h=this.settings.i18n||{},g=l.split(".")[0].replace(/\[(.*?)\]/g,""),f=this.$("<".concat(g,' data-id="').concat(t.id,'"></').concat(g,">"));return l.includes(".")&&f.addClass(l.substring(l.indexOf(".")+1).replace(/\./g," ")),Object.entries(a).forEach((function(i){var n=(0,s.A)(i,2),a=n[0],o=n[1],r=e.$("<td></td>").addClass("column-".concat(a)).attr("data-colname",o),c="populateColumn_".concat(a.replace(/[^a-zA-Z0-9_]/g,"_"));if("function"==typeof e[c])e[c](r,t,a);else if("item_actions"===a||a.endsWith("_actions")){r.addClass("actions");var l=e.$("<button></button>").attr("type","button").addClass("button button-small ".concat(d)).text(h.editButtonLabel||"Edit").data("id",t.id),g=e.$("<button></button>").attr("type","button").addClass("button button-small ".concat(u)).text(h.deleteButtonLabel||"Delete").data("id",t.id);r.append(l," ",g)}else{var m="".concat(a,"_display"),v=t[m]||t[a]||"";r.text(v)}f.append(r)})),"function"==typeof this.afterRowCreated&&this.afterRowCreated(f,t),f}},{key:"updateNoItemsMessageVisibility",value:function(){if(this.settings.selectors&&this.settings.selectors.listItemRow)if(this.dom.noItemsMessage&&this.dom.noItemsMessage.length&&this.dom.listTableBody&&this.dom.listTable){var t=this.settings.selectors.listItemRow;this.dom.listTableBody.find(t).length>0?(this.dom.noItemsMessage.hide(),this.dom.listTable.show()):(this.dom.noItemsMessage.show(),this.dom.listTable.hide())}else this.logger.warn("AdminTableManager: Required DOM elements for no-items message handling not found for '".concat(this.settings.tab_id,"'."))}},{key:"showFormLoadingSpinner",value:function(t,e){var i=e||this.dom.saveButton;if(i&&i.length){var n="original-text",a=this.settings.i18n&&this.settings.i18n.saving||"Saving...";if(t){if(i.prop("disabled",!0).addClass("pe-loading"),!i.data(n)){var o=i.is("input, textarea, select")?i.val():i.text();i.data(n,o)}i.is("input, textarea, select")?i.val(a):i.text(a)}else if(i.prop("disabled",!1).removeClass("pe-loading"),i.data(n)){var s=i.data(n);i.is("input, textarea, select")?i.val(s):i.text(s),i.removeData(n)}}}}])}(B);function G(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(G=function(){return!!t})()}function J(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}var X=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{mainTabId:"product_additions",localizedDataName:"productAdditionsSettings"}],a=k(a=e),(t=E(i,G()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).productSearchTimeout=null,t.$(document).on("admin_table_manager_ready_".concat(t.config.mainTabId),(function(){t._cacheProductAdditionsDOM(),t._bindSpecificEvents(),t._initializeSelect2()})),t}return M(e,t),(0,a.A)(e,[{key:"_cacheProductAdditionsDOM",value:function(){if(this.settings&&this.settings.selectors){var t=this.settings.selectors;this.dom.relationTypeSelect=this.$container.find(t.relationTypeSelect),this.dom.sourceCategorySelect=this.$container.find(t.sourceCategorySelect),this.dom.targetCategorySelect=this.$container.find(t.targetCategorySelect),this.dom.targetCategoryRow=this.$container.find(t.targetCategoryRow),this.dom.productSearchInput=this.$container.find(t.productSearchInput),this.dom.productSearchRow=this.$container.find(t.productSearchRow),this.dom.productSearchResults=this.$container.find(t.productSearchResults),this.dom.selectedProductIdInput=this.$container.find(t.selectedProductIdInput),this.dom.selectedProductDisplay=this.$container.find(t.selectedProductDisplay),this.dom.clearProductButton=this.$container.find(t.clearProductButton),this.dom.noteTextInput=this.$container.find(t.noteTextInput),this.dom.noteRow=this.$container.find(t.noteRow)}else this.logger.warn("ProductAdditionsSettingsModule: Settings or selectors not available for DOM caching")}},{key:"_bindSpecificEvents",value:function(){var t,e,i,n;this.dom.form&&this.dom.form.length&&(this.dom.form.on("click.productAdditions",".product-result-item",this._handleProductResultClick.bind(this)),null===(t=this.dom.relationTypeSelect)||void 0===t||t.on("change.productAdditions",this._handleRelationTypeChange.bind(this)),null===(e=this.dom.targetCategorySelect)||void 0===e||e.on("change.productAdditions",this._handleTargetCategoryChange.bind(this)),null===(i=this.dom.productSearchInput)||void 0===i||i.on("keyup.productAdditions",this._handleProductSearchKeyup.bind(this)),null===(n=this.dom.clearProductButton)||void 0===n||n.on("click.productAdditions",this._handleClearProduct.bind(this)))}},{key:"_initializeSelect2",value:function(){this.initializeSelect2Dropdowns({elements:[{element:this.dom.sourceCategorySelect,placeholderKey:"selectSourceCategories",fallbackText:"Select source categories",name:"source categories",config:{clearInitial:!0}},{element:this.dom.targetCategorySelect,placeholderKey:"selectTargetCategory",fallbackText:"Select a category",name:"target category",config:{clearInitial:!0}}],moduleName:"Product Additions"})}},{key:"onMainTabActivated",value:function(){J(e,"onMainTabActivated",this,3)([]),this.dom.sourceCategorySelect&&this.dom.sourceCategorySelect.hasClass("select2-hidden-accessible")&&this.refreshSelect2(this.dom.sourceCategorySelect),this.dom.targetCategorySelect&&this.dom.targetCategorySelect.hasClass("select2-hidden-accessible")&&this.refreshSelect2(this.dom.targetCategorySelect)}},{key:"_handleRelationTypeChange",value:function(){var t,e,i,n,a,o,s,r=null===(t=this.dom.relationTypeSelect)||void 0===t?void 0:t.val();if(null===(e=this.dom.targetCategoryRow)||void 0===e||e.hide(),null===(i=this.dom.productSearchRow)||void 0===i||i.hide(),null===(n=this.dom.noteRow)||void 0===n||n.hide(),null===(a=this.dom.targetCategorySelect)||void 0===a||a.val(null).trigger("change.select2"),this._clearProductSelectionFields(),null===(o=this.dom.noteTextInput)||void 0===o||o.val(""),"auto_add_by_category"===r)null===(s=this.dom.targetCategoryRow)||void 0===s||s.show();else if("auto_add_note_by_category"===r){var c;null===(c=this.dom.noteRow)||void 0===c||c.show()}else if("suggest_products_by_category"===r){var l;this.settings.feature_flags&&this.settings.feature_flags.suggested_products_enabled?null===(l=this.dom.targetCategoryRow)||void 0===l||l.show():this.logger.warn("ProductAdditionsSettingsModule: Suggested products feature is disabled in feature flags")}}},{key:"_handleTargetCategoryChange",value:function(){var t,e,i,n,a=null===(t=this.dom.targetCategorySelect)||void 0===t?void 0:t.val(),o=null===(e=this.dom.relationTypeSelect)||void 0===e?void 0:e.val();this._clearProductSelectionFields(),a&&"auto_add_by_category"===o?null===(i=this.dom.productSearchRow)||void 0===i||i.show():null===(n=this.dom.productSearchRow)||void 0===n||n.hide()}},{key:"_clearProductSelectionFields",value:function(){var t,e,i,n;null===(t=this.dom.productSearchInput)||void 0===t||t.val(""),null===(e=this.dom.productSearchResults)||void 0===e||e.empty().hide(),null===(i=this.dom.selectedProductIdInput)||void 0===i||i.val(""),null===(n=this.dom.selectedProductDisplay)||void 0===n||n.hide().find(".selected-product-info").empty()}},{key:"_handleProductSearchKeyup",value:function(t){var e,i,n,a,o=this,s=(null===(e=this.$(t.target).val())||void 0===e?void 0:e.trim())||"",r=null===(i=this.dom.targetCategorySelect)||void 0===i?void 0:i.val();clearTimeout(this.productSearchTimeout),s.length<3||!r?null===(a=this.dom.productSearchResults)||void 0===a||a.empty().hide():(null===(n=this.dom.productSearchResults)||void 0===n||n.html("<p>".concat(this.settings.i18n&&this.settings.i18n.searching||"Searching...","</p>")).show(),this.productSearchTimeout=setTimeout((function(){o._searchProducts(s,r)}),500))}},{key:"_searchProducts",value:function(t,e){var i,n=this;this.settings.actions&&this.settings.actions.search_products?h({url:this.settings.ajaxUrl,data:{action:this.settings.actions.search_products,nonce:this.settings.nonce,search:t,category:e}}).then((function(t){var e=null;if(t&&t.success&&t.data&&Array.isArray(t.data.products)?e=t.data.products:t&&Array.isArray(t.products)&&(e=t.products),e){var i,a="";e.length>0?(a='<ul class="product-results-list">',e.forEach((function(t){var e=n.$("<div>").text(t.name||"").html();a+='<li class="product-result-item" data-id="'.concat(t.id,'" data-name="').concat(e,'">').concat(e||"Unnamed Product"," (ID: ").concat(t.id,")</li>")})),a+="</ul>"):a="<p>".concat(n.settings.i18n&&n.settings.i18n.noProductsFound||"No products found","</p>"),null===(i=n.dom.productSearchResults)||void 0===i||i.html(a).show()}else{var o;null===(o=n.dom.productSearchResults)||void 0===o||o.html("<p>".concat(n.settings.i18n&&n.settings.i18n.errorSearching||"Error searching products","</p>")).show()}})).catch((function(){var t;null===(t=n.dom.productSearchResults)||void 0===t||t.html("<p>".concat(n.settings.i18n&&n.settings.i18n.errorSearching||"Error searching products","</p>")).show()})):null===(i=this.dom.productSearchResults)||void 0===i||i.html("<p>".concat(this.settings.i18n&&this.settings.i18n.errorSearching||"Error: Search action not configured.","</p>")).show()}},{key:"_handleProductResultClick",value:function(t){var e,i,n,a,o,s=this.$(t.currentTarget),r=s.data("id"),c=s.data("name");null===(e=this.dom.selectedProductIdInput)||void 0===e||e.val(r),null===(i=this.dom.selectedProductDisplay)||void 0===i||i.find(".selected-product-info").html("<strong>".concat(c,"</strong> (ID: ").concat(r,")")),null===(n=this.dom.selectedProductDisplay)||void 0===n||n.show(),null===(a=this.dom.productSearchInput)||void 0===a||a.val(""),null===(o=this.dom.productSearchResults)||void 0===o||o.empty().hide(),this.formModified=!0}},{key:"_handleClearProduct",value:function(){var t;this._clearProductSelectionFields(),null===(t=this.dom.productSearchInput)||void 0===t||t.focus(),this.formModified=!0}},{key:"resetForm",value:function(){var t,i,n,a,o,s;J(e,"resetForm",this,3)([]),null===(t=this.dom.relationTypeSelect)||void 0===t||t.val("").trigger("change.productAdditions"),null===(i=this.dom.sourceCategorySelect)||void 0===i||i.val(null).trigger("change.select2"),this._clearProductSelectionFields(),null===(n=this.dom.noteTextInput)||void 0===n||n.val(""),null===(a=this.dom.targetCategoryRow)||void 0===a||a.hide(),null===(o=this.dom.productSearchRow)||void 0===o||o.hide(),null===(s=this.dom.noteRow)||void 0===s||s.hide()}},{key:"populateFormWithData",value:function(t){var i,n=this;J(e,"populateFormWithData",this,3)([t]);var a=t.relation_type||"",o=t.source_category||[],s=t.target_category||"",r=t.product_id||"",c=t.note_text||"";null===(i=this.dom.relationTypeSelect)||void 0===i||i.val(a).trigger("change.productAdditions"),setTimeout((function(){var e,i;if(null===(e=n.dom.sourceCategorySelect)||void 0===e||e.val(o).trigger("change.select2"),"auto_add_by_category"===a){if(null===(i=n.dom.targetCategorySelect)||void 0===i||i.val(s).trigger("change.select2"),r&&t.product_name){var l,d,u;null===(l=n.dom.selectedProductIdInput)||void 0===l||l.val(r);var h=n.$("<div>").text(t.product_name).html();null===(d=n.dom.selectedProductDisplay)||void 0===d||d.find(".selected-product-info").html("<strong>".concat(h,"</strong> (ID: ").concat(r,")")),null===(u=n.dom.selectedProductDisplay)||void 0===u||u.show()}else if(r){var g,f,m;null===(g=n.dom.selectedProductIdInput)||void 0===g||g.val(r),null===(f=n.dom.selectedProductDisplay)||void 0===f||f.find(".selected-product-info").html("Product ID: ".concat(r," (Name not available)")),null===(m=n.dom.selectedProductDisplay)||void 0===m||m.show()}}else if("suggest_products_by_category"===a){var v;n.settings.feature_flags&&n.settings.feature_flags.suggested_products_enabled&&(null===(v=n.dom.targetCategorySelect)||void 0===v||v.val(s).trigger("change.select2"))}else if("auto_add_note_by_category"===a){var p;null===(p=n.dom.noteTextInput)||void 0===p||p.val(c)}n.formModified=!1}),150)}},{key:"validateForm",value:function(){var t,i,n,a,o,s,r,c,l,d=J(e,"validateForm",this,3)([]),u=null===(t=this.dom.relationTypeSelect)||void 0===t?void 0:t.val(),h=null===(i=this.dom.sourceCategorySelect)||void 0===i?void 0:i.val(),g=null===(n=this.dom.targetCategorySelect)||void 0===n?void 0:n.val(),f=null===(a=this.dom.selectedProductIdInput)||void 0===a?void 0:a.val(),m=(null===(o=this.dom.noteTextInput)||void 0===o||null===(o=o.val())||void 0===o?void 0:o.trim())||"",v=this.settings.i18n||{};if(this.clearFieldError(this.dom.relationTypeSelect),this.clearFieldError(null===(s=this.dom.sourceCategorySelect)||void 0===s?void 0:s.next(".select2-container")),this.clearFieldError(null===(r=this.dom.targetCategorySelect)||void 0===r?void 0:r.next(".select2-container")),this.clearFieldError(this.dom.productSearchInput),this.clearFieldError(this.dom.noteTextInput),u||(this.showFieldError(this.dom.relationTypeSelect,v.selectAction||"Please select an action type."),d=!1),h&&0!==h.length||(this.showFieldError(null===(c=this.dom.sourceCategorySelect)||void 0===c?void 0:c.next(".select2-container"),v.selectSourceCategories||"Please select source categories."),d=!1),"auto_add_by_category"===u){if(g||(this.showFieldError(null===(l=this.dom.targetCategorySelect)||void 0===l?void 0:l.next(".select2-container"),v.selectTargetCategory||"Please select a target category."),d=!1),!f){var p,b=null!==(p=this.dom.selectedProductDisplay)&&void 0!==p&&p.is(":visible")?this.dom.selectedProductDisplay:this.dom.productSearchInput;this.showFieldError(b,v.selectProduct||"Please select a product."),d=!1}}else if("suggest_products_by_category"===u){var y;this.settings.feature_flags&&this.settings.feature_flags.suggested_products_enabled&&(g||(this.showFieldError(null===(y=this.dom.targetCategorySelect)||void 0===y?void 0:y.next(".select2-container"),v.selectTargetCategory||"Please select a target category."),d=!1))}else"auto_add_note_by_category"===u&&(m||(this.showFieldError(this.dom.noteTextInput,v.noteTextRequired||"Note text is required."),d=!1));return d}},{key:"populateColumn_source_categories",value:function(t,e){t.text(e.source_category_display||"N/A")}},{key:"populateColumn_action_type",value:function(t,e){var i=this.$("<span></span>").addClass("relation-type pe-relation-".concat(e.relation_type||"unknown")).text(e.action_type_display||e.relation_type||"N/A");t.append(i)}},{key:"populateColumn_target_details",value:function(t,e){t.text(e.target_details_display||"N/A")}},{key:"bindCustomActionButtons",value:function(){this.dom.listTableBody&&this.dom.listTableBody.length&&this.dom.listTableBody.on("click.productAdditions",".pe-view-product-button",this.handleViewProduct.bind(this))}},{key:"handleViewProduct",value:function(t){t.preventDefault();var e=this.$(t.currentTarget).data("product-id");if(e){var i=window.ajaxurl?window.ajaxurl.replace("admin-ajax.php",""):"/wp-admin/",n="".concat(i,"post.php?post=").concat(e,"&action=edit");window.open(n,"_blank")}else this.showNotice("Error: Could not determine the product to view.","error")}}])}(H);function Y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Y=function(){return!!t})()}function Z(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(t){var e="product_additions",i="productAdditionsSettings";if(t("#".concat(e)).length)if(window[i]){if(!window.ProductAdditionsSettingsModuleInstance)try{window.ProductAdditionsSettingsModuleInstance=new X,p("ProductAdditionsInit").log("ProductAdditionsSettingsModule instance initiated.")}catch(t){p("ProductAdditionsInit").error("Error instantiating ProductAdditionsSettingsModule:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Product Additions settings. Check console for errors.","error")}}else p("ProductAdditionsInit").error('Localized data object "'.concat(i,'" not found for tab: ').concat(e,". Module cannot be initialized.")),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice('Configuration data for Product Additions ("'.concat(i,'") is missing. Module disabled.'),"error");else p("ProductAdditionsInit").warn("Main container #".concat(e," not found. ProductAdditionsSettingsModule will not be initialized."))}));var tt=p("LabelSettings"),et=function(t){function e(){return(0,n.A)(this,e),t=this,a=[{mainTabId:"labels",defaultSubTabId:"labels-general",ajaxActionPrefix:"save_labels",localizedDataName:"labelsSettings"}],i=k(i=e),E(t,Y()?Reflect.construct(i,a||[],k(t).constructor):i.apply(t,a));var t,i,a}return M(e,t),(0,a.A)(e,[{key:"bindModuleSpecificEvents",value:function(){Z(e,"bindModuleSpecificEvents",this,3)([]),this.$container&&this.$container.length}},{key:"onMainTabActivated",value:function(){Z(e,"onMainTabActivated",this,3)([])}}])}(B);function it(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(it=function(){return!!t})()}jQuery(document).ready((function(t){if(t("#labels").length){if(!window.ProductEstimatorLabelSettingsModuleInstance)try{window.ProductEstimatorLabelSettingsModuleInstance=new et}catch(t){window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Label Settings. Check console for errors.","error")}}else tt.warn("Container #labels not found. LabelSettingsModule will not be initialized.")}));var nt=function(t){function e(){return(0,n.A)(this,e),t=this,a=[{isModule:!0,settingsObjectName:"featureSwitchesSettings",defaultTabId:"feature_switches"}],i=k(i=e),E(t,it()?Reflect.construct(i,a||[],k(t).constructor):i.apply(t,a));var t,i,a}return M(e,t),(0,a.A)(e,[{key:"moduleInit",value:function(){this.bindEvents()}},{key:"bindEvents",value:function(){this.$(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this))}},{key:"handleTabChanged",value:function(t,e){this.settings.tab_id,this.clearSubTabFromUrl()}}])}(I);function at(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(at=function(){return!!t})()}function ot(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(){jQuery("#feature_switches").length&&(window.FeatureSwitchesSettingsModuleInstance=new nt)}));var st=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{mainTabId:"pricing_rules",defaultSubTabId:"pricing_rules_table",localizedDataName:"pricingRulesSettings"}],a=k(a=e),(t=E(i,at()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).$(document).on("admin_table_manager_ready_".concat(t.config.mainTabId),(function(){t._cachePricingRulesDOM(),t._bindSpecificEvents(),t._initializeSelect2()})),t}return M(e,t),(0,a.A)(e,[{key:"_cachePricingRulesDOM",value:function(){if(this.settings&&this.settings.selectors){var t=this.settings.selectors;this.dom.categoriesSelect=this.$container.find(t.categoriesSelect),this.dom.pricingMethodSelect=this.$container.find(t.pricingMethodSelect),this.dom.pricingSourceSelect=this.$container.find(t.pricingSourceSelect)}else this.logger.warn("PricingRulesSettingsModule: settings or selectors not available for DOM caching")}},{key:"_bindSpecificEvents",value:function(){this.dom.form&&this.dom.form.length}},{key:"_initializeSelect2",value:function(){this.initializeSelect2Dropdowns({elements:[{element:this.dom.categoriesSelect,placeholderKey:"selectCategories",fallbackText:"Select categories",name:"categories",config:{clearInitial:!0}}],moduleName:"Pricing Rules"})}},{key:"onMainTabActivated",value:function(){ot(e,"onMainTabActivated",this,3)([]),this.dom.categoriesSelect&&this.dom.categoriesSelect.hasClass("select2-hidden-accessible")&&this.refreshSelect2(this.dom.categoriesSelect)}},{key:"resetForm",value:function(){var t,i,n;ot(e,"resetForm",this,3)([]),null===(t=this.dom.categoriesSelect)||void 0===t||t.val(null).trigger("change.select2"),null===(i=this.dom.pricingMethodSelect)||void 0===i||i.val(""),null===(n=this.dom.pricingSourceSelect)||void 0===n||n.val("")}},{key:"populateFormWithData",value:function(t){var i=this;ot(e,"populateFormWithData",this,3)([t]);var n=t.categories||[],a=t.pricing_method||"",o=t.pricing_source||"";setTimeout((function(){var t,e,s;null===(t=i.dom.categoriesSelect)||void 0===t||t.val(n).trigger("change.select2"),null===(e=i.dom.pricingMethodSelect)||void 0===e||e.val(a),null===(s=i.dom.pricingSourceSelect)||void 0===s||s.val(o),i.formModified=!1}),150)}},{key:"validateForm",value:function(){var t,i,n,a,o,s=ot(e,"validateForm",this,3)([]),r=null===(t=this.dom.categoriesSelect)||void 0===t?void 0:t.val(),c=null===(i=this.dom.pricingMethodSelect)||void 0===i?void 0:i.val(),l=null===(n=this.dom.pricingSourceSelect)||void 0===n?void 0:n.val(),d=this.settings.i18n||{};return this.clearFieldError(null===(a=this.dom.categoriesSelect)||void 0===a?void 0:a.next(".select2-container")),this.clearFieldError(this.dom.pricingMethodSelect),this.clearFieldError(this.dom.pricingSourceSelect),r&&0!==r.length||(this.showFieldError(null===(o=this.dom.categoriesSelect)||void 0===o?void 0:o.next(".select2-container"),d.selectCategories||"Please select categories."),s=!1),c||(this.showFieldError(this.dom.pricingMethodSelect,d.selectPricingMethod||"Please select a pricing method."),s=!1),l||(this.showFieldError(this.dom.pricingSourceSelect,d.selectPricingSource||"Please select a pricing source."),s=!1),s}},{key:"populateColumn_categories",value:function(t,e){t.text(e.category_names||"N/A")}},{key:"populateColumn_pricing_method",value:function(t,e){t.text(e.pricing_label||"N/A")}}])}(H);function rt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(rt=function(){return!!t})()}function ct(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(t){var e="pricing_rules",i="pricingRulesSettings";if(t("#".concat(e)).length)if(window[i]){if(!window.PricingRulesSettingsModuleInstance)try{window.PricingRulesSettingsModuleInstance=new st}catch(t){p("PricingRulesInit").error("Error instantiating PricingRulesSettingsModule:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Pricing Rules settings. Check console for errors.","error")}}else p("PricingRulesInit").error('Localized data object "'.concat(i,'" not found for tab: ').concat(e,". Module cannot be initialized.")),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice('Configuration data for Pricing Rules ("'.concat(i,'") is missing. Module disabled.'),"error");else p("PricingRulesInit").warn("Main container #".concat(e," not found. PricingRulesSettingsModule will not be initialized."))}));var lt=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{mainTabId:"product_upgrades",localizedDataName:"productUpgradesSettings"}],a=k(a=e),(t=E(i,rt()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).$(document).on("admin_table_manager_ready_".concat(t.config.mainTabId),(function(){t._cacheProductUpgradesDOM(),t._bindSpecificEvents(),t._initializeSelect2()})),t}return M(e,t),(0,a.A)(e,[{key:"_cacheProductUpgradesDOM",value:function(){if(this.settings&&this.settings.selectors){var t=this.settings.selectors;this.dom.baseCategories=this.$container.find(t.baseCategories),this.dom.upgradeCategories=this.$container.find(t.upgradeCategories),this.dom.upgradeTitle=this.$container.find(t.upgradeTitle),this.dom.upgradeDescription=this.$container.find(t.upgradeDescription)}else this.logger.warn("ProductUpgradesSettingsModule: settings or selectors not available for DOM caching")}},{key:"_bindSpecificEvents",value:function(){this.dom.form&&this.dom.form.length}},{key:"_initializeSelect2",value:function(){this.initializeSelect2Dropdowns({elements:[{element:this.dom.baseCategories,placeholderKey:"selectBaseCategories",fallbackText:"Select base categories",name:"base categories",config:{clearInitial:!0,width:"100%"}},{element:this.dom.upgradeCategories,placeholderKey:"selectUpgradeCategories",fallbackText:"Select upgrade categories",name:"upgrade categories",config:{clearInitial:!0,width:"100%"}}],moduleName:"Product Upgrades"})}},{key:"onMainTabActivated",value:function(){ct(e,"onMainTabActivated",this,3)([]),this.dom.baseCategories&&this.dom.baseCategories.hasClass("select2-hidden-accessible")&&this.refreshSelect2(this.dom.baseCategories),this.dom.upgradeCategories&&this.dom.upgradeCategories.hasClass("select2-hidden-accessible")&&this.refreshSelect2(this.dom.upgradeCategories)}},{key:"resetForm",value:function(){var t,i,n,a;ct(e,"resetForm",this,3)([]),null===(t=this.dom.baseCategories)||void 0===t||t.val(null).trigger("change.select2"),null===(i=this.dom.upgradeCategories)||void 0===i||i.val(null).trigger("change.select2"),null===(n=this.dom.upgradeTitle)||void 0===n||n.val(""),null===(a=this.dom.upgradeDescription)||void 0===a||a.val("")}},{key:"populateFormWithData",value:function(t){var i=this;ct(e,"populateFormWithData",this,3)([t]);var n=t.base_categories||[],a=t.upgrade_categories||[],o=t.upgrade_title||t.title||"",s=t.upgrade_description||t.description||"";setTimeout((function(){var t,e,r,c;null===(t=i.dom.baseCategories)||void 0===t||t.val(n).trigger("change.select2"),null===(e=i.dom.upgradeCategories)||void 0===e||e.val(a).trigger("change.select2"),null===(r=i.dom.upgradeTitle)||void 0===r||r.val(o),null===(c=i.dom.upgradeDescription)||void 0===c||c.val(s),i.formModified=!1}),150)}},{key:"validateForm",value:function(){var t,i,n,a,o,s,r=ct(e,"validateForm",this,3)([]),c=null===(t=this.dom.baseCategories)||void 0===t?void 0:t.val(),l=null===(i=this.dom.upgradeCategories)||void 0===i?void 0:i.val(),d=this.settings.i18n||{};return this.clearFieldError(null===(n=this.dom.baseCategories)||void 0===n?void 0:n.next(".select2-container")),this.clearFieldError(null===(a=this.dom.upgradeCategories)||void 0===a?void 0:a.next(".select2-container")),c&&0!==c.length||(this.showFieldError(null===(o=this.dom.baseCategories)||void 0===o?void 0:o.next(".select2-container"),d.selectBaseCategories||"Please select at least one base category."),r=!1),l&&0!==l.length||(this.showFieldError(null===(s=this.dom.upgradeCategories)||void 0===s?void 0:s.next(".select2-container"),d.selectUpgradeCategories||"Please select at least one upgrade category."),r=!1),r}},{key:"populateColumn_base_categories",value:function(t,e){var i=e.base_categories_display||e.base_category_names||(Array.isArray(e.base_categories)?e.base_categories.join(","):"")||"N/A";t.text(i)}},{key:"populateColumn_upgrade_categories",value:function(t,e){var i=e.upgrade_categories_display||e.upgrade_category_names||(Array.isArray(e.upgrade_categories)?e.upgrade_categories.join(","):"")||"N/A";t.text(i)}}])}(H);function dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(dt=function(){return!!t})()}function ut(t,e,i,n){var a=N(k(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof a?function(t){return a.apply(i,t)}:a}jQuery(document).ready((function(t){var e="product_upgrades",i="productUpgradesSettings";if(t("#".concat(e)).length)if(window[i]){if(!window.ProductUpgradesSettingsModuleInstance)try{window.ProductUpgradesSettingsModuleInstance=new lt,p("ProductUpgradesInit").log("ProductUpgradesSettingsModule instance initiated.")}catch(t){p("ProductUpgradesInit").error("Error instantiating ProductUpgradesSettingsModule:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Product Upgrades settings. Check console for errors.","error")}}else p("ProductUpgradesInit").error('Localized data object "'.concat(i,'" not found for tab: ').concat(e,". Module cannot be initialized.")),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice('Configuration data for Product Upgrades ("'.concat(i,'") is missing. Module disabled.'),"error");else p("ProductUpgradesInit").warn("Main container #".concat(e," not found. ProductUpgradesSettingsModule will not be initialized."))}));var ht=function(t){function e(){var t,i,a,o;return(0,n.A)(this,e),i=this,o=[{mainTabId:"similar_products",localizedDataName:"similarProductsSettings"}],a=k(a=e),(t=E(i,dt()?Reflect.construct(a,o||[],k(i).constructor):a.apply(i,o))).$(document).on("admin_table_manager_ready_".concat(t.config.mainTabId),(function(){t._cacheSimilarProductsDOM(),t._bindSpecificEvents(),t._initializeSelect2()})),t}return M(e,t),(0,a.A)(e,[{key:"_cacheSimilarProductsDOM",value:function(){if(this.settings&&this.settings.selectors){var t=this.settings.selectors;this.dom.sourceCategoriesSelect=this.$container.find(t.sourceCategoriesSelect),this.dom.attributesContainer=this.$container.find(t.attributesContainer),this.dom.attributesList=this.$container.find(t.attributesList),this.dom.attributesLoading=this.$container.find(t.attributesLoading),this.dom.selectedAttributesInput=this.$container.find(t.selectedAttributesInput)}else p("SimilarProductsModule").warn("SimilarProductsSettingsModule: settings or selectors not available for DOM caching")}},{key:"_bindSpecificEvents",value:function(){var t;this.dom.form&&this.dom.form.length&&(null===(t=this.dom.sourceCategoriesSelect)||void 0===t||t.on("change.SimilarProducts",this._handleSourceCategoriesChange.bind(this)))}},{key:"_initializeSelect2",value:function(){this.initializeSelect2Dropdowns({elements:[{element:this.dom.sourceCategoriesSelect,placeholderKey:"selectCategoryError",fallbackText:"Select source categories",name:"source categories",config:{clearInitial:!0}}],moduleName:"Similar Products"})}},{key:"onMainTabActivated",value:function(){ut(e,"onMainTabActivated",this,3)([]),this.dom.sourceCategoriesSelect&&this.dom.sourceCategoriesSelect.hasClass("select2-hidden-accessible")}},{key:"_handleSourceCategoriesChange",value:function(){var t,e=null===(t=this.dom.sourceCategoriesSelect)||void 0===t?void 0:t.val();e&&e.length>0?this._fetchAttributesForCategories(e):this._updateAttributeSelectionField([],[])}},{key:"_updateAttributeSelectionField",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.dom.attributesList.empty(),!t||0===t.length)return this.dom.attributesLoading.show(),void this.dom.attributesList.hide();this.dom.attributesLoading.hide(),this.dom.attributesList.show(),"string"==typeof e&&(e=e.split(",").filter(Boolean));var i=t.map((function(t){var i=e.includes(t.name)?"checked":"";return'\n        <div class="attribute-item">\n          <label>\n            <input type="checkbox"\n                   name="attribute_checkbox[]"\n                   value="'.concat(t.name,'"\n                   data-label="').concat(t.label,'"\n                   ').concat(i,">\n            ").concat(t.label,"\n          </label>\n        </div>")})).join("");this.dom.attributesList.html(i),this.dom.attributesList.find('input[type="checkbox"]').on("change",this._handleAttributeCheckboxChange.bind(this)),this._updateSelectedAttributesInput()}},{key:"_fetchAttributesForCategories",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.settings.actions&&this.settings.actions.get_attributes){this.dom.attributesLoading.text(this.settings.i18n.loadingAttributes||"Loading attributes..."),this.dom.attributesLoading.show(),this.dom.attributesList.hide();var n=i||this.dom.selectedAttributesInput.val().split(",").filter(Boolean);h({url:this.settings.ajaxUrl,data:{action:this.settings.actions.get_attributes,nonce:this.settings.nonce,category_ids:t}}).then((function(t){var i=null;t&&t.success&&t.data&&Array.isArray(t.data.attributes)?i=t.data.attributes:t&&Array.isArray(t.attributes)&&(i=t.attributes),i?i.length>0?e._updateAttributeSelectionField(i,n):(e.dom.attributesLoading.text(e.settings.i18n.noAttributes||"No product attributes found for these categories."),e.dom.attributesList.hide()):(e.dom.attributesLoading.text(e.settings.i18n.errorLoading||"Error loading attributes. Please try again."),e.dom.attributesList.hide())})).catch((function(){e.dom.attributesLoading.text(e.settings.i18n.errorLoading||"Error loading attributes. Please try again."),e.dom.attributesList.hide()}))}}},{key:"_handleAttributeCheckboxChange",value:function(){this._updateSelectedAttributesInput()}},{key:"_updateSelectedAttributesInput",value:function(){var t=this,e=[];this.dom.attributesList.find('input[type="checkbox"]:checked').each((function(i,n){e.push(t.$(n).val())})),this.dom.selectedAttributesInput.val(e.join(","))}},{key:"resetForm",value:function(){var t;ut(e,"resetForm",this,3)([]),null===(t=this.dom.sourceCategoriesSelect)||void 0===t||t.val(null).trigger("change.select2"),this.dom.attributesList.empty(),this.dom.attributesLoading.text(this.settings.i18n.selectCategory||"Select categories to load available attributes..."),this.dom.attributesLoading.show(),this.dom.selectedAttributesInput.val("")}},{key:"populateFormWithData",value:function(t){var i=this;ut(e,"populateFormWithData",this,3)([t]);var n=t.source_categories||[],a=Array.isArray(t.attributes)?t.attributes:t.attributes?t.attributes.split(","):[];this.dom.selectedAttributesInput.val(a.join(",")),setTimeout((function(){var t;null===(t=i.dom.sourceCategoriesSelect)||void 0===t||t.val(n).trigger("change.select2"),n.length>0&&a.length>0&&i._fetchAttributesForCategories(n,a),i.formModified=!1}),150)}},{key:"validateForm",value:function(){var t,i,n,a=ut(e,"validateForm",this,3)([]),o=null===(t=this.dom.sourceCategoriesSelect)||void 0===t?void 0:t.val(),s=this.dom.selectedAttributesInput.val(),r=this.settings.i18n||{};return this.clearFieldError(null===(i=this.dom.sourceCategoriesSelect)||void 0===i?void 0:i.next(".select2-container")),this.clearFieldError(this.dom.attributesList),o&&0!==o.length||(this.showFieldError(null===(n=this.dom.sourceCategoriesSelect)||void 0===n?void 0:n.next(".select2-container"),r.selectCategoryError||"Please select at least one source category."),a=!1),s||(this.showFieldError(this.dom.attributesList,r.selectAttributesError||"Please select at least one attribute."),a=!1),a}},{key:"populateColumn_source_categories",value:function(t,e){t.text(e.source_categories_display||"N/A")}},{key:"populateColumn_attributes",value:function(t,e){t.text(e.attributes_display||"None selected")}}])}(H);jQuery(document).ready((function(t){var e="similar_products",i="similarProductsSettings";if(t("#".concat(e)).length)if(window[i]){if(!window.SimilarProductsSettingsModuleInstance)try{window.SimilarProductsSettingsModuleInstance=new ht,p("SimilarProductsInit").log("SimilarProductsSettingsModuleInstance instance initiated.")}catch(t){p("SimilarProductsInit").error("Error instantiating SimilarProductsSettingsModuleInstance:",t),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice("Failed to initialize Similar Products settings. Check console for errors.","error")}}else p("SimilarProductsInit").error('Localized data object "'.concat(i,'" not found for tab: ').concat(e,". Module cannot be initialized.")),window.ProductEstimatorSettingsInstance&&"function"==typeof window.ProductEstimatorSettingsInstance.showNotice&&window.ProductEstimatorSettingsInstance.showNotice('Configuration data for Similar Products ("'.concat(i,'") is missing. Module disabled.'),"error");else p("SimilarProductsInit").warn("Main container #".concat(e," not found. SimilarProductsSettingsModule will not be initialized."))})),p("ProductEstimatorAdmin").log("Product Estimator Admin initialized")}},i={};function n(t){var a=i[t];if(void 0!==a)return a.exports;var o=i[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.m=e,t=[],n.O=(e,i,a,o)=>{if(!i){var s=1/0;for(d=0;d<t.length;d++){for(var[i,a,o]=t[d],r=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((t=>n.O[t](i[c])))?i.splice(c--,1):(r=!1,o<s&&(s=o));if(r){t.splice(d--,1);var l=a();void 0!==l&&(e=l)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,a,o]},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={439:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var a,o,[s,r,c]=i,l=0;if(s.some((e=>0!==t[e]))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(c)var d=c(n)}for(e&&e(i);l<s.length;l++)o=s[l],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(d)},i=self.webpackChunkproduct_estimator=self.webpackChunkproduct_estimator||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a=n.O(void 0,[76],(()=>n(693)));a=n.O(a)})();
//# sourceMappingURL=product-estimator-admin.bundle.js.map