(()=>{"use strict";var e,t={206:(e,t,i)=>{var a=i(29),n=i(901),r=i(470),o=i(690),s=(i(75),i(467));function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){(0,s.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e?e.length<=t?e:e.substring(0,t-i.length)+i:""}var u=i(723);r.ajaxRequest,r.debounce,o.createElement,o.createElementFromHTML,o.closest,o.toggleVisibility,o.forceElementVisibility,o.findParentBySelector,o.insertAfter,o.removeElement,o.addEventListenerOnce;var g=u.validateEmail,p=(u.validateNumber,u.validateRequired,u.showFieldError),h=u.clearFieldError,f=u.showNotice;function m(e){var t;if(null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){for(var i,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];(i=console).log.apply(i,["[".concat(e,"]")].concat(n))}}var v=function(){return(0,n.A)((function e(){var t,i,n,r=this;(0,a.A)(this,e),this.settings={ajaxUrl:(null===(t=window.customerEstimatesAdmin)||void 0===t?void 0:t.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:(null===(i=window.customerEstimatesAdmin)||void 0===i?void 0:i.nonce)||"",i18n:(null===(n=window.customerEstimatesAdmin)||void 0===n?void 0:n.i18n)||{}},jQuery(document).ready((function(){return r.init()}))}),[{key:"init",value:function(){this.bindEvents(),this.initializeActions(),m("CustomerEstimatesAdmin","Initialized")}},{key:"bindEvents",value:function(){var e=this,t=jQuery;t("#doaction, #doaction2").on("click",this.handleBulkAction.bind(this)),t(".email-estimate").on("click",this.handleEmailEstimate.bind(this)),t('select[name="status_filter"]').on("change",(function(){t(this).closest("form").submit()})),t(".wp-list-table tbody tr").hover((function(){t(this).addClass("row-hover")}),(function(){t(this).removeClass("row-hover")})),"function"==typeof t.fn.tooltip&&t(".tooltip-trigger").tooltip(),t("#export-estimates-btn").on("click",this.exportEstimates.bind(this)),t(".print-estimate-btn").on("click",(function(i){i.preventDefault();var a=t(i.currentTarget).data("estimate-id");a&&e.printEstimate(a)}))}},{key:"initializeActions",value:function(){this.addResponsiveTableLabels(),this.handleSearchField(),this.handleAdminNotices()}},{key:"handleBulkAction",value:function(e){var t=jQuery;if("delete"===t(e.target).prev("select").val()){if(0===t('tbody th.check-column input[type="checkbox"]:checked').length)return e.preventDefault(),alert("Please select at least one estimate to delete."),!1;if(!confirm(this.settings.i18n.confirmBulkDelete))return e.preventDefault(),!1}}},{key:"handleEmailEstimate",value:function(e){var t=this;e.preventDefault();var i=jQuery(e.currentTarget),a=i.data("estimate-id"),n=i.text();i.text(this.settings.i18n.emailSending).prop("disabled",!0),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"email_estimate",estimate_id:a,nonce:this.settings.nonce}}).then((function(e){u.showNotice(t.settings.i18n.emailSuccess,"success")})).catch((function(e){var i,a=t.settings.i18n.emailError+(null!==(i=e.data)&&void 0!==i&&i.message?": "+e.data.message:"");u.showNotice(a,"error")})).finally((function(){i.text(n).prop("disabled",!1)}))}},{key:"addResponsiveTableLabels",value:function(){var e=jQuery;e(window).width()<=782&&e(".wp-list-table td").each((function(){var t=e(this),i=t.closest("table").find("th").eq(t.index());i.length&&t.attr("data-label",i.text())}))}},{key:"handleSearchField",value:function(){var e=jQuery("#estimate-search-input");e.length&&!e.val()&&e.focus()}},{key:"handleAdminNotices",value:function(){var e=new URLSearchParams(window.location.search).get("message");if(e){var t="",i="success";switch(e){case"email_sent":t="Email sent successfully!";break;case"email_failed":t="Failed to send email.",i="error";break;case"deleted":t="Estimate deleted successfully!";break;case"delete_failed":t="Failed to delete estimate.",i="error";break;case"duplicated":t="Estimate duplicated successfully!";break;case"duplicate_failed":t="Failed to duplicate estimate.",i="error"}t&&u.showNotice(t,i)}}},{key:"showNotice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";u.showNotice(e,t)}},{key:"exportEstimates",value:function(){var e={},t=jQuery('select[name="status_filter"]').val(),i=jQuery("#estimate-search-input").val();t&&(e.status=t),i&&(e.search=i);var a=new URL(this.settings.ajaxUrl);for(var n in a.searchParams.append("action","export_estimates"),a.searchParams.append("nonce",this.settings.nonce),e)a.searchParams.append(n,e[n]);window.location.href=a.toString()}},{key:"printEstimate",value:function(e){jQuery;var t=window.open("","_blank");t.document.write("<html><head><title>Printing Estimate...</title></head>"),t.document.write("<body><p>Loading estimate for printing...</p></body></html>"),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"get_estimate_print_view",estimate_id:e,nonce:this.settings.nonce}}).then((function(e){t.document.write(e.html),t.document.close(),t.onload=function(){t.print()}})).catch((function(e){var i;t.document.write("<p>Error loading estimate: "+((null===(i=e.data)||void 0===i?void 0:i.message)||"Unknown error")+"</p>"),t.document.close()}))}},{key:"duplicateEstimate",value:function(e){var t=this;e&&confirm(this.settings.i18n.duplicateConfirm)&&r.wpAjax("duplicate_estimate",{estimate_id:e}).then((function(e){t.showNotice(e.message||"Estimate duplicated successfully!"),window.location.reload()})).catch((function(e){t.showNotice(e.message||"Failed to duplicate estimate","error")}))}},{key:"formatDate",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=l(l({},{year:"numeric",month:"short",day:"numeric"}),t),a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?"Invalid date":new Intl.DateTimeFormat(navigator.language,i).format(a)}(e,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},{key:"formatPrice",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(null==e)return"".concat(t,"0.00");var a="string"==typeof e?parseFloat(e):e;return isNaN(a)?"".concat(t,"0.00"):t+a.toFixed(i)}(e,"$")}},{key:"truncateText",value:function(e){return c(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:50)}}])}();jQuery(document).ready((function(){var e=new v;window.CustomerEstimatesAdmin=e})),new(function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e),jQuery(document).ready((function(){t.initializeVariables(),t.bindEvents(),t.isSettingsPage()||t.initializeTabs()}))}),[{key:"isSettingsPage",value:function(){var e=new URLSearchParams(window.location.search).get("page");return e&&e.indexOf("-settings")>-1}},{key:"initializeVariables",value:function(){this.formChanged=!1,this.currentTab="",this.reportData=null,this.chart=null}},{key:"bindEvents",value:function(){var e=jQuery;this.isSettingsPage()||e(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.initializeValidation(),e(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"initializeTabs",value:function(){var e=jQuery,t=e(".nav-tab:first"),i=t.data("tab")||"tab-1";e(".tab-content").hide(),e("#".concat(i)).show(),t.addClass("nav-tab-active"),this.currentTab=i;var a=new URLSearchParams(window.location.search).get("tab");a&&this.switchTab(a)}},{key:"handleTabClick",value:function(e){e.preventDefault();var t=jQuery(e.currentTarget).data("tab");this.formChanged?confirm(productEstimatorAdmin.i18n.unsavedChanges)&&this.switchTab(t):this.switchTab(t)}},{key:"switchTab",value:function(e){var t=jQuery;t(".nav-tab").removeClass("nav-tab-active"),t('.nav-tab[data-tab="'.concat(e,'"]')).addClass("nav-tab-active"),t(".tab-content").hide(),t("#".concat(e)).show(),this.currentTab=e;var i=new URL(window.location);i.searchParams.set("tab",e),window.history.pushState({},"",i),"reports"!==e||this.reportData||this.loadInitialReport()}},{key:"initializeValidation",value:function(){if(!this.isSettingsPage()){var e=jQuery,t=e(".product-estimator-form");t.find('input[type="email"]').on("change",(function(t){var i=e(t.currentTarget),a=i.val();a&&!g(a)?p(i,productEstimatorAdmin.i18n.invalidEmail):h(i)})),t.find('input[type="number"]').on("change",(function(t){var i=e(t.currentTarget),a=parseInt(i.val()),n=parseInt(i.attr("min")),r=parseInt(i.attr("max"));a<n||a>r?p(i,productEstimatorAdmin.i18n.numberRange.replace("%min%",n).replace("%max%",r)):h(i)}))}}},{key:"handleBeforeUnload",value:function(e){if(this.formChanged)return e.preventDefault(),productEstimatorAdmin.i18n.unsavedChanges}},{key:"loadInitialReport",value:function(){console.log("Loading initial report data")}}])}());var y=function(){return(0,n.A)((function e(){(0,a.A)(this,e),this.formChanged=!1,this.currentTab="",this.formChangeTrackers={},this.ensureGlobalVariables(),this.init()}),[{key:"ensureGlobalVariables",value:function(){window.generalSettingsData=window.generalSettingsData||{tab_id:"general",i18n:{}},window.netsuiteSettings=window.netsuiteSettings||{tab_id:"netsuite",i18n:{}},window.notificationSettings=window.notificationSettings||{tab_id:"notifications",i18n:{}},window.productAdditionsSettings=window.productAdditionsSettings||{tab_id:"product_additions",i18n:{}},window.pricingRulesSettings=window.pricingRulesSettings||{tab_id:"pricing_rules",i18n:{}},window.similarProductsL10n=window.similarProductsL10n||{tab_id:"similar_products",i18n:{}},window.productUpgradesSettings=window.productUpgradesSettings||{tab_id:"product_upgrades",i18n:{}},window.productEstimatorSettings=window.productEstimatorSettings||{ajax_url:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:"",i18n:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave this tab?",saveSuccess:"Settings saved successfully.",saveError:"Error saving settings."}}}},{key:"init",value:function(){var e=this.getTabFromUrl();this.currentTab=null!==e?e:"general",jQuery(".tab-content").hide(),jQuery("#".concat(this.currentTab)).show(),jQuery(".nav-tab").removeClass("nav-tab-active"),jQuery('.nav-tab[data-tab="'.concat(this.currentTab,'"]')).addClass("nav-tab-active"),this.bindEvents(),this.initFormChangeTracking(),this.initializeValidation(),m("ProductEstimatorSettings","Settings manager initialized with tab:",this.currentTab)}},{key:"bindEvents",value:function(){var e=jQuery;e(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),e(".product-estimator-form").on("submit",this.handleAjaxFormSubmit.bind(this)),e(window).on("beforeunload",this.handleBeforeUnload.bind(this)),m("ProductEstimatorSettings","Events bound")}},{key:"handleAjaxFormSubmit",value:function(e){var t=this;e.preventDefault();var i=jQuery(e.target),a=i.closest(".tab-content").attr("id"),n=i.serialize();this.showFormLoading(i),m("ProductEstimatorSettings","Submitting form for tab: ".concat(a)),r.ajaxRequest({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_"+a+"_settings",nonce:productEstimatorSettings.nonce,form_data:n}}).then((function(e){u.showNotice(e.message||productEstimatorSettings.i18n.saveSuccess,"success"),t.formChangeTrackers[a]=!1,a===t.currentTab&&(t.formChanged=!1),m("ProductEstimatorSettings","Settings saved successfully for tab: ".concat(a))})).catch((function(e){u.showNotice(e.message||productEstimatorSettings.i18n.saveError,"error"),m("ProductEstimatorSettings","Error saving settings for tab ".concat(a,":"),e)})).finally((function(){t.hideFormLoading(i)}))}},{key:"showFormLoading",value:function(e){var t=e.find(":submit");t.prop("disabled",!0).addClass("loading"),t.data("original-text",t.val()),t.val(productEstimatorSettings.i18n.saving||"Saving...")}},{key:"hideFormLoading",value:function(e){var t=e.find(":submit");t.prop("disabled",!1).removeClass("loading"),t.val(t.data("original-text"))}},{key:"initFormChangeTracking",value:function(){var e=jQuery,t=this;e(".tab-content").each((function(){var i=e(this).attr("id");t.formChangeTrackers[i]=!1,e("#".concat(i," :input")).on("change input",(function(){t.formChangeTrackers[i]=!0,i===t.currentTab&&(t.formChanged=!0)}))})),m("ProductEstimatorSettings","Form change tracking initialized")}},{key:"initializeValidation",value:function(){var e=jQuery;e(".product-estimator-form").each((function(){var t=e(this);t.find('input[type="email"]').on("change",(function(t){var i=e(this),a=i.val();a&&!u.validateEmail(a)?u.showFieldError(i,productEstimatorSettings.i18n.invalidEmail||"Invalid email address"):u.clearFieldError(i)})),t.find('input[type="number"]').on("change",(function(t){var i=e(this),a=parseInt(i.val()),n=parseInt(i.attr("min")||0),r=parseInt(i.attr("max")||9999);if(isNaN(a)||a<n||a>r){var o=productEstimatorSettings.i18n.numberRange?productEstimatorSettings.i18n.numberRange.replace("%min%",n).replace("%max%",r):"Value must be between ".concat(n," and ").concat(r);u.showFieldError(i,o)}else u.clearFieldError(i)}))})),m("ProductEstimatorSettings","Form validation initialized")}},{key:"getTabFromUrl",value:function(){return new URLSearchParams(window.location.search).get("tab")}},{key:"handleTabClick",value:function(e){e.preventDefault();var t=jQuery(e.currentTarget).data("tab");this.formChanged&&!confirm(productEstimatorSettings.i18n.unsavedChanges)||this.switchTab(t)}},{key:"switchTab",value:function(e){var t=jQuery,i=new URL(window.location);i.searchParams.set("tab",e),window.history.pushState({},"",i),t(".nav-tab").removeClass("nav-tab-active"),t('.nav-tab[data-tab="'.concat(e,'"]')).addClass("nav-tab-active"),t(".tab-content").hide(),t("#".concat(e)).show();var a=this.currentTab;this.currentTab=e,this.formChanged=this.formChangeTrackers[e]||!1,t(document).trigger("product_estimator_tab_changed",[e,a]),m("ProductEstimatorSettings","Switched to tab: ".concat(e," from ").concat(a))}},{key:"handleBeforeUnload",value:function(e){var t=!1;for(var i in this.formChangeTrackers)if(this.formChangeTrackers[i]){t=!0;break}if(t){var a=productEstimatorSettings.i18n.unsavedChanges;return e.returnValue=a,a}}},{key:"showFieldError",value:function(e,t){u.showFieldError(e,t)}},{key:"clearFieldError",value:function(e){u.clearFieldError(e)}},{key:"showNotice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";u.showNotice(e,t)}}])}();jQuery(document).ready((function(){window.ProductEstimatorSettings=new y}));var b=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e),jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupValidation(),this.setupWpEditors(),m("GeneralSettingsModule","Initialized")}},{key:"bindEvents",value:function(){var e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),e(".file-upload-button").on("click",this.handleFileUpload.bind(this)),e(".file-remove-button").on("click",this.handleFileRemove.bind(this))}},{key:"setupWpEditors",value:function(){var e=jQuery;0!==e("#general").length&&"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.editors&&0===tinyMCE.editors.length&&"undefined"!=typeof switchEditors&&["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(t){e("#"+t).length>0&&void 0===tinyMCE.get(t)&&switchEditors.go(t,"tmce")}))}},{key:"handleFileUpload",value:function(e){e.preventDefault();var t=jQuery,i=t(e.currentTarget),a=i.data("field-id"),n=i.data("accept")||"";this.mediaFrame||(this.mediaFrame=wp.media({title:"Select or Upload PDF Template",button:{text:"Use this file"},multiple:!1,library:{type:n?[n.split("/")[0]]:null}}),this.mediaFrame.on("select",function(){var e=this.mediaFrame.state().get("selection").first().toJSON();t("#".concat(a)).val(e.id).trigger("change"),i.siblings(".file-preview-wrapper").html('<p class="file-preview"><a href="'.concat(e.url,'" target="_blank">').concat(e.filename,"</a></p>")),i.siblings(".file-remove-button").removeClass("hidden")}.bind(this))),this.mediaFrame.open()}},{key:"handleFileRemove",value:function(e){e.preventDefault();var t=jQuery,i=t(e.currentTarget),a=i.data("field-id");t("#".concat(a)).val("").trigger("change"),i.siblings(".file-preview-wrapper").empty(),i.addClass("hidden")}},{key:"setupValidation",value:function(){var e=jQuery;e("#default_markup").on("change input",this.validateMarkup.bind(this)),e("#estimate_expiry_days").on("change input",this.validateExpiryDays.bind(this))}},{key:"validateMarkup",value:function(e){var t=jQuery(e.currentTarget),i=parseInt(t.val()),a=parseInt(t.attr("min")||0),n=parseInt(t.attr("max")||100);return isNaN(i)||i<a||i>n?(p(t,generalSettingsData.i18n.validationErrorMarkup||"Value must be between ".concat(a," and ").concat(n)),!1):(h(t),!0)}},{key:"validateExpiryDays",value:function(e){var t=jQuery(e.currentTarget),i=parseInt(t.val()),a=parseInt(t.attr("min")||1),n=parseInt(t.attr("max")||365);return isNaN(i)||i<a||i>n?(p(t,generalSettingsData.i18n.validationErrorExpiry||"Value must be between ".concat(a," and ").concat(n)),!1):(h(t),!0)}},{key:"showFieldError",value:function(e,t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError?ProductEstimatorSettings.showFieldError(e,t):p(e,t)}},{key:"clearFieldError",value:function(e){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(e):h(e)}},{key:"handleTabChanged",value:function(e,t){t===generalSettingsData.tab_id&&(this.setupWpEditors(),m("GeneralSettingsModule","Tab changed to General Settings, refreshing editors"))}},{key:"saveEditorContent",value:function(){"undefined"!=typeof tinyMCE&&["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(e){var t=tinyMCE.get(e);t&&t.save()}))}},{key:"validateAllFields",value:function(){var e=!0;return this.saveEditorContent(),this.validateMarkup({currentTarget:jQuery("#default_markup")})||(e=!1),this.validateExpiryDays({currentTarget:jQuery("#estimate_expiry_days")})||(e=!1),e}},{key:"showNotice",value:function(e){f(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success")}}])}();jQuery(document).ready((function(){var e=new b,t=jQuery("form.product-estimator-form").submit;jQuery("form.product-estimator-form").submit((function(i){return void 0!==b&&e.saveEditorContent(),t.apply(this,arguments)})),window.GeneralSettingsModule=e}));var _=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e),jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){m("NetsuiteSettingsModule","Initializing NetSuite settings module"),this.bindEvents(),this.setupDependentFields()}},{key:"bindEvents",value:function(){var e=jQuery;e("#test-netsuite-connection").on("click",this.testNetsuiteConnection.bind(this)),e("#netsuite_enabled").on("change",this.toggleNetsuiteFields.bind(this)),e("#netsuite_api_url, #netsuite_token_url").on("change",this.validateUrl.bind(this)),e("#netsuite_request_limit").on("change",this.validateRequestLimit.bind(this)),e("#netsuite_cache_time").on("change",this.validateCacheTime.bind(this)),e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),m("NetsuiteSettingsModule","Events bound successfully")}},{key:"setupDependentFields",value:function(){this.toggleNetsuiteFields(),m("NetsuiteSettingsModule","Dependent fields setup complete")}},{key:"toggleNetsuiteFields",value:function(){var e=jQuery,t=e("#netsuite_enabled").is(":checked"),i=e("#netsuite_client_id, #netsuite_client_secret, #netsuite_api_url, #netsuite_token_url, #netsuite_request_limit, #netsuite_cache_time").closest("tr");t?(i.fadeIn(200),e("#test-netsuite-connection").closest("p").fadeIn(200)):(i.fadeOut(200),e("#test-netsuite-connection").closest("p").fadeOut(200)),m("NetsuiteSettingsModule","NetSuite fields toggled: ".concat(t?"visible":"hidden"))}},{key:"testNetsuiteConnection",value:function(){var e=jQuery,t=e("#test-netsuite-connection"),i=e("#connection-result");t.prop("disabled")||(t.prop("disabled",!0),i.html('<span style="color:#666;">'.concat(netsuiteSettings.i18n.testing||"Testing connection...","</span>")),m("NetsuiteSettingsModule","Testing NetSuite connection"),(0,r.ajaxRequest)({url:netsuiteSettings.ajax_url,type:"POST",data:{action:"test_netsuite_connection",nonce:netsuiteSettings.nonce}}).then((function(e){i.html('<span style="color:green;">'.concat(e.message,"</span>")),m("NetsuiteSettingsModule","Connection test successful")})).catch((function(e){i.html('<span style="color:red;">'.concat(netsuiteSettings.i18n.error||"Error:"," ").concat(e.message,"</span>")),m("NetsuiteSettingsModule","Connection test failed:",e)})).finally((function(){t.prop("disabled",!1)})))}},{key:"handleTabChanged",value:function(e,t){t===netsuiteSettings.tab_id&&(this.toggleNetsuiteFields(),m("NetsuiteSettingsModule","Tab changed to NetSuite settings, refreshing fields"))}},{key:"validateUrl",value:function(e){var t=jQuery(e.currentTarget),i=t.val().trim();return i&&!this.isValidUrl(i)?(this.showFieldError(t,netsuiteSettings.i18n.invalidUrl||"Please enter a valid URL"),!1):(this.clearFieldError(t),!0)}},{key:"validateRequestLimit",value:function(e){var t=jQuery(e.currentTarget),i=parseInt(t.val(),10);return isNaN(i)||i<1||i>100?(this.showFieldError(t,"Request limit must be between 1 and 100"),!1):(this.clearFieldError(t),!0)}},{key:"validateCacheTime",value:function(e){var t=jQuery(e.currentTarget),i=parseInt(t.val(),10);return isNaN(i)||i<0?(this.showFieldError(t,"Cache time must be at least 0"),!1):(this.clearFieldError(t),!0)}},{key:"isValidUrl",value:function(e){try{return new URL(e),!0}catch(e){return!1}}},{key:"showFieldError",value:function(e,t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError?ProductEstimatorSettings.showFieldError(e,t):(0,u.showFieldError)(e,t)}},{key:"clearFieldError",value:function(e){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(e):(0,u.clearFieldError)(e)}},{key:"addInfoSection",value:function(e){var t=jQuery,i=t("#netsuite-settings-table");if(i.length&&e){t(".netsuite-info-section").remove();var a=(0,o.createElement)("div",{className:"netsuite-info-section notice notice-info",style:{padding:"10px",marginBottom:"15px"}},e);i.before(a),m("NetsuiteSettingsModule","Added info section to settings page")}}}])}();jQuery(document).ready((function(){var e=new _;window.NetsuiteSettingsModule=e}));var w=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e);var i=window.pricingRulesSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"pricing_rules"},jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){m("PricingRulesSettingsModule","Initializing Pricing Rules Settings Module"),this.bindEvents(),this.setupFormHandling(),this.initializeDefaultSettingsForm()}},{key:"bindEvents",value:function(){jQuery(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRuleHandlers()}},{key:"initializeDefaultSettingsForm",value:function(){jQuery(".default-pricing-form").on("submit",(function(e){e.preventDefault(),"undefined"!=typeof ProductEstimatorSettings&&(ProductEstimatorSettings.formChanged=!0,ProductEstimatorSettings.handleAjaxFormSubmit(e))}))}},{key:"initRuleHandlers",value:function(){var e=jQuery,t=(e(".product-estimator-pricing-rules"),e("#pricing-rule-form")),i=e(".pricing-rules-form"),a=e(".add-new-rule");e("#categories").select2({placeholder:"Select categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),a.on("click",function(){m("PricingRulesSettingsModule","Add New Pricing Rule button clicked"),this.resetForm(),e(".form-title").text(this.settings.i18n.addNew||"Add New Pricing Rule"),e(".save-rule").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),e(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),t.on("submit",this.handleFormSubmission.bind(this)),e(".pricing-rules-list").on("click",".edit-rule",this.handleEditRule.bind(this)),e(".pricing-rules-list").on("click",".delete-rule",this.handleDeleteRule.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(e,t){t===this.settings.tab_id&&this.init()}},{key:"resetForm",value:function(){var e=jQuery;e("#pricing-rule-form")[0].reset(),e("#rule_id").val(""),e("#categories").val(null).trigger("change")}},{key:"toggleFormState",value:function(e){var t=jQuery,i=t("#pricing-rule-form"),a=i.find(".save-rule"),n=i.find(".cancel-form");i.find("input, select").prop("disabled",!e),a.prop("disabled",!e),n.prop("disabled",!e),e?a.text(t("#rule_id").val()?"Update Pricing Rule":"Save Pricing Rule"):a.text("Saving..."),e?t("#categories").prop("disabled",!1).trigger("change"):t("#categories").prop("disabled",!0).trigger("change")}},{key:"handleFormSubmission",value:function(e){var t=this;e.preventDefault();var i=jQuery,a=i("#categories").val(),n=i("#pricing_method").val(),o=i("#pricing_source").val();if(a&&0!==a.length)if(n)if(o){this.toggleFormState(!1);var s={action:"save_pricing_rule",nonce:this.settings.nonce,rule_id:i("#rule_id").val(),categories:a,pricing_method:n,pricing_source:o};m("PricingRulesSettingsModule","Sending form data:",s),r.ajaxRequest({url:this.settings.ajaxUrl,data:s}).then((function(e){if(m("PricingRulesSettingsModule","Response received:",e),t.showMessage("success",e.message),s.rule_id){m("PricingRulesSettingsModule","Updating existing rule:",s.rule_id);var a=i(".pricing-rules-list").find('tr[data-id="'.concat(s.rule_id,'"]'));a.length?a.replaceWith(t.createRuleRow(e.rule)):t.appendRuleRow(e.rule)}else t.appendRuleRow(e.rule);i(".pricing-rules-form").slideUp(),t.resetForm();var n=i(".pricing-rules-list").find(".no-items");if(n.length&&(n.remove(),!i(".pricing-rules-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped pricing-rules-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Categories",'</th>\n                    <th scope="col">',"Pricing Method",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".pricing-rules-list").find("h3").after(r)}})).catch((function(e){t.showMessage("error",e.message||"Error saving pricing rule. Please try again."),m("PricingRulesSettingsModule","Error saving pricing rule:",e)})).finally((function(){t.toggleFormState(!0)}))}else alert(this.settings.i18n.selectPricingSource||"Please select a pricing source");else alert(this.settings.i18n.selectPricingMethod||"Please select a pricing method");else alert(this.settings.i18n.selectCategories||"Please select at least one category")}},{key:"handleEditRule",value:function(e){var t=jQuery,i=t(e.currentTarget),a=i.data("id"),n=String(i.data("categories")).split(","),r=i.data("method"),o=i.data("source");m("PricingRulesSettingsModule","Edit rule:",a,n,r,o),this.resetForm(),t("#rule_id").val(a),t("#pricing_method").val(r),t("#pricing_source").val(o),setTimeout((function(){t("#categories").val(n).trigger("change")}),100),t(".form-title").text("Edit Pricing Rule"),t(".save-rule").text("Update Pricing Rule"),t(".pricing-rules-form").slideDown(),t("html, body").animate({scrollTop:t(".pricing-rules-form").offset().top-50},300)}},{key:"handleDeleteRule",value:function(e){var t=this,i=jQuery,a=i(e.currentTarget),n=a.data("id");m("PricingRulesSettingsModule","Delete rule:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this pricing rule?")&&(a.prop("disabled",!0).text("Deleting..."),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"delete_pricing_rule",nonce:this.settings.nonce,rule_id:n}}).then((function(e){m("PricingRulesSettingsModule","Delete response:",e);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".pricing-rules-list").find("tbody tr").length||(i(".pricing-rules-list").find("table").remove(),i(".pricing-rules-list").append('<div class="no-items">No pricing rules have been created yet.</div>'))})),t.showMessage("success",e.message)})).catch((function(e){t.showMessage("error",e.message||"Error deleting pricing rule. Please try again."),a.prop("disabled",!1).text("Delete"),m("PricingRulesSettingsModule","Error deleting rule:",e)})))}},{key:"createRuleRow",value:function(e){var t=jQuery,i=t("<tr></tr>").attr("data-id",e.id);i.append(t("<td></td>").text(e.category_names)),i.append(t("<td></td>").text(e.pricing_label));var a=t("<td></td>").addClass("actions"),n=o.createElement("button",{className:"button button-small edit-rule",type:"button",dataset:{id:e.id,categories:Array.isArray(e.categories)?e.categories.join(","):"",method:e.pricing_method,source:e.pricing_source}},"Edit"),r=o.createElement("button",{className:"button button-small delete-rule",type:"button",dataset:{id:e.id}},"Delete");return a.append(t(n)," ",t(r)),i.append(a),i}},{key:"appendRuleRow",value:function(e){var t=jQuery(".pricing-rules-table").find("tbody"),i=this.createRuleRow(e);t.append(i)}},{key:"showMessage",value:function(e,t){var i=jQuery,a=i(".product-estimator-pricing-rules"),n=a.find(".notice");if(n.length&&n.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice){var r=o.createElement("div",{className:"notice notice-".concat("success"===e?"success":"error")}),s=o.createElement("p",{},t);r.appendChild(s),a.find("h1, h3").first().after(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}else ProductEstimatorSettings.showNotice(t,e)}}])}();jQuery(document).ready((function(){var e=jQuery("#pricing_rules");if(e.length&&e.is(":visible")){var t=new w;window.PricingRulesSettingsModule=t}else jQuery(document).on("product_estimator_tab_changed",(function(e,t){"pricing_rules"===t&&setTimeout((function(){var e=new w;window.PricingRulesSettingsModule=e}),100)}))}));var S=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e);var i=window.productAdditionsSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"product_additions"},this.formModified=!1,jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){m("ProductAdditionsSettingsModule","Initializing Product Additions Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var e=this,t=jQuery;t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRelationshipHandlers(),t("#product-addition-form").on("change input","input, select, textarea",(function(){e.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initRelationshipHandlers",value:function(){var e,t=jQuery,i=(t(".product-estimator-additions"),t("#product-addition-form")),a=t(".product-additions-form"),n=t(".add-new-relation"),r=t("#relation_type"),o=t(".target-category-row"),s=t("#target_category"),d=t(".product-search-row"),l=t(".note-row");t("#source_category").select2({placeholder:"Select source categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),t("#target_category").select2({placeholder:"Select a category",width:"100%",allowClear:!0,dropdownCssClass:"product-estimator-dropdown"}),n.on("click",function(){m("ProductAdditionsSettingsModule","Add New Relationship button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Relationship"),t(".save-relation").text(this.settings.i18n.saveChanges||"Save Changes"),a.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){a.slideUp(),this.resetForm()}.bind(this)),r.on("change",(function(){var e=t(this).val();s.val("").trigger("change"),d.hide(),t("#selected-product").hide(),t("#selected_product_id").val(""),l.hide(),t("#note_text").val(""),"auto_add_by_category"===e?(o.show(),l.hide()):"auto_add_note_by_category"===e?(o.hide(),l.show()):"suggest_products_by_category"===e?(o.show(),l.hide(),d.hide()):(o.hide(),l.hide())})),s.on("change",(function(){var e=t(this).val(),i=r.val();t("#product_search").val(""),t("#product-search-results").empty(),t("#selected-product").hide(),t("#selected_product_id").val(""),e&&"auto_add_by_category"===i?d.show():d.hide()})),t("#product_search").on("keyup",function(i){var a=this,n=t(i.target).val()||"",r=s.val();clearTimeout(e),n.length<3?t("#product-search-results").empty():e=setTimeout((function(){a.searchProducts(n,r)}),500)}.bind(this)),t(".clear-product").on("click",(function(){t("#selected_product_id").val(""),t(".selected-product-info").empty(),t("#selected-product").hide()})),i.on("submit",this.handleFormSubmission.bind(this)),t(".product-additions-list").on("click",".edit-relation",this.handleEditRelation.bind(this)),t(".product-additions-list").on("click",".delete-relation",this.handleDeleteRelation.bind(this))}},{key:"setupFormHandling",value:function(){var e=jQuery;e(document).on("click",".product-result-item",(function(t){var i=e(t.currentTarget).data("id"),a=e(t.currentTarget).data("name");m("ProductAdditionsSettingsModule","Product selected:",i,a),e("#selected_product_id").val(i),m("ProductAdditionsSettingsModule","Product ID set to:",e("#selected_product_id").val()),e(".selected-product-info").html("<strong>".concat(a,"</strong> (ID: ").concat(i,")")),e("#selected-product").show(),e("#product_search").val(""),e("#product-search-results").empty()}))}},{key:"handleTabChanged",value:function(e,t){t===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var e=jQuery;e("#product-addition-form")[0].reset(),e("#relation_id").val(""),e("#selected_product_id").val(""),e("#source_category").val(null).trigger("change"),e("#target_category").val(null).trigger("change"),e("#relation_type").val("").trigger("change"),e(".target-category-row").hide(),e(".product-search-row").hide(),e("#selected-product").hide(),e("#product-search-results").empty(),e(".note-row").hide(),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(e){var t=jQuery,i=t("#product-addition-form"),a=i.find(".save-relation"),n=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!e),a.prop("disabled",!e),n.prop("disabled",!e),e?a.text(t("#relation_id").val()?"Update Relationship":"Save Relationship"):a.text("Saving..."),e?(t("#source_category").prop("disabled",!1).trigger("change"),t("#target_category").prop("disabled",!1).trigger("change")):(t("#source_category").prop("disabled",!0).trigger("change"),t("#target_category").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(e){var t=this;e.preventDefault();var i=jQuery,a=i("#relation_type").val(),n=i("#source_category").val(),o=i("#selected_product_id").val(),s=i("#note_text").val();if(a)if(n&&0!==n.length){if("auto_add_by_category"===a){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category");if(!o)return void alert(this.settings.i18n.selectProduct||"Please select a product")}else if("suggest_products_by_category"===a){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category")}else if("auto_add_note_by_category"===a&&!s)return void alert("Please enter a note text");this.toggleFormState(!1);var d={action:"save_category_relation",nonce:this.settings.nonce,relation_id:i("#relation_id").val(),relation_type:a,source_category:n,target_category:i("#target_category").val(),product_id:o,note_text:s};m("ProductAdditionsSettingsModule","Sending form data:",d),r.ajaxRequest({url:this.settings.ajaxUrl,data:d}).then((function(e){if(m("ProductAdditionsSettingsModule","Response received:",e),t.showMessage("success",e.message),d.relation_id){m("ProductAdditionsSettingsModule","Updating existing relation:",d.relation_id);var a=i(".product-additions-list").find('tr[data-id="'.concat(d.relation_id,'"]'));a.length?a.replaceWith(t.createRelationRow(e.relation)):t.appendRelationRow(e.relation)}else t.appendRelationRow(e.relation);i(".product-additions-form").slideUp(),t.resetForm();var n=i(".product-additions-list").find(".no-items");if(n.length&&(n.remove(),!i(".product-additions-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-additions-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Source Categories",'</th>\n                    <th scope="col">',"Action",'</th>\n                    <th scope="col">',"Target/Note",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-additions-list").find("h3").after(r)}t.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(e){t.showMessage("error",e.message||"Error saving relationship. Please try again."),m("ProductAdditionsSettingsModule","Error saving relationship:",e)})).finally((function(){t.toggleFormState(!0)}))}else alert(this.settings.i18n.selectSourceCategories||"Please select at least one source category");else alert(this.settings.i18n.selectAction||"Please select an action type")}},{key:"handleEditRelation",value:function(e){var t=jQuery,i=t(e.currentTarget),a=i.data("id"),n=String(i.data("source")||"").split(","),r=i.data("target"),o=i.data("type"),s=i.data("product-id"),d=i.data("note-text");m("ProductAdditionsSettingsModule","Edit relation:",a,n,r,o,s,d),this.resetForm(),t("#relation_id").val(a),t("#relation_type").val(o).trigger("change"),setTimeout(function(){t("#source_category").val(n).trigger("change"),"auto_add_by_category"===o&&r?(t("#target_category").val(r).trigger("change"),s&&this.loadProductDetails(s)):"suggest_products_by_category"===o&&r?t("#target_category").val(r).trigger("change"):"auto_add_note_by_category"===o&&d&&t("#note_text").val(d)}.bind(this),100),t(".form-title").text("Edit Category Relationship"),t(".save-relation").text("Update Relationship"),t(".product-additions-form").slideDown(),t("html, body").animate({scrollTop:t(".product-additions-form").offset().top-50},300)}},{key:"handleDeleteRelation",value:function(e){var t=this,i=jQuery,a=i(e.currentTarget),n=a.data("id");m("ProductAdditionsSettingsModule","Delete relation:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this relationship?")&&(a.prop("disabled",!0).text("Deleting..."),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"delete_category_relation",nonce:this.settings.nonce,relation_id:n}}).then((function(e){m("ProductAdditionsSettingsModule","Delete response:",e);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".product-additions-list").find("tbody tr").length||(i(".product-additions-list").find("table").remove(),i(".product-additions-list").append('<div class="no-items">No relationships have been created yet.</div>'))})),t.showMessage("success",e.message)})).catch((function(e){t.showMessage("error",e.message||"Error deleting relationship. Please try again."),a.prop("disabled",!1).text("Delete"),m("ProductAdditionsSettingsModule","Error deleting relationship:",e)})))}},{key:"searchProducts",value:function(e,t){var i=jQuery;e&&t?(i("#product-search-results").html("<p>Searching...</p>"),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"search_category_products",nonce:this.settings.nonce,search:e,category:t}}).then((function(e){if(e.products&&e.products.length>0){var t='<ul class="product-results-list">';e.products.forEach((function(e){t+='\n              <li class="product-result-item" data-id="'.concat(e.id,'" data-name="').concat(e.name,'">\n                ').concat(e.name," (ID: ").concat(e.id,")\n              </li>\n            ")})),t+="</ul>",i("#product-search-results").html(t)}else i("#product-search-results").html("<p>No products found</p>")})).catch((function(e){m("ProductAdditionsSettingsModule","AJAX error:",e),i("#product-search-results").html("<p>Error searching products</p>")}))):i("#product-search-results").html("<p>Please enter search term and select a category</p>")}},{key:"loadProductDetails",value:function(e){var t=jQuery;e&&r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"get_product_details",nonce:this.settings.nonce,product_id:e}}).then((function(e){if(e.product){var i=e.product;t("#selected_product_id").val(i.id),t(".selected-product-info").html("<strong>".concat(i.name,"</strong> (ID: ").concat(i.id,")")),t("#selected-product").show()}else m("ProductAdditionsSettingsModule","Failed to load product details:",e)})).catch((function(e){m("ProductAdditionsSettingsModule","AJAX error while loading product details:",e)}))}},{key:"createRelationRow",value:function(e){var t=jQuery;if(!e||!e.id)return m("ProductAdditionsSettingsModule","Invalid relation data",e),t('<tr><td colspan="4">Error: Invalid relation data</td></tr>');var i=t("<tr></tr>").attr("data-id",e.id),a=e.source_name||"";i.append(t("<td></td>").text(a));var n,r=t("<td></td>"),s=t("<span></span>").addClass("relation-type").addClass(e.relation_type||"");n="auto_add_by_category"===e.relation_type?"Auto add product with Category":"auto_add_note_by_category"===e.relation_type?"Auto add note with Category":"suggest_products_by_category"===e.relation_type?"Suggest products when Category":e.relation_type_label||"",s.text(n),r.append(s),i.append(r);var d=t("<td></td>");if("auto_add_by_category"===e.relation_type)e.product_name?d.text(e.product_name):e.target_name&&d.text(e.target_name+" (Category)");else if("auto_add_note_by_category"===e.relation_type){var l=e.note_text&&e.note_text.length>50?c(e.note_text,50):e.note_text||"";d.text(l)}else"suggest_products_by_category"===e.relation_type&&e.target_name&&d.text(e.target_name+" (Category)");i.append(d);var u=t("<td></td>").addClass("actions"),g=Array.isArray(e.source_category)?e.source_category.join(","):e.source_category||"",p=o.createElement("button",{className:"button button-small edit-relation",type:"button",dataset:{id:e.id,source:g,target:e.target_category||"",productId:e.product_id||"",type:e.relation_type||"",noteText:e.note_text||""}},"Edit"),h=o.createElement("button",{className:"button button-small delete-relation",type:"button",dataset:{id:e.id}},"Delete");return u.append(t(p)," ",t(h)),i.append(u),i}},{key:"appendRelationRow",value:function(e){var t=jQuery;if(e&&e.id){var i=t(".product-additions-table");if(i.length){var a=i.find("tbody");if(a.length){var n=this.createRelationRow(e);a.append(n)}else m("ProductAdditionsSettingsModule","Cannot append row: Table body not found")}else m("ProductAdditionsSettingsModule","Cannot append row: Table not found")}else m("ProductAdditionsSettingsModule","Cannot append row: Invalid relation data",e)}},{key:"showMessage",value:function(e,t){var i=jQuery,a=i(".product-estimator-additions");if(a.length){var n=a.find(".notice");if(n.length&&n.remove(),"function"==typeof u.showNotice)u.showNotice(t,e);else{var r=o.createElement("div",{className:"notice ".concat("success"===e?"notice-success":"notice-error")}),s=o.createElement("p",{},t);r.appendChild(s),a.prepend(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}}else m("ProductAdditionsSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var e=jQuery("#product_additions");if(e.length&&e.is(":visible")){var t=new S;window.ProductAdditionsSettingsModule=t}else jQuery(document).on("product_estimator_tab_changed",(function(e,t){"product_additions"===t&&setTimeout((function(){var e=new S;window.ProductAdditionsSettingsModule=e}),100)}))}));var E=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e);var i=window.productUpgradesSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"product_upgrades"},this.formModified=!1,jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){m("ProductUpgradesSettingsModule","Initializing Product Upgrades Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var e=this,t=jQuery;t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initUpgradeHandlers(),t("#product-upgrade-form").on("change input","input, select, textarea",(function(){e.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initUpgradeHandlers",value:function(){var e=jQuery,t=(e(".product-estimator-upgrades"),e("#product-upgrade-form")),i=e(".product-upgrades-form"),a=e(".add-new-upgrade");e("#base_categories").select2({placeholder:"Select base categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),e("#upgrade_categories").select2({placeholder:"Select upgrade categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),a.on("click",function(){m("ProductUpgradesSettingsModule","Add New Upgrade Configuration button clicked"),this.resetForm(),e(".form-title").text(this.settings.i18n.addNew||"Add New Upgrade Configuration"),e(".save-upgrade").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),e(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),t.on("submit",this.handleFormSubmission.bind(this)),e(".product-upgrades-list").on("click",".edit-upgrade",this.handleEditUpgrade.bind(this)),e(".product-upgrades-list").on("click",".delete-upgrade",this.handleDeleteUpgrade.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(e,t){t===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var e=jQuery;e("#product-upgrade-form")[0].reset(),e("#upgrade_id").val(""),e("#base_categories").val(null).trigger("change"),e("#upgrade_categories").val(null).trigger("change"),e("#display_mode").val("dropdown").trigger("change"),e("#upgrade_title").val(""),e("#upgrade_description").val(""),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(e){var t=jQuery,i=t("#product-upgrade-form"),a=i.find(".save-upgrade"),n=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!e),a.prop("disabled",!e),n.prop("disabled",!e),e?a.text(t("#upgrade_id").val()?"Update Configuration":"Save Configuration"):a.text("Saving..."),e?(t("#base_categories").prop("disabled",!1).trigger("change"),t("#upgrade_categories").prop("disabled",!1).trigger("change")):(t("#base_categories").prop("disabled",!0).trigger("change"),t("#upgrade_categories").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(e){var t=this;e.preventDefault();var i=jQuery,a=i("#base_categories").val(),n=i("#upgrade_categories").val(),o=i("#display_mode").val(),s=i("#upgrade_title").val(),d=i("#upgrade_description").val();if(a&&0!==a.length)if(n&&0!==n.length){this.toggleFormState(!1);var l={action:"save_product_upgrade",nonce:this.settings.nonce,upgrade_id:i("#upgrade_id").val(),base_categories:a,upgrade_categories:n,display_mode:o,upgrade_title:s,upgrade_description:d};m("ProductUpgradesSettingsModule","Sending form data:",l),r.ajaxRequest({url:this.settings.ajaxUrl,data:l}).then((function(e){if(m("ProductUpgradesSettingsModule","Response received:",e),t.showMessage("success",e.message),l.upgrade_id){m("ProductUpgradesSettingsModule","Updating existing upgrade:",l.upgrade_id);var a=i(".product-upgrades-list").find('tr[data-id="'.concat(l.upgrade_id,'"]'));a.length?a.replaceWith(t.createUpgradeRow(e.upgrade)):t.appendUpgradeRow(e.upgrade)}else t.appendUpgradeRow(e.upgrade);i(".product-upgrades-form").slideUp(),t.resetForm();var n=i(".product-upgrades-list").find(".no-items");if(n.length&&(n.remove(),!i(".product-upgrades-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-upgrades-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Base Categories",'</th>\n                    <th scope="col">',"Upgrade Categories",'</th>\n                    <th scope="col">',"Display Mode",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-upgrades-list").find("h3").after(r)}t.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(e){t.showMessage("error",e.message||"Error saving upgrade configuration. Please try again."),m("ProductUpgradesSettingsModule","Error saving upgrade configuration:",e)})).finally((function(){t.toggleFormState(!0)}))}else alert(this.settings.i18n.selectUpgradeCategories||"Please select at least one upgrade category");else alert(this.settings.i18n.selectBaseCategories||"Please select at least one base category")}},{key:"handleEditUpgrade",value:function(e){var t=jQuery,i=t(e.currentTarget),a=i.data("id"),n=String(i.data("base")||"").split(",").filter(Boolean),r=String(i.data("upgrade")||"").split(",").filter(Boolean),o=i.data("mode"),s=i.data("title"),d=i.data("description");m("ProductUpgradesSettingsModule","Edit upgrade:",a,n,r,o,s,d),this.resetForm(),t("#upgrade_id").val(a),t("#display_mode").val(o||"dropdown").trigger("change"),t("#upgrade_title").val(s||""),t("#upgrade_description").val(d||""),setTimeout((function(){t("#base_categories").val(n).trigger("change"),t("#upgrade_categories").val(r).trigger("change")}),100),t(".form-title").text("Edit Upgrade Configuration"),t(".save-upgrade").text("Update Configuration"),t(".product-upgrades-form").slideDown(),t("html, body").animate({scrollTop:t(".product-upgrades-form").offset().top-50},300)}},{key:"handleDeleteUpgrade",value:function(e){var t=this,i=jQuery,a=i(e.currentTarget),n=a.data("id");if(m("ProductUpgradesSettingsModule","Delete upgrade:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this upgrade configuration?")){a.prop("disabled",!0).text("Deleting...");var o={action:"delete_product_upgrade",nonce:this.settings.nonce,upgrade_id:n};r.ajaxRequest({url:this.settings.ajaxUrl,data:o}).then((function(e){m("ProductUpgradesSettingsModule","Delete response:",e);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".product-upgrades-list").find("tbody tr").length||(i(".product-upgrades-list").find("table").remove(),i(".product-upgrades-list").append('<div class="no-items">No upgrade configurations have been created yet.</div>'))})),t.showMessage("success",e.message)})).catch((function(e){t.showMessage("error",e.message||"Error deleting upgrade configuration. Please try again."),a.prop("disabled",!1).text("Delete"),m("ProductUpgradesSettingsModule","Error deleting upgrade configuration:",e)}))}}},{key:"createUpgradeRow",value:function(e){var t=jQuery;if(!e||!e.id)return m("ProductUpgradesSettingsModule","Invalid upgrade data",e),t('<tr><td colspan="4">Error: Invalid upgrade data</td></tr>');var i=t("<tr></tr>").attr("data-id",e.id),a=e.base_category_names||"";i.append(t("<td></td>").text(a));var n=e.upgrade_category_names||"";i.append(t("<td></td>").text(n));var r={dropdown:"Dropdown",radio:"Radio Buttons",tiles:"Image Tiles"}[e.display_mode]||"Dropdown";i.append(t("<td></td>").text(r));var s=t("<td></td>").addClass("actions"),d=o.createElement("button",{className:"button button-small edit-upgrade",type:"button",dataset:{id:e.id,base:Array.isArray(e.base_categories)?e.base_categories.join(","):"",upgrade:Array.isArray(e.upgrade_categories)?e.upgrade_categories.join(","):"",mode:e.display_mode||"dropdown",title:e.title||"",description:e.description||""}},"Edit"),l=o.createElement("button",{className:"button button-small delete-upgrade",type:"button",dataset:{id:e.id}},"Delete");return s.append(t(d)," ",t(l)),i.append(s),i}},{key:"appendUpgradeRow",value:function(e){var t=jQuery;if(e&&e.id){var i=t(".product-upgrades-table");if(i.length){var a=i.find("tbody");if(a.length){var n=this.createUpgradeRow(e);a.append(n)}else m("ProductUpgradesSettingsModule","Cannot append row: Table body not found")}else m("ProductUpgradesSettingsModule","Cannot append row: Table not found")}else m("ProductUpgradesSettingsModule","Cannot append row: Invalid upgrade data",e)}},{key:"showMessage",value:function(e,t){var i=jQuery,a=i(".product-estimator-upgrades");if(a.length){var n=a.find(".notice");if(n.length&&n.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice)if("function"!=typeof u.showNotice){var r=o.createElement("div",{className:"notice notice-".concat("success"===e?"success":"error")}),s=o.createElement("p",{},t);r.appendChild(s),a.prepend(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}else u.showNotice(t,e);else ProductEstimatorSettings.showNotice(t,e)}else m("ProductUpgradesSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var e=jQuery("#product_upgrades");if(e.length&&e.is(":visible")){var t=new E;window.ProductUpgradesSettingsModule=t}else jQuery(document).on("product_estimator_tab_changed",(function(e,t){"product_upgrades"===t&&setTimeout((function(){var e=new E;window.ProductUpgradesSettingsModule=e}),100)}))}));var k=function(){return(0,n.A)((function e(){var t=this;(0,a.A)(this,e),this.l10n=window.similarProductsL10n||{nonce:"",loading_attributes:"Loading attributes...",select_category:"Please select categories first.",no_attributes:"No product attributes found for these categories.",error_loading:"Error loading attributes. Please try again.",saving:"Saving...",rule_saved:"Rule saved successfully!",error_saving:"Error saving rule. Please try again.",confirm_delete:"Are you sure you want to delete this rule?",error_deleting:"Error deleting rule. Please try again.",select_category_error:"Please select at least one source category.",select_attributes_error:"Please select at least one attribute."},jQuery(document).ready((function(){return t.init()}))}),[{key:"init",value:function(){var e=jQuery;e(".product-estimator-similar-products-settings").length&&(m("SimilarProductsSettingsModule","Initializing Similar Products Settings Module"),e(".add-new-rule").on("click",this.addNewRule.bind(this)),this.initializeExistingRules(),this.initializeSliders())}},{key:"addNewRule",value:function(){var e=jQuery,t=e(".rule-template").children().first().clone(),i="new_"+Math.random().toString(36).substr(2,9);t.attr("data-rule-id",i),t.find('[name^="TEMPLATE_ID"]').each((function(){var t=e(this).attr("name").replace("TEMPLATE_ID",i);e(this).attr("name",t)})),e(".similar-products-rules").append(t),e(".no-rules-message").hide(),this.initializeRule(t),t.addClass("open")}},{key:"initializeExistingRules",value:function(){var e=this,t=jQuery;t(".similar-products-rule").each((function(i,a){e.initializeRule(t(a))}))}},{key:"initializeRule",value:function(e){var t=this,i=jQuery,a=e.data("rule-id");e.find(".rule-header").on("click",(function(t){i(t.target).hasClass("delete-rule")||i(t.target).hasClass("save-rule")||e.toggleClass("open")})),e.find(".source-categories-select").on("change",(function(a){var n=i(a.target).val();n&&n.length>0?t.loadCategoryAttributes(n,e):e.find(".attributes-list").empty().html("<p>".concat(t.l10n.select_category,"</p>"))})),e.find(".delete-rule").on("click",(function(i){i.preventDefault(),i.stopPropagation(),confirm(t.l10n.confirm_delete)&&t.deleteRule(a,e)})),e.find(".save-rule").on("click",(function(i){i.preventDefault(),i.stopPropagation(),t.saveRule(a,e)}));var n=e.find(".source-categories-select").val();n&&n.length>0&&this.loadCategoryAttributes(n,e),this.initializeSlider(e.find(".similarity-threshold"))}},{key:"initializeSliders",value:function(){var e=this,t=jQuery;t(".similarity-threshold").each((function(i,a){e.initializeSlider(t(a))}))}},{key:"initializeSlider",value:function(e){e.length&&e.on("input change",(function(){var e=$(this).val();$(this).closest(".slider-container").find(".similarity-threshold-value").text(e)}))}},{key:"loadCategoryAttributes",value:function(e,t){var i=this,a=(jQuery,t.find(".attributes-list"));a.html("<p>".concat(this.l10n.loading_attributes,"</p>")).addClass("loading"),r.ajaxRequest({url:ajaxurl,data:{action:"get_category_attributes",nonce:this.l10n.nonce,category_ids:e}}).then((function(e){i.renderAttributes(e.attributes,t)})).catch((function(e){a.html('<p class="error">'.concat(e.message||i.l10n.error_loading,"</p>")).removeClass("loading"),m("SimilarProductsSettingsModule","Error loading attributes:",e)}))}},{key:"renderAttributes",value:function(e,t){jQuery;var i=t.find(".attributes-list");if(i.empty().removeClass("loading"),e&&0!==e.length){var a=t.data("rule-id"),n=t.find(".selected-attributes").val(),r=[];n&&(r=n.split(",")),e.forEach((function(e){var t=r.indexOf(e.name)>-1,n=o.createElement("div",{className:"attribute-item"}),s=o.createElement("label",{},[o.createElement("input",{type:"checkbox",name:"".concat(a,"[attributes][]"),value:e.name,checked:t}),o.createElement("span",{},e.label)]);n.appendChild(s),i.append(n)}))}else i.html("<p>".concat(this.l10n.no_attributes,"</p>"))}},{key:"saveRule",value:function(e,t){var i=this,a=jQuery,n=t.find(".save-rule"),o=n.text(),s=t.find(".source-categories-select").val();if(s&&0!==s.length){var d=[];if(t.find('.attributes-list input[type="checkbox"]:checked').each((function(){d.push(a(this).val())})),0!==d.length){n.text(this.l10n.saving).prop("disabled",!0);var l=t.find(".similarity-threshold").val();r.ajaxRequest({url:ajaxurl,data:{action:"save_similar_products_rule",nonce:this.l10n.nonce,rule_id:e,source_categories:s,attributes:d,similarity_threshold:l}}).then((function(n){i.showMessage(t,i.l10n.rule_saved,"success"),e.startsWith("new_")&&(t.attr("data-rule-id",n.rule_id),t.find('[name^="'.concat(e,'"]')).each((function(){var t=a(this).attr("name").replace(e,n.rule_id);a(this).attr("name",t)})));var r=[];s.forEach((function(e){var i=t.find('.source-categories-select option[value="'.concat(e,'"]')).text();i&&r.push(i)})),r.length>0?t.find(".rule-title").text(r.join(", ")):t.find(".rule-title").text(i.l10n.select_category),m("SimilarProductsSettingsModule","Rule saved successfully",n)})).catch((function(e){i.showMessage(t,e.message||i.l10n.error_saving,"error"),m("SimilarProductsSettingsModule","Error saving rule:",e)})).finally((function(){n.text(o).prop("disabled",!1)}))}else this.showMessage(t,this.l10n.select_attributes_error,"error")}else this.showMessage(t,this.l10n.select_category_error,"error")}},{key:"deleteRule",value:function(e,t){var i=this,a=jQuery;if(e.startsWith("new_"))return t.remove(),void(0===a(".similar-products-rule").length&&a(".no-rules-message").show());r.ajaxRequest({url:ajaxurl,data:{action:"delete_similar_products_rule",nonce:this.l10n.nonce,rule_id:e}}).then((function(e){t.remove(),0===a(".similar-products-rule").length&&a(".no-rules-message").show(),m("SimilarProductsSettingsModule","Rule deleted successfully")})).catch((function(e){i.showMessage(t,e.message||i.l10n.error_deleting,"error"),m("SimilarProductsSettingsModule","Error deleting rule:",e)}))}},{key:"showMessage",value:function(e,t,i){var a=jQuery,n=o.createElement("div",{className:"rule-message ".concat(i)},t);e.find(".rule-message").remove(),e.find(".rule-header").after(a(n)),setTimeout((function(){o.removeElement(n,!0)}),3e3)}}])}();jQuery(document).ready((function(){var e=new k;window.SimilarProductsSettingsModule=e})),console.log("Product Estimator initialized"),console.log("Product Estimator Admin initialized")}},i={};function a(e){var n=i[e];if(void 0!==n)return n.exports;var r=i[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=(t,i,n,r)=>{if(!i){var o=1/0;for(c=0;c<e.length;c++){for(var[i,n,r]=e[c],s=!0,d=0;d<i.length;d++)(!1&r||o>=r)&&Object.keys(a.O).every((e=>a.O[e](i[d])))?i.splice(d--,1):(s=!1,r<o&&(o=r));if(s){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[i,n,r]},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={439:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var n,r,[o,s,d]=i,l=0;if(o.some((t=>0!==e[t]))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(d)var c=d(a)}for(t&&t(i);l<o.length;l++)r=o[l],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},i=self.webpackChunkproduct_estimator=self.webpackChunkproduct_estimator||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=a.O(void 0,[76],(()=>a(206)));n=a.O(n)})();