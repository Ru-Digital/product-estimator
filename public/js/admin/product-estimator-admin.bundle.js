(()=>{var t={10:()=>{!function(t){"use strict";var e={ajaxUrl:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:similarProducts?similarProducts.nonce:"",loading_attributes:similarProducts?similarProducts.loading_attributes:"Loading attributes...",select_category:similarProducts?similarProducts.select_category:"Please select categories first.",no_attributes:similarProducts?similarProducts.no_attributes:"No product attributes found for these categories.",error_loading:similarProducts?similarProducts.error_loading:"Error loading attributes. Please try again.",saving:similarProducts?similarProducts.saving:"Saving...",rule_saved:similarProducts?similarProducts.rule_saved:"Rule saved successfully!",error_saving:similarProducts?similarProducts.error_saving:"Error saving rule. Please try again.",confirm_delete:similarProducts?similarProducts.confirm_delete:"Are you sure you want to delete this rule?",error_deleting:similarProducts?similarProducts.error_deleting:"Error deleting rule. Please try again.",select_category_error:similarProducts?similarProducts.select_category_error:"Please select at least one source category.",select_attributes_error:similarProducts?similarProducts.select_attributes_error:"Please select at least one attribute."};function i(){t(".product-estimator-similar-products-settings").length&&(console.log("Initializing Similar Products Settings Module"),t(".add-new-rule").on("click",n),r(),t(document).on("product_estimator_tab_changed",a))}function a(t,e){"similar_products"===e&&(r(),console.log("Tab changed to Similar Products"))}function n(){var e=t(".rule-template").children().first().clone(),i="new_"+Math.random().toString(36).substr(2,9);e.attr("data-rule-id",i),e.find('[name^="TEMPLATE_ID"]').each((function(){var e=t(this).attr("name").replace("TEMPLATE_ID",i);t(this).attr("name",e)})),t(".similar-products-rules").append(e),t(".no-rules-message").hide(),o(e),e.addClass("open")}function r(){t(".similar-products-rule").each((function(e,i){o(t(i))}))}function o(i){var a=i.data("rule-id");i.find(".rule-header").on("click",(function(e){t(e.target).hasClass("delete-rule")||t(e.target).hasClass("save-rule")||i.toggleClass("open")}));var n=i.find(".source-categories-select");t.fn.select2&&n.select2({width:"100%",placeholder:"Select categories",allowClear:!0,closeOnSelect:!1}),n.on("change",(function(a){var n=t(a.target).val();n&&n.length>0?s(n,i):i.find(".attributes-list").empty().html("<p>"+e.select_category+"</p>")})),i.find(".delete-rule").on("click",(function(n){n.preventDefault(),n.stopPropagation(),confirm(e.confirm_delete)&&function(i,a){if(i.startsWith("new_"))return a.remove(),void(0===t(".similar-products-rule").length&&t(".no-rules-message").show());t.ajax({url:e.ajaxUrl,type:"POST",dataType:"json",data:{action:"delete_similar_products_rule",nonce:e.nonce,rule_id:i},success:function(i){i.success?(a.remove(),0===t(".similar-products-rule").length&&t(".no-rules-message").show(),console.log("Rule deleted successfully")):(d(a,i.data.message||e.error_deleting,"error"),console.error("Error deleting rule:",i))},error:function(t,i,n){d(a,e.error_deleting,"error"),console.error("AJAX error deleting rule:",i,n)}})}(a,i)})),i.find(".save-rule").on("click",(function(n){n.preventDefault(),n.stopPropagation(),function(i,a){var n=a.find(".save-rule"),r=n.text(),o=a.find(".source-categories-select").val();if(o&&0!==o.length){var s=[];if(a.find('.attributes-list input[type="checkbox"]:checked').each((function(){s.push(t(this).val())})),0!==s.length){n.text(e.saving).prop("disabled",!0);var c=a.find(".similarity-threshold").val();t.ajax({url:e.ajaxUrl,type:"POST",dataType:"json",data:{action:"save_similar_products_rule",nonce:e.nonce,rule_id:i,source_categories:o,attributes:s,similarity_threshold:c},success:function(n){if(n.success){if(d(a,e.rule_saved,"success"),i.startsWith("new_")){var r=n.data.rule_id;a.attr("data-rule-id",r),a.find('[name^="'+i+'"]').each((function(){var e=t(this).attr("name").replace(i,r);t(this).attr("name",e)}))}var s=[];t.each(o,(function(t,e){var i=a.find('.source-categories-select option[value="'+e+'"]').text();i&&s.push(i)})),s.length>0?a.find(".rule-title").text(s.join(", ")):a.find(".rule-title").text(e.select_category),console.log("Rule saved successfully",n.data)}else d(a,n.data.message||e.error_saving,"error"),console.error("Error saving rule:",n)},error:function(t,i,n){d(a,e.error_saving,"error"),console.error("AJAX error saving rule:",i,n)},complete:function(){n.text(r).prop("disabled",!1)}})}else d(a,e.select_attributes_error,"error")}else d(a,e.select_category_error,"error")}(a,i)}));var r=n.val();r&&r.length>0&&s(r,i)}function s(i,a){var n=a.find(".attributes-list");n.html("<p>"+e.loading_attributes+"</p>").addClass("loading"),t.ajax({url:e.ajaxUrl,type:"POST",dataType:"json",data:{action:"get_category_attributes",nonce:e.nonce,category_ids:i},success:function(i){i.success?function(i,a){var n=a.find(".attributes-list");if(n.empty().removeClass("loading"),i&&0!==i.length){var r=a.data("rule-id"),o=a.find(".selected-attributes").val(),s=[];o&&(s=o.split(","));var d="";t.each(i,(function(e,i){var a=t.inArray(i.name,s)>-1;d+='<div class="attribute-item">',d+="<label>",d+='<input type="checkbox" name="'+r+'[attributes][]" value="'+i.name+'"'+(a?" checked":"")+">",d+="<span>"+i.label+"</span>",d+="</label>",d+="</div>"})),n.html(d)}else n.html("<p>"+e.no_attributes+"</p>")}(i.data.attributes,a):(n.html('<p class="error">'+(i.data.message||e.error_loading)+"</p>").removeClass("loading"),console.error("Error loading attributes:",i))},error:function(t,i,a){n.html('<p class="error">'+e.error_loading+"</p>").removeClass("loading"),console.error("AJAX error loading attributes:",i,a)}})}function d(e,i,a){var n=t("<div>",{class:"rule-message "+a,text:i});e.find(".rule-message").remove(),e.find(".rule-header").after(n),setTimeout((function(){n.fadeOut(300,(function(){t(this).remove()}))}),3e3)}t(document).ready(i),window.SimilarProductsSettingsModule={init:i,addNewRule:n,initializeExistingRules:r}}(jQuery)}},e={};function i(a){var n=e[a];if(void 0!==n)return n.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,i),r.exports}(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function a(t){var i=function(t){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,"string");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:i+""}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=Array(e);i<e;i++)a[i]=t[i];return a}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var a,n,r,o,s=[],d=!0,c=!1;try{if(r=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;d=!1}else for(;!(d=(a=r.call(i)).done)&&(s.push(a.value),s.length!==e);d=!0);}catch(t){c=!0,n=t}finally{try{if(!d&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e,i){return(e=a(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t){var e,i=jQuery,a=l(l({},{url:(null===(e=window.productEstimatorVars)||void 0===e?void 0:e.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),type:"POST",dataType:"json"}),t);return new Promise((function(t,e){i.ajax(l(l({},a),{},{success:function(i){if(i.success)t(i.data);else{var a,n=new Error((null===(a=i.data)||void 0===a?void 0:a.message)||"Unknown error");n.data=i.data,e(n)}},error:function(t,i,a){console.error("AJAX error:",i,a),e(new Error(a))}}))}))}function g(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=document.createElement(t);return Object.entries(i).forEach((function(t){var i=s(t,2),a=i[0],r=i[1];"className"===a?n.className=r:"dataset"===a?Object.entries(r).forEach((function(t){var e=s(t,2),i=e[0],a=e[1];n.dataset[i]=a})):"style"===a&&"object"===e(r)?Object.entries(r).forEach((function(t){var e=s(t,2),i=e[0],a=e[1];n.style[i]=a})):n.setAttribute(a,r)})),"string"==typeof a?n.textContent=a:Array.isArray(a)&&a.forEach((function(t){"string"==typeof t?n.appendChild(document.createTextNode(t)):t instanceof Node&&n.appendChild(t)})),n}function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return t?t.length<=e?t:t.substring(0,e-i.length)+i:""}function m(t){return!!t&&/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}function v(t,e){var i=jQuery;if(t){var a=t instanceof jQuery?t:i(t);y(a);var n=i('<span class="field-error">'.concat(e,"</span>"));a.after(n),a.addClass("error")}}function y(t){var e=jQuery;if(t){var i=t instanceof jQuery?t:e(t);i.next(".field-error").remove(),i.removeClass("error")}}function b(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,i=jQuery;if(i){for(var a=i('<div class="notice notice-'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",' is-dismissible"><p>').concat(t,"</p></div>")),n=[i(".wrap h1"),i(".product-estimator-form-container"),i("#wpbody-content")],r=null,o=0;o<n.length;o++)if(n[o].length){r=n[o];break}if(r?r.after(a):i("body").prepend(a),window.wp&&window.wp.notices)window.wp.notices.init();else{var s=i('<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>');a.append(s),s.on("click",(function(){a.fadeOut(100,(function(){a.remove()}))}))}setTimeout((function(){a.fadeOut(500,(function(){return a.remove()}))}),e)}else alert(t)}var _=m,w=v,S=y,E=b;function P(t){var e;if(null!==(e=window.productEstimatorVars)&&void 0!==e&&e.debug){for(var i,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];(i=console).log.apply(i,["[".concat(t,"]")].concat(n))}}var k=function(){return r((function e(){var i,a,n,r=this;t(this,e),this.settings={ajaxUrl:(null===(i=window.customerEstimatesAdmin)||void 0===i?void 0:i.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:(null===(a=window.customerEstimatesAdmin)||void 0===a?void 0:a.nonce)||"",i18n:(null===(n=window.customerEstimatesAdmin)||void 0===n?void 0:n.i18n)||{}},jQuery(document).ready((function(){return r.init()}))}),[{key:"init",value:function(){this.bindEvents(),this.initializeActions(),P("CustomerEstimatesAdmin","Initialized")}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e("#doaction, #doaction2").on("click",this.handleBulkAction.bind(this)),e(".email-estimate").on("click",this.handleEmailEstimate.bind(this)),e('select[name="status_filter"]').on("change",(function(){e(this).closest("form").submit()})),e(".wp-list-table tbody tr").hover((function(){e(this).addClass("row-hover")}),(function(){e(this).removeClass("row-hover")})),"function"==typeof e.fn.tooltip&&e(".tooltip-trigger").tooltip(),e("#export-estimates-btn").on("click",this.exportEstimates.bind(this)),e(".print-estimate-btn").on("click",(function(i){i.preventDefault();var a=e(i.currentTarget).data("estimate-id");a&&t.printEstimate(a)}))}},{key:"initializeActions",value:function(){this.addResponsiveTableLabels(),this.handleSearchField(),this.handleAdminNotices()}},{key:"handleBulkAction",value:function(t){var e=jQuery;if("delete"===e(t.target).prev("select").val()){if(0===e('tbody th.check-column input[type="checkbox"]:checked').length)return t.preventDefault(),alert("Please select at least one estimate to delete."),!1;if(!confirm(this.settings.i18n.confirmBulkDelete))return t.preventDefault(),!1}}},{key:"handleEmailEstimate",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.currentTarget),a=i.data("estimate-id"),n=i.text();i.text(this.settings.i18n.emailSending).prop("disabled",!0),u({url:this.settings.ajaxUrl,data:{action:"email_estimate",estimate_id:a,nonce:this.settings.nonce}}).then((function(t){b(e.settings.i18n.emailSuccess,"success")})).catch((function(t){var i;b(e.settings.i18n.emailError+(null!==(i=t.data)&&void 0!==i&&i.message?": "+t.data.message:""),"error")})).finally((function(){i.text(n).prop("disabled",!1)}))}},{key:"addResponsiveTableLabels",value:function(){var t=jQuery;t(window).width()<=782&&t(".wp-list-table td").each((function(){var e=t(this),i=e.closest("table").find("th").eq(e.index());i.length&&e.attr("data-label",i.text())}))}},{key:"handleSearchField",value:function(){var t=jQuery("#estimate-search-input");t.length&&!t.val()&&t.focus()}},{key:"handleAdminNotices",value:function(){var t=new URLSearchParams(window.location.search).get("message");if(t){var e="",i="success";switch(t){case"email_sent":e="Email sent successfully!";break;case"email_failed":e="Failed to send email.",i="error";break;case"deleted":e="Estimate deleted successfully!";break;case"delete_failed":e="Failed to delete estimate.",i="error";break;case"duplicated":e="Estimate duplicated successfully!";break;case"duplicate_failed":e="Failed to duplicate estimate.",i="error"}e&&b(e,i)}}},{key:"showNotice",value:function(t){b(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success")}},{key:"exportEstimates",value:function(){var t={},e=jQuery('select[name="status_filter"]').val(),i=jQuery("#estimate-search-input").val();e&&(t.status=e),i&&(t.search=i);var a=new URL(this.settings.ajaxUrl);for(var n in a.searchParams.append("action","export_estimates"),a.searchParams.append("nonce",this.settings.nonce),t)a.searchParams.append(n,t[n]);window.location.href=a.toString()}},{key:"printEstimate",value:function(t){jQuery;var e=window.open("","_blank");e.document.write("<html><head><title>Printing Estimate...</title></head>"),e.document.write("<body><p>Loading estimate for printing...</p></body></html>"),u({url:this.settings.ajaxUrl,data:{action:"get_estimate_print_view",estimate_id:t,nonce:this.settings.nonce}}).then((function(t){e.document.write(t.html),e.document.close(),e.onload=function(){e.print()}})).catch((function(t){var i;e.document.write("<p>Error loading estimate: "+((null===(i=t.data)||void 0===i?void 0:i.message)||"Unknown error")+"</p>"),e.document.close()}))}},{key:"duplicateEstimate",value:function(t){var i=this;t&&confirm(this.settings.i18n.duplicateConfirm)&&function(t){var i,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)||(null===(i=window.productEstimatorVars)||void 0===i?void 0:i.nonce)||"",o=new FormData;return o.append("action",t),o.append("nonce",r),Object.entries(n).forEach((function(t){var i=s(t,2),a=i[0],n=i[1];null!=n&&("object"===e(n)?o.append(a,JSON.stringify(n)):o.append(a,n))})),fetch((null===(a=window.productEstimatorVars)||void 0===a?void 0:a.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",credentials:"same-origin",body:o}).then((function(t){if(!t.ok)throw new Error("Network response was not ok: ".concat(t.status));return t.json()})).then((function(t){if(t.success)return t.data;var e,i=new Error((null===(e=t.data)||void 0===e?void 0:e.message)||"Unknown error");throw i.data=t.data,i}))}("duplicate_estimate",{estimate_id:t}).then((function(t){i.showNotice(t.message||"Estimate duplicated successfully!"),window.location.reload()})).catch((function(t){i.showNotice(t.message||"Failed to duplicate estimate","error")}))}},{key:"formatDate",value:function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=h(h({},{year:"numeric",month:"short",day:"numeric"}),e),a="string"==typeof t?new Date(t):t;return isNaN(a.getTime())?"Invalid date":new Intl.DateTimeFormat(navigator.language,i).format(a)}(t,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},{key:"formatPrice",value:function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(null==t)return"".concat(e,"0.00");var a="string"==typeof t?parseFloat(t):t;return isNaN(a)?"".concat(e,"0.00"):e+a.toFixed(i)}(t,"$")}},{key:"truncateText",value:function(t){return f(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:50)}}])}();jQuery(document).ready((function(){var t=new k;window.CustomerEstimatesAdmin=t})),new(function(){return r((function e(){var i=this;t(this,e),jQuery(document).ready((function(){i.initializeVariables(),i.bindEvents(),i.isSettingsPage()||i.initializeTabs()}))}),[{key:"isSettingsPage",value:function(){var t=new URLSearchParams(window.location.search).get("page");return t&&t.indexOf("-settings")>-1}},{key:"initializeVariables",value:function(){this.formChanged=!1,this.currentTab="",this.reportData=null,this.chart=null}},{key:"bindEvents",value:function(){var t=jQuery;this.isSettingsPage()||t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.initializeValidation(),t(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"initializeTabs",value:function(){var t=jQuery,e=t(".nav-tab:first"),i=e.data("tab")||"tab-1";t(".tab-content").hide(),t("#".concat(i)).show(),e.addClass("nav-tab-active"),this.currentTab=i;var a=new URLSearchParams(window.location.search).get("tab");a&&this.switchTab(a)}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged?confirm(productEstimatorAdmin.i18n.unsavedChanges)&&this.switchTab(e):this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery;e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show(),this.currentTab=t;var i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),"reports"!==t||this.reportData||this.loadInitialReport()}},{key:"initializeValidation",value:function(){if(!this.isSettingsPage()){var t=jQuery,e=t(".product-estimator-form");e.find('input[type="email"]').on("change",(function(e){var i=t(e.currentTarget),a=i.val();a&&!_(a)?w(i,productEstimatorAdmin.i18n.invalidEmail):S(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(e.currentTarget),a=parseInt(i.val()),n=parseInt(i.attr("min")),r=parseInt(i.attr("max"));a<n||a>r?w(i,productEstimatorAdmin.i18n.numberRange.replace("%min%",n).replace("%max%",r)):S(i)}))}}},{key:"handleBeforeUnload",value:function(t){if(this.formChanged)return t.preventDefault(),productEstimatorAdmin.i18n.unsavedChanges}},{key:"loadInitialReport",value:function(){console.log("Loading initial report data")}}])}());var j=function(){return r((function e(){t(this,e),this.formChanged=!1,this.currentTab="",this.formChangeTrackers={},this.ensureGlobalVariables(),this.init()}),[{key:"ensureGlobalVariables",value:function(){window.generalSettingsData=window.generalSettingsData||{tab_id:"general",i18n:{}},window.netsuiteSettings=window.netsuiteSettings||{tab_id:"netsuite",i18n:{}},window.notificationSettings=window.notificationSettings||{tab_id:"notifications",i18n:{}},window.productAdditionsSettings=window.productAdditionsSettings||{tab_id:"product_additions",i18n:{}},window.pricingRulesSettings=window.pricingRulesSettings||{tab_id:"pricing_rules",i18n:{}},window.similarProducts=window.similarProducts||{tab_id:"similar_products",i18n:{}},window.productUpgradesSettings=window.productUpgradesSettings||{tab_id:"product_upgrades",i18n:{}},window.productEstimatorSettings=window.productEstimatorSettings||{ajax_url:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:"",i18n:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave this tab?",saveSuccess:"Settings saved successfully.",saveError:"Error saving settings."}}}},{key:"init",value:function(){var t=this.getTabFromUrl();this.currentTab=null!==t?t:"general",jQuery(".tab-content").hide(),jQuery("#".concat(this.currentTab)).show(),jQuery(".nav-tab").removeClass("nav-tab-active"),jQuery('.nav-tab[data-tab="'.concat(this.currentTab,'"]')).addClass("nav-tab-active"),this.bindEvents(),this.initFormChangeTracking(),this.initializeValidation(),P("ProductEstimatorSettings","Settings manager initialized with tab:",this.currentTab)}},{key:"bindEvents",value:function(){var t=jQuery;t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),t(".product-estimator-form").on("submit",this.handleAjaxFormSubmit.bind(this)),t(window).on("beforeunload",this.handleBeforeUnload.bind(this)),P("ProductEstimatorSettings","Events bound")}},{key:"handleAjaxFormSubmit",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.target),a=i.closest(".tab-content").attr("id"),n=i.serialize();console.log("Serialized form data:",n),this.showFormLoading(i),P("ProductEstimatorSettings","Submitting form for tab: ".concat(a)),u({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_"+a+"_settings",nonce:productEstimatorSettings.nonce,form_data:n}}).then((function(t){b(t.message||productEstimatorSettings.i18n.saveSuccess,"success"),e.formChangeTrackers[a]=!1,a===e.currentTab&&(e.formChanged=!1),P("ProductEstimatorSettings","Settings saved successfully for tab: ".concat(a))})).catch((function(t){b(t.message||productEstimatorSettings.i18n.saveError,"error"),P("ProductEstimatorSettings","Error saving settings for tab ".concat(a,":"),t)})).finally((function(){e.hideFormLoading(i)}))}},{key:"showFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!0).addClass("loading"),e.data("original-text",e.val()),e.val(productEstimatorSettings.i18n.saving||"Saving...")}},{key:"hideFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!1).removeClass("loading"),e.val(e.data("original-text"))}},{key:"initFormChangeTracking",value:function(){var t=jQuery,e=this;t(".tab-content").each((function(){var i=t(this).attr("id");e.formChangeTrackers[i]=!1,t("#".concat(i," :input")).on("change input",(function(){e.formChangeTrackers[i]=!0,i===e.currentTab&&(e.formChanged=!0)}))})),P("ProductEstimatorSettings","Form change tracking initialized")}},{key:"initializeValidation",value:function(){var t=jQuery;t(".product-estimator-form").each((function(){var e=t(this);e.find('input[type="email"]').on("change",(function(e){var i=t(this),a=i.val();a&&!m(a)?v(i,productEstimatorSettings.i18n.invalidEmail||"Invalid email address"):y(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(this),a=parseInt(i.val()),n=parseInt(i.attr("min")||0),r=parseInt(i.attr("max")||9999);isNaN(a)||a<n||a>r?v(i,productEstimatorSettings.i18n.numberRange?productEstimatorSettings.i18n.numberRange.replace("%min%",n).replace("%max%",r):"Value must be between ".concat(n," and ").concat(r)):y(i)}))})),P("ProductEstimatorSettings","Form validation initialized")}},{key:"getTabFromUrl",value:function(){return new URLSearchParams(window.location.search).get("tab")}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged&&!confirm(productEstimatorSettings.i18n.unsavedChanges)||this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery,i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show();var a=this.currentTab;this.currentTab=t,this.formChanged=this.formChangeTrackers[t]||!1,e(document).trigger("product_estimator_tab_changed",[t,a]),P("ProductEstimatorSettings","Switched to tab: ".concat(t," from ").concat(a))}},{key:"handleBeforeUnload",value:function(t){var e=!1;for(var i in this.formChangeTrackers)if(this.formChangeTrackers[i]){e=!0;break}if(e){var a=productEstimatorSettings.i18n.unsavedChanges;return t.returnValue=a,a}}},{key:"showFieldError",value:function(t,e){v(t,e)}},{key:"clearFieldError",value:function(t){y(t)}},{key:"showNotice",value:function(t){b(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success")}}])}();function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",i=jQuery;if(0!==i(e).length){console.log("Setting up rich text editors with <br> tag preservation"),window._originalEditorContent=window._originalEditorContent||{};var a=function(t){return t.replace(/<br\s*\/?>/gi,"<br>​")},n=function(t){return t.replace(/\u200B/g,"")},r=function(){if("undefined"!=typeof tinyMCE&&tinyMCE.editors){var e=!0;return t.forEach((function(t){(function(t){if(!tinyMCE||!tinyMCE.get(t))return!1;var e=tinyMCE.get(t);e.settings.wpautop=!1,e.settings.forced_root_block="",e.settings.valid_elements="*[*]",e.settings.entity_encoding="raw",e.settings.verify_html=!1,e.settings.br_in_pre=!1,e.settings.keep_styles=!0,e.settings.remove_linebreaks=!1,e.settings.convert_newlines_to_brs=!0,e.settings.remove_redundant_brs=!1;var r=i("#".concat(t));if(r.length){var o=r.val();window._originalEditorContent[t]=o,setTimeout((function(){var t=a(o);e.setContent(t,{format:"raw"})}),100)}return e.on("BeforeSetContent",(function(e){e.content&&(e.content=a(e.content)),(e.initial||e.source_view)&&(window._originalEditorContent[t]=e.content)})),e.on("GetContent",(function(t){t.content&&(t.content=n(t.content))})),e.on("init",(function(){var i=e.getContent({format:"raw"});window._originalEditorContent[t]=n(i),console.log("Editor ".concat(t," initialized with content length: ").concat(i.length))})),i('.wp-editor-tabs button[data-wp-editor-id="'.concat(t,'"]')).on("click",(function(){var e=i(this).hasClass("switch-html"),r=i(this).hasClass("switch-tmce");if(e&&tinyMCE.get(t)){var o=tinyMCE.get(t).getContent({format:"raw"}),s=n(o);window._originalEditorContent[t]=s,i("#".concat(t)).val(s)}r&&setTimeout((function(){if(tinyMCE.get(t)&&window._originalEditorContent[t]){var e=a(window._originalEditorContent[t]);tinyMCE.get(t).setContent(e,{format:"raw"})}}),100)})),console.log("Editor ".concat(t," configured with <br> tag protection")),!0})(t)||(e=!1)})),e}return!1};if(!r())var o=0,s=setInterval((function(){o++,(r()||o>20)&&clearInterval(s)}),300);t.forEach((function(t){i("#".concat(t)).on("input change",(function(){window._originalEditorContent[t]=i(this).val()}))})),i("".concat(e," form")).off("submit.htmlPreservation").on("submit.htmlPreservation",(function(){return t.forEach((function(t){var e="";if(tinyMCE.get(t)&&tinyMCE.get(t).isHidden()){var a=i("#".concat(t));a.length&&(e=a.val())}else if(tinyMCE.get(t)){var r=tinyMCE.get(t).getContent({format:"raw"});e=n(r)}!e&&window._originalEditorContent[t]&&(e=window._originalEditorContent[t]),e&&(i("#".concat(t)).val(e),console.log("Form submission: Updated ".concat(t," with content length: ").concat(e.length)))})),!0}))}}jQuery(document).ready((function(){window.ProductEstimatorSettings=new j}));var T=function(){return r((function e(){var i=this;t(this,e),this.validateMarkup=this.validateMarkup.bind(this),this.validateExpiryDays=this.validateExpiryDays.bind(this),this.showFieldError=this.showFieldError.bind(this),this.clearFieldError=this.clearFieldError.bind(this),this.handleTabChanged=this.handleTabChanged.bind(this),this.saveEditorContent=this.saveEditorContent.bind(this),this.validateAllFields=this.validateAllFields.bind(this),jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupValidation(),this.setupWpEditors(),console.log("GeneralSettingsModule: Initialized")}},{key:"bindEvents",value:function(){var t=jQuery;t(document).on("product_estimator_tab_changed",this.handleTabChanged),t(".file-upload-button").on("click",this.handleFileUpload.bind(this)),t(".file-remove-button").on("click",this.handleFileRemove.bind(this))}},{key:"setupWpEditors",value:function(){C(["pdf_footer_text","pdf_footer_contact_details_content"],"#general")}},{key:"handleFileUpload",value:function(t){var e=this;t.preventDefault();var i=jQuery,a=i(t.currentTarget),n=a.data("field-id"),r=a.data("accept")||"";this.mediaFrame||(this.mediaFrame=wp.media({title:"Select or Upload PDF Template",button:{text:"Use this file"},multiple:!1,library:{type:r?[r.split("/")[0]]:null}}),this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON();i("#".concat(n)).val(t.id).trigger("change"),a.siblings(".file-preview-wrapper").html('<p class="file-preview"><a href="'.concat(t.url,'" target="_blank">').concat(t.filename,"</a></p>")),a.siblings(".file-remove-button").removeClass("hidden")}))),this.mediaFrame.open()}},{key:"handleFileRemove",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),a=i.data("field-id");e("#".concat(a)).val("").trigger("change"),i.siblings(".file-preview-wrapper").empty(),i.addClass("hidden")}},{key:"setupValidation",value:function(){var t=jQuery;t("#default_markup").on("change input",this.validateMarkup),t("#estimate_expiry_days").on("change input",this.validateExpiryDays)}},{key:"validateMarkup",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val()),a=parseInt(e.attr("min")||0),n=parseInt(e.attr("max")||100);return isNaN(i)||i<a||i>n?(this.showFieldError(e,generalSettingsData.i18n.validationErrorMarkup||"Value must be between ".concat(a," and ").concat(n)),!1):(this.clearFieldError(e),!0)}},{key:"validateExpiryDays",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val()),a=parseInt(e.attr("min")||1),n=parseInt(e.attr("max")||365);return isNaN(i)||i<a||i>n?(this.showFieldError(e,generalSettingsData.i18n.validationErrorExpiry||"Value must be between ".concat(a," and ").concat(n)),!1):(this.clearFieldError(e),!0)}},{key:"showFieldError",value:function(t,e){if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError)ProductEstimatorSettings.showFieldError(t,e);else if("undefined"!=typeof validation&&"function"==typeof validation.showFieldError)validation.showFieldError(t,e);else{t.addClass("error"),this.clearFieldError(t);var i=jQuery('<span class="field-error">'.concat(e,"</span>"));t.after(i)}}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):"undefined"!=typeof validation&&"function"==typeof validation.clearFieldError?validation.clearFieldError(t):(t.removeClass("error"),t.next(".field-error").remove())}},{key:"handleTabChanged",value:function(t,e){"general"===e&&(this.setupWpEditors(),console.log("GeneralSettingsModule: Tab changed to General Settings, refreshing editors"))}},{key:"saveEditorContent",value:function(){"undefined"!=typeof tinyMCE&&["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(t){var e=tinyMCE.get(t);e&&e.save()}))}},{key:"validateAllFields",value:function(){var t=!0;return this.saveEditorContent(),this.validateMarkup({currentTarget:jQuery("#default_markup")})||(t=!1),this.validateExpiryDays({currentTarget:jQuery("#estimate_expiry_days")})||(t=!1),t}},{key:"showNotice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice)ProductEstimatorSettings.showNotice(t,e);else if("undefined"!=typeof validation&&"function"==typeof validation.showNotice)validation.showNotice(t,e);else{var i=jQuery,a=i('<div class="notice notice-'.concat(e,' is-dismissible"><p>').concat(t,"</p></div>"));i(".wrap h1").after(a),setTimeout((function(){a.fadeOut(500,(function(){return a.remove()}))}),5e3)}}}])}();jQuery(document).ready((function(){window.GeneralSettingsModule=new T}));var x=function(){return r((function e(){var i=this;t(this,e),jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){P("NetsuiteSettingsModule","Initializing NetSuite settings module"),this.bindEvents(),this.setupDependentFields()}},{key:"bindEvents",value:function(){var t=jQuery;t("#test-netsuite-connection").on("click",this.testNetsuiteConnection.bind(this)),t("#netsuite_enabled").on("change",this.toggleNetsuiteFields.bind(this)),t("#netsuite_api_url, #netsuite_token_url").on("change",this.validateUrl.bind(this)),t("#netsuite_request_limit").on("change",this.validateRequestLimit.bind(this)),t("#netsuite_cache_time").on("change",this.validateCacheTime.bind(this)),t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),t(".product-estimator-form").on("submit",this.handleFormSubmit.bind(this)),P("NetsuiteSettingsModule","Events bound successfully")}},{key:"handleFormSubmit",value:function(t){var e=jQuery,i=e(t.currentTarget);if(0!==i.closest("#netsuite").length){t.preventDefault();var a=i.serialize();i.find('input[type="checkbox"]').each((function(){var t=e(this).attr("name");e(this).is(":checked")||a.includes(t)||(a+="&"+t+"=0")}));var n=i.find(":submit");n.prop("disabled",!0),n.data("original-text",n.val()),n.val("Saving..."),u({url:netsuiteSettings.ajax_url,type:"POST",data:{action:"save_netsuite_settings",nonce:netsuiteSettings.nonce,form_data:a}}).then((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||"Settings saved successfully","success"):showNotice(t.message||"Settings saved successfully","success"),"undefined"!=typeof ProductEstimatorSettings&&(ProductEstimatorSettings.formChanged=!1,ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers.netsuite=!1))})).catch((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||"Error saving settings","error"):showNotice(t.message||"Error saving settings","error")})).finally((function(){n.prop("disabled",!1),n.val(n.data("original-text"))}))}}},{key:"setupDependentFields",value:function(){this.toggleNetsuiteFields(),P("NetsuiteSettingsModule","Dependent fields setup complete")}},{key:"toggleNetsuiteFields",value:function(){var t=jQuery,e=t("#netsuite_enabled").is(":checked"),i=t("#netsuite_client_id, #netsuite_client_secret, #netsuite_api_url, #netsuite_token_url, #netsuite_request_limit, #netsuite_cache_time").closest("tr");e?(i.fadeIn(200),t("#test-netsuite-connection").closest("p").fadeIn(200)):(i.fadeOut(200),t("#test-netsuite-connection").closest("p").fadeOut(200)),P("NetsuiteSettingsModule","NetSuite fields toggled: ".concat(e?"visible":"hidden"))}}])}();jQuery(document).ready((function(){var t=new x;window.NetsuiteSettingsModule=t}));var F=function(){return r((function e(){var i=this;t(this,e),jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupDependentFields(),this.setupVerticalTabs(),this.setupMediaUploader()}},{key:"bindEvents",value:function(){var t=jQuery;t("#enable_notifications").on("change",this.toggleNotificationFields.bind(this)),t('[id^="notification_"][id$="_enabled"]').on("change",function(e){var i=t(e.currentTarget),a=i.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(a,i.is(":checked"))}.bind(this)),t(".image-upload-button").on("click",this.handleImageUpload.bind(this)),t(".image-remove-button").on("click",this.handleImageRemove.bind(this)),t("#from_email, #default_designer_email, #default_store_email").on("change",this.validateEmail.bind(this)),t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),t(".notification-settings-form").on("submit",this.handleFormSubmit.bind(this)),t(".vertical-tabs-nav a").on("click",this.handleVerticalTabClick.bind(this))}},{key:"setupNotificationEditors",value:function(){0!==jQuery("#notifications").length&&(console.log("Setting up rich text editors for notifications"),C(["pdf_footer_text","pdf_footer_contact_details_content"],"#general"))}},{key:"toggleNotificationTypeFields",value:function(t,e){var i=jQuery('.notification-type-form[data-type="'.concat(t,'"]')).find("input, textarea, button").not("#notification_".concat(t,"_enabled")).not(".save-settings");e?i.prop("disabled",!1):i.prop("disabled",!0)}},{key:"setupMediaUploader",value:function(){}},{key:"validateEmail",value:function(t){var e=jQuery(t.target),i=e.val().trim();return i&&!m(i)?(this.showFieldError(e,notificationSettings.i18n.validationErrorEmail||"Please enter a valid email address"),!1):(this.clearFieldError(e),!0)}},{key:"showFieldError",value:function(t,e){if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError)ProductEstimatorSettings.showFieldError(t,e);else{S(t);var i=jQuery('<span class="field-error">'.concat(e,"</span>"));t.after(i).addClass("error")}}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):t.removeClass("error").next(".field-error").remove()}},{key:"setupDependentFields",value:function(){var t=jQuery;this.toggleNotificationFields(),t('[id^="notification_"][id$="_enabled"]').each(function(e,i){var a=t(i),n=a.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(n,a.is(":checked"))}.bind(this))}},{key:"toggleNotificationFields",value:function(){var t=jQuery,e=t("#enable_notifications").is(":checked"),i=t(".vertical-tabs-nav"),a=t(".notification-type-form");e?(i.removeClass("disabled"),a.find("input, textarea, button").not(".save-settings").prop("disabled",!1),t('[id^="notification_"][id$="_enabled"]').each(function(e,i){var a=t(i),n=a.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(n,a.is(":checked"))}.bind(this))):(i.addClass("disabled"),a.find("input, textarea, button").not(".save-settings").prop("disabled",!0))}},{key:"setupVerticalTabs",value:function(){var t=jQuery,e="notification_general",i=new URLSearchParams(window.location.search).get("sub_tab");i&&t('.vertical-tabs-nav a[data-tab="'+i+'"]').length?e=i:t(".vertical-tabs-nav .tab-item.active a").length&&(e=t(".vertical-tabs-nav .tab-item.active a").data("tab")),this.showVerticalTab(e),this.adjustTabContentHeight(),t(window).on("resize",this.adjustTabContentHeight.bind(this))}},{key:"adjustTabContentHeight",value:function(){var t=jQuery,e=t(".vertical-tabs-nav").outerHeight();t(".vertical-tabs-content").css("min-height",e+"px")}},{key:"handleVerticalTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");window.history.pushState({},"","?page=product-estimator-settings&tab=notifications&sub_tab=".concat(e)),this.showVerticalTab(e)}},{key:"showVerticalTab",value:function(t){var e=jQuery;e(".vertical-tabs-nav .tab-item").removeClass("active"),e('.vertical-tabs-nav a[data-tab="'.concat(t,'"]')).parent().addClass("active"),e(".vertical-tab-content").removeClass("active"),e("#".concat(t)).addClass("active")}},{key:"handleImageUpload",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),a=i.data("field-id"),n=this.mediaFrame;n?n.open():"undefined"!=typeof wp&&wp.media?(this.mediaFrame=wp.media({title:notificationSettings.i18n.selectImage||"Select Image",button:{text:notificationSettings.i18n.useThisImage||"Use this image"},multiple:!1,library:{type:"image"}}),this.mediaFrame.on("select",function(){var t=this.mediaFrame.state().get("selection").first().toJSON();e("#".concat(a)).val(t.id).trigger("change"),i.closest("td").find(".image-preview-wrapper").html('<img src="'.concat(t.sizes.medium?t.sizes.medium.url:t.url,'" alt="" style="max-width:200px;max-height:100px;display:block;margin-bottom:10px;" />')),i.closest("td").find(".image-remove-button").removeClass("hidden")}.bind(this)),this.mediaFrame.open()):console.error("WordPress Media Library not available")}},{key:"handleImageRemove",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),a=i.data("field-id");e("#".concat(a)).val("").trigger("change"),i.closest("td").find(".image-preview-wrapper").empty(),i.addClass("hidden")}},{key:"handleTabChanged",value:function(t,e){e===notificationSettings.tab_id&&(this.toggleNotificationFields(),this.setupVerticalTabs(),this.setupNotificationEditors())}},{key:"handleFormSubmit",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),a=i.serialize(),n=i.data("type")||"notification_general",r=i.find(".save-settings"),o=i.find(".spinner");if(r.prop("disabled",!0),o.addClass("is-active"),"undefined"!=typeof tinyMCE)for(var s=tinyMCE.editors,d=0;d<s.length;d++)s[d].save();var c=a;i.find('input[type="checkbox"]').each((function(){e(this).is(":checked")||c.includes(e(this).attr("name"))||(c+="&"+e(this).attr("name")+"=0")})),u({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_notifications_settings",nonce:productEstimatorSettings.nonce,form_data:c,notification_type:n}}).then((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||notificationSettings.i18n.saveSuccess,"success"):E(t.message||notificationSettings.i18n.saveSuccess,"success")})).catch((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||notificationSettings.i18n.saveError,"error"):E(t.message||notificationSettings.i18n.saveError,"error")})).finally((function(){r.prop("disabled",!1),o.removeClass("is-active")}))}}])}();jQuery(document).ready((function(){var t=new F;window.NotificationSettingsModule=t}));var M=function(){return r((function e(){var i=this;t(this,e);var a=window.productAdditionsSettings||{};this.settings={ajaxUrl:a.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:a.nonce||"",i18n:a.i18n||{},tab_id:a.tab_id||"product_additions"},this.formModified=!1,jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){P("ProductAdditionsSettingsModule","Initializing Product Additions Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRelationshipHandlers(),e("#product-addition-form").on("change input","input, select, textarea",(function(){t.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initRelationshipHandlers",value:function(){var t,e=jQuery,i=(e(".product-estimator-additions"),e("#product-addition-form")),a=e(".product-additions-form"),n=e(".add-new-relation"),r=e("#relation_type"),o=e(".target-category-row"),s=e("#target_category"),d=e(".product-search-row"),c=e(".note-row");e("#source_category").select2({placeholder:"Select source categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),e("#target_category").select2({placeholder:"Select a category",width:"100%",allowClear:!0,dropdownCssClass:"product-estimator-dropdown"}),n.on("click",function(){P("ProductAdditionsSettingsModule","Add New Relationship button clicked"),this.resetForm(),e(".form-title").text(this.settings.i18n.addNew||"Add New Relationship"),e(".save-relation").text(this.settings.i18n.saveChanges||"Save Changes"),a.slideDown()}.bind(this)),e(".cancel-form").on("click",function(){a.slideUp(),this.resetForm()}.bind(this)),r.on("change",(function(){var t=e(this).val();s.val("").trigger("change"),d.hide(),e("#selected-product").hide(),e("#selected_product_id").val(""),c.hide(),e("#note_text").val(""),"auto_add_by_category"===t?(o.show(),c.hide()):"auto_add_note_by_category"===t?(o.hide(),c.show()):"suggest_products_by_category"===t?(o.show(),c.hide(),d.hide()):(o.hide(),c.hide())})),s.on("change",(function(){var t=e(this).val(),i=r.val();e("#product_search").val(""),e("#product-search-results").empty(),e("#selected-product").hide(),e("#selected_product_id").val(""),t&&"auto_add_by_category"===i?d.show():d.hide()})),e("#product_search").on("keyup",function(i){var a=this,n=e(i.target).val()||"",r=s.val();clearTimeout(t),n.length<3?e("#product-search-results").empty():t=setTimeout((function(){a.searchProducts(n,r)}),500)}.bind(this)),e(".clear-product").on("click",(function(){e("#selected_product_id").val(""),e(".selected-product-info").empty(),e("#selected-product").hide()})),i.on("submit",this.handleFormSubmission.bind(this)),e(".product-additions-list").on("click",".edit-relation",this.handleEditRelation.bind(this)),e(".product-additions-list").on("click",".delete-relation",this.handleDeleteRelation.bind(this))}},{key:"setupFormHandling",value:function(){var t=jQuery;t(document).on("click",".product-result-item",(function(e){var i=t(e.currentTarget).data("id"),a=t(e.currentTarget).data("name");P("ProductAdditionsSettingsModule","Product selected:",i,a),t("#selected_product_id").val(i),P("ProductAdditionsSettingsModule","Product ID set to:",t("#selected_product_id").val()),t(".selected-product-info").html("<strong>".concat(a,"</strong> (ID: ").concat(i,")")),t("#selected-product").show(),t("#product_search").val(""),t("#product-search-results").empty()}))}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var t=jQuery;t("#product-addition-form")[0].reset(),t("#relation_id").val(""),t("#selected_product_id").val(""),t("#source_category").val(null).trigger("change"),t("#target_category").val(null).trigger("change"),t("#relation_type").val("").trigger("change"),t(".target-category-row").hide(),t(".product-search-row").hide(),t("#selected-product").hide(),t("#product-search-results").empty(),t(".note-row").hide(),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#product-addition-form"),a=i.find(".save-relation"),n=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!t),a.prop("disabled",!t),n.prop("disabled",!t),t?a.text(e("#relation_id").val()?"Update Relationship":"Save Relationship"):a.text("Saving..."),t?(e("#source_category").prop("disabled",!1).trigger("change"),e("#target_category").prop("disabled",!1).trigger("change")):(e("#source_category").prop("disabled",!0).trigger("change"),e("#target_category").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,a=i("#relation_type").val(),n=i("#source_category").val(),r=i("#selected_product_id").val(),o=i("#note_text").val();if(a)if(n&&0!==n.length){if("auto_add_by_category"===a){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category");if(!r)return void alert(this.settings.i18n.selectProduct||"Please select a product")}else if("suggest_products_by_category"===a){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category")}else if("auto_add_note_by_category"===a&&!o)return void alert("Please enter a note text");this.toggleFormState(!1);var s={action:"save_category_relation",nonce:this.settings.nonce,relation_id:i("#relation_id").val(),relation_type:a,source_category:n,target_category:i("#target_category").val(),product_id:r,note_text:o};P("ProductAdditionsSettingsModule","Sending form data:",s),u({url:this.settings.ajaxUrl,data:s}).then((function(t){if(P("ProductAdditionsSettingsModule","Response received:",t),e.showMessage("success",t.message),s.relation_id){P("ProductAdditionsSettingsModule","Updating existing relation:",s.relation_id);var a=i(".product-additions-list").find('tr[data-id="'.concat(s.relation_id,'"]'));a.length?a.replaceWith(e.createRelationRow(t.relation)):e.appendRelationRow(t.relation)}else e.appendRelationRow(t.relation);i(".product-additions-form").slideUp(),e.resetForm();var n=i(".product-additions-list").find(".no-items");if(n.length&&(n.remove(),!i(".product-additions-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-additions-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Source Categories",'</th>\n                    <th scope="col">',"Action",'</th>\n                    <th scope="col">',"Target/Note",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-additions-list").find("h3").after(r)}e.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(t){e.showMessage("error",t.message||"Error saving relationship. Please try again."),P("ProductAdditionsSettingsModule","Error saving relationship:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectSourceCategories||"Please select at least one source category");else alert(this.settings.i18n.selectAction||"Please select an action type")}},{key:"handleEditRelation",value:function(t){var e=jQuery,i=e(t.currentTarget),a=i.data("id"),n=String(i.data("source")||"").split(","),r=i.data("target"),o=i.data("type"),s=i.data("product-id"),d=i.data("note-text");P("ProductAdditionsSettingsModule","Edit relation:",a,n,r,o,s,d),this.resetForm(),e("#relation_id").val(a),e("#relation_type").val(o).trigger("change"),setTimeout(function(){e("#source_category").val(n).trigger("change"),"auto_add_by_category"===o&&r?(e("#target_category").val(r).trigger("change"),s&&this.loadProductDetails(s)):"suggest_products_by_category"===o&&r?e("#target_category").val(r).trigger("change"):"auto_add_note_by_category"===o&&d&&e("#note_text").val(d)}.bind(this),100),e(".form-title").text("Edit Category Relationship"),e(".save-relation").text("Update Relationship"),e(".product-additions-form").slideDown(),e("html, body").animate({scrollTop:e(".product-additions-form").offset().top-50},300)}},{key:"handleDeleteRelation",value:function(t){var e=this,i=jQuery,a=i(t.currentTarget),n=a.data("id");P("ProductAdditionsSettingsModule","Delete relation:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this relationship?")&&(a.prop("disabled",!0).text("Deleting..."),u({url:this.settings.ajaxUrl,data:{action:"delete_category_relation",nonce:this.settings.nonce,relation_id:n}}).then((function(t){P("ProductAdditionsSettingsModule","Delete response:",t);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".product-additions-list").find("tbody tr").length||(i(".product-additions-list").find("table").remove(),i(".product-additions-list").append('<div class="no-items">No relationships have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting relationship. Please try again."),a.prop("disabled",!1).text("Delete"),P("ProductAdditionsSettingsModule","Error deleting relationship:",t)})))}},{key:"searchProducts",value:function(t,e){var i=jQuery;t&&e?(i("#product-search-results").html("<p>Searching...</p>"),u({url:this.settings.ajaxUrl,data:{action:"search_category_products",nonce:this.settings.nonce,search:t,category:e}}).then((function(t){if(t.products&&t.products.length>0){var e='<ul class="product-results-list">';t.products.forEach((function(t){e+='\n              <li class="product-result-item" data-id="'.concat(t.id,'" data-name="').concat(t.name,'">\n                ').concat(t.name," (ID: ").concat(t.id,")\n              </li>\n            ")})),e+="</ul>",i("#product-search-results").html(e)}else i("#product-search-results").html("<p>No products found</p>")})).catch((function(t){P("ProductAdditionsSettingsModule","AJAX error:",t),i("#product-search-results").html("<p>Error searching products</p>")}))):i("#product-search-results").html("<p>Please enter search term and select a category</p>")}},{key:"loadProductDetails",value:function(t){var e=jQuery;t&&u({url:this.settings.ajaxUrl,data:{action:"get_product_details",nonce:this.settings.nonce,product_id:t}}).then((function(t){if(t.product){var i=t.product;e("#selected_product_id").val(i.id),e(".selected-product-info").html("<strong>".concat(i.name,"</strong> (ID: ").concat(i.id,")")),e("#selected-product").show()}else P("ProductAdditionsSettingsModule","Failed to load product details:",t)})).catch((function(t){P("ProductAdditionsSettingsModule","AJAX error while loading product details:",t)}))}},{key:"createRelationRow",value:function(t){var e=jQuery;if(!t||!t.id)return P("ProductAdditionsSettingsModule","Invalid relation data",t),e('<tr><td colspan="4">Error: Invalid relation data</td></tr>');var i=e("<tr></tr>").attr("data-id",t.id),a=t.source_name||"";i.append(e("<td></td>").text(a));var n,r=e("<td></td>"),o=e("<span></span>").addClass("relation-type").addClass(t.relation_type||"");n="auto_add_by_category"===t.relation_type?"Auto add product with Category":"auto_add_note_by_category"===t.relation_type?"Auto add note with Category":"suggest_products_by_category"===t.relation_type?"Suggest products when Category":t.relation_type_label||"",o.text(n),r.append(o),i.append(r);var s=e("<td></td>");if("auto_add_by_category"===t.relation_type)t.product_name?s.text(t.product_name):t.target_name&&s.text(t.target_name+" (Category)");else if("auto_add_note_by_category"===t.relation_type){var d=t.note_text&&t.note_text.length>50?f(t.note_text,50):t.note_text||"";s.text(d)}else"suggest_products_by_category"===t.relation_type&&t.target_name&&s.text(t.target_name+" (Category)");i.append(s);var c=e("<td></td>").addClass("actions"),l=Array.isArray(t.source_category)?t.source_category.join(","):t.source_category||"",u=g("button",{className:"button button-small edit-relation",type:"button",dataset:{id:t.id,source:l,target:t.target_category||"",productId:t.product_id||"",type:t.relation_type||"",noteText:t.note_text||""}},"Edit"),p=g("button",{className:"button button-small delete-relation",type:"button",dataset:{id:t.id}},"Delete");return c.append(e(u)," ",e(p)),i.append(c),i}},{key:"appendRelationRow",value:function(t){var e=jQuery;if(t&&t.id){var i=e(".product-additions-table");if(i.length){var a=i.find("tbody");if(a.length){var n=this.createRelationRow(t);a.append(n)}else P("ProductAdditionsSettingsModule","Cannot append row: Table body not found")}else P("ProductAdditionsSettingsModule","Cannot append row: Table not found")}else P("ProductAdditionsSettingsModule","Cannot append row: Invalid relation data",t)}},{key:"showMessage",value:function(t,e){var i=jQuery(".product-estimator-additions");if(i.length){var a=i.find(".notice");a.length&&a.remove(),b(e,t)}else P("ProductAdditionsSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var t=jQuery("#product_additions");if(t.length&&t.is(":visible")){var e=new M;window.ProductAdditionsSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"product_additions"===e&&setTimeout((function(){var t=new M;window.ProductAdditionsSettingsModule=t}),100)}))}));var Q=function(){return r((function e(){var i=this;t(this,e);var a=window.pricingRulesSettings||{};this.settings={ajaxUrl:a.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:a.nonce||"",i18n:a.i18n||{},tab_id:a.tab_id||"pricing_rules"},jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){P("PricingRulesSettingsModule","Initializing Pricing Rules Settings Module"),this.bindEvents(),this.setupFormHandling(),this.initializeDefaultSettingsForm()}},{key:"bindEvents",value:function(){jQuery(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRuleHandlers()}},{key:"initializeDefaultSettingsForm",value:function(){jQuery(".default-pricing-form").on("submit",(function(t){t.preventDefault(),"undefined"!=typeof ProductEstimatorSettings&&(ProductEstimatorSettings.formChanged=!0,ProductEstimatorSettings.handleAjaxFormSubmit(t))}))}},{key:"initRuleHandlers",value:function(){var t=jQuery,e=(t(".product-estimator-pricing-rules"),t("#pricing-rule-form")),i=t(".pricing-rules-form"),a=t(".add-new-rule");t("#categories").select2({placeholder:"Select categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),a.on("click",function(){P("PricingRulesSettingsModule","Add New Pricing Rule button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Pricing Rule"),t(".save-rule").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),e.on("submit",this.handleFormSubmission.bind(this)),t(".pricing-rules-list").on("click",".edit-rule",this.handleEditRule.bind(this)),t(".pricing-rules-list").on("click",".delete-rule",this.handleDeleteRule.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&this.init()}},{key:"resetForm",value:function(){var t=jQuery;t("#pricing-rule-form")[0].reset(),t("#rule_id").val(""),t("#categories").val(null).trigger("change")}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#pricing-rule-form"),a=i.find(".save-rule"),n=i.find(".cancel-form");i.find("input, select").prop("disabled",!t),a.prop("disabled",!t),n.prop("disabled",!t),t?a.text(e("#rule_id").val()?"Update Pricing Rule":"Save Pricing Rule"):a.text("Saving..."),t?e("#categories").prop("disabled",!1).trigger("change"):e("#categories").prop("disabled",!0).trigger("change")}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,a=i("#categories").val(),n=i("#pricing_method").val(),r=i("#pricing_source").val();if(a&&0!==a.length)if(n)if(r){this.toggleFormState(!1);var o={action:"save_pricing_rule",nonce:this.settings.nonce,rule_id:i("#rule_id").val(),categories:a,pricing_method:n,pricing_source:r};P("PricingRulesSettingsModule","Sending form data:",o),u({url:this.settings.ajaxUrl,data:o}).then((function(t){if(P("PricingRulesSettingsModule","Response received:",t),e.showMessage("success",t.message),o.rule_id){P("PricingRulesSettingsModule","Updating existing rule:",o.rule_id);var a=i(".pricing-rules-list").find('tr[data-id="'.concat(o.rule_id,'"]'));a.length?a.replaceWith(e.createRuleRow(t.rule)):e.appendRuleRow(t.rule)}else e.appendRuleRow(t.rule);i(".pricing-rules-form").slideUp(),e.resetForm();var n=i(".pricing-rules-list").find(".no-items");if(n.length&&(n.remove(),!i(".pricing-rules-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped pricing-rules-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Categories",'</th>\n                    <th scope="col">',"Pricing Method",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".pricing-rules-list").find("h3").after(r)}})).catch((function(t){e.showMessage("error",t.message||"Error saving pricing rule. Please try again."),P("PricingRulesSettingsModule","Error saving pricing rule:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectPricingSource||"Please select a pricing source");else alert(this.settings.i18n.selectPricingMethod||"Please select a pricing method");else alert(this.settings.i18n.selectCategories||"Please select at least one category")}},{key:"handleEditRule",value:function(t){var e=jQuery,i=e(t.currentTarget),a=i.data("id"),n=String(i.data("categories")).split(","),r=i.data("method"),o=i.data("source");P("PricingRulesSettingsModule","Edit rule:",a,n,r,o),this.resetForm(),e("#rule_id").val(a),e("#pricing_method").val(r),e("#pricing_source").val(o),setTimeout((function(){e("#categories").val(n).trigger("change")}),100),e(".form-title").text("Edit Pricing Rule"),e(".save-rule").text("Update Pricing Rule"),e(".pricing-rules-form").slideDown(),e("html, body").animate({scrollTop:e(".pricing-rules-form").offset().top-50},300)}},{key:"handleDeleteRule",value:function(t){var e=this,i=jQuery,a=i(t.currentTarget),n=a.data("id");P("PricingRulesSettingsModule","Delete rule:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this pricing rule?")&&(a.prop("disabled",!0).text("Deleting..."),u({url:this.settings.ajaxUrl,data:{action:"delete_pricing_rule",nonce:this.settings.nonce,rule_id:n}}).then((function(t){P("PricingRulesSettingsModule","Delete response:",t);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".pricing-rules-list").find("tbody tr").length||(i(".pricing-rules-list").find("table").remove(),i(".pricing-rules-list").append('<div class="no-items">No pricing rules have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting pricing rule. Please try again."),a.prop("disabled",!1).text("Delete"),P("PricingRulesSettingsModule","Error deleting rule:",t)})))}},{key:"createRuleRow",value:function(t){var e=jQuery,i=e("<tr></tr>").attr("data-id",t.id);i.append(e("<td></td>").text(t.category_names)),i.append(e("<td></td>").text(t.pricing_label));var a=e("<td></td>").addClass("actions"),n=g("button",{className:"button button-small edit-rule",type:"button",dataset:{id:t.id,categories:Array.isArray(t.categories)?t.categories.join(","):"",method:t.pricing_method,source:t.pricing_source}},"Edit"),r=g("button",{className:"button button-small delete-rule",type:"button",dataset:{id:t.id}},"Delete");return a.append(e(n)," ",e(r)),i.append(a),i}},{key:"appendRuleRow",value:function(t){var e=jQuery(".pricing-rules-table").find("tbody"),i=this.createRuleRow(t);e.append(i)}},{key:"showMessage",value:function(t,e){var i=jQuery,a=i(".product-estimator-pricing-rules"),n=a.find(".notice");if(n.length&&n.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice){var r=g("div",{className:"notice notice-".concat("success"===t?"success":"error")}),o=g("p",{},e);r.appendChild(o),a.find("h1, h3").first().after(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}else ProductEstimatorSettings.showNotice(e,t)}}])}();jQuery(document).ready((function(){var t=jQuery("#pricing_rules");if(t.length&&t.is(":visible")){var e=new Q;window.PricingRulesSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"pricing_rules"===e&&setTimeout((function(){var t=new Q;window.PricingRulesSettingsModule=t}),100)}))})),i(10);var A=function(){return r((function e(){var i=this;t(this,e);var a=window.productUpgradesSettings||{};this.settings={ajaxUrl:a.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:a.nonce||"",i18n:a.i18n||{},tab_id:a.tab_id||"product_upgrades"},this.formModified=!1,jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){P("ProductUpgradesSettingsModule","Initializing Product Upgrades Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initUpgradeHandlers(),e("#product-upgrade-form").on("change input","input, select, textarea",(function(){t.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initUpgradeHandlers",value:function(){var t=jQuery,e=(t(".product-estimator-upgrades"),t("#product-upgrade-form")),i=t(".product-upgrades-form"),a=t(".add-new-upgrade");t("#base_categories").select2({placeholder:"Select base categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),t("#upgrade_categories").select2({placeholder:"Select upgrade categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),a.on("click",function(){P("ProductUpgradesSettingsModule","Add New Upgrade Configuration button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Upgrade Configuration"),t(".save-upgrade").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),e.on("submit",this.handleFormSubmission.bind(this)),t(".product-upgrades-list").on("click",".edit-upgrade",this.handleEditUpgrade.bind(this)),t(".product-upgrades-list").on("click",".delete-upgrade",this.handleDeleteUpgrade.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var t=jQuery;t("#product-upgrade-form")[0].reset(),t("#upgrade_id").val(""),t("#base_categories").val(null).trigger("change"),t("#upgrade_categories").val(null).trigger("change"),t("#display_mode").val("dropdown").trigger("change"),t("#upgrade_title").val(""),t("#upgrade_description").val(""),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#product-upgrade-form"),a=i.find(".save-upgrade"),n=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!t),a.prop("disabled",!t),n.prop("disabled",!t),t?a.text(e("#upgrade_id").val()?"Update Configuration":"Save Configuration"):a.text("Saving..."),t?(e("#base_categories").prop("disabled",!1).trigger("change"),e("#upgrade_categories").prop("disabled",!1).trigger("change")):(e("#base_categories").prop("disabled",!0).trigger("change"),e("#upgrade_categories").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,a=i("#base_categories").val(),n=i("#upgrade_categories").val(),r=i("#display_mode").val(),o=i("#upgrade_title").val(),s=i("#upgrade_description").val();if(a&&0!==a.length)if(n&&0!==n.length){this.toggleFormState(!1);var d={action:"save_product_upgrade",nonce:this.settings.nonce,upgrade_id:i("#upgrade_id").val(),base_categories:a,upgrade_categories:n,display_mode:r,upgrade_title:o,upgrade_description:s};P("ProductUpgradesSettingsModule","Sending form data:",d),u({url:this.settings.ajaxUrl,data:d}).then((function(t){if(P("ProductUpgradesSettingsModule","Response received:",t),e.showMessage("success",t.message),d.upgrade_id){P("ProductUpgradesSettingsModule","Updating existing upgrade:",d.upgrade_id);var a=i(".product-upgrades-list").find('tr[data-id="'.concat(d.upgrade_id,'"]'));a.length?a.replaceWith(e.createUpgradeRow(t.upgrade)):e.appendUpgradeRow(t.upgrade)}else e.appendUpgradeRow(t.upgrade);i(".product-upgrades-form").slideUp(),e.resetForm();var n=i(".product-upgrades-list").find(".no-items");if(n.length&&(n.remove(),!i(".product-upgrades-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-upgrades-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Base Categories",'</th>\n                    <th scope="col">',"Upgrade Categories",'</th>\n                    <th scope="col">',"Display Mode",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-upgrades-list").find("h3").after(r)}e.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(t){e.showMessage("error",t.message||"Error saving upgrade configuration. Please try again."),P("ProductUpgradesSettingsModule","Error saving upgrade configuration:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectUpgradeCategories||"Please select at least one upgrade category");else alert(this.settings.i18n.selectBaseCategories||"Please select at least one base category")}},{key:"handleEditUpgrade",value:function(t){var e=jQuery,i=e(t.currentTarget),a=i.data("id"),n=String(i.data("base")||"").split(",").filter(Boolean),r=String(i.data("upgrade")||"").split(",").filter(Boolean),o=i.data("mode"),s=i.data("title"),d=i.data("description");P("ProductUpgradesSettingsModule","Edit upgrade:",a,n,r,o,s,d),this.resetForm(),e("#upgrade_id").val(a),e("#display_mode").val(o||"dropdown").trigger("change"),e("#upgrade_title").val(s||""),e("#upgrade_description").val(d||""),setTimeout((function(){e("#base_categories").val(n).trigger("change"),e("#upgrade_categories").val(r).trigger("change")}),100),e(".form-title").text("Edit Upgrade Configuration"),e(".save-upgrade").text("Update Configuration"),e(".product-upgrades-form").slideDown(),e("html, body").animate({scrollTop:e(".product-upgrades-form").offset().top-50},300)}},{key:"handleDeleteUpgrade",value:function(t){var e=this,i=jQuery,a=i(t.currentTarget),n=a.data("id");if(P("ProductUpgradesSettingsModule","Delete upgrade:",n),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this upgrade configuration?")){a.prop("disabled",!0).text("Deleting...");var r={action:"delete_product_upgrade",nonce:this.settings.nonce,upgrade_id:n};u({url:this.settings.ajaxUrl,data:r}).then((function(t){P("ProductUpgradesSettingsModule","Delete response:",t);var n=a.closest("tr");n.fadeOut(300,(function(){n.remove(),i(".product-upgrades-list").find("tbody tr").length||(i(".product-upgrades-list").find("table").remove(),i(".product-upgrades-list").append('<div class="no-items">No upgrade configurations have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting upgrade configuration. Please try again."),a.prop("disabled",!1).text("Delete"),P("ProductUpgradesSettingsModule","Error deleting upgrade configuration:",t)}))}}},{key:"createUpgradeRow",value:function(t){var e=jQuery;if(!t||!t.id)return P("ProductUpgradesSettingsModule","Invalid upgrade data",t),e('<tr><td colspan="4">Error: Invalid upgrade data</td></tr>');var i=e("<tr></tr>").attr("data-id",t.id),a=t.base_category_names||"";i.append(e("<td></td>").text(a));var n=t.upgrade_category_names||"";i.append(e("<td></td>").text(n));var r={dropdown:"Dropdown",radio:"Radio Buttons",tiles:"Image Tiles"}[t.display_mode]||"Dropdown";i.append(e("<td></td>").text(r));var o=e("<td></td>").addClass("actions"),s=g("button",{className:"button button-small edit-upgrade",type:"button",dataset:{id:t.id,base:Array.isArray(t.base_categories)?t.base_categories.join(","):"",upgrade:Array.isArray(t.upgrade_categories)?t.upgrade_categories.join(","):"",mode:t.display_mode||"dropdown",title:t.title||"",description:t.description||""}},"Edit"),d=g("button",{className:"button button-small delete-upgrade",type:"button",dataset:{id:t.id}},"Delete");return o.append(e(s)," ",e(d)),i.append(o),i}},{key:"appendUpgradeRow",value:function(t){var e=jQuery;if(t&&t.id){var i=e(".product-upgrades-table");if(i.length){var a=i.find("tbody");if(a.length){var n=this.createUpgradeRow(t);a.append(n)}else P("ProductUpgradesSettingsModule","Cannot append row: Table body not found")}else P("ProductUpgradesSettingsModule","Cannot append row: Table not found")}else P("ProductUpgradesSettingsModule","Cannot append row: Invalid upgrade data",t)}},{key:"showMessage",value:function(t,e){var i=jQuery(".product-estimator-upgrades");if(i.length){var a=i.find(".notice");a.length&&a.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice?b(e,t):ProductEstimatorSettings.showNotice(e,t)}else P("ProductUpgradesSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var t=jQuery("#product_upgrades");if(t.length&&t.is(":visible")){var e=new A;window.ProductUpgradesSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"product_upgrades"===e&&setTimeout((function(){var t=new A;window.ProductUpgradesSettingsModule=t}),100)}))}));var U=function(){return r((function e(){var i=this;t(this,e),jQuery(document).ready((function(){return i.init()}))}),[{key:"init",value:function(){var t=this;console.log("Label Settings Module initialized"),this.bindEvents(),setTimeout((function(){t.setupVerticalTabs()}),100)}},{key:"bindEvents",value:function(){var t=jQuery;t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),t(".label-settings-form").on("submit",this.handleFormSubmit.bind(this)),t(document).on("click",".vertical-tabs-nav a",this.handleVerticalTabClick.bind(this)),t(document).on("change",'input[type="email"]',this.validateEmail.bind(this)),console.log("Label Settings events bound")}},{key:"validateEmail",value:function(t){var e=jQuery(t.target),i=e.val().trim();return i&&!m(i)?(this.showFieldError(e,"Please enter a valid email address"),!1):(this.clearFieldError(e),!0)}},{key:"showFieldError",value:function(t,e){if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError)ProductEstimatorSettings.showFieldError(t,e);else{y(t);var i=jQuery('<span class="field-error">'.concat(e,"</span>"));t.after(i).addClass("error")}}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):y(t)}},{key:"setupVerticalTabs",value:function(){var t=jQuery;console.log("Setting up vertical tabs");var e="labels-general",i=new URLSearchParams(window.location.search).get("sub_tab");i&&t('.vertical-tabs-nav a[data-tab="'+i+'"]').length?e=i:t(".vertical-tabs-nav .tab-item.active a").length&&(e=t(".vertical-tabs-nav .tab-item.active a").data("tab")),console.log("Active tab ID:",e),this.showVerticalTab(e),this.adjustTabContentHeight(),t(window).on("resize",this.adjustTabContentHeight.bind(this))}},{key:"adjustTabContentHeight",value:function(){var t=jQuery,e=t(".vertical-tabs-nav").outerHeight();e&&t(".vertical-tabs-content").css("min-height",e+"px")}},{key:"handleVerticalTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");console.log("Vertical tab clicked:",e),window.history.pushState({},"","?page=product-estimator-settings&tab=labels&sub_tab=".concat(e)),this.showVerticalTab(e)}},{key:"showVerticalTab",value:function(t){var e=jQuery;console.log("Showing vertical tab:",t),e(".vertical-tabs-nav .tab-item").removeClass("active"),e('.vertical-tabs-nav a[data-tab="'.concat(t,'"]')).parent().addClass("active"),e(".vertical-tab-content").hide().removeClass("active"),e("#".concat(t)).show().addClass("active")}},{key:"handleTabChanged",value:function(t,e){var i=this;"labels"===e&&(console.log("Labels tab activated"),setTimeout((function(){i.setupVerticalTabs()}),100))}},{key:"handleFormSubmit",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),a=i.serialize(),n=i.data("type")||"labels-general";console.log("Form submitted for type:",n);var r=i.find(".save-settings"),o=i.find(".spinner");r.prop("disabled",!0),o.addClass("is-active");var s=a;i.find('input[type="checkbox"]').each((function(){e(this).is(":checked")||s.includes(e(this).attr("name"))||(s+="&"+e(this).attr("name")+"=0")})),console.log("Sending form data:",s),u({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_labels_settings",nonce:productEstimatorSettings.nonce,form_data:s,label_type:n}}).then((function(t){console.log("Success response:",t),"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||"Labels saved successfully","success"):E(t.message||"Labels saved successfully","success")})).catch((function(t){console.error("Error response:",t),"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||"Error saving labels","error"):E(t.message||"Error saving labels","error")})).finally((function(){r.prop("disabled",!1),o.removeClass("is-active")}))}}])}(),R=null;jQuery(document).ready((function(){console.log("Document ready, initializing Label Settings Module"),R=new U,window.LabelSettingsModule=R})),console.log("Product Estimator Admin initialized"),console.log("Product Estimator Admin initialized")})()})();