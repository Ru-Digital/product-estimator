(()=>{"use strict";var t,e={90:(t,e,i)=>{var n=i(29),a=i(901),r=i(470),o=i(690),s=(i(75),i(467));function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){(0,s.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return t?t.length<=e?t:t.substring(0,e-i.length)+i:""}var u=i(723);r.ajaxRequest,r.debounce,o.createElement,o.createElementFromHTML,o.closest,o.toggleVisibility,o.forceElementVisibility,o.findParentBySelector,o.insertAfter,o.removeElement,o.addEventListenerOnce;var g=u.validateEmail,h=(u.validateNumber,u.validateRequired,u.showFieldError),p=u.clearFieldError,f=u.showNotice;function m(t){var e;if(null!==(e=window.productEstimatorVars)&&void 0!==e&&e.debug){for(var i,n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];(i=console).log.apply(i,["[".concat(t,"]")].concat(a))}}var v=function(){return(0,a.A)((function t(){var e,i,a,r=this;(0,n.A)(this,t),this.settings={ajaxUrl:(null===(e=window.customerEstimatesAdmin)||void 0===e?void 0:e.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:(null===(i=window.customerEstimatesAdmin)||void 0===i?void 0:i.nonce)||"",i18n:(null===(a=window.customerEstimatesAdmin)||void 0===a?void 0:a.i18n)||{}},jQuery(document).ready((function(){return r.init()}))}),[{key:"init",value:function(){this.bindEvents(),this.initializeActions(),m("CustomerEstimatesAdmin","Initialized")}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e("#doaction, #doaction2").on("click",this.handleBulkAction.bind(this)),e(".email-estimate").on("click",this.handleEmailEstimate.bind(this)),e('select[name="status_filter"]').on("change",(function(){e(this).closest("form").submit()})),e(".wp-list-table tbody tr").hover((function(){e(this).addClass("row-hover")}),(function(){e(this).removeClass("row-hover")})),"function"==typeof e.fn.tooltip&&e(".tooltip-trigger").tooltip(),e("#export-estimates-btn").on("click",this.exportEstimates.bind(this)),e(".print-estimate-btn").on("click",(function(i){i.preventDefault();var n=e(i.currentTarget).data("estimate-id");n&&t.printEstimate(n)}))}},{key:"initializeActions",value:function(){this.addResponsiveTableLabels(),this.handleSearchField(),this.handleAdminNotices()}},{key:"handleBulkAction",value:function(t){var e=jQuery;if("delete"===e(t.target).prev("select").val()){if(0===e('tbody th.check-column input[type="checkbox"]:checked').length)return t.preventDefault(),alert("Please select at least one estimate to delete."),!1;if(!confirm(this.settings.i18n.confirmBulkDelete))return t.preventDefault(),!1}}},{key:"handleEmailEstimate",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.currentTarget),n=i.data("estimate-id"),a=i.text();i.text(this.settings.i18n.emailSending).prop("disabled",!0),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"email_estimate",estimate_id:n,nonce:this.settings.nonce}}).then((function(t){u.showNotice(e.settings.i18n.emailSuccess,"success")})).catch((function(t){var i,n=e.settings.i18n.emailError+(null!==(i=t.data)&&void 0!==i&&i.message?": "+t.data.message:"");u.showNotice(n,"error")})).finally((function(){i.text(a).prop("disabled",!1)}))}},{key:"addResponsiveTableLabels",value:function(){var t=jQuery;t(window).width()<=782&&t(".wp-list-table td").each((function(){var e=t(this),i=e.closest("table").find("th").eq(e.index());i.length&&e.attr("data-label",i.text())}))}},{key:"handleSearchField",value:function(){var t=jQuery("#estimate-search-input");t.length&&!t.val()&&t.focus()}},{key:"handleAdminNotices",value:function(){var t=new URLSearchParams(window.location.search).get("message");if(t){var e="",i="success";switch(t){case"email_sent":e="Email sent successfully!";break;case"email_failed":e="Failed to send email.",i="error";break;case"deleted":e="Estimate deleted successfully!";break;case"delete_failed":e="Failed to delete estimate.",i="error";break;case"duplicated":e="Estimate duplicated successfully!";break;case"duplicate_failed":e="Failed to duplicate estimate.",i="error"}e&&u.showNotice(e,i)}}},{key:"showNotice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";u.showNotice(t,e)}},{key:"exportEstimates",value:function(){var t={},e=jQuery('select[name="status_filter"]').val(),i=jQuery("#estimate-search-input").val();e&&(t.status=e),i&&(t.search=i);var n=new URL(this.settings.ajaxUrl);for(var a in n.searchParams.append("action","export_estimates"),n.searchParams.append("nonce",this.settings.nonce),t)n.searchParams.append(a,t[a]);window.location.href=n.toString()}},{key:"printEstimate",value:function(t){jQuery;var e=window.open("","_blank");e.document.write("<html><head><title>Printing Estimate...</title></head>"),e.document.write("<body><p>Loading estimate for printing...</p></body></html>"),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"get_estimate_print_view",estimate_id:t,nonce:this.settings.nonce}}).then((function(t){e.document.write(t.html),e.document.close(),e.onload=function(){e.print()}})).catch((function(t){var i;e.document.write("<p>Error loading estimate: "+((null===(i=t.data)||void 0===i?void 0:i.message)||"Unknown error")+"</p>"),e.document.close()}))}},{key:"duplicateEstimate",value:function(t){var e=this;t&&confirm(this.settings.i18n.duplicateConfirm)&&r.wpAjax("duplicate_estimate",{estimate_id:t}).then((function(t){e.showNotice(t.message||"Estimate duplicated successfully!"),window.location.reload()})).catch((function(t){e.showNotice(t.message||"Failed to duplicate estimate","error")}))}},{key:"formatDate",value:function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=l(l({},{year:"numeric",month:"short",day:"numeric"}),e),n="string"==typeof t?new Date(t):t;return isNaN(n.getTime())?"Invalid date":new Intl.DateTimeFormat(navigator.language,i).format(n)}(t,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},{key:"formatPrice",value:function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(null==t)return"".concat(e,"0.00");var n="string"==typeof t?parseFloat(t):t;return isNaN(n)?"".concat(e,"0.00"):e+n.toFixed(i)}(t,"$")}},{key:"truncateText",value:function(t){return c(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:50)}}])}();jQuery(document).ready((function(){var t=new v;window.CustomerEstimatesAdmin=t})),new(function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),jQuery(document).ready((function(){e.initializeVariables(),e.bindEvents(),e.isSettingsPage()||e.initializeTabs()}))}),[{key:"isSettingsPage",value:function(){var t=new URLSearchParams(window.location.search).get("page");return t&&t.indexOf("-settings")>-1}},{key:"initializeVariables",value:function(){this.formChanged=!1,this.currentTab="",this.reportData=null,this.chart=null}},{key:"bindEvents",value:function(){var t=jQuery;this.isSettingsPage()||t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),this.initializeValidation(),t(window).on("beforeunload",this.handleBeforeUnload.bind(this))}},{key:"initializeTabs",value:function(){var t=jQuery,e=t(".nav-tab:first"),i=e.data("tab")||"tab-1";t(".tab-content").hide(),t("#".concat(i)).show(),e.addClass("nav-tab-active"),this.currentTab=i;var n=new URLSearchParams(window.location.search).get("tab");n&&this.switchTab(n)}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged?confirm(productEstimatorAdmin.i18n.unsavedChanges)&&this.switchTab(e):this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery;e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show(),this.currentTab=t;var i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),"reports"!==t||this.reportData||this.loadInitialReport()}},{key:"initializeValidation",value:function(){if(!this.isSettingsPage()){var t=jQuery,e=t(".product-estimator-form");e.find('input[type="email"]').on("change",(function(e){var i=t(e.currentTarget),n=i.val();n&&!g(n)?h(i,productEstimatorAdmin.i18n.invalidEmail):p(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(e.currentTarget),n=parseInt(i.val()),a=parseInt(i.attr("min")),r=parseInt(i.attr("max"));n<a||n>r?h(i,productEstimatorAdmin.i18n.numberRange.replace("%min%",a).replace("%max%",r)):p(i)}))}}},{key:"handleBeforeUnload",value:function(t){if(this.formChanged)return t.preventDefault(),productEstimatorAdmin.i18n.unsavedChanges}},{key:"loadInitialReport",value:function(){console.log("Loading initial report data")}}])}());var y=function(){return(0,a.A)((function t(){(0,n.A)(this,t),this.formChanged=!1,this.currentTab="",this.formChangeTrackers={},this.ensureGlobalVariables(),this.init()}),[{key:"ensureGlobalVariables",value:function(){window.generalSettingsData=window.generalSettingsData||{tab_id:"general",i18n:{}},window.netsuiteSettings=window.netsuiteSettings||{tab_id:"netsuite",i18n:{}},window.notificationSettings=window.notificationSettings||{tab_id:"notifications",i18n:{}},window.productAdditionsSettings=window.productAdditionsSettings||{tab_id:"product_additions",i18n:{}},window.pricingRulesSettings=window.pricingRulesSettings||{tab_id:"pricing_rules",i18n:{}},window.similarProductsL10n=window.similarProductsL10n||{tab_id:"similar_products",i18n:{}},window.productUpgradesSettings=window.productUpgradesSettings||{tab_id:"product_upgrades",i18n:{}},window.productEstimatorSettings=window.productEstimatorSettings||{ajax_url:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",nonce:"",i18n:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave this tab?",saveSuccess:"Settings saved successfully.",saveError:"Error saving settings."}}}},{key:"init",value:function(){var t=this.getTabFromUrl();this.currentTab=null!==t?t:"general",jQuery(".tab-content").hide(),jQuery("#".concat(this.currentTab)).show(),jQuery(".nav-tab").removeClass("nav-tab-active"),jQuery('.nav-tab[data-tab="'.concat(this.currentTab,'"]')).addClass("nav-tab-active"),this.bindEvents(),this.initFormChangeTracking(),this.initializeValidation(),m("ProductEstimatorSettings","Settings manager initialized with tab:",this.currentTab)}},{key:"bindEvents",value:function(){var t=jQuery;t(".nav-tab-wrapper").on("click",".nav-tab",this.handleTabClick.bind(this)),t(".product-estimator-form").on("submit",this.handleAjaxFormSubmit.bind(this)),t(window).on("beforeunload",this.handleBeforeUnload.bind(this)),m("ProductEstimatorSettings","Events bound")}},{key:"handleAjaxFormSubmit",value:function(t){var e=this;t.preventDefault();var i=jQuery(t.target),n=i.closest(".tab-content").attr("id"),a=i.serialize();console.log("Serialized form data:",a),this.showFormLoading(i),m("ProductEstimatorSettings","Submitting form for tab: ".concat(n)),r.ajaxRequest({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_"+n+"_settings",nonce:productEstimatorSettings.nonce,form_data:a}}).then((function(t){u.showNotice(t.message||productEstimatorSettings.i18n.saveSuccess,"success"),e.formChangeTrackers[n]=!1,n===e.currentTab&&(e.formChanged=!1),m("ProductEstimatorSettings","Settings saved successfully for tab: ".concat(n))})).catch((function(t){u.showNotice(t.message||productEstimatorSettings.i18n.saveError,"error"),m("ProductEstimatorSettings","Error saving settings for tab ".concat(n,":"),t)})).finally((function(){e.hideFormLoading(i)}))}},{key:"showFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!0).addClass("loading"),e.data("original-text",e.val()),e.val(productEstimatorSettings.i18n.saving||"Saving...")}},{key:"hideFormLoading",value:function(t){var e=t.find(":submit");e.prop("disabled",!1).removeClass("loading"),e.val(e.data("original-text"))}},{key:"initFormChangeTracking",value:function(){var t=jQuery,e=this;t(".tab-content").each((function(){var i=t(this).attr("id");e.formChangeTrackers[i]=!1,t("#".concat(i," :input")).on("change input",(function(){e.formChangeTrackers[i]=!0,i===e.currentTab&&(e.formChanged=!0)}))})),m("ProductEstimatorSettings","Form change tracking initialized")}},{key:"initializeValidation",value:function(){var t=jQuery;t(".product-estimator-form").each((function(){var e=t(this);e.find('input[type="email"]').on("change",(function(e){var i=t(this),n=i.val();n&&!u.validateEmail(n)?u.showFieldError(i,productEstimatorSettings.i18n.invalidEmail||"Invalid email address"):u.clearFieldError(i)})),e.find('input[type="number"]').on("change",(function(e){var i=t(this),n=parseInt(i.val()),a=parseInt(i.attr("min")||0),r=parseInt(i.attr("max")||9999);if(isNaN(n)||n<a||n>r){var o=productEstimatorSettings.i18n.numberRange?productEstimatorSettings.i18n.numberRange.replace("%min%",a).replace("%max%",r):"Value must be between ".concat(a," and ").concat(r);u.showFieldError(i,o)}else u.clearFieldError(i)}))})),m("ProductEstimatorSettings","Form validation initialized")}},{key:"getTabFromUrl",value:function(){return new URLSearchParams(window.location.search).get("tab")}},{key:"handleTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");this.formChanged&&!confirm(productEstimatorSettings.i18n.unsavedChanges)||this.switchTab(e)}},{key:"switchTab",value:function(t){var e=jQuery,i=new URL(window.location);i.searchParams.set("tab",t),window.history.pushState({},"",i),e(".nav-tab").removeClass("nav-tab-active"),e('.nav-tab[data-tab="'.concat(t,'"]')).addClass("nav-tab-active"),e(".tab-content").hide(),e("#".concat(t)).show();var n=this.currentTab;this.currentTab=t,this.formChanged=this.formChangeTrackers[t]||!1,e(document).trigger("product_estimator_tab_changed",[t,n]),m("ProductEstimatorSettings","Switched to tab: ".concat(t," from ").concat(n))}},{key:"handleBeforeUnload",value:function(t){var e=!1;for(var i in this.formChangeTrackers)if(this.formChangeTrackers[i]){e=!0;break}if(e){var n=productEstimatorSettings.i18n.unsavedChanges;return t.returnValue=n,n}}},{key:"showFieldError",value:function(t,e){u.showFieldError(t,e)}},{key:"clearFieldError",value:function(t){u.clearFieldError(t)}},{key:"showNotice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";u.showNotice(t,e)}}])}();jQuery(document).ready((function(){window.ProductEstimatorSettings=new y}));var b=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),this.validateMarkup=this.validateMarkup.bind(this),this.validateExpiryDays=this.validateExpiryDays.bind(this),this.showFieldError=this.showFieldError.bind(this),this.clearFieldError=this.clearFieldError.bind(this),this.handleTabChanged=this.handleTabChanged.bind(this),this.saveEditorContent=this.saveEditorContent.bind(this),this.validateAllFields=this.validateAllFields.bind(this),jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupValidation(),this.setupWpEditors(),console.log("GeneralSettingsModule: Initialized")}},{key:"bindEvents",value:function(){var t=jQuery;t(document).on("product_estimator_tab_changed",this.handleTabChanged),t(".file-upload-button").on("click",this.handleFileUpload.bind(this)),t(".file-remove-button").on("click",this.handleFileRemove.bind(this))}},{key:"setupWpEditors",value:function(){var t,e=jQuery;if(0!==e("#general").length){console.log("Setting up rich text editors with <br> tag preservation");var i=["pdf_footer_text","pdf_footer_contact_details_content"];window._originalEditorContent=window._originalEditorContent||{};var n=function(t){return t.replace(/<br\s*\/?>/gi,"<br>â€‹")},a=function(t){return t.replace(/\u200B/g,"")},r=function(){if("undefined"!=typeof tinyMCE&&tinyMCE.editors){var t=!0;return i.forEach((function(i){(function(t){if(!tinyMCE||!tinyMCE.get(t))return!1;var i=tinyMCE.get(t);i.settings.wpautop=!1,i.settings.forced_root_block="",i.settings.valid_elements="*[*]",i.settings.entity_encoding="raw",i.settings.verify_html=!1,i.settings.br_in_pre=!1,i.settings.keep_styles=!0,i.settings.remove_linebreaks=!1,i.settings.convert_newlines_to_brs=!0,i.settings.remove_redundant_brs=!1;var r=e("#".concat(t));if(r.length){var o=r.val();window._originalEditorContent[t]=o,setTimeout((function(){var t=n(o);i.setContent(t,{format:"raw"})}),100)}return i.on("BeforeSetContent",(function(e){e.content&&(e.content=n(e.content)),(e.initial||e.source_view)&&(window._originalEditorContent[t]=e.content)})),i.on("GetContent",(function(t){t.content&&(t.content=a(t.content))})),i.on("init",(function(){var e=i.getContent({format:"raw"});window._originalEditorContent[t]=a(e),console.log("Editor ".concat(t," initialized with content length: ").concat(e.length))})),e('.wp-editor-tabs button[data-wp-editor-id="'.concat(t,'"]')).on("click",(function(){var i=e(this).hasClass("switch-html"),r=e(this).hasClass("switch-tmce");if(i&&tinyMCE.get(t)){var o=tinyMCE.get(t).getContent({format:"raw"}),s=a(o);window._originalEditorContent[t]=s,e("#".concat(t)).val(s)}r&&setTimeout((function(){if(tinyMCE.get(t)&&window._originalEditorContent[t]){var e=n(window._originalEditorContent[t]);tinyMCE.get(t).setContent(e,{format:"raw"})}}),100)})),console.log("Editor ".concat(t," configured with <br> tag protection")),!0})(i)||(t=!1)})),t}return!1};if(!r())var o=0,s=setInterval((function(){o++,(r()||o>20)&&clearInterval(s)}),300);if(i.forEach((function(t){e("#".concat(t)).on("input change",(function(){window._originalEditorContent[t]=e(this).val()}))})),e("#general form").off("submit.htmlPreservation").on("submit.htmlPreservation",(function(){return i.forEach((function(t){var i="";if(tinyMCE.get(t)&&tinyMCE.get(t).isHidden()){var n=e("#".concat(t));n.length&&(i=n.val())}else if(tinyMCE.get(t)){var r=tinyMCE.get(t).getContent({format:"raw"});i=a(r)}!i&&window._originalEditorContent[t]&&(i=window._originalEditorContent[t]),i&&(e("#".concat(t)).val(i),console.log("Form submission: Updated ".concat(t," with content length: ").concat(i.length)))})),!0})),null!==(t=window.productEstimatorVars)&&void 0!==t&&t.debug){var d=e('<button type="button" class="button debug-editor-content">Debug Editor Content</button>');e("#general form .submit").append(d),d.on("click",(function(t){t.preventDefault(),console.group("TinyMCE Editor Debug"),i.forEach((function(t){if(console.group("Editor: ".concat(t)),tinyMCE.get(t)){var i=tinyMCE.get(t).getContent({format:"raw"});console.log("Visual Editor Content:",i),console.log("Clean Visual Content:",a(i))}else console.log("Visual Editor not available");var n=e("#".concat(t)).val();console.log("Textarea Content:",n),console.log("Stored Original Content:",window._originalEditorContent[t]||"None"),console.groupEnd()})),console.groupEnd(),alert("Editor content information has been logged to the console")}))}}}},{key:"handleFileUpload",value:function(t){var e=this;t.preventDefault();var i=jQuery,n=i(t.currentTarget),a=n.data("field-id"),r=n.data("accept")||"";this.mediaFrame||(this.mediaFrame=wp.media({title:"Select or Upload PDF Template",button:{text:"Use this file"},multiple:!1,library:{type:r?[r.split("/")[0]]:null}}),this.mediaFrame.on("select",(function(){var t=e.mediaFrame.state().get("selection").first().toJSON();i("#".concat(a)).val(t.id).trigger("change"),n.siblings(".file-preview-wrapper").html('<p class="file-preview"><a href="'.concat(t.url,'" target="_blank">').concat(t.filename,"</a></p>")),n.siblings(".file-remove-button").removeClass("hidden")}))),this.mediaFrame.open()}},{key:"handleFileRemove",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),n=i.data("field-id");e("#".concat(n)).val("").trigger("change"),i.siblings(".file-preview-wrapper").empty(),i.addClass("hidden")}},{key:"setupValidation",value:function(){var t=jQuery;t("#default_markup").on("change input",this.validateMarkup),t("#estimate_expiry_days").on("change input",this.validateExpiryDays)}},{key:"validateMarkup",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val()),n=parseInt(e.attr("min")||0),a=parseInt(e.attr("max")||100);return isNaN(i)||i<n||i>a?(this.showFieldError(e,generalSettingsData.i18n.validationErrorMarkup||"Value must be between ".concat(n," and ").concat(a)),!1):(this.clearFieldError(e),!0)}},{key:"validateExpiryDays",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val()),n=parseInt(e.attr("min")||1),a=parseInt(e.attr("max")||365);return isNaN(i)||i<n||i>a?(this.showFieldError(e,generalSettingsData.i18n.validationErrorExpiry||"Value must be between ".concat(n," and ").concat(a)),!1):(this.clearFieldError(e),!0)}},{key:"showFieldError",value:function(t,e){if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError)ProductEstimatorSettings.showFieldError(t,e);else if("undefined"!=typeof validation&&"function"==typeof validation.showFieldError)validation.showFieldError(t,e);else{t.addClass("error"),this.clearFieldError(t);var i=jQuery('<span class="field-error">'.concat(e,"</span>"));t.after(i)}}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):"undefined"!=typeof validation&&"function"==typeof validation.clearFieldError?validation.clearFieldError(t):(t.removeClass("error"),t.next(".field-error").remove())}},{key:"handleTabChanged",value:function(t,e){"general"===e&&(this.setupWpEditors(),console.log("GeneralSettingsModule: Tab changed to General Settings, refreshing editors"))}},{key:"saveEditorContent",value:function(){"undefined"!=typeof tinyMCE&&["pdf_footer_text","pdf_footer_contact_details_content"].forEach((function(t){var e=tinyMCE.get(t);e&&e.save()}))}},{key:"validateAllFields",value:function(){var t=!0;return this.saveEditorContent(),this.validateMarkup({currentTarget:jQuery("#default_markup")})||(t=!1),this.validateExpiryDays({currentTarget:jQuery("#estimate_expiry_days")})||(t=!1),t}},{key:"showNotice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice)ProductEstimatorSettings.showNotice(t,e);else if("undefined"!=typeof validation&&"function"==typeof validation.showNotice)validation.showNotice(t,e);else{var i=jQuery,n=i('<div class="notice notice-'.concat(e,' is-dismissible"><p>').concat(t,"</p></div>"));i(".wrap h1").after(n),setTimeout((function(){n.fadeOut(500,(function(){return n.remove()}))}),5e3)}}}])}();jQuery(document).ready((function(){window.GeneralSettingsModule=new b}));var _=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){m("NetsuiteSettingsModule","Initializing NetSuite settings module"),this.bindEvents(),this.setupDependentFields()}},{key:"bindEvents",value:function(){var t=jQuery;t("#test-netsuite-connection").on("click",this.testNetsuiteConnection.bind(this)),t("#netsuite_enabled").on("change",this.toggleNetsuiteFields.bind(this)),t("#netsuite_api_url, #netsuite_token_url").on("change",this.validateUrl.bind(this)),t("#netsuite_request_limit").on("change",this.validateRequestLimit.bind(this)),t("#netsuite_cache_time").on("change",this.validateCacheTime.bind(this)),t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),m("NetsuiteSettingsModule","Events bound successfully")}},{key:"setupDependentFields",value:function(){this.toggleNetsuiteFields(),m("NetsuiteSettingsModule","Dependent fields setup complete")}},{key:"toggleNetsuiteFields",value:function(){var t=jQuery,e=t("#netsuite_enabled").is(":checked"),i=t("#netsuite_client_id, #netsuite_client_secret, #netsuite_api_url, #netsuite_token_url, #netsuite_request_limit, #netsuite_cache_time").closest("tr");e?(i.fadeIn(200),t("#test-netsuite-connection").closest("p").fadeIn(200)):(i.fadeOut(200),t("#test-netsuite-connection").closest("p").fadeOut(200)),m("NetsuiteSettingsModule","NetSuite fields toggled: ".concat(e?"visible":"hidden"))}},{key:"testNetsuiteConnection",value:function(){var t=jQuery,e=t("#test-netsuite-connection"),i=t("#connection-result");e.prop("disabled")||(e.prop("disabled",!0),i.html('<span style="color:#666;">'.concat(netsuiteSettings.i18n.testing||"Testing connection...","</span>")),m("NetsuiteSettingsModule","Testing NetSuite connection"),(0,r.ajaxRequest)({url:netsuiteSettings.ajax_url,type:"POST",data:{action:"test_netsuite_connection",nonce:netsuiteSettings.nonce}}).then((function(t){i.html('<span style="color:green;">'.concat(t.message,"</span>")),m("NetsuiteSettingsModule","Connection test successful")})).catch((function(t){i.html('<span style="color:red;">'.concat(netsuiteSettings.i18n.error||"Error:"," ").concat(t.message,"</span>")),m("NetsuiteSettingsModule","Connection test failed:",t)})).finally((function(){e.prop("disabled",!1)})))}},{key:"handleTabChanged",value:function(t,e){e===netsuiteSettings.tab_id&&(this.toggleNetsuiteFields(),m("NetsuiteSettingsModule","Tab changed to NetSuite settings, refreshing fields"))}},{key:"validateUrl",value:function(t){var e=jQuery(t.currentTarget),i=e.val().trim();return i&&!this.isValidUrl(i)?(this.showFieldError(e,netsuiteSettings.i18n.invalidUrl||"Please enter a valid URL"),!1):(this.clearFieldError(e),!0)}},{key:"validateRequestLimit",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val(),10);return isNaN(i)||i<1||i>100?(this.showFieldError(e,"Request limit must be between 1 and 100"),!1):(this.clearFieldError(e),!0)}},{key:"validateCacheTime",value:function(t){var e=jQuery(t.currentTarget),i=parseInt(e.val(),10);return isNaN(i)||i<0?(this.showFieldError(e,"Cache time must be at least 0"),!1):(this.clearFieldError(e),!0)}},{key:"isValidUrl",value:function(t){try{return new URL(t),!0}catch(t){return!1}}},{key:"showFieldError",value:function(t,e){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError?ProductEstimatorSettings.showFieldError(t,e):(0,u.showFieldError)(t,e)}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):(0,u.clearFieldError)(t)}},{key:"addInfoSection",value:function(t){var e=jQuery,i=e("#netsuite-settings-table");if(i.length&&t){e(".netsuite-info-section").remove();var n=(0,o.createElement)("div",{className:"netsuite-info-section notice notice-info",style:{padding:"10px",marginBottom:"15px"}},t);i.before(n),m("NetsuiteSettingsModule","Added info section to settings page")}}}])}();jQuery(document).ready((function(){var t=new _;window.NetsuiteSettingsModule=t}));var w=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){this.mediaFrame=null,this.bindEvents(),this.setupDependentFields(),this.setupVerticalTabs(),this.setupMediaUploader()}},{key:"bindEvents",value:function(){var t=jQuery;t("#enable_notifications").on("change",this.toggleNotificationFields.bind(this)),t('[id^="notification_"][id$="_enabled"]').on("change",function(e){var i=t(e.currentTarget),n=i.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(n,i.is(":checked"))}.bind(this)),t(".image-upload-button").on("click",this.handleImageUpload.bind(this)),t(".image-remove-button").on("click",this.handleImageRemove.bind(this)),t("#from_email, #default_designer_email, #default_store_email").on("change",this.validateEmail.bind(this)),t(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),t(".notification-settings-form").on("submit",this.handleFormSubmit.bind(this)),t(".vertical-tabs-nav a").on("click",this.handleVerticalTabClick.bind(this))}},{key:"toggleNotificationTypeFields",value:function(t,e){var i=jQuery('.notification-type-form[data-type="'.concat(t,'"]')).find("input, textarea, button").not("#notification_".concat(t,"_enabled"));e?i.prop("disabled",!1):i.prop("disabled",!0)}},{key:"setupMediaUploader",value:function(){}},{key:"validateEmail",value:function(t){var e=jQuery(t.target),i=e.val().trim();return i&&!u.validateEmail(i)?(this.showFieldError(e,notificationSettings.i18n.validationErrorEmail||"Please enter a valid email address"),!1):(this.clearFieldError(e),!0)}},{key:"showFieldError",value:function(t,e){if("undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showFieldError)ProductEstimatorSettings.showFieldError(t,e);else{p(t);var i=jQuery('<span class="field-error">'.concat(e,"</span>"));t.after(i).addClass("error")}}},{key:"clearFieldError",value:function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.clearFieldError?ProductEstimatorSettings.clearFieldError(t):t.removeClass("error").next(".field-error").remove()}},{key:"setupDependentFields",value:function(){var t=jQuery;this.toggleNotificationFields(),t('[id^="notification_"][id$="_enabled"]').each(function(e,i){var n=t(i),a=n.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(a,n.is(":checked"))}.bind(this))}},{key:"toggleNotificationFields",value:function(){var t=jQuery,e=t("#enable_notifications").is(":checked"),i=t(".vertical-tabs-nav"),n=t(".notification-type-form");e?(i.removeClass("disabled"),n.find("input, textarea, button").prop("disabled",!1),t('[id^="notification_"][id$="_enabled"]').each(function(e,i){var n=t(i),a=n.attr("id").replace("notification_","").replace("_enabled","");this.toggleNotificationTypeFields(a,n.is(":checked"))}.bind(this))):(i.addClass("disabled"),n.find("input, textarea, button").prop("disabled",!0))}},{key:"setupVerticalTabs",value:function(){var t=jQuery,e="notification_general",i=new URLSearchParams(window.location.search).get("sub_tab");i&&t('.vertical-tabs-nav a[data-tab="'+i+'"]').length?e=i:t(".vertical-tabs-nav .tab-item.active a").length&&(e=t(".vertical-tabs-nav .tab-item.active a").data("tab")),this.showVerticalTab(e),this.adjustTabContentHeight(),t(window).on("resize",this.adjustTabContentHeight.bind(this))}},{key:"adjustTabContentHeight",value:function(){var t=jQuery,e=t(".vertical-tabs-nav").outerHeight();t(".vertical-tabs-content").css("min-height",e+"px")}},{key:"handleVerticalTabClick",value:function(t){t.preventDefault();var e=jQuery(t.currentTarget).data("tab");window.history.pushState({},"","?page=product-estimator-settings&tab=notifications&sub_tab=".concat(e)),this.showVerticalTab(e)}},{key:"showVerticalTab",value:function(t){var e=jQuery;e(".vertical-tabs-nav .tab-item").removeClass("active"),e('.vertical-tabs-nav a[data-tab="'.concat(t,'"]')).parent().addClass("active"),e(".vertical-tab-content").removeClass("active"),e("#".concat(t)).addClass("active")}},{key:"handleImageUpload",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),n=i.data("field-id"),a=this.mediaFrame;a?a.open():"undefined"!=typeof wp&&wp.media?(this.mediaFrame=wp.media({title:notificationSettings.i18n.selectImage||"Select Image",button:{text:notificationSettings.i18n.useThisImage||"Use this image"},multiple:!1,library:{type:"image"}}),this.mediaFrame.on("select",function(){var t=this.mediaFrame.state().get("selection").first().toJSON();e("#".concat(n)).val(t.id).trigger("change"),i.closest("td").find(".image-preview-wrapper").html('<img src="'.concat(t.sizes.medium?t.sizes.medium.url:t.url,'" alt="" style="max-width:200px;max-height:100px;display:block;margin-bottom:10px;" />')),i.closest("td").find(".image-remove-button").removeClass("hidden")}.bind(this)),this.mediaFrame.open()):console.error("WordPress Media Library not available")}},{key:"handleImageRemove",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),n=i.data("field-id");e("#".concat(n)).val("").trigger("change"),i.closest("td").find(".image-preview-wrapper").empty(),i.addClass("hidden")}},{key:"handleTabChanged",value:function(t,e){e===notificationSettings.tab_id&&(this.toggleNotificationFields(),this.setupVerticalTabs())}},{key:"handleFormSubmit",value:function(t){t.preventDefault();var e=jQuery,i=e(t.currentTarget),n=i.serialize(),a=i.data("type")||"notification_general",o=i.find(".save-settings"),s=i.find(".spinner");if(o.prop("disabled",!0),s.addClass("is-active"),"undefined"!=typeof tinyMCE)for(var d=tinyMCE.editors,l=0;l<d.length;l++)d[l].save();var c=n;i.find('input[type="checkbox"]').each((function(){e(this).is(":checked")||c.includes(e(this).attr("name"))||(c+="&"+e(this).attr("name")+"=0")})),r.ajaxRequest({url:productEstimatorSettings.ajax_url,type:"POST",data:{action:"save_notifications_settings",nonce:productEstimatorSettings.nonce,form_data:c,notification_type:a}}).then((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||notificationSettings.i18n.saveSuccess,"success"):f(t.message||notificationSettings.i18n.saveSuccess,"success")})).catch((function(t){"undefined"!=typeof ProductEstimatorSettings&&"function"==typeof ProductEstimatorSettings.showNotice?ProductEstimatorSettings.showNotice(t.message||notificationSettings.i18n.saveError,"error"):f(t.message||notificationSettings.i18n.saveError,"error")})).finally((function(){o.prop("disabled",!1),s.removeClass("is-active")}))}}])}();jQuery(document).ready((function(){var t=new w;window.NotificationSettingsModule=t}));var E=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t);var i=window.productAdditionsSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"product_additions"},this.formModified=!1,jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){m("ProductAdditionsSettingsModule","Initializing Product Additions Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRelationshipHandlers(),e("#product-addition-form").on("change input","input, select, textarea",(function(){t.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initRelationshipHandlers",value:function(){var t,e=jQuery,i=(e(".product-estimator-additions"),e("#product-addition-form")),n=e(".product-additions-form"),a=e(".add-new-relation"),r=e("#relation_type"),o=e(".target-category-row"),s=e("#target_category"),d=e(".product-search-row"),l=e(".note-row");e("#source_category").select2({placeholder:"Select source categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),e("#target_category").select2({placeholder:"Select a category",width:"100%",allowClear:!0,dropdownCssClass:"product-estimator-dropdown"}),a.on("click",function(){m("ProductAdditionsSettingsModule","Add New Relationship button clicked"),this.resetForm(),e(".form-title").text(this.settings.i18n.addNew||"Add New Relationship"),e(".save-relation").text(this.settings.i18n.saveChanges||"Save Changes"),n.slideDown()}.bind(this)),e(".cancel-form").on("click",function(){n.slideUp(),this.resetForm()}.bind(this)),r.on("change",(function(){var t=e(this).val();s.val("").trigger("change"),d.hide(),e("#selected-product").hide(),e("#selected_product_id").val(""),l.hide(),e("#note_text").val(""),"auto_add_by_category"===t?(o.show(),l.hide()):"auto_add_note_by_category"===t?(o.hide(),l.show()):"suggest_products_by_category"===t?(o.show(),l.hide(),d.hide()):(o.hide(),l.hide())})),s.on("change",(function(){var t=e(this).val(),i=r.val();e("#product_search").val(""),e("#product-search-results").empty(),e("#selected-product").hide(),e("#selected_product_id").val(""),t&&"auto_add_by_category"===i?d.show():d.hide()})),e("#product_search").on("keyup",function(i){var n=this,a=e(i.target).val()||"",r=s.val();clearTimeout(t),a.length<3?e("#product-search-results").empty():t=setTimeout((function(){n.searchProducts(a,r)}),500)}.bind(this)),e(".clear-product").on("click",(function(){e("#selected_product_id").val(""),e(".selected-product-info").empty(),e("#selected-product").hide()})),i.on("submit",this.handleFormSubmission.bind(this)),e(".product-additions-list").on("click",".edit-relation",this.handleEditRelation.bind(this)),e(".product-additions-list").on("click",".delete-relation",this.handleDeleteRelation.bind(this))}},{key:"setupFormHandling",value:function(){var t=jQuery;t(document).on("click",".product-result-item",(function(e){var i=t(e.currentTarget).data("id"),n=t(e.currentTarget).data("name");m("ProductAdditionsSettingsModule","Product selected:",i,n),t("#selected_product_id").val(i),m("ProductAdditionsSettingsModule","Product ID set to:",t("#selected_product_id").val()),t(".selected-product-info").html("<strong>".concat(n,"</strong> (ID: ").concat(i,")")),t("#selected-product").show(),t("#product_search").val(""),t("#product-search-results").empty()}))}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var t=jQuery;t("#product-addition-form")[0].reset(),t("#relation_id").val(""),t("#selected_product_id").val(""),t("#source_category").val(null).trigger("change"),t("#target_category").val(null).trigger("change"),t("#relation_type").val("").trigger("change"),t(".target-category-row").hide(),t(".product-search-row").hide(),t("#selected-product").hide(),t("#product-search-results").empty(),t(".note-row").hide(),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#product-addition-form"),n=i.find(".save-relation"),a=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!t),n.prop("disabled",!t),a.prop("disabled",!t),t?n.text(e("#relation_id").val()?"Update Relationship":"Save Relationship"):n.text("Saving..."),t?(e("#source_category").prop("disabled",!1).trigger("change"),e("#target_category").prop("disabled",!1).trigger("change")):(e("#source_category").prop("disabled",!0).trigger("change"),e("#target_category").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,n=i("#relation_type").val(),a=i("#source_category").val(),o=i("#selected_product_id").val(),s=i("#note_text").val();if(n)if(a&&0!==a.length){if("auto_add_by_category"===n){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category");if(!o)return void alert(this.settings.i18n.selectProduct||"Please select a product")}else if("suggest_products_by_category"===n){if(!i("#target_category").val())return void alert(this.settings.i18n.selectTargetCategory||"Please select a target category")}else if("auto_add_note_by_category"===n&&!s)return void alert("Please enter a note text");this.toggleFormState(!1);var d={action:"save_category_relation",nonce:this.settings.nonce,relation_id:i("#relation_id").val(),relation_type:n,source_category:a,target_category:i("#target_category").val(),product_id:o,note_text:s};m("ProductAdditionsSettingsModule","Sending form data:",d),r.ajaxRequest({url:this.settings.ajaxUrl,data:d}).then((function(t){if(m("ProductAdditionsSettingsModule","Response received:",t),e.showMessage("success",t.message),d.relation_id){m("ProductAdditionsSettingsModule","Updating existing relation:",d.relation_id);var n=i(".product-additions-list").find('tr[data-id="'.concat(d.relation_id,'"]'));n.length?n.replaceWith(e.createRelationRow(t.relation)):e.appendRelationRow(t.relation)}else e.appendRelationRow(t.relation);i(".product-additions-form").slideUp(),e.resetForm();var a=i(".product-additions-list").find(".no-items");if(a.length&&(a.remove(),!i(".product-additions-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-additions-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Source Categories",'</th>\n                    <th scope="col">',"Action",'</th>\n                    <th scope="col">',"Target/Note",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-additions-list").find("h3").after(r)}e.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(t){e.showMessage("error",t.message||"Error saving relationship. Please try again."),m("ProductAdditionsSettingsModule","Error saving relationship:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectSourceCategories||"Please select at least one source category");else alert(this.settings.i18n.selectAction||"Please select an action type")}},{key:"handleEditRelation",value:function(t){var e=jQuery,i=e(t.currentTarget),n=i.data("id"),a=String(i.data("source")||"").split(","),r=i.data("target"),o=i.data("type"),s=i.data("product-id"),d=i.data("note-text");m("ProductAdditionsSettingsModule","Edit relation:",n,a,r,o,s,d),this.resetForm(),e("#relation_id").val(n),e("#relation_type").val(o).trigger("change"),setTimeout(function(){e("#source_category").val(a).trigger("change"),"auto_add_by_category"===o&&r?(e("#target_category").val(r).trigger("change"),s&&this.loadProductDetails(s)):"suggest_products_by_category"===o&&r?e("#target_category").val(r).trigger("change"):"auto_add_note_by_category"===o&&d&&e("#note_text").val(d)}.bind(this),100),e(".form-title").text("Edit Category Relationship"),e(".save-relation").text("Update Relationship"),e(".product-additions-form").slideDown(),e("html, body").animate({scrollTop:e(".product-additions-form").offset().top-50},300)}},{key:"handleDeleteRelation",value:function(t){var e=this,i=jQuery,n=i(t.currentTarget),a=n.data("id");m("ProductAdditionsSettingsModule","Delete relation:",a),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this relationship?")&&(n.prop("disabled",!0).text("Deleting..."),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"delete_category_relation",nonce:this.settings.nonce,relation_id:a}}).then((function(t){m("ProductAdditionsSettingsModule","Delete response:",t);var a=n.closest("tr");a.fadeOut(300,(function(){a.remove(),i(".product-additions-list").find("tbody tr").length||(i(".product-additions-list").find("table").remove(),i(".product-additions-list").append('<div class="no-items">No relationships have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting relationship. Please try again."),n.prop("disabled",!1).text("Delete"),m("ProductAdditionsSettingsModule","Error deleting relationship:",t)})))}},{key:"searchProducts",value:function(t,e){var i=jQuery;t&&e?(i("#product-search-results").html("<p>Searching...</p>"),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"search_category_products",nonce:this.settings.nonce,search:t,category:e}}).then((function(t){if(t.products&&t.products.length>0){var e='<ul class="product-results-list">';t.products.forEach((function(t){e+='\n              <li class="product-result-item" data-id="'.concat(t.id,'" data-name="').concat(t.name,'">\n                ').concat(t.name," (ID: ").concat(t.id,")\n              </li>\n            ")})),e+="</ul>",i("#product-search-results").html(e)}else i("#product-search-results").html("<p>No products found</p>")})).catch((function(t){m("ProductAdditionsSettingsModule","AJAX error:",t),i("#product-search-results").html("<p>Error searching products</p>")}))):i("#product-search-results").html("<p>Please enter search term and select a category</p>")}},{key:"loadProductDetails",value:function(t){var e=jQuery;t&&r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"get_product_details",nonce:this.settings.nonce,product_id:t}}).then((function(t){if(t.product){var i=t.product;e("#selected_product_id").val(i.id),e(".selected-product-info").html("<strong>".concat(i.name,"</strong> (ID: ").concat(i.id,")")),e("#selected-product").show()}else m("ProductAdditionsSettingsModule","Failed to load product details:",t)})).catch((function(t){m("ProductAdditionsSettingsModule","AJAX error while loading product details:",t)}))}},{key:"createRelationRow",value:function(t){var e=jQuery;if(!t||!t.id)return m("ProductAdditionsSettingsModule","Invalid relation data",t),e('<tr><td colspan="4">Error: Invalid relation data</td></tr>');var i=e("<tr></tr>").attr("data-id",t.id),n=t.source_name||"";i.append(e("<td></td>").text(n));var a,r=e("<td></td>"),s=e("<span></span>").addClass("relation-type").addClass(t.relation_type||"");a="auto_add_by_category"===t.relation_type?"Auto add product with Category":"auto_add_note_by_category"===t.relation_type?"Auto add note with Category":"suggest_products_by_category"===t.relation_type?"Suggest products when Category":t.relation_type_label||"",s.text(a),r.append(s),i.append(r);var d=e("<td></td>");if("auto_add_by_category"===t.relation_type)t.product_name?d.text(t.product_name):t.target_name&&d.text(t.target_name+" (Category)");else if("auto_add_note_by_category"===t.relation_type){var l=t.note_text&&t.note_text.length>50?c(t.note_text,50):t.note_text||"";d.text(l)}else"suggest_products_by_category"===t.relation_type&&t.target_name&&d.text(t.target_name+" (Category)");i.append(d);var u=e("<td></td>").addClass("actions"),g=Array.isArray(t.source_category)?t.source_category.join(","):t.source_category||"",h=o.createElement("button",{className:"button button-small edit-relation",type:"button",dataset:{id:t.id,source:g,target:t.target_category||"",productId:t.product_id||"",type:t.relation_type||"",noteText:t.note_text||""}},"Edit"),p=o.createElement("button",{className:"button button-small delete-relation",type:"button",dataset:{id:t.id}},"Delete");return u.append(e(h)," ",e(p)),i.append(u),i}},{key:"appendRelationRow",value:function(t){var e=jQuery;if(t&&t.id){var i=e(".product-additions-table");if(i.length){var n=i.find("tbody");if(n.length){var a=this.createRelationRow(t);n.append(a)}else m("ProductAdditionsSettingsModule","Cannot append row: Table body not found")}else m("ProductAdditionsSettingsModule","Cannot append row: Table not found")}else m("ProductAdditionsSettingsModule","Cannot append row: Invalid relation data",t)}},{key:"showMessage",value:function(t,e){var i=jQuery,n=i(".product-estimator-additions");if(n.length){var a=n.find(".notice");if(a.length&&a.remove(),"function"==typeof u.showNotice)u.showNotice(e,t);else{var r=o.createElement("div",{className:"notice ".concat("success"===t?"notice-success":"notice-error")}),s=o.createElement("p",{},e);r.appendChild(s),n.prepend(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}}else m("ProductAdditionsSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var t=jQuery("#product_additions");if(t.length&&t.is(":visible")){var e=new E;window.ProductAdditionsSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"product_additions"===e&&setTimeout((function(){var t=new E;window.ProductAdditionsSettingsModule=t}),100)}))}));var S=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t);var i=window.pricingRulesSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"pricing_rules"},jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){m("PricingRulesSettingsModule","Initializing Pricing Rules Settings Module"),this.bindEvents(),this.setupFormHandling(),this.initializeDefaultSettingsForm()}},{key:"bindEvents",value:function(){jQuery(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initRuleHandlers()}},{key:"initializeDefaultSettingsForm",value:function(){jQuery(".default-pricing-form").on("submit",(function(t){t.preventDefault(),"undefined"!=typeof ProductEstimatorSettings&&(ProductEstimatorSettings.formChanged=!0,ProductEstimatorSettings.handleAjaxFormSubmit(t))}))}},{key:"initRuleHandlers",value:function(){var t=jQuery,e=(t(".product-estimator-pricing-rules"),t("#pricing-rule-form")),i=t(".pricing-rules-form"),n=t(".add-new-rule");t("#categories").select2({placeholder:"Select categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),n.on("click",function(){m("PricingRulesSettingsModule","Add New Pricing Rule button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Pricing Rule"),t(".save-rule").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),e.on("submit",this.handleFormSubmission.bind(this)),t(".pricing-rules-list").on("click",".edit-rule",this.handleEditRule.bind(this)),t(".pricing-rules-list").on("click",".delete-rule",this.handleDeleteRule.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&this.init()}},{key:"resetForm",value:function(){var t=jQuery;t("#pricing-rule-form")[0].reset(),t("#rule_id").val(""),t("#categories").val(null).trigger("change")}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#pricing-rule-form"),n=i.find(".save-rule"),a=i.find(".cancel-form");i.find("input, select").prop("disabled",!t),n.prop("disabled",!t),a.prop("disabled",!t),t?n.text(e("#rule_id").val()?"Update Pricing Rule":"Save Pricing Rule"):n.text("Saving..."),t?e("#categories").prop("disabled",!1).trigger("change"):e("#categories").prop("disabled",!0).trigger("change")}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,n=i("#categories").val(),a=i("#pricing_method").val(),o=i("#pricing_source").val();if(n&&0!==n.length)if(a)if(o){this.toggleFormState(!1);var s={action:"save_pricing_rule",nonce:this.settings.nonce,rule_id:i("#rule_id").val(),categories:n,pricing_method:a,pricing_source:o};m("PricingRulesSettingsModule","Sending form data:",s),r.ajaxRequest({url:this.settings.ajaxUrl,data:s}).then((function(t){if(m("PricingRulesSettingsModule","Response received:",t),e.showMessage("success",t.message),s.rule_id){m("PricingRulesSettingsModule","Updating existing rule:",s.rule_id);var n=i(".pricing-rules-list").find('tr[data-id="'.concat(s.rule_id,'"]'));n.length?n.replaceWith(e.createRuleRow(t.rule)):e.appendRuleRow(t.rule)}else e.appendRuleRow(t.rule);i(".pricing-rules-form").slideUp(),e.resetForm();var a=i(".pricing-rules-list").find(".no-items");if(a.length&&(a.remove(),!i(".pricing-rules-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped pricing-rules-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Categories",'</th>\n                    <th scope="col">',"Pricing Method",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".pricing-rules-list").find("h3").after(r)}})).catch((function(t){e.showMessage("error",t.message||"Error saving pricing rule. Please try again."),m("PricingRulesSettingsModule","Error saving pricing rule:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectPricingSource||"Please select a pricing source");else alert(this.settings.i18n.selectPricingMethod||"Please select a pricing method");else alert(this.settings.i18n.selectCategories||"Please select at least one category")}},{key:"handleEditRule",value:function(t){var e=jQuery,i=e(t.currentTarget),n=i.data("id"),a=String(i.data("categories")).split(","),r=i.data("method"),o=i.data("source");m("PricingRulesSettingsModule","Edit rule:",n,a,r,o),this.resetForm(),e("#rule_id").val(n),e("#pricing_method").val(r),e("#pricing_source").val(o),setTimeout((function(){e("#categories").val(a).trigger("change")}),100),e(".form-title").text("Edit Pricing Rule"),e(".save-rule").text("Update Pricing Rule"),e(".pricing-rules-form").slideDown(),e("html, body").animate({scrollTop:e(".pricing-rules-form").offset().top-50},300)}},{key:"handleDeleteRule",value:function(t){var e=this,i=jQuery,n=i(t.currentTarget),a=n.data("id");m("PricingRulesSettingsModule","Delete rule:",a),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this pricing rule?")&&(n.prop("disabled",!0).text("Deleting..."),r.ajaxRequest({url:this.settings.ajaxUrl,data:{action:"delete_pricing_rule",nonce:this.settings.nonce,rule_id:a}}).then((function(t){m("PricingRulesSettingsModule","Delete response:",t);var a=n.closest("tr");a.fadeOut(300,(function(){a.remove(),i(".pricing-rules-list").find("tbody tr").length||(i(".pricing-rules-list").find("table").remove(),i(".pricing-rules-list").append('<div class="no-items">No pricing rules have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting pricing rule. Please try again."),n.prop("disabled",!1).text("Delete"),m("PricingRulesSettingsModule","Error deleting rule:",t)})))}},{key:"createRuleRow",value:function(t){var e=jQuery,i=e("<tr></tr>").attr("data-id",t.id);i.append(e("<td></td>").text(t.category_names)),i.append(e("<td></td>").text(t.pricing_label));var n=e("<td></td>").addClass("actions"),a=o.createElement("button",{className:"button button-small edit-rule",type:"button",dataset:{id:t.id,categories:Array.isArray(t.categories)?t.categories.join(","):"",method:t.pricing_method,source:t.pricing_source}},"Edit"),r=o.createElement("button",{className:"button button-small delete-rule",type:"button",dataset:{id:t.id}},"Delete");return n.append(e(a)," ",e(r)),i.append(n),i}},{key:"appendRuleRow",value:function(t){var e=jQuery(".pricing-rules-table").find("tbody"),i=this.createRuleRow(t);e.append(i)}},{key:"showMessage",value:function(t,e){var i=jQuery,n=i(".product-estimator-pricing-rules"),a=n.find(".notice");if(a.length&&a.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice){var r=o.createElement("div",{className:"notice notice-".concat("success"===t?"success":"error")}),s=o.createElement("p",{},e);r.appendChild(s),n.find("h1, h3").first().after(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}else ProductEstimatorSettings.showNotice(e,t)}}])}();jQuery(document).ready((function(){var t=jQuery("#pricing_rules");if(t.length&&t.is(":visible")){var e=new S;window.PricingRulesSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"pricing_rules"===e&&setTimeout((function(){var t=new S;window.PricingRulesSettingsModule=t}),100)}))}));var k=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t),this.l10n=window.similarProductsL10n||{nonce:"",loading_attributes:"Loading attributes...",select_category:"Please select categories first.",no_attributes:"No product attributes found for these categories.",error_loading:"Error loading attributes. Please try again.",saving:"Saving...",rule_saved:"Rule saved successfully!",error_saving:"Error saving rule. Please try again.",confirm_delete:"Are you sure you want to delete this rule?",error_deleting:"Error deleting rule. Please try again.",select_category_error:"Please select at least one source category.",select_attributes_error:"Please select at least one attribute."},jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){var t=jQuery;t(".product-estimator-similar-products-settings").length&&(m("SimilarProductsSettingsModule","Initializing Similar Products Settings Module"),t(".add-new-rule").on("click",this.addNewRule.bind(this)),this.initializeExistingRules(),this.initializeSliders())}},{key:"addNewRule",value:function(){var t=jQuery,e=t(".rule-template").children().first().clone(),i="new_"+Math.random().toString(36).substr(2,9);e.attr("data-rule-id",i),e.find('[name^="TEMPLATE_ID"]').each((function(){var e=t(this).attr("name").replace("TEMPLATE_ID",i);t(this).attr("name",e)})),t(".similar-products-rules").append(e),t(".no-rules-message").hide(),this.initializeRule(e),e.addClass("open")}},{key:"initializeExistingRules",value:function(){var t=this,e=jQuery;e(".similar-products-rule").each((function(i,n){t.initializeRule(e(n))}))}},{key:"initializeRule",value:function(t){var e=this,i=jQuery,n=t.data("rule-id");t.find(".rule-header").on("click",(function(e){i(e.target).hasClass("delete-rule")||i(e.target).hasClass("save-rule")||t.toggleClass("open")})),t.find(".source-categories-select").on("change",(function(n){var a=i(n.target).val();a&&a.length>0?e.loadCategoryAttributes(a,t):t.find(".attributes-list").empty().html("<p>".concat(e.l10n.select_category,"</p>"))})),t.find(".delete-rule").on("click",(function(i){i.preventDefault(),i.stopPropagation(),confirm(e.l10n.confirm_delete)&&e.deleteRule(n,t)})),t.find(".save-rule").on("click",(function(i){i.preventDefault(),i.stopPropagation(),e.saveRule(n,t)}));var a=t.find(".source-categories-select").val();a&&a.length>0&&this.loadCategoryAttributes(a,t),this.initializeSlider(t.find(".similarity-threshold"))}},{key:"initializeSliders",value:function(){var t=this,e=jQuery;e(".similarity-threshold").each((function(i,n){t.initializeSlider(e(n))}))}},{key:"initializeSlider",value:function(t){t.length&&t.on("input change",(function(){var t=$(this).val();$(this).closest(".slider-container").find(".similarity-threshold-value").text(t)}))}},{key:"loadCategoryAttributes",value:function(t,e){var i=this,n=(jQuery,e.find(".attributes-list"));n.html("<p>".concat(this.l10n.loading_attributes,"</p>")).addClass("loading"),r.ajaxRequest({url:ajaxurl,data:{action:"get_category_attributes",nonce:this.l10n.nonce,category_ids:t}}).then((function(t){i.renderAttributes(t.attributes,e)})).catch((function(t){n.html('<p class="error">'.concat(t.message||i.l10n.error_loading,"</p>")).removeClass("loading"),m("SimilarProductsSettingsModule","Error loading attributes:",t)}))}},{key:"renderAttributes",value:function(t,e){jQuery;var i=e.find(".attributes-list");if(i.empty().removeClass("loading"),t&&0!==t.length){var n=e.data("rule-id"),a=e.find(".selected-attributes").val(),r=[];a&&(r=a.split(",")),t.forEach((function(t){var e=r.indexOf(t.name)>-1,a=o.createElement("div",{className:"attribute-item"}),s=o.createElement("label",{},[o.createElement("input",{type:"checkbox",name:"".concat(n,"[attributes][]"),value:t.name,checked:e}),o.createElement("span",{},t.label)]);a.appendChild(s),i.append(a)}))}else i.html("<p>".concat(this.l10n.no_attributes,"</p>"))}},{key:"saveRule",value:function(t,e){var i=this,n=jQuery,a=e.find(".save-rule"),o=a.text(),s=e.find(".source-categories-select").val();if(s&&0!==s.length){var d=[];if(e.find('.attributes-list input[type="checkbox"]:checked').each((function(){d.push(n(this).val())})),0!==d.length){a.text(this.l10n.saving).prop("disabled",!0);var l=e.find(".similarity-threshold").val();r.ajaxRequest({url:ajaxurl,data:{action:"save_similar_products_rule",nonce:this.l10n.nonce,rule_id:t,source_categories:s,attributes:d,similarity_threshold:l}}).then((function(a){i.showMessage(e,i.l10n.rule_saved,"success"),t.startsWith("new_")&&(e.attr("data-rule-id",a.rule_id),e.find('[name^="'.concat(t,'"]')).each((function(){var e=n(this).attr("name").replace(t,a.rule_id);n(this).attr("name",e)})));var r=[];s.forEach((function(t){var i=e.find('.source-categories-select option[value="'.concat(t,'"]')).text();i&&r.push(i)})),r.length>0?e.find(".rule-title").text(r.join(", ")):e.find(".rule-title").text(i.l10n.select_category),m("SimilarProductsSettingsModule","Rule saved successfully",a)})).catch((function(t){i.showMessage(e,t.message||i.l10n.error_saving,"error"),m("SimilarProductsSettingsModule","Error saving rule:",t)})).finally((function(){a.text(o).prop("disabled",!1)}))}else this.showMessage(e,this.l10n.select_attributes_error,"error")}else this.showMessage(e,this.l10n.select_category_error,"error")}},{key:"deleteRule",value:function(t,e){var i=this,n=jQuery;if(t.startsWith("new_"))return e.remove(),void(0===n(".similar-products-rule").length&&n(".no-rules-message").show());r.ajaxRequest({url:ajaxurl,data:{action:"delete_similar_products_rule",nonce:this.l10n.nonce,rule_id:t}}).then((function(t){e.remove(),0===n(".similar-products-rule").length&&n(".no-rules-message").show(),m("SimilarProductsSettingsModule","Rule deleted successfully")})).catch((function(t){i.showMessage(e,t.message||i.l10n.error_deleting,"error"),m("SimilarProductsSettingsModule","Error deleting rule:",t)}))}},{key:"showMessage",value:function(t,e,i){var n=jQuery,a=o.createElement("div",{className:"rule-message ".concat(i)},e);t.find(".rule-message").remove(),t.find(".rule-header").after(n(a)),setTimeout((function(){o.removeElement(a,!0)}),3e3)}}])}();jQuery(document).ready((function(){var t=new k;window.SimilarProductsSettingsModule=t}));var P=function(){return(0,a.A)((function t(){var e=this;(0,n.A)(this,t);var i=window.productUpgradesSettings||{};this.settings={ajaxUrl:i.ajax_url||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),nonce:i.nonce||"",i18n:i.i18n||{},tab_id:i.tab_id||"product_upgrades"},this.formModified=!1,jQuery(document).ready((function(){return e.init()}))}),[{key:"init",value:function(){m("ProductUpgradesSettingsModule","Initializing Product Upgrades Settings Module"),this.formModified=!1,this.bindEvents(),this.setupFormHandling()}},{key:"bindEvents",value:function(){var t=this,e=jQuery;e(document).on("product_estimator_tab_changed",this.handleTabChanged.bind(this)),this.initUpgradeHandlers(),e("#product-upgrade-form").on("change input","input, select, textarea",(function(){t.formModified=!0,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[t.settings.tab_id]=!0,ProductEstimatorSettings.currentTab===t.settings.tab_id&&(ProductEstimatorSettings.formChanged=!0))}))}},{key:"initUpgradeHandlers",value:function(){var t=jQuery,e=(t(".product-estimator-upgrades"),t("#product-upgrade-form")),i=t(".product-upgrades-form"),n=t(".add-new-upgrade");t("#base_categories").select2({placeholder:"Select base categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),t("#upgrade_categories").select2({placeholder:"Select upgrade categories",width:"100%",dropdownCssClass:"product-estimator-dropdown"}),n.on("click",function(){m("ProductUpgradesSettingsModule","Add New Upgrade Configuration button clicked"),this.resetForm(),t(".form-title").text(this.settings.i18n.addNew||"Add New Upgrade Configuration"),t(".save-upgrade").text(this.settings.i18n.saveChanges||"Save Changes"),i.slideDown()}.bind(this)),t(".cancel-form").on("click",function(){i.slideUp(),this.resetForm()}.bind(this)),e.on("submit",this.handleFormSubmission.bind(this)),t(".product-upgrades-list").on("click",".edit-upgrade",this.handleEditUpgrade.bind(this)),t(".product-upgrades-list").on("click",".delete-upgrade",this.handleDeleteUpgrade.bind(this))}},{key:"setupFormHandling",value:function(){}},{key:"handleTabChanged",value:function(t,e){e===this.settings.tab_id&&(this.formModified=!1,this.init(),"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1)))}},{key:"resetForm",value:function(){var t=jQuery;t("#product-upgrade-form")[0].reset(),t("#upgrade_id").val(""),t("#base_categories").val(null).trigger("change"),t("#upgrade_categories").val(null).trigger("change"),t("#display_mode").val("dropdown").trigger("change"),t("#upgrade_title").val(""),t("#upgrade_description").val(""),this.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[this.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===this.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))}},{key:"toggleFormState",value:function(t){var e=jQuery,i=e("#product-upgrade-form"),n=i.find(".save-upgrade"),a=i.find(".cancel-form");i.find("input, select, textarea").prop("disabled",!t),n.prop("disabled",!t),a.prop("disabled",!t),t?n.text(e("#upgrade_id").val()?"Update Configuration":"Save Configuration"):n.text("Saving..."),t?(e("#base_categories").prop("disabled",!1).trigger("change"),e("#upgrade_categories").prop("disabled",!1).trigger("change")):(e("#base_categories").prop("disabled",!0).trigger("change"),e("#upgrade_categories").prop("disabled",!0).trigger("change"))}},{key:"handleFormSubmission",value:function(t){var e=this;t.preventDefault();var i=jQuery,n=i("#base_categories").val(),a=i("#upgrade_categories").val(),o=i("#display_mode").val(),s=i("#upgrade_title").val(),d=i("#upgrade_description").val();if(n&&0!==n.length)if(a&&0!==a.length){this.toggleFormState(!1);var l={action:"save_product_upgrade",nonce:this.settings.nonce,upgrade_id:i("#upgrade_id").val(),base_categories:n,upgrade_categories:a,display_mode:o,upgrade_title:s,upgrade_description:d};m("ProductUpgradesSettingsModule","Sending form data:",l),r.ajaxRequest({url:this.settings.ajaxUrl,data:l}).then((function(t){if(m("ProductUpgradesSettingsModule","Response received:",t),e.showMessage("success",t.message),l.upgrade_id){m("ProductUpgradesSettingsModule","Updating existing upgrade:",l.upgrade_id);var n=i(".product-upgrades-list").find('tr[data-id="'.concat(l.upgrade_id,'"]'));n.length?n.replaceWith(e.createUpgradeRow(t.upgrade)):e.appendUpgradeRow(t.upgrade)}else e.appendUpgradeRow(t.upgrade);i(".product-upgrades-form").slideUp(),e.resetForm();var a=i(".product-upgrades-list").find(".no-items");if(a.length&&(a.remove(),!i(".product-upgrades-list").find("table").length)){var r='\n              <table class="wp-list-table widefat fixed striped product-upgrades-table">\n                <thead>\n                  <tr>\n                    <th scope="col">'.concat("Base Categories",'</th>\n                    <th scope="col">',"Upgrade Categories",'</th>\n                    <th scope="col">',"Display Mode",'</th>\n                    <th scope="col">',"Actions","</th>\n                  </tr>\n                </thead>\n                <tbody></tbody>\n              </table>\n            ");i(".product-upgrades-list").find("h3").after(r)}e.formModified=!1,"undefined"!=typeof ProductEstimatorSettings&&void 0!==ProductEstimatorSettings.formChangeTrackers&&(ProductEstimatorSettings.formChangeTrackers[e.settings.tab_id]=!1,ProductEstimatorSettings.currentTab===e.settings.tab_id&&(ProductEstimatorSettings.formChanged=!1))})).catch((function(t){e.showMessage("error",t.message||"Error saving upgrade configuration. Please try again."),m("ProductUpgradesSettingsModule","Error saving upgrade configuration:",t)})).finally((function(){e.toggleFormState(!0)}))}else alert(this.settings.i18n.selectUpgradeCategories||"Please select at least one upgrade category");else alert(this.settings.i18n.selectBaseCategories||"Please select at least one base category")}},{key:"handleEditUpgrade",value:function(t){var e=jQuery,i=e(t.currentTarget),n=i.data("id"),a=String(i.data("base")||"").split(",").filter(Boolean),r=String(i.data("upgrade")||"").split(",").filter(Boolean),o=i.data("mode"),s=i.data("title"),d=i.data("description");m("ProductUpgradesSettingsModule","Edit upgrade:",n,a,r,o,s,d),this.resetForm(),e("#upgrade_id").val(n),e("#display_mode").val(o||"dropdown").trigger("change"),e("#upgrade_title").val(s||""),e("#upgrade_description").val(d||""),setTimeout((function(){e("#base_categories").val(a).trigger("change"),e("#upgrade_categories").val(r).trigger("change")}),100),e(".form-title").text("Edit Upgrade Configuration"),e(".save-upgrade").text("Update Configuration"),e(".product-upgrades-form").slideDown(),e("html, body").animate({scrollTop:e(".product-upgrades-form").offset().top-50},300)}},{key:"handleDeleteUpgrade",value:function(t){var e=this,i=jQuery,n=i(t.currentTarget),a=n.data("id");if(m("ProductUpgradesSettingsModule","Delete upgrade:",a),confirm(this.settings.i18n.confirmDelete||"Are you sure you want to delete this upgrade configuration?")){n.prop("disabled",!0).text("Deleting...");var o={action:"delete_product_upgrade",nonce:this.settings.nonce,upgrade_id:a};r.ajaxRequest({url:this.settings.ajaxUrl,data:o}).then((function(t){m("ProductUpgradesSettingsModule","Delete response:",t);var a=n.closest("tr");a.fadeOut(300,(function(){a.remove(),i(".product-upgrades-list").find("tbody tr").length||(i(".product-upgrades-list").find("table").remove(),i(".product-upgrades-list").append('<div class="no-items">No upgrade configurations have been created yet.</div>'))})),e.showMessage("success",t.message)})).catch((function(t){e.showMessage("error",t.message||"Error deleting upgrade configuration. Please try again."),n.prop("disabled",!1).text("Delete"),m("ProductUpgradesSettingsModule","Error deleting upgrade configuration:",t)}))}}},{key:"createUpgradeRow",value:function(t){var e=jQuery;if(!t||!t.id)return m("ProductUpgradesSettingsModule","Invalid upgrade data",t),e('<tr><td colspan="4">Error: Invalid upgrade data</td></tr>');var i=e("<tr></tr>").attr("data-id",t.id),n=t.base_category_names||"";i.append(e("<td></td>").text(n));var a=t.upgrade_category_names||"";i.append(e("<td></td>").text(a));var r={dropdown:"Dropdown",radio:"Radio Buttons",tiles:"Image Tiles"}[t.display_mode]||"Dropdown";i.append(e("<td></td>").text(r));var s=e("<td></td>").addClass("actions"),d=o.createElement("button",{className:"button button-small edit-upgrade",type:"button",dataset:{id:t.id,base:Array.isArray(t.base_categories)?t.base_categories.join(","):"",upgrade:Array.isArray(t.upgrade_categories)?t.upgrade_categories.join(","):"",mode:t.display_mode||"dropdown",title:t.title||"",description:t.description||""}},"Edit"),l=o.createElement("button",{className:"button button-small delete-upgrade",type:"button",dataset:{id:t.id}},"Delete");return s.append(e(d)," ",e(l)),i.append(s),i}},{key:"appendUpgradeRow",value:function(t){var e=jQuery;if(t&&t.id){var i=e(".product-upgrades-table");if(i.length){var n=i.find("tbody");if(n.length){var a=this.createUpgradeRow(t);n.append(a)}else m("ProductUpgradesSettingsModule","Cannot append row: Table body not found")}else m("ProductUpgradesSettingsModule","Cannot append row: Table not found")}else m("ProductUpgradesSettingsModule","Cannot append row: Invalid upgrade data",t)}},{key:"showMessage",value:function(t,e){var i=jQuery,n=i(".product-estimator-upgrades");if(n.length){var a=n.find(".notice");if(a.length&&a.remove(),"undefined"==typeof ProductEstimatorSettings||"function"!=typeof ProductEstimatorSettings.showNotice)if("function"!=typeof u.showNotice){var r=o.createElement("div",{className:"notice notice-".concat("success"===t?"success":"error")}),s=o.createElement("p",{},e);r.appendChild(s),n.prepend(i(r)),setTimeout((function(){i(r).fadeOut(500,(function(){i(this).remove()}))}),5e3)}else u.showNotice(e,t);else ProductEstimatorSettings.showNotice(e,t)}else m("ProductUpgradesSettingsModule","Cannot show notice: Container not found")}}])}();jQuery(document).ready((function(){var t=jQuery("#product_upgrades");if(t.length&&t.is(":visible")){var e=new P;window.ProductUpgradesSettingsModule=e}else jQuery(document).on("product_estimator_tab_changed",(function(t,e){"product_upgrades"===e&&setTimeout((function(){var t=new P;window.ProductUpgradesSettingsModule=t}),100)}))})),console.log("Product Estimator initialized"),console.log("Product Estimator Admin initialized")}},i={};function n(t){var a=i[t];if(void 0!==a)return a.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.m=e,t=[],n.O=(e,i,a,r)=>{if(!i){var o=1/0;for(c=0;c<t.length;c++){for(var[i,a,r]=t[c],s=!0,d=0;d<i.length;d++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](i[d])))?i.splice(d--,1):(s=!1,r<o&&(o=r));if(s){t.splice(c--,1);var l=a();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[i,a,r]},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={439:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var a,r,[o,s,d]=i,l=0;if(o.some((e=>0!==t[e]))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(d)var c=d(n)}for(e&&e(i);l<o.length;l++)r=o[l],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(c)},i=self.webpackChunkproduct_estimator=self.webpackChunkproduct_estimator||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a=n.O(void 0,[76],(()=>n(90)));a=n.O(a)})();