(()=>{"use strict";var e,t={160:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m});var a=o(467),i=o(29),r=o(901),n=o(418),s=o(191),l=o(981);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,a.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var u=(0,n.h)("ConfirmationDialog");const m=function(){return(0,r.A)((function e(){(0,i.A)(this,e),this.dialogContainer=null,this.dialog=null,this.backdropElement=null,this.initialized=!1,this.callbacks={confirm:null,cancel:null},this.initialized=!0,u.log("ConfirmationDialog constructor completed")}),[{key:"confirm",value:function(e,t,o,a){this.show({title:e,message:t,confirmText:s.i.get("buttons.confirm","Confirm"),cancelText:s.i.get("buttons.cancel","Cancel"),action:"default",onConfirm:o,onCancel:a})}},{key:"init",value:function(){this.initialized||(this.initialized=!0,u.log("ConfirmationDialog initialized"))}},{key:"createDialogElements",value:function(){u.log("Creating dialog elements");var e=document.getElementById("confirmation-dialog-container");e&&e.remove(),this.dialogContainer=document.createElement("div"),this.dialogContainer.id="confirmation-dialog-container",l.A.insert("confirmation-dialog-template",{},this.dialogContainer),this.backdropElement=this.dialogContainer.querySelector(".pe-dialog-backdrop"),this.dialog=this.dialogContainer.querySelector(".pe-confirmation-dialog"),l.A.processLabels(this.dialogContainer),document.body.appendChild(this.dialogContainer),this.bindEvents(),u.log("Dialog elements created and appended to body")}},{key:"bindEvents",value:function(){var e=this;if(this.dialog){u.log("Binding events to dialog elements");var t=this.dialog.querySelector(".pe-dialog-close"),o=this.dialog.querySelector(".pe-dialog-cancel"),a=this.dialog.querySelector(".pe-dialog-confirm");t&&t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel()})),o&&o.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel()})),a&&a.addEventListener("click",(function(t){if(t.preventDefault(),t.stopPropagation(),"function"==typeof e.callbacks.confirm){var o=e.callbacks.confirm();if(!1===o)return void u.log("Confirmation callback returned false, keeping dialog open");if(o&&"function"==typeof o.then)return void o.then((function(t){!1!==t&&e.hide()})).catch((function(t){u.error("Error in confirmation callback:",t),e.hide()}))}e.hide()})),this.backdropElement&&this.backdropElement.addEventListener("click",(function(t){t.target===e.backdropElement&&(t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel())})),this.dialog&&this.dialog.addEventListener("click",(function(e){e.stopPropagation()})),this.escKeyHandler=function(t){"Escape"===t.key&&e.isVisible()&&(t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel())},document.addEventListener("keydown",this.escKeyHandler),u.log("Events bound to dialog elements")}else u.error("Cannot bind events: dialog element not found")}},{key:"show",value:function(){var e,t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.hide(),this.createDialogElements(),this.dialog&&this.backdropElement){var a=(null===(e=window.productEstimatorVars)||void 0===e?void 0:e.i18n)||{},i=c(c({},{title:s.i.get("ui_elements.confirm_title","Confirm Action"),message:s.i.get("messages.confirm_proceed","Are you sure you want to proceed?"),type:"",confirmText:s.i.get("buttons.confirm",a.confirm||"Confirm"),cancelText:s.i.get("buttons.cancel",a.cancel||"Cancel"),onConfirm:null,onCancel:null,action:"default",showCancel:!0}),o);null!==o.cancelText&&!1!==o.cancelText||(i.showCancel=!1),this.callbacks.confirm=i.onConfirm,this.callbacks.cancel=i.onCancel;var r=this.dialog.querySelector(".pe-dialog-title"),n=this.dialog.querySelector(".pe-dialog-message"),d=this.dialog.querySelector(".pe-dialog-confirm"),m=this.dialog.querySelector(".pe-dialog-cancel"),g=this.dialog.querySelector(".pe-dialog-buttons");r&&(r.textContent=i.title);var p=this.dialog.querySelector(".pe-dialog-body");if(p&&("form"===i.type||"collect-details"===i.action?p.classList.add("form-body"):p.classList.remove("form-body")),n)if(n.innerHTML="","form"===i.type&&i.formFields){var h=l.A.create("dialog-content-form-template",{instruction:i.message||s.i.get("ui_elements.form_instructions","Please fill out the following information:")}),v=h.querySelector(".pe-dialog-form-fields");v&&Array.isArray(i.formFields)&&i.formFields.forEach((function(e){var t=l.A.create("dialog-form-field-template",e);t.firstElementChild&&v.appendChild(t.firstElementChild)})),n.appendChild(h)}else if("contact-selection"===i.type){var f=l.A.create("dialog-contact-selection-template",{message:i.message||s.i.get("messages.contact_selection","How would you like to be contacted?"),emailButtonText:i.emailButtonText||s.i.get("buttons.contact_email","Email"),phoneButtonText:i.phoneButtonText||s.i.get("buttons.contact_phone","Phone")});n.appendChild(f);var y=n.querySelector(".pe-dialog-email-choice"),b=n.querySelector(".pe-dialog-phone-choice");y&&i.onEmailChoice&&y.addEventListener("click",(function(){i.onEmailChoice(),t.hide()})),b&&i.onPhoneChoice&&b.addEventListener("click",(function(){i.onPhoneChoice(),t.hide()}))}else n.textContent=i.message||"";d&&(d.textContent=i.confirmText);var _=this.dialog.querySelector(".pe-dialog-footer");if("contact-selection"===i.type?_&&(_.style.display="none"):(_&&(_.style.display=""),m&&(i.showCancel?(m.classList.remove("hidden"),m.textContent=i.cancelText,d&&d.classList.remove("full-width")):(m.classList.add("hidden"),d&&d.classList.add("full-width")))),i.additionalButtons&&g&&(g.querySelectorAll(".pe-dialog-additional").forEach((function(e){return e.remove()})),i.additionalButtons.forEach((function(e,o){var a=document.createElement("button");a.className="pe-button pe-button-secondary pe-dialog-additional",a.textContent=e.text||"Button ".concat(o+1),a.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),t.hide(),"function"==typeof e.callback&&e.callback()})),m&&i.showCancel,g.insertBefore(a,d)}))),document.body.style.overflow="hidden",this.backdropElement&&this.backdropElement.classList.add("visible"),this.dialog){this.dialog.classList.add("visible"),this.dialog.classList.remove("pe-dialog-action-default","pe-dialog-action-delete","pe-dialog-action-error","pe-dialog-action-warning","pe-dialog-action-success");var w=i.action||"default";"add"===w&&(w="success"),"remove"===w&&(w="delete"),this.dialog.classList.add("pe-dialog-action-".concat(w))}setTimeout((function(){var e=i.showCancel&&m?m:d;e&&e.focus()}),100)}else{u.error("Failed to create dialog elements");var E=o.message||s.i.get("messages.confirm_proceed","Are you sure you want to proceed?");confirm(E)?"function"==typeof o.onConfirm&&o.onConfirm():"function"==typeof o.onCancel&&o.onCancel()}}},{key:"hide",value:function(){document.body.style.overflow="",this.dialogContainer&&(this.backdropElement&&this.backdropElement.classList.remove("visible"),this.dialog&&this.dialog.classList.remove("visible"),this.dialogContainer&&(this.dialogContainer.remove(),this.dialogContainer=null,this.backdropElement=null,this.dialog=null))}},{key:"isVisible",value:function(){return this.dialog&&this.backdropElement&&this.backdropElement.classList.contains("visible")}}])}()},201:e=>{e.exports="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},219:(e,t,o)=>{o.r(t),o.d(t,{currency:()=>s,debounce:()=>c,formatDate:()=>g,formatPrice:()=>l,formatPriceRange:()=>d,objectToQueryString:()=>h,sanitizeHTML:()=>m,throttle:()=>u,truncateText:()=>p});var a=o(296),i=o(467);function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function n(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){(0,i.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"USD";(null==e||isNaN(e))&&(e=0);var a="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat(t,{style:"currency",currency:o}).format(a)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(null==e)return"".concat(t,"0.00");var a="string"==typeof e?parseFloat(e):e;return isNaN(a)?"".concat(t,"0.00"):t+a.toFixed(o)}function d(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"$",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=null==e?0:"string"==typeof e?parseFloat(e.replace(/[^0-9.-]+/g,"")):e,r=null==t?0:"string"==typeof t?parseFloat(t.replace(/[^0-9.-]+/g,"")):t;return isNaN(i)&&isNaN(r)?"".concat(l(0,o,a)):isNaN(i)?l(r,o,a):isNaN(r)||i===r?l(i,o,a):"".concat(l(i,o,a)," - ").concat(l(r,o,a))}function c(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];var n=this;clearTimeout(t),t=setTimeout((function(){return e.apply(n,i)}),o)}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,o=0;return function(){var a=Date.now();if(a-o>=t){o=a;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e.apply(this,r)}}}function m(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n(n({},{year:"numeric",month:"short",day:"numeric"}),t),a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?"Invalid date":new Intl.DateTimeFormat(navigator.language,o).format(a)}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e?e.length<=t?e:e.substring(0,t-o.length)+o:""}function h(e){return Object.entries(e).filter((function(e){var t=(0,a.A)(e,2);return null!=(t[0],t[1])})).map((function(e){var t=(0,a.A)(e,2),o=t[0],i=t[1];return Array.isArray(i)?i.map((function(e){return"".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(e))})).join("&"):"".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(i))})).join("&")}},418:(e,t,o)=>{o.d(t,{El:()=>u,GP:()=>r,Zj:()=>m,_F:()=>g,h:()=>c,ig:()=>d.i,jb:()=>h,qW:()=>p});var a=o(470),i=o(690),r=o(219),n=o(723),s=o(16),l=o(504),d=o(191);s.Rm,s.R8,s.z3;var c=s.h,u=s.El,m=(a.ajaxRequest,a.debounce,i.n,i.SL,i.kp,i.LF,i.ai,i.eV,i.WH,i.Nz,i.L$,r.formatPrice,r.sanitizeHTML,n.validateEmail,n.validateNumber,n.validateRequired,n.showFieldError,n.clearFieldError,n.showNotice,l.Ay.showSuccessDialog),g=l.Ay.showErrorDialog,p=l.Ay.showWarningDialog,h=l.Ay.showDeleteConfirmDialog;l.Ay.showConfirmDialog},470:(e,t,o)=>{o.d(t,{ajaxRequest:()=>c,debounce:()=>u,formatFormData:()=>g,wpAjax:()=>m});var a=o(284),i=o(296),r=o(467);function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=Array(t);o<t;o++)a[o]=e[o];return a}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){(0,r.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var d=o(16).h("UtilsAjax");function c(e){var t,o=jQuery,a=l(l({},{url:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.ajax_url)||("undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"),type:"POST",dataType:"json"}),e);return new Promise((function(e,t){o.ajax(l(l({},a),{},{success:function(o){if(o.success)e(o.data);else{var a,i=new Error((null===(a=o.data)||void 0===a?void 0:a.message)||"Unknown error");i.data=o.data,t(i)}},error:function(e,o,a){d.error("AJAX error:",o,a),t(new Error(a))}}))}))}function u(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];clearTimeout(t),t=setTimeout((function(){clearTimeout(t),e.apply(void 0,i)}),o)}}function m(e){var t,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)||(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.nonce)||"",s=new FormData;return s.append("action",e),s.append("nonce",n),Object.entries(r).forEach((function(e){var t=(0,i.A)(e,2),o=t[0],r=t[1];null!=r&&("object"===(0,a.A)(r)?s.append(o,JSON.stringify(r)):s.append(o,r))})),fetch((null===(o=window.productEstimatorVars)||void 0===o?void 0:o.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",credentials:"same-origin",body:s}).then((function(e){if(!e.ok)throw new Error("Network response was not ok: ".concat(e.status));return e.json()})).then((function(e){if(e.success)return e.data;var t,o=new Error((null===(t=e.data)||void 0===t?void 0:t.message)||"Unknown error");throw o.data=e.data,o}))}function g(e){if("string"==typeof e)return e;if(e instanceof FormData){var t,o=new URLSearchParams,a=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==o.return||o.return()}finally{if(l)throw r}}}}(e.entries());try{for(a.s();!(t=a.n()).done;){var r=(0,i.A)(t.value,2),s=r[0],l=r[1];o.append(s,l)}}catch(e){a.e(e)}finally{a.f()}return o.toString()}return new URLSearchParams(e).toString()}},723:(e,t,o)=>{function a(e){return!!e&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.min,a=t.max,i=t.integer,r=void 0!==i&&i,n="string"==typeof e?parseFloat(e):e;return!(isNaN(n)||r&&!Number.isInteger(n)||void 0!==o&&n<o||void 0!==a&&n>a)}function r(e){return null!=e&&("string"==typeof e?""!==e.trim():!Array.isArray(e)||e.length>0)}function n(e,t){var o=jQuery;if(e){var a=e instanceof jQuery?e:o(e);s(a);var i=o('<span class="field-error">'.concat(t,"</span>"));a.after(i),a.addClass("error")}}function s(e){var t=jQuery;if(e){var o=e instanceof jQuery?e:t(e);o.next(".field-error").remove(),o.removeClass("error")}}function l(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,o=jQuery;if(o){for(var a=o('<div class="notice notice-'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",' is-dismissible"><p>').concat(e,"</p></div>")),i=[o(".wrap h1"),o(".product-estimator-form-container"),o("#wpbody-content")],r=null,n=0;n<i.length;n++)if(i[n].length){r=i[n];break}if(r?r.after(a):o("body").prepend(a),window.wp&&window.wp.notices)window.wp.notices.init();else{var s=o('<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>');a.append(s),s.on("click",(function(){a.fadeOut(100,(function(){a.remove()}))}))}setTimeout((function(){a.fadeOut(500,(function(){return a.remove()}))}),t)}else alert(e)}o.d(t,{clearFieldError:()=>s,showFieldError:()=>n,showNotice:()=>l,validateEmail:()=>a,validateNumber:()=>i,validateRequired:()=>r})},911:(e,t,o)=>{var a=o(418),i=o(29),r=o(901),n=o(296),s=(0,a.h)("EventBus");const l=new(function(){return(0,r.A)((function e(){(0,i.A)(this,e),this.events={},this.debug=!1}),[{key:"setDebug",value:function(e){return this.debug=!!e,this}},{key:"on",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.events[e]||(this.events[e]=[]);var i={callback:t,context:a};return this.events[e].push(i),this.debug&&s.log('Subscribed to event "'.concat(e,'"'),{totalSubscribers:this.events[e].length}),function(){o.off(e,t,a)}}},{key:"off",value:function(e,t){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.events[e]?(this.events[e]=this.events[e].filter((function(e){return e.callback!==t||null!==a&&e.context!==a})),0===this.events[e].length&&delete this.events[e],this.debug&&s.log('Unsubscribed from event "'.concat(e,'"'),{remainingSubscribers:(null===(o=this.events[e])||void 0===o?void 0:o.length)||0}),this):this}},{key:"once",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=function(){o.off(e,i,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return t.apply(a||o,n)};return i.originalCallback=t,this.on(e,i,a)}},{key:"emit",value:function(e){for(var t=this,o=arguments.length,a=new Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];return this.events[e]?(this.debug&&s.log('Emitting event "'.concat(e,'" to ').concat(this.events[e].length," subscribers"),{args:a.length?a:"none"}),this.events[e].forEach((function(o){try{var i=o.callback,r=o.context;i.apply(r||t,a)}catch(t){s.error('Error in event handler for "'.concat(e,'":'),t)}})),this):(this.debug&&s.log('Event "'.concat(e,'" emitted but has no subscribers')),this)}},{key:"clear",value:function(e){return e?(delete this.events[e],this.debug&&s.log('Cleared all handlers for event "'.concat(e,'"'))):(this.events={},this.debug&&s.log("Cleared all event handlers")),this}},{key:"subscriberCount",value:function(e){var t;return(null===(t=this.events[e])||void 0===t?void 0:t.length)||0}},{key:"hasSubscribers",value:function(e){return this.subscriberCount(e)>0}},{key:"getStats",value:function(){var e={totalEvents:Object.keys(this.events).length,totalSubscribers:0,events:{}};return Object.entries(this.events).forEach((function(t){var o=(0,n.A)(t,2),a=o[0],i=o[1];e.events[a]=i.length,e.totalSubscribers+=i.length})),e}}])}());var d=o(458),c=o(284),u=o(467),m=o(470);function g(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?g(Object(o),!0).forEach((function(t){(0,u.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var h=(0,a.h)("AjaxService"),v=function(){return(0,r.A)((function e(){var t,o,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,i.A)(this,e),window._ajaxServiceInstance)return h.log("Using existing AjaxService instance"),window._ajaxServiceInstance;this.config=Object.assign({debug:!1,ajaxUrl:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.ajax_url)||"/wp-admin/admin-ajax.php",nonce:(null===(o=window.productEstimatorVars)||void 0===o?void 0:o.nonce)||"",i18n:(null===(a=window.productEstimatorVars)||void 0===a?void 0:a.i18n)||{}},r),this.cache={productData:{},similarProducts:{},suggestions:{},estimatesData:null,rooms:{}},window._ajaxServiceLogged||(h.log("AjaxService initialized"),window._ajaxServiceLogged=!0),window._ajaxServiceInstance=this}),[{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return h.log("Making request to '".concat(e,"'"),t),this.config.debug&&h.log("Request details:",{url:this.config.ajaxUrl,action:e,nonce:this.config.nonce,data:t}),(0,m.wpAjax)(e,t,this.config.nonce).catch((function(t){if(t&&t.data&&(t.data.primary_conflict||t.data.duplicate))throw h.log("Request '".concat(e,"' returned expected response:"),t.data.primary_conflict?"primary conflict":"duplicate"),t;h.error("Request '".concat(e,"' error:"),t);var a=new Error("AJAX request failed: ".concat(t.message));if(a.originalError=t,a.action=e,a.data=t.data,o)return h.warn("AJAX request to '".concat(e,"' failed but continuing with fallback data.")),{success:!0,data:{},isFallback:!0};throw a}))}},{key:"formatFormData",value:function(e){return(0,m.formatFormData)(e)}},{key:"getProductDataForStorage",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.product_id||"null"===e.product_id||"undefined"===e.product_id||"0"===e.product_id)return Promise.reject(new Error("Product ID is required"));var a=String(e.product_id);if(""===a.trim())return Promise.reject(new Error("Product ID cannot be empty"));var i=p(p({},e),{},{product_id:a}),r="data_".concat(a,"_").concat(i.room_width||0,"_").concat(i.room_length||0);return!o&&this.cache.productData[r]?(h.log("Returning cached product data for key ".concat(r)),Promise.resolve(this.cache.productData[r])):this._request("get_product_data_for_storage",i).then((function(e){return e&&e.product_data&&(t.cache.productData[r]=e),e})).catch((function(e){throw delete t.cache.productData[r],e}))}},{key:"getSimilarProducts",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="similar_".concat(e.product_id,"_area_").concat(e.room_area);return!o&&this.cache.similarProducts[a]?(h.log("Returning cached similar products for key ".concat(a)),Promise.resolve(this.cache.similarProducts[a])):this._request("get_similar_products",e).then((function(e){return e&&Array.isArray(e.products)&&(t.cache.similarProducts[a]=e),e})).catch((function(e){throw delete t.cache.similarProducts[a],e}))}},{key:"fetchSuggestionsForModifiedRoom",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="suggestions_".concat(e.estimate_id,"_").concat(e.room_id,"_").concat(e.room_product_ids_for_suggestions);return!o&&this.cache.suggestions[a]?(h.log("Returning cached suggestions for key ".concat(a)),Promise.resolve(this.cache.suggestions[a])):this._request("fetch_suggestions_for_modified_room",e).then((function(e){return e&&Array.isArray(e.updated_suggestions)&&(t.cache.suggestions[a]=e),e})).catch((function(e){throw delete t.cache.suggestions[a],e}))}},{key:"getVariationEstimator",value:function(e){return this._request("get_variation_estimator",e)}},{key:"invalidateCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Object.prototype.hasOwnProperty.call(this.cache,e)?(h.log("Invalidating ".concat(e," cache")),"object"===(0,c.A)(this.cache[e])?this.cache[e]={}:this.cache[e]=null):(h.log("Invalidating all caches"),this.cache={productData:{},similarProducts:{},suggestions:{},estimatesData:null,rooms:{}})}}])}();const f=v,y={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let b;const _=new Uint8Array(16),w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));const E=function(e,t,o){if(y.randomUUID&&!t&&!e)return y.randomUUID();const a=(e=e||{}).random??e.rng?.()??function(){if(!b){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");b=crypto.getRandomValues.bind(crypto)}return b(_)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((o=o||0)<0||o+16>t.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[o+e]=a[e];return t}return function(e,t=0){return(w[e[t+0]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]).toLowerCase()}(a)};var S="productEstimatorEstimateData",M=(0,a.h)("EstimateStorage");function k(e){var t=E();return e?"".concat(e,"_").concat(t):t}function P(){try{var e=localStorage.getItem(S);if(e){var t=JSON.parse(e);if(t.estimates&&Array.isArray(t.estimates)){M.log("loadEstimateData - Converting estimates array to object");var o={};t.estimates.forEach((function(e,t){var a=e.id||String(t);e.id||(e.id=a),o[a]=e})),t.estimates=o,L(t),M.log("loadEstimateData - Converted array to object structure")}return M.log("loadEstimateData - Data loaded:",t),t}var a=sessionStorage.getItem(S);return a?JSON.parse(a):{}}catch(e){return M.error("Error loading estimate data from localStorage:",e),{}}}function L(e){try{localStorage.setItem(S,JSON.stringify(e))}catch(e){M.error("sessionStorage not available:",e)}}function C(){try{localStorage.removeItem(S)}catch(e){M.warn("sessionStorage not available:",e)}}function I(e){var t=P();return t.estimates&&t.estimates[e]?t.estimates[e]:null}function A(e,t,o){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return M.log("[addSuggestionsToRoom] Suggestions feature is disabled. Returning null for room ".concat(o,".")),Promise.resolve(null);var a=P();if(!(a.estimates&&a.estimates[t]&&a.estimates[t].rooms&&a.estimates[t].rooms[o]))return null;var i=a.estimates[t].rooms[o];return Array.isArray(e)?(i.product_suggestions=e,L(a),i.product_suggestions):(M.error("Error: suggestedProducts must be an array."),null)}function D(e){if(e.products&&"object"===(0,c.A)(e.products)){var t=null;for(var o in e.products){var a=e.products[o];if(a&&!0===a.is_primary_category){t=o;break}}e.primary_category_product_id=t}else e.primary_category_product_id=null}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=Array(t);o<t;o++)a[o]=e[o];return a}function q(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?q(Object(o),!0).forEach((function(t){(0,u.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):q(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var R=(0,a.h)("DataService"),O=function(){return(0,r.A)((function e(){var t,o,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,i.A)(this,e),window._dataServiceInstance)return R.log("Using existing DataService instance"),window._dataServiceInstance;this.config=Object.assign({debug:!1,ajaxUrl:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.ajax_url)||"/wp-admin/admin-ajax.php",nonce:(null===(o=window.productEstimatorVars)||void 0===o?void 0:o.nonce)||"",i18n:(null===(a=window.productEstimatorVars)||void 0===a?void 0:a.i18n)||{}},r),this.ajaxService=new f({debug:this.config.debug,ajaxUrl:this.config.ajaxUrl,nonce:this.config.nonce}),this.cache={estimatesData:null,estimatesList:null,rooms:{},similarProducts:{}},window._dataServiceLogged||(R.log("DataService initialized"),window._dataServiceLogged=!0),window._dataServiceInstance=this}),[{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R.log("[DEPRECATED] Using generic request method for '".concat(e,"'. Consider using dedicated action methods."),t),this.ajaxService._request(e,t)}},{key:"getProductVariationData",value:function(e){return R.log("Getting variation data for product ID: ".concat(e)),this.ajaxService._request("product_estimator_get_product_variations",{product_id:e}).then((function(t){return R.log("Variation data received for product ".concat(e,":"),t),{isVariable:t.is_variable||!1,productName:t.product_name||"",variations:t.variations||[],attributes:t.attributes||{}}})).catch((function(e){throw R.error("Error getting product variation data:",e),e}))}},{key:"checkEstimatesExist",value:function(){var e=this;return new Promise((function(t){var o=e.loadEstimateData?e.loadEstimateData():P(),a=o&&o.estimates&&Object.keys(o.estimates).length>0;R.log("Checking localStorage for estimates: ".concat(a?"Found":"None found")),t(a)}))}},{key:"getEstimatesData",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.cache.estimatesData)return R.log("Returning cached estimates data from localStorage."),Promise.resolve(this.cache.estimatesData);R.log("Loading estimates data from localStorage.");var e=P(),t=e&&e.estimates?Object.values(e.estimates):[];return this.cache.estimatesData=t,Promise.resolve(t)}},{key:"getEstimate",value:function(e){R.log("Getting estimate ".concat(e," from localStorage."));var t=I(e);return t?R.log("Found estimate ".concat(e," in localStorage.")):R.warn("Estimate ".concat(e," not found in localStorage.")),Promise.resolve(t)}},{key:"getRoomsForEstimate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o="estimate_".concat(e);if(!t&&this.cache.rooms[o])return R.log("Returning cached rooms for estimate ".concat(e," from localStorage.")),Promise.resolve(this.cache.rooms[o]);R.log("Loading rooms for estimate ".concat(e," from localStorage."));var a=P(),i=a&&a.estimates?a.estimates[e]:null,r=[],n=!1;i&&i.rooms?(n=(r=(r=Object.values(i.rooms)).map((function(e){var t=parseFloat(e.width)||0,o=parseFloat(e.length)||0;return x(x({},e),{},{dimensions:"".concat(t," x ").concat(o)})}))).length>0,R.log("Found ".concat(r.length," rooms for estimate ").concat(e," in localStorage."))):R.log("Estimate ".concat(e," not found or has no rooms in localStorage."));var s={has_rooms:n,rooms:r};return this.cache.rooms[o]=s,Promise.resolve(s)}},{key:"getProductsForRoom",value:function(e,t){R.log("Getting products for room ".concat(t," in estimate ").concat(e," from localStorage."));var o=P();if(!(o.estimates&&o.estimates[e]&&o.estimates[e].rooms&&o.estimates[e].rooms[t]))return R.warn("Estimate ".concat(e," or room ").concat(t," not found in localStorage.")),Promise.resolve([]);var a=o.estimates[e].rooms[t],i=[];return a.products&&("object"!==(0,c.A)(a.products)||Array.isArray(a.products)?Array.isArray(a.products)&&(i=a.products):i=Object.values(a.products)),R.log("Found ".concat(i.length," products for room ").concat(t," in estimate ").concat(e,".")),Promise.resolve(i)}},{key:"addProductToRoom",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.log("DataService: Adding product to room (localStorage first)",{roomId:e,productId:t,estimateId:o});var i=P(),r=i.estimates?i.estimates[o]:null,s=r&&r.rooms?r.rooms[e]:null,l=null,u=null;if(s){if(l=s.width,u=s.length,s.products){var m=String(t);if("object"===(0,c.A)(s.products)&&s.products[m]||Array.isArray(s.products)&&s.products.find((function(e){return String(e.id)===m})))return R.warn("DataService: Product ID ".concat(t," already exists in room ").concat(e," locally. Aborting.")),Promise.reject({message:a.ig.get("messages.product_already_exists","This product already exists in the selected room."),data:{duplicate:!0,estimate_id:o,room_id:e}})}}else R.warn("DataService: Room ID ".concat(e," not found in local storage for estimate ").concat(o,". Room dimensions will be null for product data fetch."));var g=[];s&&s.products&&("object"!==(0,c.A)(s.products)||Array.isArray(s.products)?Array.isArray(s.products)&&(g=s.products.map((function(e){return e.id}))):g=Object.keys(s.products));var p=(0,d.A)(new Set([].concat((0,d.A)(g),[String(t)])));if(!t||"null"===t||"undefined"===t||"0"===t||""===String(t).trim())return Promise.reject(new Error("Valid product ID is required to add a product to a room"));var h=this.ajaxService.getProductDataForStorage({product_id:String(t),room_width:l,room_length:u,room_products:p}).then((function(a){if(R.log("DataService: Fetched comprehensive product data response:",a),a.product_data&&a.product_data.additional_products?(console.log("ADDITIONAL PRODUCTS CHECK: Found additional products:",a.product_data.additional_products),Object.entries(a.product_data.additional_products).forEach((function(e){var t=(0,n.A)(e,2),o=t[0],a=t[1];console.log("ADDITIONAL PRODUCTS CHECK: Product ".concat(o," - ").concat(a.name)),console.log("  - has_upgrades: ".concat(a.has_upgrades)),a.has_upgrades&&a.upgrades&&(console.log("  - upgrades data:",a.upgrades),a.upgrades.products&&console.log("  - number of upgrade products: ".concat(a.upgrades.products.length)))}))):console.log("ADDITIONAL PRODUCTS CHECK: No additional products found in response"),!a){var i="Failed to get comprehensive product data from server - null/undefined response.";return R.error(i),{success:!1,error:new Error(i),critical:!0}}if(!a.product_data){var r="Failed to get comprehensive product data from server - missing product_data property.";return R.error(r,a),{success:!1,error:new Error(r),critical:!0}}if(!0===a.isFallback){var s="Unable to get product data from server for product ID ".concat(t,". This is a required server request.");return R.error(s),{success:!1,error:new Error(s),critical:!0}}var l=a.product_data,d=[];if(!0===l.is_primary_category){var u=I(o),m=u&&u.rooms&&u.rooms[e],g=m&&m.products?m.products:{};for(var p in g){var h=g[p];if("note"!==h.type&&!0===h.is_primary_category)return R.log("DataService: Primary category conflict detected. Existing product:",h.name,"New product:",l.name),{success:!1,error:new Error("Primary category conflict - flooring product already exists in this room"),primaryConflict:!0,existingProductId:h.id,newProductId:t,roomId:e,estimateId:o,existingProductName:h.name,newProductName:l.name}}}if(l.similar_products||(l.similar_products={}),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var v=a.room_suggested_products||l.room_suggested_products||[];Array.isArray(v)&&(d=v),R.log("DataService: Suggestions enabled. Processed room suggestions to be stored:",d)}else R.log("DataService: Suggestions feature disabled. Not processing room suggestions from response.");Object.prototype.hasOwnProperty.call(l,"room_suggested_products")&&delete l.room_suggested_products,R.log("DataService: Comprehensive product data to be stored (similar_products processed):",l);try{if(function(e,t,o){var a,i,r=P();if(!(r.estimates&&r.estimates[e]&&r.estimates[e].rooms&&r.estimates[e].rooms[t]))return M.error("Estimate or Room not found. E: ".concat(e,", R: ").concat(t)),!1;var n=r.estimates[e].rooms[t];if(Array.isArray(n.products)){var s={};n.products.forEach((function(e){e&&e.id&&(s[e.id]=e)})),n.products=s}else n.products&&"object"===(0,c.A)(n.products)||(n.products={});Array.isArray(n.product_suggestions)||(n.product_suggestions=[]);var l=o;if("string"==typeof o)try{l=JSON.parse(o),M.log("Converted product data from string to object")}catch(e){return M.error("Failed to parse product data string:",e),!1}if(n.products[l.id])return M.warn(" Product with ID ".concat(l.id," already exists in room ").concat(t,". Aborting add to room.products.")),!1;n.products[l.id]=l,l.similar_products?console.log("EstimateStorage: Product has similar_products before save:",l.similar_products):console.log("EstimateStorage: Product has NO similar_products before save"),D(n),L(r);var d=null===(a=P().estimates)||void 0===a||null===(a=a[e])||void 0===a||null===(a=a.rooms)||void 0===a?void 0:a[t],u=null==d||null===(i=d.products)||void 0===i?void 0:i[l.id];return u&&u.similar_products?console.log("EstimateStorage: Product has similar_products AFTER save:",u.similar_products):console.log("EstimateStorage: Product has NO similar_products AFTER save"),M.log(" Product ".concat(l.id," added to room ").concat(t,". products:"),n.products),!0}(o,e,l)){var f,y;R.log("Product ID ".concat(t," (with its similar products) successfully added to room ").concat(e," in localStorage.")),window.productEstimatorVars.featureSwitches.suggested_products_enabled?(A(d,o,e),R.log("Room suggestions updated in localStorage for room ".concat(e,"."))):(A([],o,e),R.log("Suggestions cleared for room ".concat(e," as feature is disabled.")));var b=P();return{success:!0,estimateData:b,estimateId:o,roomId:e,productData:l,estimate_totals:(null===(f=b.estimates)||void 0===f||null===(f=f[o])||void 0===f?void 0:f.totals)||{min_total:0,max_total:0},room_totals:(null===(y=b.estimates)||void 0===y||null===(y=y[o])||void 0===y||null===(y=y.rooms)||void 0===y||null===(y=y[e])||void 0===y?void 0:y.totals)||{min_total:0,max_total:0}}}return R.warn("DataService: Failed to add product ID ".concat(t," to room ").concat(e," in localStorage via addProductToRoomStorage.")),{success:!1,error:new Error("Failed to add to local storage (product might exist or storage function failed).")}}catch(o){return R.error("DataService: Error adding comprehensive product ID ".concat(t," to room ").concat(e," in localStorage:"),o),{success:!1,error:o}}})).catch((function(e){return R.error("Error fetching comprehensive product data or processing local storage for addProductToRoom:",e),{success:!1,error:e}}));return h.then((function(e){if(e.success)R.log("DataService: Local storage update successful. No server sync required.");else{if(e.critical){var t,o=(null===(t=e.error)||void 0===t?void 0:t.message)||"Critical error: Unable to add product to room.";return void R.error("CRITICAL ERROR:",o)}R.warn("Local storage update failed, skipping asynchronous server request for adding product to session.")}})).catch((function(e){R.error("Error in background sync process:",e)})),h}},{key:"replaceProductInRoom",value:function(e,t,o,a,i){var r,n,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"main";R.log("DataService: Initiating product replacement (localStorage first)",{estimateId:e,roomId:t,oldProductId:o,newProductId:a,parentProductId:i,replaceType:s});var l=null===(r=P().estimates)||void 0===r?void 0:r[e],u=null==l||null===(n=l.rooms)||void 0===n?void 0:n[t],m=null==u?void 0:u.width,g=null==u?void 0:u.length,p=[],h=String(o),v=String(a);if(u&&u.products)if("object"!==(0,c.A)(u.products)||Array.isArray(u.products)){if(Array.isArray(u.products)){var f=(p=u.products.map((function(e){return String(e.id)}))).indexOf(h);f>-1?p.splice(f,1,v):p.push(v)}}else(p=Object.keys(u.products)).includes(h)&&(p=p.filter((function(e){return e!==h}))),p.push(v);else p.push(v);p=(0,d.A)(new Set(p));var y=this.ajaxService.getProductDataForStorage({product_id:String(a),room_width:m,room_length:g,room_products:p}).then((function(r){if(R.log("DataService: Fetched comprehensive product data for storage (for local replacement):",r),!r||!r.product_data)throw new Error("Failed to fetch complete product data for local replacement.");var n=r.product_data,l=[];if(n.similar_products||(n.similar_products={}),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var d=r.room_suggested_products||n.room_suggested_products||[];Array.isArray(d)&&(l=d),R.log("DataService: Suggestions enabled. Processed room suggestions to be stored for replacement:",l)}else R.log("DataService: Suggestions feature disabled. Not processing room suggestions from response for replacement.");if(Object.prototype.hasOwnProperty.call(n,"room_suggested_products")&&delete n.room_suggested_products,R.log("DataService: New product data for replacement (similar_products processed):",n),function(e,t,o,a,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"main",n=P();if(!(n.estimates&&n.estimates[e]&&n.estimates[e].rooms&&n.estimates[e].rooms[t]))return M.warn("Estimate or room not found in storedData."),!1;var s=n.estimates[e].rooms[t];if(!s.products||"object"!==(0,c.A)(s.products))return M.warn("Room products not found or not an object."),!1;var l=String(o),d=String(a);return"main"===r?s.products[l]?(delete s.products[l],s.products[d]=i,D(s),L(n),!0):(M.warn("Main product with ID ".concat(l," not found in room.")),!1):(M.warn("Invalid replaceType: ".concat(r)),!1)}(e,t,o,a,n,s,i)){var u,m;R.log("Product replacement (old ID ".concat(o," -> new ID ").concat(a,") successful in localStorage for room ").concat(t,".")),window.productEstimatorVars.featureSwitches.suggested_products_enabled?(A(l,e,t),R.log("Room suggestions updated in localStorage for room ".concat(t," after product replacement."))):(A([],e,t),R.log("Suggestions cleared for room ".concat(t," as feature is disabled (during product replacement).")));var g=P(),p=null===(u=g.estimates)||void 0===u?void 0:u[e],h=null==p||null===(m=p.rooms)||void 0===m?void 0:m[t];return{success:!0,estimateData:g,estimateId:e,roomId:t,oldProductId:o,newProductId:a,productData:n,estimate_totals:(null==p?void 0:p.totals)||{min_total:0,max_total:0},room_totals:(null==h?void 0:h.totals)||{min_total:0,max_total:0}}}throw new Error("Failed to replace product in local storage. Original product not found or storage function failed.")})).catch((function(e){throw R.error("Error during fetch or local storage replacement attempt:",e),e}));return y.then((function(e){e.success&&R.log("DataService: Local storage replacement successful. No server sync required.")})).catch((function(e){R.error("Error during local storage replacement:",e)})),y}},{key:"getSimilarProducts",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];R.log("Attempting to get similar products for product ID: ".concat(e,", area: ").concat(t,". Cache bypass: ").concat(o));var a={product_id:e,room_area:t};return this.ajaxService.getSimilarProducts(a,o).then((function(e){if(e&&Array.isArray(e.products))return e.section_info?e:e.products;if(e&&"object"===(0,c.A)(e.products)&&!Array.isArray(e.products)){R.log("Converting products object to array format");var t=Object.values(e.products);return e.section_info?x(x({},e),{},{products:t}):t}return e&&e.message&&e.source_product_id?(R.log(e.message),[]):(R.warn("get_similar_products did not return expected data structure",e),[])})).catch((function(e){throw R.error("Error fetching similar products:",e),e}))}},{key:"addNewEstimate",value:function(e){var t,o,a,i=(t={name:e instanceof FormData?e.get("estimate_name"):e.estimate_name||"Unnamed Estimate",rooms:{}},(a=P()).estimates||(a.estimates={}),t.id?o=t.id:(o=k("estimate"),t.id=o),a.estimates[o]=t,L(a),o);return R.log("Client-side estimate saved to localStorage with unique ID: ".concat(i)),Promise.resolve({estimate_id:i})}},{key:"addNewRoom",value:function(e,t){return R.log("DataService: Adding new room",{estimateId:t,formData:e instanceof FormData?Object.fromEntries(e):e}),new Promise((function(o,a){var i=P();if(!i.estimates||!i.estimates[t]){var r="Estimate with ID ".concat(t," not found in local storage. Cannot add room.");return R.error("DataService: ".concat(r)),void a(new Error(r))}var n=parseFloat(e instanceof FormData?e.get("room_width"):e.room_width)||0,s=parseFloat(e instanceof FormData?e.get("room_length"):e.room_length)||0,l={name:e instanceof FormData?e.get("room_name")||"Unnamed Room":e.room_name||"Unnamed Room",width:n,length:s,products:{},min_total:0,max_total:0},d=function(e,t){var o=P();if(!o.estimates||!o.estimates[e])return!1;var a,i=o.estimates[e];return i.rooms||(i.rooms={}),t.id?a=t.id:(a=k("room"),t.id=a),Object.prototype.hasOwnProperty.call(t,"primary_category_product_id")||(t.primary_category_product_id=null),i.rooms[a]=t,L(o),a}(t,l);R.log("Room ID ".concat(d," (empty) added to localStorage for estimate ").concat(t)),R.log("Room ".concat(d," created. Resolving with basic room data.")),o(x({room_id:d,estimate_id:t},l))}))}},{key:"removeProductFromRoom",value:function(e,t,o,a){var i=this;return R.log("[removeProductFromRoom] Initiating product removal process",{estimateId:e,roomId:t,productIndex:o,productId:a}),new Promise((function(o,r){var n,s,l=null===(n=P().estimates)||void 0===n?void 0:n[e],d=null==l||null===(s=l.rooms)||void 0===s?void 0:s[t];if(!d||!d.products){var u="Room or products not found in localStorage for product removal.";return R.log("[removeProductFromRoom] Error: ".concat(u)),void r(new Error(u))}var m=String(a),g=!1,p=[];"object"!==(0,c.A)(d.products)||Array.isArray(d.products)?Array.isArray(d.products)&&(g=!!d.products.find((function(e){return String(e.id)===m})),p=d.products.filter((function(e){return String(e.id)!==m})).map((function(e){return e.id}))):(g=!!d.products[m],p=Object.keys(d.products).filter((function(e){return e!==m}))),g||R.log("[removeProductFromRoom] Warning: Product with ID ".concat(a," not found in room ").concat(t," (localStorage) before attempting removal logic."));var h=function(n){var s,l,d=!1,u=null;try{(d=function(e,t,o,a){var i=P();if(!(i.estimates&&i.estimates[e]&&i.estimates[e].rooms&&i.estimates[e].rooms[t]))return M.warn("[removeProductFromRoom] Attempted to remove product: Path to products is invalid.",{estimateId:e,roomId:t,receivedProductId:a}),!1;var r=i.estimates[e].rooms[t];if(Array.isArray(r.products)){var n={};r.products.forEach((function(e){e&&e.id&&(n[e.id]=e)})),r.products=n}else r.products&&"object"===(0,c.A)(r.products)||(r.products={});var s=String(a);return r.products[s]?(delete r.products[s],D(r),L(i),M.log("[removeProductFromRoom] Product with ID '".concat(a,"' successfully removed from localStorage for room '").concat(t,"', estimate '").concat(e,"'.")),!0):(M.warn("[removeProductFromRoom] Product with ID '".concat(a,"' not found in room '").concat(t,"' for estimate '").concat(e,"'. Cannot remove.")),!1)}(e,t,0,a))?R.log("[removeProductFromRoom] Product ID ".concat(a," reported as removed from localStorage by EstimateStorage.")):(u=new Error("Failed to remove product ID ".concat(a," from localStorage (EstimateStorage.removeProductFromRoom returned false).")),R.log("[removeProductFromRoom] Warning: ".concat(u.message)))}catch(e){u=new Error("Error during localStorage product removal for ID ".concat(a,": ").concat(e.message)),R.log("[removeProductFromRoom] Error: ".concat(u.message),e)}if(!u||d){var m=null===(s=P().estimates)||void 0===s?void 0:s[e],g=null==m||null===(l=m.rooms)||void 0===l?void 0:l[t],p=d?"Product removed locally. ":"Product local removal status uncertain (check logs). ";switch(n){case"updated":p+="Suggestions updated.";break;case"update_failed":p+="Suggestion update failed (see logs).";break;case"cleared_due_to_disabled":p+="Suggestions cleared (feature disabled).";break;default:p+="Suggestions not managed (feature disabled)."}o({success:!0,message:p,estimateId:e,roomId:t,productId:a,estimate_totals:(null==m?void 0:m.totals)||{min_total:0,max_total:0},room_totals:(null==g?void 0:g.totals)||{min_total:0,max_total:0}}),R.log("[removeProductFromRoom] Product removed from localStorage. No server sync required."),i.invalidateCache()}else r(u)};window.productEstimatorVars.featureSwitches.suggested_products_enabled?(R.log("[removeProductFromRoom] Suggestions enabled. Fetching updated suggestions for room based on post-deletion state."),i.ajaxService.fetchSuggestionsForModifiedRoom({estimate_id:e,room_id:t,room_product_ids_for_suggestions:JSON.stringify(p)}).then((function(o){R.log("[removeProductFromRoom] Successfully fetched updated suggestions:",o),o&&Array.isArray(o.updated_suggestions)?(A(o.updated_suggestions,e,t),R.log("[removeProductFromRoom] Suggestions updated in localStorage."),h("updated")):(R.log("[removeProductFromRoom] No updated_suggestions array received or invalid format. Clearing local suggestions."),A([],e,t),h("update_failed"))})).catch((function(o){R.error("[removeProductFromRoom] Error fetching suggestions:",o,". Proceeding with product removal without suggestion update."),A([],e,t),R.log("[removeProductFromRoom] Cleared local suggestions due to fetch error."),h("update_failed")}))):(R.log("[removeProductFromRoom] Suggestions disabled. Skipping suggestion fetch/update."),A([],e,t),R.log("[removeProductFromRoom] Cleared local suggestions as feature is disabled."),h("cleared_due_to_disabled"))}))}},{key:"removeRoom",value:function(e,t){R.log("DataService: Removing room",{estimateId:e,roomId:t});try{!function(e,t){var o=P();return!!(o.estimates&&o.estimates[e]&&o.estimates[e].rooms&&o.estimates[e].rooms[t])&&(delete o.estimates[e].rooms[t],L(o),!0)}(e,t)?R.warn("Room ID ".concat(t," not found in localStorage for estimate ").concat(e," during removal attempt.")):R.log("Room ID ".concat(t," successfully removed from localStorage for estimate ").concat(e))}catch(e){R.error("Error removing room ID ".concat(t," from localStorage:"),e)}return Promise.resolve({success:!0})}},{key:"removeEstimate",value:function(e){R.log("DataService: Removing estimate ".concat(e));try{!function(e){var t=P();return!(!t.estimates||!t.estimates[e]||(delete t.estimates[e],L(t),0))}(e)?R.warn("Estimate ID ".concat(e," not found in localStorage during removal attempt.")):R.log("Estimate ID ".concat(e," successfully removed from localStorage."))}catch(t){R.error("Error removing estimate ID ".concat(e," from localStorage:"),t)}return Promise.resolve({success:!0})}},{key:"getSuggestedProducts",value:function(e,t){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return R.log("[getSuggestedProducts] Suggestions feature is disabled. Returning null for room ".concat(t,".")),Promise.resolve(null);R.log("Getting suggested products for room ".concat(t," in estimate ").concat(e," from localStorage."));var o=function(e,t){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return M.log("[getSuggestionsForRoom] Suggestions feature is disabled. Returning null for room ".concat(t,".")),Promise.resolve(null);var o=P();return o.estimates&&o.estimates[e]&&o.estimates[e].rooms&&o.estimates[e].rooms[t]&&o.estimates[e].rooms[t].product_suggestions||null}(e,t);return o?(R.log("Found suggestions for room ".concat(t,":"),o),Promise.resolve(o)):(R.log("No suggestions found for room ".concat(t," in localStorage.")),Promise.resolve(null))}},{key:"getVariationEstimator",value:function(e){return this.ajaxService.getVariationEstimator({variation_id:e})}},{key:"formatFormData",value:function(e){if("string"==typeof e)return e;if(e instanceof FormData){var t,o=new URLSearchParams,a=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return T(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){s=!0,r=e},f:function(){try{n||null==o.return||o.return()}finally{if(s)throw r}}}}(e.entries());try{for(a.s();!(t=a.n()).done;){var i=(0,n.A)(t.value,2),r=i[0],s=i[1];o.append(r,s)}}catch(e){a.e(e)}finally{a.f()}return o.toString()}return new URLSearchParams(e).toString()}},{key:"invalidateCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;R.log("Invalidating caches"),e?Object.prototype.hasOwnProperty.call(this.cache,e)&&("object"===(0,c.A)(this.cache[e])?this.cache[e]={}:this.cache[e]=null):(this.cache.estimatesData=null,this.cache.estimatesList=null,this.cache.rooms={}),this.ajaxService.invalidateCache(e)}},{key:"refreshEstimatesCache",value:function(){R.log("Refreshing estimates cache directly from localStorage");var e=P();return e&&e.estimates?(this.cache.estimatesData=Object.values(e.estimates),R.log("Refreshed cache with ".concat(this.cache.estimatesData.length," estimates"))):(this.cache.estimatesData=[],R.log("No estimates found in localStorage during refresh")),e}},{key:"updateProductAdditionVariation",value:function(e,t,o,a){var i=this;return R.log("DataService: Updating product addition variation",{estimateId:e,roomId:t,parentProductId:o,variationId:a}),new Promise((function(r,n){try{var s=P(),l=s.estimates[e];if(!l||!l.rooms[t])return R.error("Estimate or room not found",{estimateId:e,roomId:t}),void n(new Error("Estimate or room not found"));var d=l.rooms[t],u=null,m=null;if(d.products&&"object"===(0,c.A)(d.products)&&Object.values(d.products).forEach((function(e){e.additional_products&&e.additional_products[o]&&(u=e,m=e.additional_products[o])})),!u||!m)return R.error("Parent product or additional product not found",{parentProductId:o}),void n(new Error("Parent product or additional product not found"));m.selected_option=parseInt(a),m.variations&&Object.values(m.variations).forEach((function(e){e.selected=e.id===parseInt(a)})),L(s),i.refreshEstimatesCache(),r()}catch(e){R.error("Error updating product addition variation",e),n(e)}}))}}])}();const F=O;var N="productEstimatorCustomerData",j=(0,a.h)("CustomerStorage");function H(){try{var e=localStorage.getItem(N);if(e)return JSON.parse(e);var t=sessionStorage.getItem(N);return t?JSON.parse(t):{}}catch(e){return j.error("Error loading customer details:",e),{}}}function B(e){try{localStorage.setItem(N,JSON.stringify(e))}catch(t){j.warn("localStorage not available, using sessionStorage:",t);try{sessionStorage.setItem(N,JSON.stringify(e))}catch(e){j.error("sessionStorage not available:",e)}}}function z(){try{localStorage.removeItem(N)}catch(e){j.warn("localStorage not available:",e)}try{sessionStorage.removeItem(N)}catch(e){j.warn("sessionStorage not available:",e)}}var V=o(981),U=o(160),G=o(191);const W=function(){return(0,r.A)((function e(t,o){(0,i.A)(this,e),this.modalManager=t,this.templateEngine=o,this.dialogElement=null,this.backdropElement=null,this.currentProduct=null,this.selectedVariations={},this.availableVariations=null,this.selectedVariationId=null,this.onSelectCallback=null,this.onCancelCallback=null,this.labels={selectOptionsTitle:G.i.get("ui_elements.select_product_options","Select Product Options"),addToEstimate:G.i.get("buttons.add_to_estimate","Add to Estimate"),replaceProduct:G.i.get("buttons.replace_product","Replace Product"),confirmAddMessage:G.i.get("messages.confirm_proceed","Add this product to your estimate?"),loadingTitle:G.i.get("ui_elements.loading","Loading..."),loadingMessage:G.i.get("messages.loading_variations","Loading product variations...")}}),[{key:"show",value:function(e){if(this.currentProduct=e.product,this.availableVariations=e.variations||[],this.attributes=e.attributes||{},this.action=e.action||"add",this.onSelectCallback=e.onSelect,this.onCancelCallback=e.onCancel,this.selectedVariations={},this.selectedVariationId=null,this.create(),!this.dialogElement||!this.backdropElement)throw new Error("Failed to create product selection dialog");var t=this.dialogElement.querySelector(".pe-dialog-confirm");t&&(t.disabled=!0),this.dialogElement&&this.dialogElement.classList.contains("loading")&&this.hideLoading(),this.populateDialog(),this.showDialog()}},{key:"create",value:function(){if(!this.dialogElement){if(!this.templateEngine.getTemplate("product-selection-template"))throw console.error("ProductSelectionDialog: Product selection template not found"),new Error("Product selection template not found");var e=this.templateEngine.create("product-selection-template",{}),t=document.createElement("div");if(t.appendChild(e),this.backdropElement=t.querySelector(".pe-dialog-backdrop"),this.dialogElement=t.querySelector(".pe-product-selection-dialog"),!this.backdropElement||!this.dialogElement)throw console.error("ProductSelectionDialog: Failed to create dialog elements"),new Error("Failed to create dialog elements");this.processLabels(),document.body.appendChild(this.backdropElement),this.bindEvents()}}},{key:"processLabels",value:function(){this.dialogElement&&(G.i.updateDOM(this.dialogElement),this.backdropElement&&G.i.updateDOM(this.backdropElement))}},{key:"bindEvents",value:function(){var e=this;if(this.dialogElement){var t=this.dialogElement.querySelector(".pe-dialog-close");t&&t.addEventListener("click",(function(){return e.cancel()}));var o=this.dialogElement.querySelector(".pe-dialog-cancel");o&&o.addEventListener("click",(function(){return e.cancel()}));var a=this.dialogElement.querySelector(".pe-dialog-confirm");a&&a.addEventListener("click",(function(){return e.confirm()})),this.backdropElement.addEventListener("click",(function(t){t.target===e.backdropElement&&e.cancel()}))}}},{key:"populateDialog",value:function(){var e=this;if(this.dialogElement&&this.currentProduct){var t=this.dialogElement.querySelector(".pe-dialog-product-name");t&&(t.textContent=this.currentProduct.name||this.labels.selectOptionsTitle);var o=this.dialogElement.querySelector(".pe-dialog-confirm");o&&(o.textContent="replace"===this.action?this.labels.replaceProduct:this.labels.addToEstimate,o.disabled=!0);var a=this.dialogElement.querySelector(".pe-variation-options");if(a){if(a.innerHTML="",!this.availableVariations||0===this.availableVariations.length){var i=this.dialogElement.querySelector(".pe-dialog-message");return i&&(i.textContent=this.labels.confirmAddMessage),void this.updateConfirmButton(!0)}Object.entries(this.attributes).forEach((function(t){var o=(0,n.A)(t,2),i=o[0],r=o[1],s=e.templateEngine.create("variation-option-template",{attributeName:i,attributeLabel:r.label||i}),l=document.createElement("div");l.appendChild(s);var d=l.firstElementChild;if(d){var c=d.querySelector(".pe-variation-swatches");c&&r.options&&r.options.forEach((function(t){var o=e.createSwatch(i,t,r.type);o&&c.appendChild(o)})),a.appendChild(d)}}))}}}},{key:"createSwatch",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"label",i=this.templateEngine.create("variation-swatch-template",{attributeName:e,value:t.value,type:a,label:t.label||t.value,selected:""}),r=document.createElement("div");r.appendChild(i);var n=r.firstElementChild;if(!n)return null;var s=n.querySelector(".pe-swatch-content");if(s)switch(a){case"color":var l=document.createElement("span");l.className="pe-swatch-color",l.style.backgroundColor=t.color||t.value,s.appendChild(l);break;case"image":var d=document.createElement("img");d.className="pe-swatch-image",d.src=t.image||t.value,d.alt=t.label||t.value,s.appendChild(d);break;default:s.textContent=t.label||t.value}return t.disabled?n.disabled=!0:n.addEventListener("click",(function(){return o.selectVariation(e,t.value)})),n}},{key:"selectVariation",value:function(e,t){this.selectedVariations[e]=t,this.dialogElement.querySelectorAll('.pe-variation-swatch[data-attribute-name="'.concat(e,'"]')).forEach((function(e){e.dataset.value===t?e.classList.add("selected"):e.classList.remove("selected")})),this.findMatchingVariation(),this.updateConfirmButton(),this.updateSelectedSummary()}},{key:"findMatchingVariation",value:function(){var e=this;if(this.availableVariations&&0!==this.availableVariations.length){var t=this.availableVariations.find((function(t){return Object.entries(e.selectedVariations).every((function(e){var o=(0,n.A)(e,2),a=o[0],i=o[1],r="attribute_".concat(a);return t.attributes[a]===i||t.attributes[r]===i}))}));this.selectedVariationId=t?t.variation_id:null}}},{key:"updateConfirmButton",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=this.dialogElement.querySelector(".pe-dialog-confirm");if(o)if(null===t){var a=Object.keys(this.attributes).every((function(t){return void 0!==e.selectedVariations[t]}));o.disabled=!a||!this.selectedVariationId}else o.disabled=!t}},{key:"updateSelectedSummary",value:function(){}},{key:"showDialog",value:function(){this.backdropElement&&this.dialogElement&&(this.backdropElement.style.display="flex",this.backdropElement.classList.add("visible"),this.dialogElement.classList.add("visible"))}},{key:"hideDialog",value:function(){var e=this;this.backdropElement&&this.dialogElement&&(this.backdropElement.classList.remove("visible"),this.dialogElement.classList.remove("visible"),setTimeout((function(){e.backdropElement.style.display="none"}),300))}},{key:"confirm",value:function(){var e={productId:this.currentProduct.id,variationId:this.selectedVariationId,selectedAttributes:this.selectedVariations,product:this.currentProduct};this.hideDialog(),this.onSelectCallback&&this.onSelectCallback(e)}},{key:"cancel",value:function(){this.hideDialog(),this.onCancelCallback&&this.onCancelCallback()}},{key:"destroy",value:function(){this.backdropElement&&(this.backdropElement.remove(),this.backdropElement=null),this.dialogElement=null,this.currentProduct=null,this.selectedVariations={},this.selectedVariationId=null}},{key:"showLoading",value:function(){if(this.backdropElement&&this.dialogElement||this.create(),this.backdropElement&&(this.backdropElement.style.display="flex",this.backdropElement.classList.add("visible")),this.dialogElement){this.dialogElement.classList.add("visible","loading");var e=this.dialogElement.querySelector(".pe-dialog-title");e&&(e.textContent=this.labels.loadingTitle);var t=this.dialogElement.querySelector(".pe-dialog-body");t&&(t.innerHTML='<div class="pe-loading-message">'.concat(this.labels.loadingMessage,"</div>"));var o=this.dialogElement.querySelector(".pe-dialog-confirm"),a=this.dialogElement.querySelector(".pe-dialog-cancel");o&&(o.style.display="none"),a&&(a.style.display="none")}}},{key:"hideLoading",value:function(){if(this.dialogElement){this.dialogElement.classList.remove("loading");var e=this.dialogElement.querySelector(".pe-dialog-title");e&&(e.textContent=this.labels.selectOptionsTitle);var t=this.dialogElement.querySelector(".pe-dialog-body");if(t){var o=G.i.get("messages.select_options","Please select your options below:");t.innerHTML='\n                    <div class="pe-dialog-product-name"></div>\n                    <div class="pe-dialog-variations">\n                        <p class="pe-dialog-message">'.concat(o,'</p>\n                        <div class="pe-variation-options">\n                            \x3c!-- Variation options will be dynamically inserted here --\x3e\n                        </div>\n                    </div>\n                ')}var a=this.dialogElement.querySelector(".pe-dialog-confirm"),i=this.dialogElement.querySelector(".pe-dialog-cancel");a&&(a.style.display=""),i&&(i.style.display="")}}}])}();var K=function(){return(0,r.A)((function e(t){(0,i.A)(this,e),this.templateEngine=t,this.activeTooltips=new Map,this.activeRichTooltips=new Map,this.initStyles()}),[{key:"init",value:function(){try{document.addEventListener("mouseenter",this.handleMouseEnter.bind(this),!0),document.addEventListener("mouseleave",this.handleMouseLeave.bind(this),!0),document.addEventListener("focusin",this.handleFocusIn.bind(this),!0),document.addEventListener("focusout",this.handleFocusOut.bind(this),!0),document.addEventListener("click",this.handleClick.bind(this),!0),window.addEventListener("scroll",this.handleScroll.bind(this),!0)}catch(e){console.error("Error initializing tooltip system:",e)}}},{key:"initStyles",value:function(){if(!document.getElementById("pe-tooltip-styles")){var e=document.createElement("style");e.id="pe-tooltip-styles",e.textContent="\n        .pe-tooltip {\n          position: absolute;\n          z-index: 1000000;\n          opacity: 0;\n          visibility: hidden;\n          transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;\n          pointer-events: none;\n        }\n        \n        .pe-tooltip.visible {\n          opacity: 1;\n          visibility: visible;\n        }\n        \n        .pe-tooltip.pe-tooltip-rich {\n          pointer-events: all;\n        }\n        \n        .pe-tooltip-arrow {\n          position: absolute;\n          width: 0;\n          height: 0;\n          border-style: solid;\n        }\n      ",document.head.appendChild(e)}}},{key:"handleMouseEnter",value:function(e){var t=e.target;if(t&&"function"==typeof t.closest){var o=t.closest('[data-tooltip]:not([data-tooltip-type="rich"])');o&&this.showTooltip(o)}}},{key:"handleMouseLeave",value:function(e){var t=e.target;if(t&&"function"==typeof t.closest){var o=t.closest('[data-tooltip]:not([data-tooltip-type="rich"])');!o||e.relatedTarget&&"function"==typeof e.relatedTarget.closest&&e.relatedTarget.closest(".pe-tooltip")||this.hideTooltip(o)}}},{key:"handleFocusIn",value:function(e){var t=e.target;if(t&&"function"==typeof t.closest){var o=t.closest('[data-tooltip]:not([data-tooltip-type="rich"])');o&&this.showTooltip(o)}}},{key:"handleFocusOut",value:function(e){var t=e.target;if(t&&"function"==typeof t.closest){var o=t.closest('[data-tooltip]:not([data-tooltip-type="rich"])');!o||e.relatedTarget&&"function"==typeof e.relatedTarget.closest&&e.relatedTarget.closest(".pe-tooltip")||this.hideTooltip(o)}}},{key:"handleClick",value:function(e){var t=this,o=e.target;if(o&&"function"==typeof o.closest){var a=o.closest('[data-tooltip-type="rich"]');a&&(e.preventDefault(),this.toggleRichTooltip(a));var i=o.closest(".pe-tooltip-close");if(i){var r,s=i.closest(".pe-tooltip-rich"),l=null===(r=Array.from(this.activeRichTooltips.entries()).find((function(e){var t=(0,n.A)(e,2);return t[0],t[1]===s})))||void 0===r?void 0:r[0];l&&this.hideRichTooltip(l)}o.closest(".pe-tooltip-rich")||a||this.activeRichTooltips.forEach((function(e,o){t.hideRichTooltip(o)}))}}},{key:"handleScroll",value:function(e){var t=this;this.activeTooltips.forEach((function(e,o){t.hideTooltip(o)})),this.activeRichTooltips.forEach((function(e,o){t.hideRichTooltip(o)}))}},{key:"showTooltip",value:function(e){var t=e.getAttribute("data-tooltip"),o=e.getAttribute("data-tooltip-position")||"top";if(t){var a=this.activeTooltips.get(e);if(!a){if(!(a=this.createTooltip(t,o)))return void console.error("Failed to create tooltip");this.activeTooltips.set(e,a)}this.positionTooltip(a,e,o),document.body.contains(a)||document.body.appendChild(a),a.offsetHeight,a.classList.add("visible")}}},{key:"hideTooltip",value:function(e){var t=this,o=this.activeTooltips.get(e);o&&(o.classList.remove("visible"),setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o),t.activeTooltips.delete(e)}),200))}},{key:"toggleRichTooltip",value:function(e){this.activeRichTooltips.get(e)?this.hideRichTooltip(e):this.showRichTooltip(e)}},{key:"showRichTooltip",value:function(e){var t=e.getAttribute("data-tooltip-position")||"right",o=this.getRichTooltipData(e),a=this.activeRichTooltips.get(e);if(!a){if(!(a=this.createRichTooltip(o,t)))return void console.error("Failed to create rich tooltip");this.activeRichTooltips.set(e,a)}this.positionTooltip(a,e,t,!0),document.body.contains(a)||document.body.appendChild(a),a.offsetHeight,a.classList.add("visible")}},{key:"hideRichTooltip",value:function(e){var t=this,o=this.activeRichTooltips.get(e);o&&(o.classList.remove("visible"),setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o),t.activeRichTooltips.delete(e)}),200))}},{key:"createTooltip",value:function(e,t){try{var o=this.templateEngine.create("tooltip",{content:e}).querySelector(".pe-tooltip");if(!o)return console.error("Tooltip element not found in template"),null;o.className="pe-tooltip pe-tooltip-".concat(t);var a=o.querySelector(".pe-tooltip-content");return a&&(a.textContent=e),o}catch(e){return console.error("Error creating tooltip:",e),null}}},{key:"createRichTooltip",value:function(e,t){var o=this;try{var a=this.templateEngine.create("tooltip-rich",{}).querySelector(".pe-tooltip");if(!a)return console.error("Rich tooltip element not found in template"),null;var i=a.querySelector(".pe-tooltip-title"),r=a.querySelector(".pe-tooltip-notes-content"),n=a.querySelector(".pe-tooltip-details-content");return i&&(i.textContent=e.title||"Product Information"),r&&(e.notes&&"No additional notes available"!==e.notes?(r.innerHTML="",e.notes.split("\n\n").forEach((function(e){if(e.trim()){var t=o.templateEngine.create("note-item-template",{"note-text":e}),a=t.querySelector(".note-text");a&&(a.textContent=e);var i=t.querySelector(".note-item");i&&(i.style.margin="0",i.style.padding="8px 0",i.style.border="none"),r.appendChild(t)}}))):r.textContent="No notes available"),n&&(e.details&&"No additional details available"!==e.details?n.innerHTML=e.details.replace(/\n/g,"<br>"):n.textContent="No details available"),console.log("[Tooltip] Populated rich tooltip:",{title:null==i?void 0:i.textContent,notes:null==r?void 0:r.textContent,details:null==n?void 0:n.textContent}),a.className="pe-tooltip pe-tooltip-rich pe-tooltip-".concat(t),a}catch(e){return console.error("Error creating rich tooltip:",e),null}}},{key:"getRichTooltipData",value:function(e){var t={title:e.getAttribute("data-tooltip-title")||"Product Information",notes:"",details:""},o=e.closest(".include-item");if(o){var i,r=o.getAttribute("data-product-id"),n=null===(i=o.querySelector(".include-item-name"))||void 0===i?void 0:i.textContent;n&&(t.title=n.trim()),console.log("[Tooltip] Looking for product data:",{productId:r,productName:t.title,includeItem:o});var s=o.closest(".room-item");if(s){var l=s.getAttribute("data-room-id"),d=s.getAttribute("data-estimate-id");console.log("[Tooltip] Found room context:",{roomId:l,estimateId:d});var c=localStorage.getItem("productEstimatorEstimateData");if(c)try{var u,m,g=JSON.parse(c),p=null==g||null===(u=g.estimates)||void 0===u?void 0:u[d];if(null!=p&&null!==(m=p.rooms)&&void 0!==m&&m[l]){var h,v=p.rooms[l];if(console.log("[Tooltip] Room data:",v),console.log("[Tooltip] Looking for product with ID:",r),r&&null!==(h=v.products)&&void 0!==h&&h[r]){var f=v.products[r];if(console.log("[Tooltip] Found product:",f),f.additional_notes){var y=Object.values(f.additional_notes).filter((function(e){return"note"===e.type})).map((function(e){return e.note_text})).filter((function(e){return e&&e.trim()}));console.log("[Tooltip] Found notes:",y),y.length>0&&(t.notes=y.join("\n\n"))}if(f.additional_products){var b=Object.values(f.additional_products).map((function(e){if(e.is_variable&&e.selected_option&&e.variations&&e.variations[e.selected_option]){var t=e.variations[e.selected_option],o=t.min_price_total||t.min_price||0;return"".concat(t.name).concat(o>0?" - ".concat(a.GP.currency(o)):" (included)")}return"".concat(e.name).concat(e.min_price>0?" - ".concat(a.GP.currency(e.min_price)):" (included)")})).filter((function(e){return e&&e.trim()}));console.log("[Tooltip] Found additional products:",b),b.length>0&&(t.details="Additional Products:\n"+b.join("\n"))}}else console.log("[Tooltip] Product not found in room.products")}else console.log("[Tooltip] Room not found in estimate")}catch(e){console.error("[Tooltip] Error parsing localStorage data:",e)}else console.log("[Tooltip] No productEstimatorEstimateData in localStorage");t.notes||(t.notes="No additional notes available"),t.details||(t.details="No additional details available")}else console.log("[Tooltip] No room-item found")}else console.log("[Tooltip] No include-item found");var _=e.getAttribute("data-tooltip-notes"),w=e.getAttribute("data-tooltip-details");return _&&(t.notes=_),w&&(t.details=w),t}},{key:"positionTooltip",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t.getBoundingClientRect(),r=e.getBoundingClientRect(),n=a?12:8,s=0,l=0;switch(o){case"top":s=i.top-r.height-n,l=i.left+(i.width-r.width)/2;break;case"bottom":s=i.bottom+n,l=i.left+(i.width-r.width)/2;break;case"left":s=i.top+(i.height-r.height)/2,l=i.left-r.width-n;break;case"right":s=i.top+(i.height-r.height)/2,l=i.right+n}var d=window.innerWidth,c=window.innerHeight;l<0&&(l=n),l+r.width>d&&(l=d-r.width-n),s<0&&(s=n),s+r.height>c&&(s=c-r.height-n),e.style.top="".concat(s+window.scrollY,"px"),e.style.left="".concat(l+window.scrollX,"px"),this.positionArrow(e,t,o)}},{key:"positionArrow",value:function(e,t,o){var a=e.querySelector(".pe-tooltip-arrow");if(a){var i=t.getBoundingClientRect(),r=e.getBoundingClientRect();switch(a.style="",o){case"top":a.style.bottom="-".concat(8,"px"),a.style.left="".concat(i.left-r.left+i.width/2-8,"px"),a.style.borderColor="transparent transparent transparent transparent",a.style.borderTopColor="#333",a.style.borderWidth="".concat(8,"px ").concat(8,"px 0 ").concat(8,"px");break;case"bottom":a.style.top="-".concat(8,"px"),a.style.left="".concat(i.left-r.left+i.width/2-8,"px"),a.style.borderColor="transparent transparent transparent transparent",a.style.borderBottomColor="#333",a.style.borderWidth="0 ".concat(8,"px ").concat(8,"px ").concat(8,"px");break;case"left":a.style.right="-".concat(8,"px"),a.style.top="".concat(i.top-r.top+i.height/2-8,"px"),a.style.borderColor="transparent transparent transparent transparent",a.style.borderLeftColor="#333",a.style.borderWidth="".concat(8,"px 0 ").concat(8,"px ").concat(8,"px");break;case"right":a.style.left="-".concat(8,"px"),a.style.top="".concat(i.top-r.top+i.height/2-8,"px"),a.style.borderColor="transparent transparent transparent transparent",a.style.borderRightColor="#333",a.style.borderWidth="".concat(8,"px ").concat(8,"px ").concat(8,"px 0")}}}},{key:"addTooltip",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.position,i=void 0===a?"top":a,r=o.type,n=void 0===r?"simple":r,s=o.notes,l=void 0===s?null:s,d=o.details,c=void 0===d?null:d,u=o.title,m=void 0===u?null:u;"rich"===n?(e.setAttribute("data-tooltip-type","rich"),m&&e.setAttribute("data-tooltip-title",m),l&&e.setAttribute("data-tooltip-notes",l),c&&e.setAttribute("data-tooltip-details",c)):e.setAttribute("data-tooltip",t),e.setAttribute("data-tooltip-position",i)}},{key:"removeTooltip",value:function(e){e.removeAttribute("data-tooltip"),e.removeAttribute("data-tooltip-position"),e.removeAttribute("data-tooltip-type"),e.removeAttribute("data-tooltip-title"),e.removeAttribute("data-tooltip-notes"),e.removeAttribute("data-tooltip-details"),this.hideTooltip(e),this.hideRichTooltip(e)}},{key:"updateTooltip",value:function(e,t){if("string"==typeof t){e.setAttribute("data-tooltip",t);var o=this.activeTooltips.get(e);if(o){var a=o.querySelector(".pe-tooltip-content");a&&(a.textContent=t)}}else{t.title&&e.setAttribute("data-tooltip-title",t.title),t.notes&&e.setAttribute("data-tooltip-notes",t.notes),t.details&&e.setAttribute("data-tooltip-details",t.details);var i=this.activeRichTooltips.get(e);if(i){var r,n=this.createRichTooltip(t,(null===(r=i.className.match(/pe-tooltip-(\w+)/))||void 0===r?void 0:r[1])||"right");i.replaceWith(n),this.activeRichTooltips.set(e,n)}}}}])}();function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=Array(t);o<t;o++)a[o]=e[o];return a}function Y(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}var J=(0,a.h)("EstimateActions"),$=function(){return(0,r.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,e),this.config=Object.assign({debug:!1,selectors:{printButton:".print-estimate, .print-estimate-pdf",requestContactButton:".request-contact-estimate",requestCopyButton:".request-a-copy",scheduleDesignerButton:".schedule-designer-estimate"},i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.modalManager=o.modalManager||null,this.initialized=!1,this.processing=!1,!1!==o.autoInit&&this.init()}),[{key:"init",value:function(){return this.initialized?(console.log("[EstimateActions] Already initialized"),this):(this.bindEvents(),this.initialized=!0,console.log("[EstimateActions] PrintEstimate initialized with debug mode:",this.config.debug),console.log("[EstimateActions] Dialog availability at init:",window.productEstimator&&window.productEstimator.dialog),this)}},{key:"bindEvents",value:function(){var e=this;console.log("[EstimateActions] Binding events..."),document.addEventListener("click",(function(t){var o=t.target.closest(e.config.selectors.printButton);if(o&&!e.processing)if(console.log("[EstimateActions] Print button clicked"),t.preventDefault(),e.processing=!0,e.setButtonLoading(o,!0),o.classList.contains("print-estimate-pdf")){var a=o.dataset.estimateId;console.log("[EstimateActions] PDF link clicked, estimate ID:",a),e.checkCustomerDetails(a).then((function(t){var i=[];if(t.name&&""!==t.name.trim()||i.push("name"),t.email&&""!==t.email.trim()||i.push("email"),0===i.length){var r=o.getAttribute("href");r&&"#"!==r&&"javascript:void(0)"!==r?window.open(r,"_blank"):e.getSecurePdfUrl(a).then((function(e){window.open(e,"_blank")})).catch((function(){e.showError("Error generating PDF URL. Please try again.")}))}else e.showCustomerDetailsPrompt(a,o,"print")})).catch((function(){e.showError("Error checking customer details. Please try again.")})).finally((function(){}))}else e.handlePrintEstimate(o);var i=t.target.closest(e.config.selectors.requestCopyButton);if(i&&!e.processing){t.preventDefault(),e.processing=!0,e.setButtonLoading(i,!0);var r=i.dataset.estimateId;e.showContactSelectionPrompt(r,i,"request_copy")}var n=t.target.closest(e.config.selectors.requestContactButton);if(n&&!e.processing){t.preventDefault(),e.processing=!0,e.setButtonLoading(n,!0);var s=n.dataset.estimateId;e.showContactSelectionPrompt(s,n,"request_contact")}}))}},{key:"handlePrintEstimate",value:function(e){var t=this,o=e.dataset.estimateId;if(!o)return this.showError("No estimate ID provided"),this.setButtonLoading(e,!1),void(this.processing=!1);console.log("[EstimateActions] Print estimate requested for estimate ID: ".concat(o)),this.checkCustomerDetails(o).then((function(a){var i=[];return a.name&&""!==a.name.trim()||i.push("name"),a.email&&""!==a.email.trim()||i.push("email"),0===i.length?t.storeEstimate(o).then((function(e){if(e&&e.estimate_id)return t.getSecurePdfUrl(e.estimate_id);throw new Error("Failed to store estimate")})).then((function(o){t.setButtonLoading(e,!1),t.processing=!1,window.open(o,"_blank")})):(t.showCustomerDetailsPrompt(o,e,"print"),Promise.reject(new Error("missing_customer_details")))})).catch((function(o){"missing_customer_details"!==o.message&&(t.showError("Error generating PDF. Please try again."),t.setButtonLoading(e,!1),t.processing=!1)}))}},{key:"showCustomerDetailsPrompt",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"print";this.log("showCustomerDetailsPrompt called with:",{estimateId:e,action:a}),this.checkCustomerDetails(e).then((function(i){o.log("Customer info in showCustomerDetailsPrompt:",i);var r=o.getMissingFields(i,a);if(o.log("Missing fields:",r),0!==r.length){console.log("[EstimateActions] Looking for dialog...");var n=null;if(o.modalManager&&o.modalManager.confirmationDialog?(n=o.modalManager.confirmationDialog,console.log("[EstimateActions] Found dialog via modalManager reference")):window.productEstimator&&window.productEstimator.dialog&&(n=window.productEstimator.dialog,console.log("[EstimateActions] Found dialog at window.productEstimator.dialog")),!n)return console.error("[EstimateActions] Dialog not available"),console.log("[EstimateActions] Debug info:",{hasModalManager:!!o.modalManager,hasConfirmationDialog:o.modalManager&&!!o.modalManager.confirmationDialog,hasGlobalDialog:window.productEstimator&&!!window.productEstimator.dialog}),o.showError("Unable to show dialog. Please refresh the page and try again."),o.setButtonLoading(t,!1),void(o.processing=!1);console.log("[EstimateActions] Dialog found:",n);var s=o.createFormFieldsData(r,a,i),l=o.getDialogInstruction(a,r);n.show({title:o.getDialogTitle(a),message:l,formFields:s,confirmText:G.i.get("buttons.continue","Continue"),cancelText:G.i.get("buttons.cancel","Cancel"),type:"form",action:"collect-details",showCancel:!0,onConfirm:function(){console.log("[EstimateActions] Dialog onConfirm triggered");var n=o.validateAndCollectFormData(r,i);if(console.log("[EstimateActions] Validation result:",n),!n.isValid){var s=document.querySelector(".pe-dialog-validation-error");return s&&(s.textContent=n.errorMessage,s.style.display="block"),console.log("[EstimateActions] Validation failed, keeping dialog open"),!1}B(n.details),o.log("Customer details saved to localStorage:",n.details),o.updateCustomerDetails(e,n.details).then((function(){o.setButtonLoading(t,!0),o.processing=!0,o.continueWithAction(a,e,t,n.details)})).catch((function(){o.showError("Error saving details. Please try again.")}))},onCancel:function(){o.setButtonLoading(t,!1),o.processing=!1}}),setTimeout((function(){var e=document.querySelector(".pe-dialog-body input");e&&e.focus()}),100)}else o.continueWithAction(a,e,t,i)})).catch((function(e){o.log("Error in showCustomerDetailsPrompt:",e),o.setButtonLoading(t,!1),o.processing=!1}))}},{key:"createFormFieldsData",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map((function(e){return{fieldName:e,fieldLabel:o.getFieldLabel(e),fieldValue:a[e]||"",fieldType:"email"===e?"email":"phone"===e?"tel":"text"}}))}},{key:"getDialogInstruction",value:function(e,t){return"request_copy_email"===e?G.i.get("messages.email_required_for_copy","An email address is required to send your estimate copy."):"request_copy_sms"===e?G.i.get("messages.phone_required_for_sms","A phone number is required to send your estimate via SMS."):"request_contact_email"===e?G.i.get("messages.contact_email_details_required","Your details are required for our store to contact you via email."):"request_contact_phone"===e?G.i.get("messages.contact_phone_details_required","Your details are required for our store to contact you via phone."):t.includes("email")&&!t.includes("name")?G.i.get("messages.email_required_for_estimate","An email address is required to view your estimate."):G.i.get("messages.additional_information_required","Additional information is required to continue.")}},{key:"validateAndCollectFormData",value:function(e,t){var o,a=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(o),!0).forEach((function(t){(0,u.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Y(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},t),i=!0,r="",n=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return Q(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?Q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){s=!0,r=e},f:function(){try{n||null==o.return||o.return()}finally{if(s)throw r}}}}(e);try{for(n.s();!(o=n.n()).done;){var s=o.value,l=document.querySelector("#customer-".concat(s,"-input")),d=l?l.value.trim():"";if(!d){r="".concat(this.getFieldLabel(s)," ").concat(G.i.get("messages.required_field","is required")),i=!1;break}if("email"===s&&!this.validateEmail(d)){r=G.i.get("messages.invalid_email","Please enter a valid email address"),i=!1;break}if("phone"===s&&!this.validatePhone(d)){r=G.i.get("messages.invalid_phone","Please enter a valid phone number"),i=!1;break}a[s]=d}}catch(e){n.e(e)}finally{n.f()}return{isValid:i,errorMessage:r,details:a}}},{key:"getDialogTitle",value:function(e){return{print:G.i.get("ui_elements.complete_details_title","Complete Your Details"),request_copy_email:G.i.get("ui_elements.email_details_required_title","Email Details Required"),request_copy_sms:G.i.get("ui_elements.phone_details_required_title","Phone Number Required"),request_contact_email:G.i.get("ui_elements.contact_information_required_title","Contact Information Required"),request_contact_phone:G.i.get("ui_elements.contact_information_required_title","Contact Information Required")}[e]||G.i.get("ui_elements.complete_details_title","Complete Your Details")}},{key:"getMissingFields",value:function(e,t){var o={print:["name","email"],request_copy_email:["name","email"],request_copy_sms:["name","phone"],request_contact_email:["name","email"],request_contact_phone:["name","phone"]};return(o[t]||o.print).filter((function(t){return!e||!e[t]||""===e[t].trim()}))}},{key:"getFieldLabel",value:function(e){return{name:G.i.get("forms.full_name","Full Name"),email:G.i.get("forms.email_address","Email Address"),phone:G.i.get("forms.phone_number","Phone Number")}[e]||e.charAt(0).toUpperCase()+e.slice(1)}},{key:"createPromptModalHtml",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="Additional information is required to continue.";"request_copy_email"===t?i="An email address is required to send your estimate copy.":"request_copy_sms"===t?i="A phone number is required to send your estimate via SMS.":"request_contact_email"===t?i="Your details are required for our store to contact you via email.":"request_contact_phone"===t?i="Your details are required for our store to contact you via phone.":e.includes("email")&&!e.includes("name")&&(i="An email address is required to view your estimate.");var r='\n      <div class="email-prompt-overlay"></div>\n      <div class="email-prompt-container">\n        <div class="email-prompt-header">\n          <h3>'.concat("Please Complete Your Details",'</h3>\n        </div>\n        <div class="email-prompt-body">\n          <p>').concat(i,"</p>\n    ");return e.forEach((function(e){var t=o.getFieldLabel(e),i=a[e]||"",n="email"===e?"email":"phone"===e?"tel":"text";r+='\n        <div class="form-group">\n          <label for="customer-'.concat(e,'-input">').concat(t,':</label>\n          <input type="').concat(n,'" id="customer-').concat(e,'-input" value="').concat(i,'" required>\n        </div>\n      ')})),r+='\n          <div class="email-validation-message"></div>\n        </div>\n        <div class="email-prompt-footer">\n          <button type="button" class="button cancel-email-btn">Cancel</button>\n          <button type="button" class="button submit-email-btn">Continue</button>\n        </div>\n      </div>\n    '}},{key:"validateEmail",value:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},{key:"validatePhone",value:function(e){return/^[\d\s()+]{8,}$/.test(e)}},{key:"continueWithAction",value:function(e,t,o,a){var i=this;switch(e){case"print":this.handlePrintEstimate(o);break;case"request_copy_email":this.requestCopyEstimate(t,o).then((function(){i.showMessage("Estimate has been emailed to ".concat(a.email),"success",(function(){i.setButtonLoading(o,!1),i.processing=!1}))})).catch((function(){i.showError("Error sending estimate copy. Please try again."),i.setButtonLoading(o,!1),i.processing=!1}));break;case"request_copy_sms":this.showMessage("SMS option coming soon.","success"),this.setButtonLoading(o,!1),this.processing=!1;break;case"request_contact_email":this.requestStoreContact(t,"email",o,a);break;case"request_contact_phone":this.requestStoreContact(t,"phone",o,a)}}},{key:"showContactSelectionPrompt",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"request_copy",i=G.i.get("ui_elements.contact_method_estimate_title","How would you like to receive your estimate?"),r=G.i.get("messages.contact_method_estimate_prompt","Please choose how you'd prefer to receive your estimate:"),n=G.i.get("buttons.contact_email","Email"),s=G.i.get("buttons.contact_phone","SMS");"request_contact"===a&&(i=G.i.get("ui_elements.contact_method_title","How would you like to be contacted?"),r=G.i.get("messages.contact_method_prompt","Please choose how you'd prefer our store to contact you:"),n=G.i.get("buttons.contact_email","Email"),s=G.i.get("buttons.contact_phone","Phone"));var l=null;if(this.modalManager&&this.modalManager.confirmationDialog?l=this.modalManager.confirmationDialog:window.productEstimator&&window.productEstimator.dialog&&(l=window.productEstimator.dialog),!l)return this.showError("Dialog not available. Please refresh the page and try again."),this.setButtonLoading(t,!1),void(this.processing=!1);l.show({title:i,message:r,type:"contact-selection",emailButtonText:n,phoneButtonText:s,onEmailChoice:function(){var i="request_contact"===a?"request_contact_email":"request_copy_email";o.checkCustomerDetails(e).then((function(r){var n=[];r.name&&""!==r.name.trim()||n.push("name"),r.email&&""!==r.email.trim()||n.push("email"),0===n.length?"request_contact"===a?o.requestStoreContact(e,"email",t,r):o.requestCopyEstimate(e,t).then((function(){o.showMessage("Estimate has been emailed to ".concat(r.email),"success",(function(){o.setButtonLoading(t,!1),o.processing=!1}))})).catch((function(){o.showError("Error sending estimate copy. Please try again."),o.setButtonLoading(t,!1),o.processing=!1})):o.showCustomerDetailsPrompt(e,t,i)})).catch((function(){o.showError("Error checking customer details. Please try again."),o.setButtonLoading(t,!1),o.processing=!1}))},onPhoneChoice:function(){var i="request_contact"===a?"request_contact_phone":"request_copy_sms";o.checkCustomerDetails(e).then((function(r){var n=[];r.name&&""!==r.name.trim()||n.push("name"),r.phone&&""!==r.phone.trim()||n.push("phone"),0===n.length?"request_contact"===a?o.requestStoreContact(e,"phone",t,r):(o.showMessage("SMS option coming soon.","success"),o.setButtonLoading(t,!1),o.processing=!1):o.showCustomerDetailsPrompt(e,t,i)})).catch((function(){o.showError("Error checking customer details. Please try again."),o.setButtonLoading(t,!1),o.processing=!1}))},showCancel:!0,onCancel:function(){o.setButtonLoading(t,!1),o.processing=!1}})}},{key:"requestStoreContact",value:function(e,t,o,a){var i=this;this.storeEstimate(e).then((function(o){if(!o||!o.estimate_id)throw new Error("Failed to store estimate");var r={action:"request_store_contact",nonce:productEstimatorVars.nonce,estimate_id:e,contact_method:t,customer_details:JSON.stringify(a)};return i.log("Sending store contact request with data:",r),fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(r)})})).then((function(e){return e.json()})).then((function(e){if(e.success){i.log("Store contact request successful:",e.data);var o;o="email"===t?"Your request has been sent. Our store will contact you at ".concat(a.email," shortly."):"Your request has been sent. Our store will call you at ".concat(a.phone," shortly."),i.showMessage(o,"success")}else{var r;i.log("Store contact request failed:",e.data),i.showError((null===(r=e.data)||void 0===r?void 0:r.message)||"Error sending contact request. Please try again.")}})).catch((function(e){i.log("Error in requestStoreContact:",e),i.showError("Error sending contact request. Please try again.")})).finally((function(){i.setButtonLoading(o,!1),i.processing=!1}))}},{key:"checkCustomerDetails",value:function(e){return new Promise((function(e,t){var o=H();o&&Object.keys(o).length>0?(console.log("[EstimateActions] Customer details found in localStorage:",o),e(o)):(console.log("[EstimateActions] No customer details in localStorage, returning empty object"),e({}))}))}},{key:"updateCustomerDetails",value:function(e,t){var o=this;return new Promise((function(a,i){t.postcode||(t.postcode="0000"),B(t),o.log("Customer details saved to localStorage from updateCustomerDetails:",t);var r=new CustomEvent("customer_details_updated",{bubbles:!0,detail:{details:t}});document.dispatchEvent(r),fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"store_single_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var t;if(!e.success)throw J.error("Error storing estimate:",e),new Error((null===(t=e.data)||void 0===t?void 0:t.message)||"Error storing estimate");a(e.data)})).catch((function(e){J.error("Error in updateCustomerDetails:",e),i(e)}))}))}},{key:"storeEstimate",value:function(e){var t=this;return new Promise((function(o,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"store_single_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var i;e.success?(t.log("Estimate stored successfully",e.data),o(e.data)):a(new Error((null===(i=e.data)||void 0===i?void 0:i.message)||"Error storing estimate"))})).catch((function(e){t.log("Error storing estimate:",e),a(e)}))}))}},{key:"getSecurePdfUrl",value:function(e){var t=this;return new Promise((function(o,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_secure_pdf_url",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var i;e.success&&e.data.url?(t.log("Received secure PDF URL:",e.data),o(e.data.url)):a(new Error((null===(i=e.data)||void 0===i?void 0:i.message)||"Failed to get secure PDF URL"))})).catch((function(e){t.log("Error getting secure PDF URL:",e),a(e)}))}))}},{key:"requestCopyEstimate",value:function(e,t){var o=this;return this.checkCustomerDetails(e).then((function(t){return t.email?o.storeEstimate(e).then((function(t){if(!t||!t.estimate_id)throw new Error("Failed to store estimate");return new Promise((function(t,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"request_copy_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var o,i;e.success?t(e.data):"no_email"===(null===(o=e.data)||void 0===o?void 0:o.code)?a(new Error("no_email")):a(new Error((null===(i=e.data)||void 0===i?void 0:i.message)||"Error requesting estimate copy"))})).catch((function(e){o.log("Error requesting estimate copy:",e),a(e)}))}))})):Promise.reject(new Error("no_email"))}))}},{key:"setButtonLoading",value:function(e,t){e&&(t?(e.dataset.originalHtml||(e.dataset.originalHtml=e.innerHTML),e.classList.add("loading"),e.innerHTML='<span class="loading-dots">Processing...</span>',e.disabled=!0):(e.classList.remove("loading"),e.dataset.originalHtml?e.innerHTML=e.dataset.originalHtml:e.textContent=e.dataset.originalText||e.textContent,e.disabled=!1))}},{key:"showMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;window.productEstimator&&window.productEstimator.dialog?window.productEstimator.dialog.show({title:G.i.get("ui_elements.success_title","Success"),message:e,type:"estimate",action:"confirm",confirmText:G.i.get("buttons.ok","OK"),cancelText:null,onConfirm:function(){"function"==typeof t&&t()}}):(alert(e),"function"==typeof t&&t())}},{key:"showError",value:function(e){window.productEstimator&&window.productEstimator.core&&"function"==typeof window.productEstimator.core.showError?window.productEstimator.core.showError(e):alert(e)}},{key:"log",value:function(){this.config.debug&&J.log.apply(J,arguments)}}])}();const X=$;var Z=(0,a.h)("EstimateManager"),ee=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,i.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.estimatesList=null,this.estimateSelection=null,this.newEstimateForm=null,this.currentProductId=null,this.handleProductFlow=this.handleProductFlow.bind(this),this.showEstimatesList=this.showEstimatesList.bind(this),this.loadEstimatesList=this.loadEstimatesList.bind(this),this.showNewEstimateForm=this.showNewEstimateForm.bind(this),this.handleEstimateRemoval=this.handleEstimateRemoval.bind(this),this.updateEstimate=this.updateEstimate.bind(this),this.bindEstimateSelectionFormEvents=this.bindEstimateSelectionFormEvents.bind(this),this.onModalClosed=this.onModalClosed.bind(this),this.estimateHasProducts=this.estimateHasProducts.bind(this)}),[{key:"init",value:function(){this.estimatesList=this.modalManager.estimatesList,this.estimateSelection=this.modalManager.estimateSelection,this.newEstimateForm=this.modalManager.newEstimateForm,this.bindEvents(),Z.log("EstimateManager initialized")}},{key:"bindEvents",value:function(){Z.log("EstimateManager events bound")}},{key:"estimateHasProducts",value:function(e){if(!e||!e.rooms||"object"!==(0,c.A)(e.rooms))return!1;for(var t in e.rooms){var o=e.rooms[t];if(o.products){if(Array.isArray(o.products)&&o.products.length>0)return!0;if("object"===(0,c.A)(o.products)&&Object.keys(o.products).length>0)return!0}}return!1}},{key:"hideAllSections",value:function(){var e=this;Z.log("Hiding all sections"),[this.modalManager.estimatesList,this.modalManager.estimateSelection,this.modalManager.roomSelectionForm,this.modalManager.newEstimateForm,this.modalManager.newRoomForm].forEach((function(t){t&&e.modalManager.uiManager?e.modalManager.uiManager.hideElement(t):t&&(t.style.display="none")}))}},{key:"handleProductFlow",value:function(e){var t=this;Z.log("Handling product flow with ID:",e),this.currentProductId=e,this.modalManager.showLoading(),this.dataService.checkEstimatesExist().then((function(o){Z.log("Has estimates check result:",o),o?(Z.log("Estimates found, showing estimate selection."),t.showEstimateSelection(e)):(Z.log("No estimates found, showing new estimate form."),t.showNewEstimateForm(e))})).catch((function(e){Z.error("Error checking estimates:",e),t.modalManager.contentContainer&&V.A.showMessage(a.ig.get("messages.estimate_check_error","Error checking estimates. Please try again."),"error",t.modalManager.contentContainer),t.modalManager.hideLoading()}))}},{key:"showEstimateSelection",value:function(e){Z.log("Showing estimate selection with product ID:",e),this.modalManager.contentContainer;var t=this.modalManager.estimateSelection;if(this.hideAllSections(),!t)return Z.error("Estimate selection wrapper not found in modal"),this.modalManager.hideLoading(),void this.modalManager.showError(a.ig.get("errors.modal_structure","Modal structure incomplete. Please contact support."));this.modalManager.forceElementVisibility(t);try{t.innerHTML="",V.A.insert("estimate-selection-template",{},t),V.A.processLabels(t),Z.log("Estimate selection template inserted into wrapper and labels processed.");var o=t.querySelector("#estimate-selection-form-wrapper");if(o){this.modalManager.forceElementVisibility(o);var i=o.querySelector("form");i?(Z.log("Estimate selection form element found after template insertion, populating dropdown and binding events."),this.loadEstimatesData(i,e),this.bindEstimateSelectionFormEvents(i,e)):(Z.error("Form element not found inside the template after insertion!"),this.modalManager.showError(a.ig.get("errors.form_template","Error rendering form template. Please try again.")),this.modalManager.hideLoading())}else Z.error("Estimate selection form wrapper not found in template!"),this.modalManager.showError(a.ig.get("errors.modal_structure","Modal structure incomplete. Please contact support.")),this.modalManager.hideLoading()}catch(e){Z.error("Error inserting estimate selection template:",e),this.modalManager.showError(a.ig.get("errors.selection_template","Error loading selection form template. Please try again.")),this.modalManager.hideLoading()}}},{key:"loadEstimatesData",value:function(e,t){var o=this;Z.log("Loading estimates data for selection form");var i=e.querySelector("select");if(!i)return Z.error("Select element not found in form"),void this.modalManager.hideLoading();e.dataset.productId=t,this.dataService.getEstimatesData().then((function(t){i.innerHTML="";var r=a.ig.get("forms.select_estimate_option","-- Select an Estimate --");if(V.A.insert("select-option-template",{value:"",text:r,labelKey:"forms.select_estimate_option"},i),t&&t.length>0){t.forEach((function(e){var t=e.name||"Estimate #".concat(e.id);V.A.insert("select-option-template",{value:e.id,text:t},i)})),i.disabled=!1;var n=e.querySelector('button[type="submit"]');n&&(n.disabled=!1)}else{V.A.insert("select-option-template",{value:"",text:a.ig.get("ui_elements.no_estimates_available","No estimates available"),labelKey:"ui_elements.no_estimates_available"},i),i.disabled=!0;var s=e.querySelector('button[type="submit"]');s&&(s.disabled=!0)}o.modalManager.hideLoading()})).catch((function(e){Z.error("Error loading estimates:",e),o.modalManager.showError(a.ig.get("messages.load_estimates_error","Error loading estimates. Please try again.")),o.modalManager.hideLoading()}))}},{key:"bindEstimateSelectionFormEvents",value:function(e,t){var o=this;if(Z.log("Binding events to estimate selection form"),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(i){i.preventDefault(),o.modalManager.showLoading();var r=e.querySelector("select").value;if(!r)return o.modalManager.showError(a.ig.get("messages.select_estimate","Please select an estimate.")),void o.modalManager.hideLoading();o.modalManager.roomManager?o.modalManager.roomManager.showRoomSelectionForm(r,t):(Z.error("RoomManager not available for showRoomSelectionForm"),o.modalManager.hideLoading())},e.addEventListener("submit",e._submitHandler);var i=e.querySelector("#create-estimate-btn");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),o.showNewEstimateForm(t)},i.addEventListener("click",i._clickHandler));var r=e.querySelector(".cancel-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.modalManager.closeModal()},r.addEventListener("click",r._clickHandler))}else Z.error("Form element not available for binding events")}},{key:"showEstimatesList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Z.log("Showing estimates list view",{expandEstimateId:t,expandRoomId:o});var i=this.modalManager.estimatesList;if(!i)return Z.error("Estimates list container not found in modal"),this.modalManager.hideLoading(),void this.modalManager.showError(a.ig.get("errors.modal_structure","Modal structure incomplete. Please contact support."));this.hideAllSections(),this.modalManager.forceElementVisibility(i),this.loadEstimatesList(o,t).then((function(){e.bindEstimateListEventHandlers()})).catch((function(t){Z.error("Error loading estimates list:",t),i?V.A.showMessage(a.ig.get("messages.load_estimates_error","Error loading estimates. Please try again."),"error",i):e.modalManager.showError(a.ig.get("messages.load_estimates_error","Error loading estimates. Please try again."))})).finally((function(){e.modalManager.hideLoading()}))}},{key:"bindEstimateListEventHandlers",value:function(){var e=this;Z.log("Binding event handlers to estimates list");var t=this.modalManager.estimatesList;t?(t._clickHandler&&(Z.log("Removing existing click handler from estimates list"),t.removeEventListener("click",t._clickHandler)),Z.log("Adding click handler to estimates list"),t._clickHandler=function(t){if(t.target.closest("#create-estimate-btn"))return t.preventDefault(),console.log("Create New Estimate button clicked"),void e.showNewEstimateForm();var o=t.target.closest(".remove-estimate");if(o){t.preventDefault(),t.stopPropagation();var a=o.getAttribute("data-estimate-id");if(a)e.handleEstimateRemoval(a);else{var i=o.closest(".estimate-section");if(i&&i.dataset.estimateId){var r=i.dataset.estimateId;e.handleEstimateRemoval(r)}else Z.error("Could not find estimate ID for removal")}}else if(t.target.closest(".print-estimate")){t.preventDefault();var n=t.target.closest(".print-estimate").dataset.estimateId;n&&Z.log("Print estimate clicked for ID:",n)}else if(t.target.closest(".request-contact-estimate")){t.preventDefault();var s=t.target.closest(".request-contact-estimate").dataset.estimateId;s&&Z.log("Request contact clicked for ID:",s)}else if(t.target.closest(".request-a-copy")){t.preventDefault();var l=t.target.closest(".request-a-copy").dataset.estimateId;l&&Z.log("Request copy clicked for ID:",l)}else if(t.target.closest(".add-room")){t.preventDefault();var d=t.target.closest(".add-room").dataset.estimateId;d&&(Z.log("Add room clicked for estimate ID:",d),e.modalManager.roomManager&&e.modalManager.roomManager.showNewRoomForm(d))}else if(t.target.closest(".estimate-header")){if(t.target.closest("button")||t.target.closest("a")||t.target.closest(".remove-estimate"))return;Z.log("Toggling estimate accordion");var c=t.target.closest(".estimate-header").closest(".estimate-section"),u=c.querySelector(".estimate-content");u&&(c.classList.contains("expanded")?(c.classList.remove("expanded"),c.classList.add("collapsed"),u.style.display="none"):(c.classList.remove("collapsed"),c.classList.add("expanded"),u.style.display="block",c.dataset.estimateId&&!u.dataset.loaded&&(u.dataset.loaded="true",e.modalManager.roomManager&&e.modalManager.roomManager.loadRoomsForEstimate(c.dataset.estimateId,u,null,!1))))}},Z.log("Attaching click event listener to estimates list"),t.addEventListener("click",t._clickHandler)):Z.error("Estimates list container not found for binding events")}},{key:"loadEstimatesList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Z.log("Loading estimates list",{expandRoomId:t,expandEstimateId:o});var a=this.modalManager.estimatesList;return a?(this.modalManager.showLoading(),o&&this.dataService.refreshEstimatesCache(),this.dataService.getEstimatesData(!0).then((function(i){if(a.innerHTML="",i&&0!==i.length){if(i.forEach((function(t){var o={id:t.id,name:t.name||"Estimate #".concat(t.id),min_total:t.min_total||0,max_total:t.max_total||0};V.A.insert("estimate-item-template",o,a);var i=a.querySelectorAll(".estimate-section"),r=i[i.length-1];if(r){r.setAttribute("data-estimate-id",t.id);var n=r.querySelector(".remove-estimate");n?(n.setAttribute("data-estimate-id",t.id),console.log("Set data-estimate-id on remove button:",n)):console.warn("Remove button not found in estimate element"),r.querySelectorAll("[data-estimate-id]").forEach((function(e){e.setAttribute("data-estimate-id",t.id)}));var s=r.querySelector(".add-room");s&&s.setAttribute("data-estimate-id",t.id),r.querySelectorAll(".estimate-actions a").forEach((function(e){e.setAttribute("data-estimate-id",t.id)}));var l=r.querySelector(".estimate-actions");if(l){var d=e.estimateHasProducts(t);Z.log("Estimate ".concat(t.id," has products: ").concat(d)),l.style.display=d?"block":"none"}}})),o){var r=a.querySelector('.estimate-section[data-estimate-id="'.concat(o,'"]'));if(r){var n=r.querySelector(".estimate-header"),s=r.querySelector(".estimate-content");n&&s&&(r.classList.remove("collapsed"),r.classList.add("expanded"),s.style.display="block",s.dataset.loaded="true",e.modalManager.roomManager&&e.modalManager.roomManager.loadRoomsForEstimate(o,s,t,!0))}}}else V.A.insert("estimates-empty-template",{},a)})).finally((function(){e.modalManager.hideLoading()}))):Promise.reject(new Error("Estimates list container not found"))}},{key:"showNewEstimateForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Z.log("Showing new estimate form",{productId:e});var t=this.modalManager.newEstimateForm;if(!t)return Z.error("New estimate form container not found in modal"),this.modalManager.showError(a.ig.get("errors.modal_structure","Modal structure incomplete. Please contact support.")),void this.modalManager.hideLoading();this.hideAllSections(),this.modalManager.forceElementVisibility(t),this.modalManager.showLoading();try{t.innerHTML="",V.A.insert("new-estimate-form-template",{},t),Z.log("New estimate form template inserted into wrapper.");var o=t.querySelector("form");if(o){var i;e?o.dataset.productId=e:delete o.dataset.productId;var r=null===(i=window.productEstimator)||void 0===i||null===(i=i.core)||void 0===i?void 0:i.customerDetailsManager,n=t.querySelector(".customer-details-display"),s=t.querySelector(".customer-details-content");if(r){var l=r.getCustomerDetails();if(l&&(l.name||l.email||l.phone||l.postcode)){Z.log("Customer data found, displaying details");var d="";l.name&&(d+="<p><strong>NAME:</strong><br>".concat(l.name,"</p>")),l.email&&(d+="<p><strong>EMAIL:</strong><br>".concat(l.email,"</p>")),l.phone&&(d+="<p><strong>PHONE:</strong><br>".concat(l.phone,"</p>")),l.postcode&&(d+="<p><strong>POSTCODE:</strong><br>".concat(l.postcode,"</p>")),n&&s&&(s.innerHTML=d,n.style.display="")}if(r.hasPostcode()){Z.log("Customer postcode found, hiding postcode field");var c=o.querySelector(".customer-details-section");c&&(c.style.display="none");var u=o.querySelector("#customer-postcode");u&&(u.removeAttribute("required"),Z.log("Removed required attribute from hidden postcode field")),o.dataset.hasPostcode="true"}else Z.log("No customer postcode found, showing postcode field"),o.dataset.hasPostcode="false"}this.modalManager.formManager?this.modalManager.formManager.bindNewEstimateFormEvents(o,e):Z.error("FormManager not available for bindNewEstimateFormEvents"),r&&r.bindEvents&&(r.bindEvents(),Z.log("Customer details edit functionality initialized")),this.modalManager.hideLoading()}else Z.error("Form element not found inside the template after insertion!"),this.modalManager.showError("Error rendering form template. Please try again."),this.modalManager.hideLoading()}catch(e){Z.error("Error inserting new estimate form template:",e),this.modalManager.showError(a.ig.get("errors.form_template","Error loading form template. Please try again.")),this.modalManager.hideLoading()}}},{key:"handleEstimateRemoval",value:function(e){var t=this;this.modalManager&&this.modalManager.confirmationDialog?(0,a.jb)(this.modalManager,a.ig.get("messages.confirm_delete_estimate","Are you sure you want to delete this estimate?"),(function(){Z.log("Confirm button clicked, proceeding with estimate removal"),t.modalManager.showLoading(),t.dataService.removeEstimate(e).then((function(){var o=t.modalManager.estimatesList;if(o){var i=o.querySelector('.estimate-section[data-estimate-id="'.concat(e,'"]'));i&&(i.remove(),0===o.querySelectorAll(".estimate-section").length&&(o.innerHTML="",V.A.insert("estimates-empty-template",{},o)))}Z.log("Showing success dialog"),(0,a.Zj)(t.modalManager,a.ig.get("messages.estimate_removed","This estimate has been removed successfully."),"estimate",(function(){return Z.log("Success dialog closed")}))})).catch((function(e){Z.error("Error removing estimate:",e),(0,a._F)(t.modalManager,a.ig.get("messages.estimate_remove_error","There was a problem removing the estimate. Please try again."),"estimate",(function(){return Z.log("Error dialog closed")}))})).finally((function(){t.modalManager.hideLoading()}))}),"estimate",(function(){Z.log("Estimate removal cancelled by user")})):Z.error("ConfirmationDialog not available")}},{key:"updateEstimate",value:function(e,t){var o=this;return Z.log("Updating estimate",{estimateId:e,updateData:t}),this.modalManager.showLoading(),this.dataService.updateEstimate(e,t).then((function(t){return Z.log("Estimate updated successfully:",t),o.loadEstimatesList(null,e)})).catch((function(e){throw Z.error("Error updating estimate:",e),o.modalManager.showError(a.ig.get("messages.update_estimate_error","Error updating estimate. Please try again.")),e})).finally((function(){o.modalManager.hideLoading()}))}},{key:"onModalClosed",value:function(){Z.log("EstimateManager: Modal closed"),this.currentProductId=null}}])}();const te=ee;var oe=(0,a.h)("InfiniteCarousel"),ae=function(){return(0,r.A)((function e(t){(0,i.A)(this,e),this.container=t,this.itemsContainer=t.querySelector(".suggestions-container"),this.originalItems=Array.from(t.querySelectorAll(".suggestion-item")),this.prevBtn=t.querySelector(".suggestions-nav.prev"),this.nextBtn=t.querySelector(".suggestions-nav.next"),this.isSimilarProducts=t.classList.contains("similar-products-carousel"),this.itemsContainer&&0!==this.originalItems.length?(this.itemWidth=this.isSimilarProducts?170:200,this.itemGap=this.isSimilarProducts?5:15,this.animationDuration=300,this.currentPosition=0,this.itemCount=this.originalItems.length,this.isAnimating=!1,this.duplicatedSets=0,t.carouselInstance=this,this.init()):oe.warn("Carousel missing required elements")}),[{key:"init",value:function(){this.calculateDimensions(),this.ensureSufficientItems(),this.setPosition(0,!1),this.processLabels(),this.bindEvents(),this.updateButtons(),oe.log("Initialized continuous scroll carousel with ".concat(this.itemCount," items"))}},{key:"processLabels",value:function(){G.i.updateDOM(this.container),this.prevBtn&&(this.prevBtn.getAttribute("aria-label")||this.prevBtn.setAttribute("aria-label",G.i.get("ui_elements.previous","Previous"))),this.nextBtn&&(this.nextBtn.getAttribute("aria-label")||this.nextBtn.setAttribute("aria-label",G.i.get("ui_elements.next","Next")))}},{key:"calculateDimensions",value:function(){var e=window.getComputedStyle(this.container),t=parseInt(e.paddingLeft)+parseInt(e.paddingRight);this.containerWidth=this.container.clientWidth;var o=this.containerWidth-t,a=this.itemWidth+this.itemGap;this.visibleItems=Math.floor(o/a),this.visibleItems=Math.max(1,this.visibleItems),this.totalItemsWidth=this.itemCount*a-this.itemGap,oe.log("Container width: ".concat(this.containerWidth,", Padding: ").concat(t,", Visible items: ").concat(this.visibleItems,", Available width: ").concat(o))}},{key:"ensureSufficientItems",value:function(){this.itemWidth,this.itemGap;for(var e=window.getComputedStyle(this.container),t=parseInt(e.paddingLeft)+parseInt(e.paddingRight),o=this.containerWidth-t;this.totalItemsWidth<3*o;)this.duplicateItems()}},{key:"duplicateItems",value:function(){var e=this,t=[];this.originalItems.forEach((function(o){var a=o.cloneNode(!0);a.classList.add("duplicated"),a.dataset.duplicateSet=e.duplicatedSets,t.push(a)})),t.forEach((function(t){e.itemsContainer.appendChild(t),G.i.updateDOM(t)})),this.itemCount+=this.originalItems.length,this.duplicatedSets++;var o=this.itemWidth+this.itemGap;this.totalItemsWidth=this.itemCount*o-this.itemGap,oe.log("Duplicated items. Total count: ".concat(this.itemCount))}},{key:"bindEvents",value:function(){var e,t=this;this.prevBtn&&this.prevBtn.addEventListener("click",(function(){return t.prev()})),this.nextBtn&&this.nextBtn.addEventListener("click",(function(){return t.next()})),window.addEventListener("resize",(function(){clearTimeout(e),e=setTimeout((function(){t.calculateDimensions(),t.ensureSufficientItems()}),150)})),this.itemsContainer.addEventListener("transitionend",(function(){t.isAnimating=!1,t.checkInfiniteScroll()}))}},{key:"prev",value:function(){this.isAnimating||(this.isAnimating=!0,this.currentPosition=Math.max(0,this.currentPosition-1),this.setPosition(this.currentPosition,!0))}},{key:"next",value:function(){this.isAnimating||(this.isAnimating=!0,this.currentPosition++,this.setPosition(this.currentPosition,!0))}},{key:"setPosition",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=-e*(this.itemWidth+this.itemGap);this.itemsContainer.style.transition=t?"transform ".concat(this.animationDuration,"ms ease"):"none",this.itemsContainer.style.transform="translateX(".concat(o,"px)"),t&&this.updateButtons()}},{key:"checkInfiniteScroll",value:function(){var e=this.itemWidth+this.itemGap,t=-this.currentPosition*e,o=window.getComputedStyle(this.container),a=(parseInt(o.paddingLeft),parseInt(o.paddingRight),this.containerWidth,Math.floor((this.totalItemsWidth+t)/e));a<10&&(this.duplicateItems(),oe.log("Duplicating items - items ahead: ".concat(a)))}},{key:"updateButtons",value:function(){this.nextBtn&&(this.nextBtn.classList.remove("disabled"),this.nextBtn.disabled=!1,this.nextBtn.style.pointerEvents="auto"),this.prevBtn&&(this.prevBtn.classList.toggle("disabled",0===this.currentPosition),this.prevBtn.disabled=0===this.currentPosition)}},{key:"destroy",value:function(){var e=this;this.prevBtn&&this.prevBtn.removeEventListener("click",(function(){return e.prev()})),this.nextBtn&&this.nextBtn.removeEventListener("click",(function(){return e.next()})),delete this.container.carouselInstance}}])}();function ie(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function re(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(o),!0).forEach((function(t){(0,u.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ie(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var ne=(0,a.h)("RoomManager");const se=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,i.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.newRoomForm=null,this.roomSelectionForm=null,this.currentEstimateId=null,this.currentProductId=null,this.showRoomSelectionForm=this.showRoomSelectionForm.bind(this),this.loadRoomsForEstimate=this.loadRoomsForEstimate.bind(this),this.showNewRoomForm=this.showNewRoomForm.bind(this),this.bindNewRoomFormEvents=this.bindNewRoomFormEvents.bind(this),this.handleRoomRemoval=this.handleRoomRemoval.bind(this),this.updateRoomTotals=this.updateRoomTotals.bind(this),this.renderRoom=this.renderRoom.bind(this),this.onModalClosed=this.onModalClosed.bind(this),this.initializeSimilarProductsForRoom=this.initializeSimilarProductsForRoom.bind(this),this.loadSimilarProductsForRoom=this.loadSimilarProductsForRoom.bind(this),this.bindIncludesToggle=this.bindIncludesToggle.bind(this),this.bindSimilarProductsToggle=this.bindSimilarProductsToggle.bind(this)}),[{key:"init",value:function(){this.newRoomForm=this.modalManager.newRoomForm,this.roomSelectionForm=this.modalManager.roomSelectionForm,this.bindEvents(),ne.log("RoomManager initialized")}},{key:"bindEvents",value:function(){ne.log("RoomManager events bound")}},{key:"getRoomName",value:function(e,t){var o=P();if(o&&o.estimates){var a=o.estimates[e];if(a&&a.rooms&&a.rooms[t])return a.rooms[t].name||"Room #".concat(t)}return"selected room"}},{key:"showRoomSelectionForm",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ne.log("Showing room selection form",{estimateId:e,productId:o}),this.currentEstimateId=e,this.currentProductId=o;var a=this.modalManager.roomSelectionForm;if(!a)return ne.error("Room selection form container not found in modal"),this.modalManager.showError("Modal structure incomplete. Please contact support."),void this.modalManager.hideLoading();this.modalManager.estimateManager&&this.modalManager.estimateManager.hideAllSections&&this.modalManager.estimateManager.hideAllSections(),this.modalManager.forceElementVisibility(a),this.modalManager.showLoading(),this.dataService.getEstimate(e).then((function(i){if(!i)throw new Error("Estimate with ID ".concat(e," not found"));if(!(i.rooms&&Object.keys(i.rooms).length>0))return ne.log("Estimate has no rooms, showing new room form directly"),t.modalManager.hideLoading(),void t.showNewRoomForm(e,o);try{a.innerHTML="",V.A.insert("room-selection-form-template",{estimateName:i.name||"Estimate #".concat(i.id)},a),V.A.processLabels(a),ne.log("Room selection form template inserted into wrapper.");var r=a.querySelector("form");r?(r.dataset.estimateId=e,o?r.dataset.productId=o:delete r.dataset.productId,t.loadRoomsForSelection(e,r).then((function(){t.bindRoomSelectionFormEvents(r,e,o),t.modalManager.hideLoading()})).catch((function(e){ne.error("Error loading rooms for selection:",e),t.modalManager.showError("Error loading rooms. Please try again."),t.modalManager.hideLoading()}))):(ne.error("Form element not found inside the template after insertion!"),t.modalManager.showError("Error rendering form template. Please try again."),t.modalManager.hideLoading())}catch(e){ne.error("Error inserting room selection form template:",e),t.modalManager.showError("Error loading form template. Please try again."),t.modalManager.hideLoading()}})).catch((function(e){ne.error("Error fetching estimate details:",e),t.modalManager.showError("Error loading estimate details. Please try again."),t.modalManager.hideLoading()}))}},{key:"loadRoomsForSelection",value:function(e,t){ne.log("Loading rooms for selection form",{estimateId:e});var o=t.querySelector("select");return o?this.dataService.getRoomsForEstimate(e).then((function(e){var i=!(!e||!e.has_rooms)&&e.has_rooms,r=e&&e.rooms?e.rooms:[];if(ne.log("Got rooms for selection, has_rooms:",i,"count:",r.length),o.innerHTML="",V.A.insert("select-option-template",{value:"",text:a.ig.get("forms.select_room_option","-- Select a room --"),labelKey:"forms.select_room_option"},o),i&&r.length>0){r.forEach((function(e){V.A.insert("select-option-template",{value:e.id,text:e.name||"Room #".concat(e.id)},o)})),o.disabled=!1;var n=t.querySelector('button[type="submit"]');n&&(n.disabled=!1)}else V.A.insert("select-option-template",{value:"",text:a.ig.get("ui_elements.no_rooms_available","No rooms available"),labelKey:"ui_elements.no_rooms_available"},o),o.disabled=!0;return r})):Promise.reject(new Error("Select element not found in form"))}},{key:"bindRoomSelectionFormEvents",value:function(e,t){var o=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ne.log("Binding events to room selection form",{estimateId:t,productId:i}),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(r){r.preventDefault(),o.modalManager.showLoading();var n=e.querySelector("select").value;if(!n)return o.modalManager.showError("Please select a room or create a new one."),void o.modalManager.hideLoading();i?o.modalManager.productManager?o.modalManager.productManager.addProductToRoom(t,n,i).then((function(){o.modalManager.hideLoading(),o.modalManager.estimateManager&&o.modalManager.estimateManager.showEstimatesList(t,n),o.modalManager&&o.modalManager.confirmationDialog?setTimeout((function(){o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.product_added_title","Product Added"),message:a.ig.get("messages.product_added_success","The product has been added to the selected room."),type:"product",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}),100):ne.log("Product has been added to the selected room.")})).catch((function(e){e&&e.data&&e.data.duplicate||(ne.log("Error adding product to room:",e),o.modalManager.showError("Error adding product to room. Please try again."),o.modalManager.hideLoading())})):(ne.error("ProductManager not available for addProductToRoom"),o.modalManager.hideLoading()):(o.modalManager.hideLoading(),o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList(t,n):o.modalManager.closeModal())},e.addEventListener("submit",e._submitHandler);var r=e.querySelector("#add-new-room-from-selection, .add-room");r?(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),ne.log("Add New Room button clicked"),o.showNewRoomForm(t,i)},r.addEventListener("click",r._clickHandler),ne.log("Add New Room button handler attached")):ne.log("Add New Room button not found in form");var n=e.querySelector(".cancel-btn, .back-btn, .cancel-button");n?(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),ne.log("Cancel/Back button clicked"),i&&o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(i):o.modalManager.closeModal()},n.addEventListener("click",n._clickHandler),ne.log("Cancel/Back button handler attached")):ne.log("Cancel/Back button not found in form");var s=e.querySelector(".back-button:not(.cancel-btn)");s&&s!==n&&(s._clickHandler&&s.removeEventListener("click",s._clickHandler),s._clickHandler=function(e){e.preventDefault(),ne.log("Separate back button clicked"),o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(i):o.modalManager.closeModal()},s.addEventListener("click",s._clickHandler))}else ne.error("Form element not available for binding events")}},{key:"loadRoomsForEstimate",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(ne.log("Loading rooms for estimate",{estimateId:e,expandRoomId:a,bypassCache:i}),!t)return Promise.reject(new Error("Container not provided for loading rooms"));var r=t.querySelector(".loading-placeholder");r&&(r.style.display="block");var n=t.querySelector(".estimate-rooms-container");return n||(V.A.insert("rooms-container-template",{},t),n=t.querySelector(".estimate-rooms-container")),this.dataService.getRoomsForEstimate(e,i).then((function(t){n.innerHTML="";var i=t&&t.rooms?t.rooms:[];if(t&&t.has_rooms&&t.has_rooms&&0!==i.length){var s=i.map((function(t){var i=a===t.id;return o.renderRoom(t,t.id,e,n,i)}));return Promise.all(s)}return ne.log("No rooms found for estimate ".concat(e,", showing empty template")),V.A.insert("rooms-empty-template",{},n),r&&(r.style.display="none"),t})).catch((function(e){throw ne.error("Error loading rooms for estimate:",e),V.A.insert("room-error-template",{},n),r&&(r.style.display="none"),e}))}},{key:"aggregateProductIncludes",value:function(e){var t=new Map,o=null;return e?(e.products&&Object.values(e.products).forEach((function(e){var a=e.id||e.product_id;a&&!t.has(a)&&t.set(a,{id:a,product_id:a,name:e.name||"Product",price:e.min_price_total||e.max_price_total||e.price||0,image:e.image||"",sku:e.sku||"",is_primary:!0}),e.additional_products&&(Array.isArray(e.additional_products)?e.additional_products:Object.values(e.additional_products)).forEach((function(e){var o=e.id||e.product_id;if(e.is_variable&&e.variations)ne.log("Skipping variable additional product from includes:",{name:e.name,productId:o});else if(o&&!t.has(o)){var a=e.price||e.total||0;if(e.selected_option&&e.variations&&e.variations[e.selected_option]){var i=e.variations[e.selected_option];a=i.min_price_total||i.max_price_total||0}t.set(o,{id:o,product_id:o,name:e.name||e.product_name||"Product",price:a,image:e.image||"",sku:e.sku||"",selected_option:e.selected_option,variations:e.variations,is_variable:e.is_variable,is_additional:!0})}})),e.additional_products_section&&!o&&(o=e.additional_products_section)})),{includes:Array.from(t.values()),sectionInfo:o}):(ne.warn("aggregateProductIncludes called with null/undefined room"),{includes:[],sectionInfo:null})}},{key:"renderRoom",value:function(e,t,o,i){var r=this,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(ne.log("Rendering room",{roomId:t,estimateId:o,expand:n}),!i)return Promise.reject(new Error("Container not provided for rendering room"));var s=null,l=null;if(ne.log("Looking for primary product in room:",{roomName:e.name,primaryCategoryProductId:e.primary_category_product_id,productsObject:e.products,productsKeys:e.products?Object.keys(e.products):[],roomStructure:e}),e.primary_category_product_id&&e.products){var d=e.products[e.primary_category_product_id];d?(s=d.image||null,l=d.name||null,ne.log("Primary product found:",{productId:e.primary_category_product_id,image:s,name:l,productData:d})):ne.log("Primary product not found in products object:",{searchedId:e.primary_category_product_id,availableIds:Object.keys(e.products),productsStructure:e.products})}else ne.log("Cannot find primary product:",{primaryId:e.primary_category_product_id,hasProducts:!!e.products,roomData:e});var c={id:t,room_id:t,estimate_id:o,roomId:t,estimateId:o,roomName:e.name||"Room #".concat(t),room_name:e.name||"Room #".concat(t),"room-name":e.name||"Room #".concat(t),roomTotal:a.GP.currency(e.total||0),room_price:a.GP.currency(e.total||0),"room-price":a.GP.currency(e.total||0),room_dimensions:e.dimensions_display||(e.width&&e.length?"".concat(e.width,"m x ").concat(e.length,"m"):""),"room-dimensions":e.dimensions_display||(e.width&&e.length?"".concat(e.width,"m x ").concat(e.length,"m"):""),primary_product_image:s,primary_product_name:l||"","primary-product-name":l||"",has_primary_product:!!s,isExpanded:n};ne.log("Room template data:",c),V.A.insert("room-item-template",c,i);var u=i.lastElementChild;if(u){u.classList.add("room-item"),u.dataset.roomId=t,u.dataset.estimateId=o;var m=u.querySelector(".remove-room");m&&(m.dataset.roomId=t,m.dataset.estimateId=o);var g=u.querySelector(".accordion-header-wrapper");g&&n&&g.classList.add("expanded");var p=u.querySelector(".accordion-content");p&&(p.style.display=n?"block":"none"),this.bindRoomEvents(u,o,t),this.bindIncludesToggle(u),this.bindSimilarProductsToggle(u);var h=this.aggregateProductIncludes(e);this.renderRoomIncludes(h,u,e.id,o),this.renderAdditionalProducts(e,u),setTimeout((function(){r.initializeSimilarProductsForRoom(o,t)}),300),ne.log("Room element rendered with data-room-id=".concat(u.dataset.roomId," and data-estimate-id=").concat(u.dataset.estimateId))}else ne.error("Failed to find rendered room element after insertion");return Promise.resolve(u)}},{key:"renderAdditionalProducts",value:function(e,t){ne.log("Rendering additional products",{roomName:e.name});var o=t.dataset.estimateId,i=t.dataset.roomId;if(o&&i){var r=t.querySelector(".additional-products-container"),n=t.querySelector(".additional-products-list");if(n){n.innerHTML="";var s=!1;e.products&&"object"===(0,c.A)(e.products)&&Object.values(e.products).forEach((function(e){e.additional_products&&"object"===(0,c.A)(e.additional_products)&&Object.values(e.additional_products).forEach((function(t){if(t.is_variable&&t.variations){s=!0;var r=document.createElement("div");r.className="additional-product-section",r.setAttribute("data-parent-product-id",t.id);var l=document.createElement("h6");l.className="additional-product-title";var d="".concat(t.name," Variations"),c="";if(e.additional_products_section&&(d=e.additional_products_section.title||d,c=e.additional_products_section.description||""),l.textContent=d,r.appendChild(l),c){var u=document.createElement("p");u.className="additional-product-description",u.textContent=c,r.appendChild(u)}var m=document.createElement("div");m.className="additional-product-variations-grid",Object.values(t.variations).sort((function(e,t){return(e.menu_order||0)-(t.menu_order||0)})).forEach((function(r,n){var s={product_id:r.id,estimate_id:o,room_id:i,parent_product_id:t.id,name:r.name,product_name:r.name,price:r.min_price_total||r.min_price||0,product_price:a.GP.currency(r.min_price_total||r.min_price||0),image:r.image||"",attributes:r.attributes||{}};ne.log("Rendering additional product variation:",s);var l=document.createElement("div");V.A.insert("additional-product-option-template",s,l);var d=l.querySelector(".additional-product-option-tile");if(d){d.classList.add("variation-tile"),!0===r.selected&&d.classList.add("selected");var c="option_colour_".concat(n+1);e.additional_products_section&&e.additional_products_section[c]&&(d.style.backgroundColor=e.additional_products_section[c])}var u=d.querySelector(".replace-product-in-room");u&&(u.textContent=!0===r.selected?a.ig.get("buttons.selected_additional_product","Selected"):a.ig.get("buttons.select_additional_product","Select"),u.dataset.productId=r.id,u.dataset.estimateId=o,u.dataset.roomId=i,u.dataset.replaceProductId=t.id,u.dataset.replaceType="additional_products",u.dataset.parentProductId=t.id),m.appendChild(l.firstElementChild)})),r.appendChild(m),n.appendChild(r)}}))})),r&&(r.style.display=s?"":"none"),s&&this.bindAdditionalProductButtons(n)}else ne.warn("Additional products list container not found in room element")}else ne.error("Missing estimate or room ID on room element")}},{key:"bindAdditionalProductButtons",value:function(e){var t=this;e.querySelectorAll(".replace-product-in-room").forEach((function(e){e._clickHandler&&e.removeEventListener("click",e._clickHandler),e._clickHandler=function(o){o.preventDefault(),o.stopPropagation();var a=e.dataset.productId,i=e.dataset.estimateId,r=e.dataset.roomId,n=e.dataset.replaceProductId,s=e.dataset.replaceType,l=e.dataset.parentProductId;ne.log("Additional product variation button clicked",{productId:a,estimateId:i,roomId:r,replaceProductId:n,replaceType:s,parentProductId:l}),t.selectProductAdditionVariation(i,r,l,a)},e.addEventListener("click",e._clickHandler)}))}},{key:"selectProductAdditionVariation",value:function(e,t,o,i){var r=this;ne.log("Selecting product addition variation",{estimateId:e,roomId:t,parentProductId:o,variationId:i}),this.dataService.updateProductAdditionVariation(e,t,o,i).then((function(){ne.log("Product addition variation updated successfully"),r.updateProductAdditionVariationUI(e,t)})).catch((function(e){ne.error("Error updating product addition variation",e),r.modalManager.confirmationDialog&&r.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.general_error","Failed to update the variation. Please try again."),type:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}))}},{key:"updateProductAdditionVariationUI",value:function(e,t){var o=document.querySelector('.room-item[data-estimate-id="'.concat(e,'"][data-room-id="').concat(t,'"]'));if(o){var a=P().estimates[e];if(a&&a.rooms[t]){this.renderAdditionalProducts(a.rooms[t],o);var i=this.aggregateProductIncludes(a.rooms[t]);this.renderRoomIncludes(i,o,t,e)}var r=o.closest(".room-container");if(r){var n=r.querySelector(".room-products");n&&this.displayRoomProducts(e,t,n)}}else{var s=document.querySelector('.room-content[data-estimate-id="'.concat(e,'"][data-room-id="').concat(t,'"]'));s&&this.displayRoomProducts(e,t,s)}}},{key:"renderRoomIncludes",value:function(e,t,o,i){var r;if(ne.log("Rendering room includes (products)",{roomId:o,includesData:e}),i&&o){var n=t.querySelector(".product-includes-items");if(n){n.innerHTML="";var s=[];if(e.includes&&Array.isArray(e.includes))s=e.includes,e.sectionInfo;else if(e.products){var l=this.aggregateProductIncludes(e);s=l.includes,l.sectionInfo}if(0!==s.length){var d=t.querySelector(".room-empty-state");d&&(d.style.display="none");var c=t.querySelector(".includes-container"),u=t.querySelector(".product-includes-toggle");c&&(c.style.display=""),u&&(u.style.display="");var m=t.querySelector(".similar-products-toggle"),g=t.querySelector(".similar-products-container");m&&(m.style.display=""),g&&(g.style.display="");var p=s.filter((function(e){return e.is_primary})),h=s.filter((function(e){return e.is_additional}));p.forEach((function(e,t){var r=e.price||0,s={product_id:e.id||e.product_id,estimate_id:i,room_id:o,product_index:t,name:e.name||"Product",product_name:e.name||"Product",price:r,product_price:a.GP.currency(r),image:e.image||"",sku:e.sku||""};ne.log("Rendering primary product as include:",s),V.A.insert("include-item-template",s,n)}));var v=h.filter((function(e){return!e.is_variable||!e.variations}));v.length>0&&v.forEach((function(e,t){var r=e.price||0,s={product_id:e.id||e.product_id,estimate_id:i,room_id:o,product_index:p.length+t,name:e.name||"Product",product_name:e.name||"Product",price:r,product_price:a.GP.currency(r),image:e.image||"",sku:e.sku||""};ne.log("Rendering non-variable additional product:",s),V.A.insert("include-item-template",s,n)})),this.bindIncludeItemRemoveButtons(n,i,o);var f=null===(r=n.parentElement)||void 0===r?void 0:r.querySelector(".additional-products-section");if(f){var y=f.querySelector(".additional-products-list");y&&this.bindIncludeItemRemoveButtons(y,i,o)}ne.log("Rendered ".concat(s.length," products in room includes (").concat(p.length," primary, ").concat(h.length," additional)"))}else{ne.log("No includes to display, show empty state");var b=t.querySelector(".includes-container"),_=t.querySelector(".product-includes-toggle"),w=t.querySelector(".similar-products-container"),E=t.querySelector(".similar-products-toggle");b&&(b.style.display="none"),_&&(_.style.display="none"),w&&(w.style.display="none"),E&&(E.style.display="none");var S=t.querySelector(".room-empty-state");S&&(S.style.display="block",V.A.insert("products-empty-template",{},S))}}else ne.warn("Product includes container not found in room element")}else ne.error("Missing estimate or room ID on room element")}},{key:"bindIncludeItemRemoveButtons",value:function(e,t,o){var i=this;ne.log("Binding remove buttons for include items",{estimateId:t,roomId:o}),e.querySelectorAll(".remove-product").forEach((function(e){var r=e.dataset.productId,n=e.closest(".include-item"),s=n?n.querySelector(".product-name").textContent:"this product";e._clickHandler&&e.removeEventListener("click",e._clickHandler),e._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),i.modalManager&&i.modalManager.confirmationDialog&&i.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.remove_product_title","Remove Product"),message:a.ig.format("messages.confirm_product_remove_with_name",{product_name:s},'Are you sure you want to remove "'.concat(s,'" from this room?')),confirmText:a.ig.get("buttons.remove","Remove"),cancelText:a.ig.get("buttons.cancel","Cancel"),type:"product",action:"delete",onConfirm:function(){i.modalManager.productManager&&i.modalManager.productManager.performProductRemoval(t,o,null,r)},onCancel:function(){ne.log("Product removal cancelled by user")}})},e.addEventListener("click",e._clickHandler)}))}},{key:"bindIncludesToggle",value:function(e){ne.log("bindIncludesToggle called for room element");var t=e.querySelector(".product-includes-toggle"),o=e.querySelector(".includes-container");ne.log("Found includes toggle button:",!!t),ne.log("Found includes container:",!!o),t&&o?(t._clickHandler&&(ne.log("Removing existing includes toggle handler"),t.removeEventListener("click",t._clickHandler)),t._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),ne.log("Includes toggle clicked");var a=t.classList.contains("expanded");if(ne.log("Current expanded state:",a),a){t.classList.remove("expanded"),o.classList.remove("visible");var i=t.querySelector(".toggle-icon");i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2")),ne.log("Includes collapsed")}else{t.classList.add("expanded"),o.classList.add("visible");var r=t.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),ne.log("Includes expanded")}},t.addEventListener("click",t._clickHandler),ne.log("Includes toggle event handler attached")):ne.warn("Could not bind includes toggle - missing elements")}},{key:"bindSimilarProductsToggle",value:function(e){var t=this;ne.log("bindSimilarProductsToggle called for room element");var o=e.querySelector(".similar-products-toggle"),a=e.querySelector(".similar-products-container");ne.log("Found similar products toggle button:",!!o),ne.log("Found similar products container:",!!a),o&&a?(o._clickHandler&&(ne.log("Removing existing similar products toggle handler"),o.removeEventListener("click",o._clickHandler)),o._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),ne.log("Similar products toggle clicked");var i=o.classList.contains("expanded");if(ne.log("Current expanded state:",i),i){o.classList.remove("expanded"),a.classList.remove("visible");var r=o.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),ne.log("Similar products collapsed")}else{o.classList.add("expanded"),a.classList.add("visible");var n=o.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2")),ne.log("Similar products expanded");var s=a.querySelector(".similar-products-carousel");s&&t.modalManager.uiManager&&t.modalManager.uiManager.initializeCarouselInContainer(s)}},o.addEventListener("click",o._clickHandler),ne.log("Similar products toggle event handler attached")):ne.warn("Could not bind similar products toggle - missing elements")}},{key:"bindRoomEvents",value:function(e,t,o){var a=this;if(ne.log("Binding events to room element",{estimateId:t,roomId:o}),e){var i=e.querySelector(".accordion-header");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(r){if(!r.target.closest("button:not(.accordion-header)")){var n=i.closest(".accordion-header-wrapper"),s=e.querySelector(".accordion-content");s&&n&&(n.classList.contains("expanded")?(n.classList.remove("expanded"),s.style.display="none"):(n.classList.add("expanded"),s.style.display="block",a.initializeSimilarProductsForRoom(t,o)))}},i.addEventListener("click",i._clickHandler));var r=e.querySelector(".remove-room");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),a.handleRoomRemoval(t,o)},r.addEventListener("click",r._clickHandler));var n=e.querySelector(".add-product-button");if(!n){var s=e.querySelector(".product-list");s&&s.parentElement&&(V.A.insert("room-actions-footer-template",{},s.parentElement),n=e.querySelector(".add-product-button"))}n&&(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),a.modalManager.productManager?a.modalManager.productManager.showProductSelection(t,o):ne.error("ProductManager not available for showProductSelection")},n.addEventListener("click",n._clickHandler))}else ne.error("Room element not available for binding events")}},{key:"showNewRoomForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ne.log("Showing new room form",{estimateId:e,productId:t}),this.currentEstimateId=e,this.currentProductId=t;var o=this.modalManager.newRoomForm;if(!o)return ne.error("New room form container not found in modal"),this.modalManager.showError("Modal structure incomplete. Please contact support."),void this.modalManager.hideLoading();this.modalManager.estimateManager&&this.modalManager.estimateManager.hideAllSections&&this.modalManager.estimateManager.hideAllSections(),this.modalManager.forceElementVisibility(o),this.modalManager.showLoading();try{o.innerHTML="",V.A.insert("new-room-form-template",{},o),ne.log("New room form template inserted into wrapper.");var i=o.querySelector("form");if(i){i.dataset.estimateId=e;var r=i.querySelector(".submit-btn");t?(i.dataset.productId=t,r&&(r.textContent=a.ig.get("buttons.add_room_and_product","Add Room & Product"))):(delete i.dataset.productId,r&&(r.dataset.label?r.textContent=a.ig.get("buttons.add_room","Add Room"):r.textContent="Add Room")),this.modalManager.formManager?this.modalManager.formManager.bindNewRoomFormEvents(i,e,t):this.bindNewRoomFormEvents(i,e,t),this.modalManager.hideLoading()}else ne.error("Form element not found inside the template after insertion!"),this.modalManager.showError("Error rendering form template. Please try again."),this.modalManager.hideLoading()}catch(e){ne.error("Error inserting new room form template:",e),this.modalManager.showError("Error loading form template. Please try again."),this.modalManager.hideLoading()}}},{key:"bindNewRoomFormEvents",value:function(e,t){var o=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ne.log("Binding events to new room form",{estimateId:t,productId:i}),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(r){r.preventDefault(),o.modalManager.showLoading();var n=new FormData(e),s=n.get("room_name"),l=n.get("room_width"),d=n.get("room_length");return s?l&&d?void o.dataService.addNewRoom({room_name:s,room_width:l,room_length:d},t,i).then((function(e){if(ne.log("Room created successfully:",e),i){if(o.modalManager.productManager)return ne.log("[DEBUG][ROOM]".toJSON(e)),o.modalManager.productManager.addProductToRoom(t,e.room_id,i).then((function(){o.modalManager.hideLoading(),o.modalManager.estimateManager&&o.modalManager.estimateManager.showEstimatesList(t,e.room_id),o.modalManager&&o.modalManager.confirmationDialog?setTimeout((function(){o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.room_created_title","Room Created"),message:a.ig.get("messages.room_created_with_product","The room has been created and the product has been added."),type:"room",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}),100):ne.log("Room created and product added successfully.")})).catch((function(a){if(a&&a.data&&a.data.duplicate)return o.modalManager.estimateManager&&o.modalManager.estimateManager.showEstimatesList(t,e.room_id),void o.modalManager.hideLoading();throw ne.log("Error adding product to new room:",a),o.modalManager.hideLoading(),a}));ne.error("ProductManager not available for addProductToRoom"),o.modalManager.hideLoading(),o.modalManager.estimateManager&&o.modalManager.estimateManager.showEstimatesList(t,e.id),o.modalManager&&o.modalManager.confirmationDialog?setTimeout((function(){o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.room_created_title","Room Created"),message:a.ig.get("messages.room_created","The room has been created."),type:"room",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}),100):ne.log("Room created successfully.")}else o.modalManager.hideLoading(),o.modalManager.estimateManager?(o.modalManager.estimateManager.showEstimatesList(t,e.id),o.modalManager&&o.modalManager.confirmationDialog?setTimeout((function(){o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.room_created_title","Room Created"),message:a.ig.get("messages.room_created","The room has been created."),type:"room",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}),100):ne.log("Room created successfully.")):o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.room_created_title","Room Created"),message:a.ig.get("messages.room_created","The room has been created."),type:"room",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK"),onConfirm:function(){o.modalManager.closeModal()}}):(ne.log("Room created successfully."),o.modalManager.closeModal())})).catch((function(e){ne.error("Error creating room:",e),o.modalManager.showError("Error creating room. Please try again."),o.modalManager.hideLoading()})):(o.modalManager.showError("Please enter room dimensions."),void o.modalManager.hideLoading()):(o.modalManager.showError("Please enter a room name."),void o.modalManager.hideLoading())},e.addEventListener("submit",e._submitHandler);var r=e.querySelector(".cancel-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),i?o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(i):o.modalManager.closeModal():o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList():o.modalManager.closeModal()},r.addEventListener("click",r._clickHandler));var n=e.querySelector(".back-button");n&&(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),i?o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(i):o.modalManager.closeModal():o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList():o.modalManager.closeModal()},n.addEventListener("click",n._clickHandler))}else ne.error("Form element not available for binding events")}},{key:"handleRoomRemoval",value:function(e,t){var o=this;if(ne.log("Handling room removal",{estimateId:e,roomId:t}),!this.modalManager||!this.modalManager.confirmationDialog)return ne.error("ConfirmationDialog not available"),void(confirm(a.ig.get("ui_elements.remove_room_message","Are you sure you want to remove this room? All products in this room will also be removed. This action cannot be undone."))&&this.performRoomRemoval(e,t));this.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.remove_room_title","Remove Room"),message:a.ig.get("ui_elements.remove_room_message","Are you sure you want to remove this room? All products in this room will also be removed. This action cannot be undone."),confirmText:a.ig.get("buttons.delete","Delete"),cancelText:a.ig.get("buttons.cancel","Cancel"),type:"room",action:"delete",onConfirm:function(){o.performRoomRemoval(e,t)},onCancel:function(){ne.log("Room removal cancelled by user")}})}},{key:"performRoomRemoval",value:function(e,t){var o=this;ne.log("Performing room removal",{estimateId:e,roomId:t}),this.modalManager.showLoading(),this.dataService.removeRoom(e,t).then((function(){ne.log("Room removed successfully from localStorage");var i=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));i||(i=document.querySelector('.accordion-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'))),i?(i.remove(),ne.log("Room element removed from DOM"),ne.log("Room element removed. Will check localStorage for remaining rooms.")):(ne.warn("Room element not found for removal with ID ".concat(t)),o.modalManager.estimateManager&&o.modalManager.estimateManager.showEstimatesList(null,e)),o.dataService.getEstimate(e).then((function(t){var o=t&&t.rooms&&Object.keys(t.rooms).length>0,i=document.querySelector('.estimate-item[data-estimate-id="'.concat(e,'"]'));if(i){var r=i.querySelector(".estimate-total-value");r&&(r.textContent=a.GP.currency(t.total||0));var n=i.querySelector(".estimate-rooms-container");if(n){var s=n.querySelectorAll(".room-item, .accordion-item"),l=s.length>0;o&&l||(ne.log("No rooms remaining in estimate, showing empty rooms template",{hasRoomsInStorage:o,roomCountInDOM:s.length}),n.innerHTML="",V.A.insert("rooms-empty-template",{},n))}}})).catch((function(e){ne.error("Error updating estimate totals after room removal:",e)})).finally((function(){o.modalManager.hideLoading()}))})).catch((function(e){ne.error("Error removing room:",e),o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.general_error","Error removing room. Please try again."),confirmText:a.ig.get("buttons.ok","OK"),cancelText:!1,onConfirm:function(){ne.log("Error dialog closed")}}):o.modalManager.showError(a.ig.get("messages.general_error","Error removing room. Please try again.")),o.modalManager.hideLoading()}))}},{key:"updateRoomTotals",value:function(e,t,o){var i=this;ne.log("Updating room totals",{estimateId:e,roomId:t,totals:o});var r=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(!r)return ne.warn("Room element not found for updating totals - will be updated on next view refresh",{estimateId:e,roomId:t}),this.pendingTotals=this.pendingTotals||{},void(this.pendingTotals["".concat(e,":").concat(t)]=o);var n=r.querySelector(".room-price");n?n.textContent=a.GP.currency(o.total||0):ne.warn("Room price element not found in room",{estimateId:e,roomId:t}),this.dataService.getEstimate(e).then((function(t){var o=document.querySelector('.estimate-item[data-estimate-id="'.concat(e,'"]'));if(o){var r=o.querySelector(".estimate-total-value");r&&(r.textContent=a.GP.currency(t.total||0))}var n=document.querySelector('.estimate-section[data-estimate-id="'.concat(e,'"]'));if(n){var s=n.querySelector(".estimate-actions");if(s&&i.modalManager.estimateManager){var l=i.modalManager.estimateManager.estimateHasProducts(t);ne.log("Updating estimate actions visibility for ".concat(e,": ").concat(l)),s.style.display=l?"block":"none"}}})).catch((function(e){ne.error("Error updating estimate totals:",e)}))}},{key:"updateRoomPrimaryProduct",value:function(e,t){var o,a;ne.log("Updating room primary product display",{estimateId:e,roomId:t});var i=null===(o=P().estimates)||void 0===o?void 0:o[e],r=null==i||null===(a=i.rooms)||void 0===a?void 0:a[t];if(r){var n=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(n){var s=null,l=null;if(ne.log("Looking for primary product in room:",{roomName:r.name,primaryCategoryProductId:r.primary_category_product_id,productsObject:r.products,productsKeys:r.products?Object.keys(r.products):[]}),r.primary_category_product_id&&r.products){var d=r.products[r.primary_category_product_id];d&&(s=d.image||null,l=d.name||null,ne.log("Primary product found:",{productId:r.primary_category_product_id,image:s,name:l}))}var c=n.querySelector(".primary-product-image");c&&(s?(c.src=s,c.style.display=""):(c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",c.style.display="none"));var u=n.querySelector(".primary-product-name");u&&(u.textContent=l||"",u.style.display=l?"":"none"),ne.log("Room primary product display updated",{hasPrimaryProduct:!!s,primaryProductName:l})}else ne.warn("Room element not found in DOM for primary product update",{estimateId:e,roomId:t})}else ne.warn("Room not found in storage for primary product update",{estimateId:e,roomId:t})}},{key:"onModalClosed",value:function(){ne.log("RoomManager: Modal closed"),this.currentEstimateId=null,this.currentProductId=null}},{key:"updateRoomIncludes",value:function(e,t){var o,a,i=this;ne.log("Updating room includes",{estimateId:e,roomId:t});var r=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(r){var n=null===(o=P().estimates)||void 0===o?void 0:o[e],s=null==n||null===(a=n.rooms)||void 0===a?void 0:a[t];if(s){var l=this.aggregateProductIncludes(s);if(this.renderRoomIncludes(l,r,t,e),s.products&&Object.keys(s.products).length>0){var d=r.querySelector(".similar-products-toggle"),c=r.querySelector(".similar-products-container");if(d){d.style.display="",d.classList.add("expanded");var u=d.querySelector(".toggle-icon");u&&(u.classList.remove("dashicons-arrow-down-alt2"),u.classList.add("dashicons-arrow-up-alt2"))}c&&(c.style.display="",c.classList.add("visible"))}setTimeout((function(){i.initializeSimilarProductsForRoom(e,t,!1)}),300)}else ne.warn("Room not found in storage for includes update",{estimateId:e,roomId:t})}else ne.warn("Room element not found for updating includes",{estimateId:e,roomId:t})}},{key:"initializeSimilarProductsForRoom",value:function(e,t){var o,a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ne.log("Initializing similar products for room",{estimateId:e,roomId:t,forceRefresh:i});var r=null===(o=P().estimates)||void 0===o||null===(o=o[e])||void 0===o||null===(o=o.rooms)||void 0===o?void 0:o[t];if(r){var n=Object.keys(r.products||{});if(0!==n.length){if(!document.querySelector('.room-item[data-room-id="'.concat(t,'"]')))return ne.warn("Room element not found in DOM, deferring similar products initialization"),void setTimeout((function(){a.initializeSimilarProductsForRoom(e,t,i)}),100);var s=r.width*r.length;this.loadSimilarProductsForRoom(e,t,n,s,i)}else{ne.log("No products in room, skipping similar products initialization");var l=document.querySelector('.room-item[data-room-id="'.concat(t,'"]'));if(l){var d=l.querySelector(".similar-products-toggle"),c=l.querySelector(".similar-products-container");d&&(d.style.display="none"),c&&c.classList.remove("visible")}}}else ne.warn("Room not found for similar products initialization")}},{key:"loadSimilarProductsForRoom",value:function(e,t,o,a){var i,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];ne.log("Loading similar products for room",{estimateId:e,roomId:t,productIds:o,roomArea:a,forceRefresh:r});var n=document.querySelector('.room-item[data-room-id="'.concat(t,'"]'));if(n){var s=n.querySelector(".similar-products-list"),l=n.querySelector(".similar-products-container"),u=n.querySelector(".similar-products-toggle");if(s&&l){var m=null===(i=P().estimates)||void 0===i||null===(i=i[e])||void 0===i||null===(i=i.rooms)||void 0===i?void 0:i[t],g=[],p=[],h=null;o.forEach((function(e){var t,o=null==m||null===(t=m.products)||void 0===t?void 0:t[e];if(ne.log("Processing product ".concat(e,":"),{hasProduct:!!o,hasSimilarProducts:!(null==o||!o.similar_products),similarProductsType:Array.isArray(null==o?void 0:o.similar_products)?"array":(0,c.A)(null==o?void 0:o.similar_products),hasSimilarProductsSection:!(null==o||!o.similar_products_section),forceRefresh:r}),null!=o&&o.similar_products&&!r){var a=Array.isArray(o.similar_products)?o.similar_products:Object.values(o.similar_products),i=a.map((function(t){return re(re({},t),{},{sourceProductId:e})}));g.push.apply(g,(0,d.A)(i)),ne.log("Found ".concat(a.length," similar products for product ").concat(e," in localStorage")),!h&&o.similar_products_section&&(h=o.similar_products_section,ne.log("Found similar products section info in localStorage:",h))}else p.push(e),r?ne.log("Forcing refresh of similar products for product ".concat(e)):o?ne.log("Product ".concat(e," has no similar products in localStorage")):ne.log("Product ".concat(e," not found in room data"))}));var v={};g.forEach((function(e){v[e.id]||(v[e.id]=e)}));var f=Object.values(v);ne.log("Rendering ".concat(f.length," similar products from localStorage")),this.renderSimilarProductsList(s,l,u,f,e,t,o,n,h)}else ne.warn("Similar products list or container not found in room element")}else ne.warn("Room element not found in DOM")}},{key:"renderSimilarProductsList",value:function(e,t,o,i,r,n,s,l){var d=this,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(0===i.length)return e.innerHTML='<div class="no-similar-products">No similar products available</div>',o&&(o.style.display="none"),void(t&&(t.classList.remove("visible"),t.classList.remove("has-similar-products")));if(t&&t.classList.add("has-similar-products"),e.innerHTML="",c){var u=t.querySelector(".similar-products-section-header");u&&u.remove();var m=document.createElement("div");if(m.className="similar-products-section-header",c.section_title){var g=document.createElement("h6");g.className="similar-products-section-title",g.textContent=c.section_title,m.appendChild(g)}if(c.section_description){var p=document.createElement("p");p.className="similar-products-section-description",p.textContent=c.section_description,m.appendChild(p)}var h=t.querySelector(".product-similar-products");h?t.insertBefore(m,h):t.insertBefore(m,t.firstChild)}i.forEach((function(t){var o=re(re({},t),{},{id:t.id||t.product_id,product_id:t.id||t.product_id,estimate_id:r,room_id:n,name:t.name||t.product_name||"Similar Product",product_name:t.name||t.product_name||"Similar Product",price:t.price||t.regular_price||0,product_price:a.GP.currency(t.price||t.regular_price||0),image:t.image||t.product_image||"",product_img:t.image||t.product_image||"",pricing_method:t.pricing_method||"sq_ft",replace_product_id:t.sourceProductId||s[0]||""});ne.log("Rendering similar product with data:",o),V.A.insert("similar-product-item-template",o,e);var i=e.lastElementChild;if(i){var l=i.querySelector(".replace-product-in-room");l&&l.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();var t=l.dataset.productId,o=l.dataset.replaceProductId,a=l.dataset.roomId,i=l.dataset.estimateId;ne.log("Replace button clicked",{productId:t,replaceProductId:o,roomId:a,estimateId:i}),d.modalManager&&d.modalManager.productManager?d.modalManager.productManager.handleProductVariationSelection(t,{action:"replace",estimateId:i,roomId:a,replaceProductId:o,button:l}):ne.error("ProductManager not available for product replacement")}))}}));var v=l.querySelector(".similar-products-carousel");v&&i.length>0&&(ne.log("Initializing similar products carousel manually"),setTimeout((function(){v.carouselInstance||new ae(v)}),100)),o&&(o.style.display="block"),ne.log("Rendered ".concat(e.length," similar products for room ").concat(n))}}])}();var le=(0,a.h)("ProductManager"),de=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,i.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.currentRoomId=null,this.currentEstimateId=null,this.currentProductId=null,this.showProductSelection=this.showProductSelection.bind(this),this.addProductToRoom=this.addProductToRoom.bind(this),this.handleProductRemoval=this.handleProductRemoval.bind(this),this.renderProduct=this.renderProduct.bind(this),this.handleVariationSelection=this.handleVariationSelection.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){this.bindEvents(),le.log("ProductManager initialized")}},{key:"bindEvents",value:function(){le.log("ProductManager events bound")}},{key:"loadProductsForRoom",value:function(e,t,o){return le.warn("loadProductsForRoom is deprecated - products are now displayed as part of room-item template"),Promise.resolve([])}},{key:"showProductSelection",value:function(e,t){var o=this;le.log("Showing product selection",{estimateId:e,roomId:t}),this.currentRoomId=t,this.currentEstimateId=e;var i=prompt("Enter a product ID to add:");i&&this.addProductToRoom(e,t,i).then((function(){if(o.modalManager){var e=o.modalManager.confirmationDialog;e?e.show({title:a.ig.get("ui_elements.success_title","Success"),message:a.ig.get("messages.product_added_success","Product added successfully!"),type:"product",action:"add",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")}):(le.warn("ConfirmationDialog not available, using console log instead"),le.log("Product added successfully!"))}})).catch((function(e){if(le.error("Error adding product to room:",e),o.modalManager){var t=o.modalManager.confirmationDialog;t?t.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.product_add_error","Error adding product. Please try again."),type:"product",action:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")}):(le.warn("ConfirmationDialog not available, using console log instead"),le.error("Error adding product. Please try again."))}}))}},{key:"addProductToRoom",value:function(e,t,o){var i=this;if(le.log("Adding product to room",{estimateId:e,roomId:t,productId:o}),!o){var r="Product ID is required to add a product to a room";return le.log(r),Promise.reject(new Error(r))}return this.modalManager&&this.modalManager.showLoading(),this.dataService.addProductToRoom(t,o,e).then((function(o){if(o&&!o.success&&o.primaryConflict)throw o;if(le.log("Product added successfully:",o),"estimate_".concat(e),i.dataService.invalidateCache("rooms"),le.log("Invalidated room cache for estimate ".concat(e)),i.modalManager&&i.modalManager.roomManager&&o&&o.room_totals)try{i.modalManager.roomManager.updateRoomTotals(e,t,{total:o.room_totals.min_total||0})}catch(e){le.log("Non-critical error updating room totals UI")}if(i.modalManager&&i.modalManager.roomManager)try{i.modalManager.roomManager.updateRoomIncludes(e,t)}catch(e){le.log("Non-critical error updating room includes UI")}if(i.modalManager&&i.modalManager.roomManager)try{i.modalManager.roomManager.initializeSimilarProductsForRoom(e,t,!0)}catch(e){le.log("Non-critical error updating similar products UI:",e)}return i.modalManager&&i.modalManager.hideLoading(),o})).catch((function(e){if(e&&e.data&&e.data.duplicate)return i.modalManager&&i.modalManager.hideLoading(),i.modalManager&&i.modalManager.confirmationDialog&&i.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.product_exists_title","Product Already Exists"),message:e.message||a.ig.get("messages.product_already_exists","This product already exists in the selected room."),type:"product",action:"warning",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")}),Promise.reject(e);if(!0===e.primaryConflict){if(i.modalManager&&i.modalManager.hideLoading(),i.modalManager&&i.modalManager.confirmationDialog){var t=i.modalManager.roomManager?i.modalManager.roomManager.getRoomName(e.estimateId,e.roomId):"selected room";i.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.product_conflict_title","A flooring product already exists in the selected room"),message:a.ig.format("messages.product_conflict",{room_name:t,existing_product:e.existingProductName,new_product:e.newProductName},"The ".concat(t,' already contains "').concat(e.existingProductName,'". Would you like to replace it with "').concat(e.newProductName,'"?')),type:"product",action:"replace",confirmText:a.ig.get("buttons.replace_existing_product","Replace the existing product"),cancelText:a.ig.get("buttons.go_back_to_room_select","Go back to room select"),additionalButtons:[{text:a.ig.get("buttons.cancel","Cancel"),callback:function(){}}],onConfirm:function(){i.replaceProductInRoom(e.estimateId,e.roomId,e.existingProductId,e.newProductId)},onCancel:function(){i.modalManager&&i.modalManager.roomManager.showRoomSelection(e.estimateId)}})}return Promise.reject(e)}if(e&&e.data&&e.data.primary_conflict)return i.modalManager&&i.modalManager.hideLoading(),i.modalManager&&i.modalManager.confirmationDialog&&i.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.primary_conflict_title","Primary Product Category Conflict"),message:e.message||e.data.message,type:"product",action:"replace",confirmText:a.ig.get("buttons.replace_existing_product","Replace existing product"),cancelText:a.ig.get("buttons.back","Back"),additionalButtons:[{text:a.ig.get("buttons.cancel","Cancel"),callback:function(){}}],onConfirm:function(){var t=e.data.new_product_id,o=e.data.existing_product_id,a=e.data.room_id,r=e.data.estimate_id;i.replaceProductInRoom(r,a,o,t)},onCancel:function(){}}),Promise.reject(e);throw le.log("Error adding product to room:",e),i.modalManager&&i.modalManager.hideLoading(),e}))}},{key:"renderProduct",value:function(e,t,o,a,i){return le.log("Rendering product",{index:t,roomId:o,estimateId:a,product:e}),i?(le.warn("renderProduct method is deprecated - products are now rendered as part of room-item template"),null):(le.error("Container not provided for rendering product"),null)}},{key:"bindProductEvents",value:function(e,t,o,a,i){le.log("Binding events to product element is deprecated",{index:o,roomId:a,estimateId:i})}},{key:"handleProductRemoval",value:function(e,t,a,i){var r=this;if(le.log("Handling product removal",{estimateId:e,roomId:t,productIndex:a,productId:i}),this.modalManager)return this.modalManager.confirmationDialog?void this._showProductRemovalDialog(e,t,a,i):(le.warn("ConfirmationDialog not available via ModalManager, creating one"),void Promise.resolve().then(o.bind(o,160)).then((function(o){var n=o.default;r.modalManager.confirmationDialog=new n,r._showProductRemovalDialog(e,t,a,i)})).catch((function(e){le.error("Error importing ConfirmationDialog:",e)})));le.error("ModalManager not available for product removal")}},{key:"_showProductRemovalDialog",value:function(e,t,o,i){var r=this;le.log("Showing product removal dialog with params:",{estimateId:e,roomId:t,productIndex:o,productId:i}),this.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.remove_product_title","Remove Product"),message:a.ig.get("messages.confirm_product_remove","Are you sure you want to remove this product from the room?"),confirmText:a.ig.get("buttons.delete","Delete"),cancelText:a.ig.get("buttons.cancel","Cancel"),type:"product",action:"delete",onConfirm:function(){r.performProductRemoval(e,t,o,i)},onCancel:function(){le.log("Product removal cancelled by user")}})}},{key:"performProductRemoval",value:function(e,t,o,i){var r=this;if(le.log("Performing product removal",{estimateId:e,roomId:t,productIndex:o,productId:i}),!i||"undefined"===i){var n=new Error("Cannot remove product: Invalid product ID (".concat(i,")"));return le.error(n),void(this.modalManager&&(this.modalManager.hideLoading(),this.modalManager.confirmationDialog&&this.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.product_remove_error","Could not identify the product to remove."),type:"product",action:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})))}this.modalManager&&this.modalManager.showLoading(),this.dataService.removeProductFromRoom(e,t,o,i).then((function(a){le.log("Product removed successfully:",a);var n=document.querySelector('.product-item[data-product-id="'.concat(i,'"][data-room-id="').concat(t,'"][data-estimate-id="').concat(e,'"], ')+'.product-item[data-product-index="'.concat(o,'"][data-room-id="').concat(t,'"][data-estimate-id="').concat(e,'"]'));if(n){n.remove();var s=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"] .product-list, ')+'.accordion-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"] .product-list'));s&&0===s.querySelectorAll(".product-item").length&&(le.log("No products remaining in room, showing empty products template"),s.innerHTML="",V.A.insert("products-empty-template",{},s))}else le.log("Product element not found in DOM after removal. It may have been removed already.");if(r.modalManager&&r.modalManager.roomManager){r.modalManager.roomManager.updateRoomTotals(e,t,{total:a.roomTotal}),r.modalManager.roomManager.updateRoomPrimaryProduct(e,t);try{r.modalManager.roomManager.updateRoomIncludes(e,t)}catch(e){le.log("Non-critical error updating room includes UI after product removal")}try{r.modalManager.roomManager.initializeSimilarProductsForRoom(e,t)}catch(e){le.log("Non-critical error updating similar products UI after product removal:",e)}}r.modalManager&&r.modalManager.hideLoading()})).catch((function(e){le.error("Error removing product:",e),r.modalManager?(r.modalManager.hideLoading(),r.modalManager.confirmationDialog?r.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.product_remove_error","Error removing product. Please try again."),type:"product",action:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")}):r.modalManager.showError("Error removing product. Please try again.")):le.error("Error removing product. Please try again.")}))}},{key:"handleVariationSelection",value:function(e,t,o,i,r,n){var s=this;le.log("Handling variation selection",{variationId:e,estimateId:o,roomId:i,productIndex:r,productId:n}),t?(this.modalManager&&this.modalManager.showLoading(),this.dataService.updateProductVariation(o,i,r,e).then((function(e){le.log("Variation updated successfully:",e);var r=t.querySelector(".product-price");if(r&&e.updatedProduct&&(r.textContent=a.GP.currency(e.updatedProduct.price||0)),s.modalManager&&s.modalManager.roomManager){s.modalManager.roomManager.updateRoomTotals(o,i,{total:e.roomTotal});try{s.modalManager.roomManager.updateRoomIncludes(o,i)}catch(e){le.log("Non-critical error updating room includes UI after variation change")}}s.modalManager&&s.modalManager.hideLoading()})).catch((function(e){le.error("Error updating variation:",e);var n=t.querySelector(".variation-select");if(n&&s.dataService.getProductsForRoom(o,i).then((function(e){var t=e[r];t&&t.selectedVariation?n.value=t.selectedVariation:n.value=""})).catch((function(){n.value=""})),s.modalManager){s.modalManager.hideLoading();var l=s.modalManager.confirmationDialog;l?l.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.general_error","Error updating variation. Please try again."),type:"product",action:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")}):s.modalManager.showError("Error updating variation. Please try again.")}else le.error("Error updating variation. Please try again.")}))):le.error("Product element not provided for variation selection")}},{key:"replaceProductInRoom",value:function(e,t,o,i){var r=this;le.log("Replacing product in room",{estimateId:e,roomId:t,oldProductId:o,newProductId:i}),this.modalManager&&this.modalManager.showLoading(),this.dataService.replaceProductInRoom(e,t,o,i).then((function(){if(le.log("Product replaced successfully"),r.modalManager&&r.modalManager.hideLoading(),r.modalManager&&r.modalManager.estimateManager)r.modalManager.estimateManager.showEstimatesList(e,t),setTimeout((function(){r.modalManager.roomManager&&r.modalManager.roomManager.initializeSimilarProductsForRoom(e,t)}),300),setTimeout((function(){r.modalManager.confirmationDialog&&r.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.product_replaced_title","Product Replaced Successfully"),message:a.ig.get("messages.product_replaced_success","The product has been successfully replaced in your estimate."),type:"success",action:"success",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}),200);else{var o=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(o){var i=o.querySelector(".room-products-container");i&&(delete i.dataset.loaded,r.loadProductsForRoom(e,t,i))}}})).catch((function(e){le.error("Error replacing product:",e),r.modalManager&&r.modalManager.hideLoading(),r.modalManager&&r.modalManager.confirmationDialog&&r.modalManager.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("messages.general_error","Error replacing product. Please try again."),type:"product",action:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})}))}},{key:"onModalClosed",value:function(){le.log("ProductManager: Modal closed"),this.currentRoomId=null,this.currentEstimateId=null,this.currentProductId=null}},{key:"handleProductVariationSelection",value:function(e,t){var o=this,i=t.action,r=t.estimateId,n=t.roomId,s=t.replaceProductId,l=(t.room,t.button);le.log("Handling product variation selection for ".concat(i),{productId:e,estimateId:r,roomId:n});var d=null;return l&&(d={text:l.textContent,disabled:l.disabled},l.disabled=!0,l.innerHTML='<span class="spinner"></span> '.concat(a.ig.get("ui_elements.loading","Loading...")),l.classList.add("loading")),this.dataService.getProductVariationData(e).then((function(t){if(t&&t.isVariable&&t.variations&&t.variations.length>0){var c={id:e,name:t.productName||"Product",variations:t.variations,attributes:t.attributes};return le.log("Product has variations, showing selection dialog"),l&&d&&(l.innerHTML=d.text,l.disabled=d.disabled,l.classList.remove("loading")),new Promise((function(e,t){o.modalManager.productSelectionDialog?o.modalManager.productSelectionDialog.show({product:c,variations:c.variations,attributes:c.attributes||{},action:i,onSelect:function(d){le.log("Variation selected:",d);var c=d.variationId;c?(l&&(l.innerHTML='<span class="spinner"></span> '.concat(a.ig.get("ui_elements.loading","Loading...")),l.disabled=!0,l.classList.add("loading")),"add"===i?e(o.addProductToRoom(r,n,c)):"replace"===i?e(o.replaceProductInRoom(r,n,s,c)):t(new Error("Unknown action: ".concat(i)))):t(new Error("No variation selected"))},onCancel:function(){le.log("Variation selection cancelled"),l&&d&&(l.innerHTML=d.text,l.disabled=d.disabled,l.classList.remove("loading"),l.dataset.processing="false"),t(new Error("Variation selection cancelled"))}}):t(new Error("Product selection dialog not available"))}))}if(le.log("Product has no variations, proceeding directly"),"add"===i)return o.addProductToRoom(r,n,e);if("replace"===i)return o.replaceProductInRoom(r,n,s,e);throw new Error("Unknown action: ".concat(i))})).finally((function(){l&&d&&(l.innerHTML=d.text,l.disabled=d.disabled,l.classList.remove("loading"),l.dataset&&(l.dataset.processing="false"))}))}}])}();const ce=de;var ue=(0,a.h)("FormManager"),me=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,i.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.currentForm=null,this.bindNewEstimateFormEvents=this.bindNewEstimateFormEvents.bind(this),this.bindNewRoomFormEvents=this.bindNewRoomFormEvents.bind(this),this.loadEstimateSelectionForm=this.loadEstimateSelectionForm.bind(this),this.cancelForm=this.cancelForm.bind(this),this.validateForm=this.validateForm.bind(this),this.showError=this.showError.bind(this),this.clearErrors=this.clearErrors.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){ue.log("FormManager initialized")}},{key:"bindNewEstimateFormEvents",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(ue.log("Binding events to new estimate form",{productId:o}),e){this.currentForm=e,o?e.dataset.productId=o:delete e.dataset.productId,e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(a){var i;if(a.preventDefault(),t.clearErrors(e),!t.validateForm(e))return ue.log("Form validation failed - stopping form submission"),a.stopPropagation(),!1;t.modalManager&&t.modalManager.showLoading();var r=new FormData(e),n=r.get("estimate_name"),s=r.get("customer_postcode"),l=null===(i=window.productEstimator)||void 0===i||null===(i=i.core)||void 0===i?void 0:i.customerDetailsManager;l&&s&&""!==s.trim()&&l.updatePostcodeIfNew(s);var d={estimate_name:n};s&&(d.customer_postcode=s),t.dataService.addNewEstimate(d).then((function(e){if(ue.log("Estimate created successfully:",e),o){var a=e.estimate_id;if(!a)return ue.error("No estimate ID returned from server. Cannot create room."),t.modalManager.hideLoading(),void t.showPartialSuccessMessage("Estimate created successfully, but there was an error adding a room.");t.modalManager&&t.modalManager.roomManager?(ue.log("Transitioning to new room form with estimate ID:",a),t.modalManager.roomManager.showNewRoomForm(a,o)):(ue.error("RoomManager not available for showNewRoomForm"),t.modalManager&&t.modalManager.hideLoading(),t.showSuccessMessage("Estimate created successfully."))}else{var i=e.estimate_id;if(!i)return ue.error("No estimate ID returned from server. Cannot show estimate."),t.modalManager.hideLoading(),void t.showSuccessMessage("Estimate created successfully.");t.modalManager&&t.modalManager.estimateManager?(ue.log("Transitioning to estimates list with estimate ID:",i),t.modalManager.estimateManager.showEstimatesList(null,i)):(t.modalManager&&t.modalManager.hideLoading(),t.showSuccessMessage("Estimate created successfully."))}})).catch((function(o){ue.error("Error creating estimate:",o),t.showError(e,"Error creating estimate. Please try again."),t.modalManager&&t.modalManager.hideLoading()}))},e.addEventListener("submit",e._submitHandler);var a=e.querySelector(".cancel-btn, .cancel-button");a?(a._clickHandler&&a.removeEventListener("click",a._clickHandler),a._clickHandler=function(e){e.preventDefault(),ue.log("Cancel button clicked in new estimate form"),t.cancelForm("estimate")},a.addEventListener("click",a._clickHandler),ue.log("Cancel button handler attached to new estimate form")):(ue.log("Cancel button not found in new estimate form"),ue.log("Form element structure:",e.innerHTML))}else ue.error("Form element not available for binding events")}},{key:"bindNewRoomFormEvents",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ue.log("Binding events to new room form",{estimateId:t,productId:a}),e){this.currentForm=e,e.dataset.estimateId=t,a?e.dataset.productId=a:delete e.dataset.productId,e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(t){if(t.preventDefault(),o.clearErrors(e),!o.validateForm(e))return ue.log("Form validation failed - stopping form submission"),t.stopPropagation(),!1;o.modalManager&&o.modalManager.showLoading();var a=new FormData(e),i=a.get("room_name"),r=a.get("room_width"),n=a.get("room_length"),s=e.dataset.estimateId;if(!s)return o.showError(e,"No estimate ID found. Please try again."),void o.modalManager.hideLoading();var l=e.dataset.productId;o.dataService.addNewRoom({room_name:i,room_width:r,room_length:n},s,l).then((function(e){ue.log("Room created successfully:",e);var t=!0===e.product_added;if(l&&!t)o.modalManager&&o.modalManager.productManager?o.modalManager.productManager.addProductToRoom(s,e.room_id,l).then((function(){o.modalManager&&o.modalManager.hideLoading(),o.modalManager&&o.modalManager.estimateManager?(ue.log("Product added to room successfully, showing estimates list with new room expanded"),o.modalManager.estimateManager.showEstimatesList(s,e.room_id)):(ue.log("EstimateManager not available, showing success message"),o.showSuccessMessage("Room created and product added successfully!"))})).catch((function(e){ue.error("Error adding product to room:",e),o.modalManager&&o.modalManager.hideLoading(),o.showPartialSuccessMessage("Room created successfully, but product could not be added.")})):(ue.error("ProductManager not available for addProductToRoom"),o.modalManager&&o.modalManager.hideLoading(),o.showSuccessMessage("Room created successfully."));else if(t&&ue.log("Product was already added by the server, skipping client-side addition"),o.modalManager&&o.modalManager.estimateManager)o.modalManager.estimateManager.showEstimatesList(s,e.room_id);else{o.modalManager&&o.modalManager.hideLoading();var a=t?"Room created and product added successfully!":"Room created successfully.";o.showSuccessMessage(a)}})).catch((function(t){ue.error("Error creating room:",t),o.showError(e,"Error creating room. Please try again."),o.modalManager&&o.modalManager.hideLoading()}))},e.addEventListener("submit",e._submitHandler);var i=e.querySelector(".cancel-btn, .cancel-button");i?(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),ue.log("Cancel button clicked in new room form"),o.cancelForm("room",t,a)},i.addEventListener("click",i._clickHandler),ue.log("Cancel button handler attached to new room form")):(ue.log("Cancel button not found in new room form"),ue.log("Form element structure:",e.innerHTML));var r=e.querySelector(".back-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.cancelForm("room",t,a)},r.addEventListener("click",r._clickHandler))}else ue.error("Form element not available for binding events")}},{key:"loadEstimateSelectionForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ue.log("Loading estimate selection form",{productId:e}),this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimateSelection(e):ue.error("EstimateManager not available for showEstimateSelection")}},{key:"cancelForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(ue.log("Cancelling form",{formType:e,estimateId:t,productId:o}),e){case"estimate":o&&this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimateSelection(o):this.modalManager&&this.modalManager.closeModal();break;case"room":o&&this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimateSelection(o):t&&this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimatesList():this.modalManager&&this.modalManager.closeModal();break;default:this.modalManager&&this.modalManager.closeModal()}}},{key:"validateForm",value:function(e){var t=this;if(ue.log("Validating form",e),!e)return ue.error("Form not provided for validation"),!1;this.clearErrors(e);var o=!0;return e.querySelectorAll("[required]").forEach((function(a){a.value.trim()||(t.showError(e,"".concat(a.name," is required."),a),a.value="",a.dataset.validationFailed="true",o=!1)})),o?e.removeAttribute("data-validation-failed"):(ue.log("Form validation failed - form has errors"),e.dataset.validationFailed="true",e.hasAttribute("data-submitting")&&e.removeAttribute("data-submitting")),o}},{key:"showError",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ue.log("Showing error",{message:t,field:o}),e){var a=e.querySelector(".form-errors");if(a){var i=a.querySelector("p");if(i)i.textContent=t;else{var r=document.createElement("p");r.textContent=t,a.appendChild(r)}}else{var n=document.createElement("div");V.A.insert("form-error-template",{errorMessage:t},n),a=n.firstElementChild,e.insertBefore(a,e.firstChild)}if(o){o.classList.add("error-field"),o.setAttribute("aria-invalid","true");var s=o.closest(".form-group");s&&s.classList.add("has-error"),o.focus()}}else ue.error("Form not provided for showing error")}},{key:"clearErrors",value:function(e){if(ue.log("Clearing errors from form"),e){var t=e.querySelector(".form-errors");t&&t.remove(),e.querySelectorAll(".error-field").forEach((function(e){e.classList.remove("error-field"),e.removeAttribute("aria-invalid");var t=e.closest(".form-group");t&&t.classList.remove("has-error")})),e.querySelectorAll(".has-error").forEach((function(e){e.classList.remove("has-error")}))}else ue.error("Form not provided for clearing errors")}},{key:"showSuccessMessage",value:function(e){var t=this;ue.log("Showing success message",{message:e}),(0,a.Zj)(this.modalManager,e,"estimate",(function(){t.modalManager&&t.modalManager.estimateManager?(ue.log("Success dialog confirmed, showing estimates list"),t.modalManager.estimateManager.showEstimatesList()):(ue.log("EstimateManager not available, closing modal after success dialog"),t.modalManager&&t.modalManager.closeModal())}))||(ue.log("Success: ".concat(e)),this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimatesList():this.modalManager&&this.modalManager.closeModal())}},{key:"showPartialSuccessMessage",value:function(e){var t=this;ue.log("Showing partial success message as warning",{message:e}),(0,a.qW)(this.modalManager,e,"estimate",(function(){t.modalManager&&t.modalManager.estimateManager?(ue.log("Warning dialog confirmed, showing estimates list"),t.modalManager.estimateManager.showEstimatesList()):(ue.log("EstimateManager not available, closing modal after warning dialog"),t.modalManager&&t.modalManager.closeModal())}))||(ue.log("Warning: ".concat(e)),this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimatesList():this.modalManager&&this.modalManager.closeModal())}},{key:"onModalClosed",value:function(){ue.log("FormManager: Modal closed"),this.currentForm=null}}])}();const ge=me;var pe,he=(0,a.h)("ProductDetailsToggle"),ve=new(function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,e),this.config=Object.assign({debug:!1,selectors:{productToggleButton:".product-details-toggle",notesToggleButton:".product-notes-toggle",includesToggleButton:".product-includes-toggle",productItem:".product-item",roomItem:".room-item",similarProductsContainer:".similar-products-container",productIncludes:".product-includes",similarProducts:".product-similar-products",productNotes:".product-notes",notesContainer:".notes-container",includesContainer:".includes-container",suggestionsContainer:".suggestions-container"},i18n:{showProducts:"Similar Products",hideProducts:"Similar Products",showNotes:"Product Notes",hideNotes:"Product Notes",showIncludes:"Product Includes",hideIncludes:"Product Includes",showSuggestions:"Suggested Products",hideSuggestions:"Suggested Products",loading:"Loading..."}},t),this.initialized=!1,this.init()}),[{key:"init",value:function(){var e=this;this.initialized?he.log("Already initialized, skipping"):("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return e.setup()})):this.setup(),document.addEventListener("product_estimator_modal_loaded",(function(){he.log("Modal content loaded, initializing toggles"),e.setup()})),this.setupMutationObserver(),this.initialized=!0,he.log("ProductDetailsToggle initialized"))}},{key:"prepareSuggestionsToggle",value:function(){var e=this;if(window.productEstimatorVars.featureSwitches.suggested_products_enabled){var t=document.querySelectorAll(this.config.selectors.accordionContent);he.log("Found ".concat(t.length," accordion content elements to process for suggestions toggle")),t.forEach((function(t){if(!t.classList.contains("suggestions-toggle-processed")){var o=t.querySelector(e.config.selectors.productSuggestions);if(o){he.log("Found suggestions section, processing",o),t.classList.add("has-suggestions");var a=t.querySelector(e.config.selectors.suggestionsContainer);if(!a){if(he.log("Creating new suggestions container"),(a=document.createElement("div")).className="suggestions-container visible",o.parentNode!==a){var i=o.cloneNode(!0);a.appendChild(i),o.parentNode.removeChild(o)}t.appendChild(a)}var r=t.querySelector(e.config.selectors.suggestionsToggleButton);r||(he.log("Adding suggestions toggle button to accordion content"),(r=document.createElement("button")).className="product-suggestions-toggle expanded",r.setAttribute("data-toggle-type","suggestions"),r.innerHTML="\n        ".concat(e.config.i18n.hideSuggestions,'\n        <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n      '),t.insertBefore(r,a)),a.style.display="block",a.classList.add("visible"),t.classList.add("suggestions-toggle-processed"),he.log("Accordion content processed for suggestions toggle")}else he.log("No suggestions section found for accordion content, skipping",t)}}))}}},{key:"setupMutationObserver",value:function(){var e=this;new MutationObserver((function(t){var o=!1;t.forEach((function(t){t.addedNodes.length&&Array.from(t.addedNodes).forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&(t.matches(e.config.selectors.productItem)||t.matches(e.config.selectors.productToggleButton)||t.matches(e.config.selectors.notesToggleButton)||t.querySelector(e.config.selectors.productItem)||t.querySelector(e.config.selectors.productToggleButton)||t.querySelector(e.config.selectors.notesToggleButton))&&(o=!0)}))})),o&&(he.log("New toggle-related content detected, re-initializing"),setTimeout((function(){return e.setup()}),100))})).observe(document.body,{childList:!0,subtree:!0}),he.log("Mutation observer set up")}},{key:"setup",value:function(){he.log("Setting up product details toggles"),this.prepareNotesToggle(),this.prepareSuggestionsToggle(),this.bindEvents(),this.initializeAllCarousels()}},{key:"prepareProductsToggle",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.roomItem);he.log("Found ".concat(t.length," room items to process for similar products toggle")),t.forEach((function(t){t.classList.contains("products-toggle-processed")||(t.querySelector(e.config.selectors.similarProducts)?(t.classList.add("has-similar-products"),t.classList.add("products-toggle-processed"),he.log("Room item processed for similar products toggle (visibility managed elsewhere).")):t.classList.add("products-toggle-processed"))}))}},{key:"prepareNotesToggle",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.productItem);he.log("Found ".concat(t.length," product items to process for notes toggle")),t.forEach((function(t){if(!t.classList.contains("notes-toggle-processed")){var o=t.querySelector(e.config.selectors.productNotes);if(o){var a=!1,i=o.querySelectorAll(".product-note-item");if(i&&i.length>0&&(a=!0),t.dataset.additionalNotes)try{var r=JSON.parse(t.dataset.additionalNotes);Array.isArray(r)&&r.length>0&&r.some((function(e){return e&&(e.note_text||e.text)}))&&(a=!0)}catch(e){}if(o.querySelector(".product-notes-items")&&""!==o.querySelector(".product-notes-items").textContent.trim()&&(a=!0),!a){he.log("No valid notes found for product, skipping",t),t.classList.add("notes-toggle-processed");var n=t.querySelector(e.config.selectors.notesToggleButton),s=t.querySelector(e.config.selectors.notesContainer);return n&&(n.style.display="none"),void(s&&(s.style.display="none"))}he.log("Found notes section with content, processing",o),t.classList.add("has-notes");var l=t.querySelector(e.config.selectors.notesContainer);if(!l){if(he.log("Creating new notes container"),(l=document.createElement("div")).className="notes-container visible",o.parentNode!==l){var d=o.cloneNode(!0);l.appendChild(d),o.parentNode.removeChild(o)}t.appendChild(l)}var c=t.querySelector(e.config.selectors.notesToggleButton);if(c){c.classList.add("expanded");var u=c.querySelector(".toggle-icon");u&&(u.classList.remove("dashicons-arrow-down-alt2"),u.classList.add("dashicons-arrow-up-alt2"))}else he.log("Adding notes toggle button to product item"),(c=document.createElement("button")).className="product-notes-toggle expanded",c.setAttribute("data-toggle-type","notes"),c.innerHTML="\n      ".concat(e.config.i18n.hideNotes,'\n      <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n    '),t.insertBefore(c,l);l.style.display="block",l.classList.add("visible"),t.classList.add("notes-toggle-processed"),he.log("Product item processed for notes toggle")}else he.log("No notes section found for product item, skipping",t)}}))}},{key:"bindEvents",value:function(){var e=this;he.log("Skipping similar products toggle binding - handled by RoomManager");var t=document.querySelectorAll(this.config.selectors.notesToggleButton);if(he.log("Found ".concat(t.length," notes toggle buttons to bind")),t.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleNotes(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)})),he.log("Skipping includes toggle binding - handled by RoomManager"),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var o=document.querySelectorAll(this.config.selectors.suggestionsToggleButton);he.log("Found ".concat(o.length," suggestions toggle buttons to bind")),o.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleSuggestions(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)}))}he.log("All toggle events bound")}},{key:"toggleSuggestions",value:function(e){var t=e.closest(this.config.selectors.accordionContent);if(t){var o=t.querySelector(this.config.selectors.suggestionsContainer);if(o){var a=e.classList.contains("expanded");if(he.log("Suggestions toggle clicked, current expanded state: ".concat(a)),a){o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded");var i=e.querySelector(".toggle-icon");i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2")),e.innerHTML=e.innerHTML.replace(this.config.i18n.hideSuggestions,this.config.i18n.showSuggestions),he.log("Suggestions hidden")}else{o.classList.add("visible"),o.style.display="block",e.classList.add("expanded");var r=e.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),e.innerHTML=e.innerHTML.replace(this.config.i18n.showSuggestions,this.config.i18n.hideSuggestions),this.initializeCarousels(o),he.log("Suggestions shown")}}else he.log("Suggestions container not found")}else he.log("Accordion content not found for toggle button")}},{key:"toggleSimilarProducts",value:function(e){var t=e.closest(this.config.selectors.roomItem);if(t){var o=t.querySelector(this.config.selectors.similarProductsContainer);if(o){var a=e.classList.contains("expanded");he.log("Similar products toggle clicked, current expanded state: ".concat(a));var i=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2")),he.log("Similar products hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),i&&(i.classList.remove("dashicons-arrow-down-alt2"),i.classList.add("dashicons-arrow-up-alt2")),he.log("Similar products shown"),this.initializeCarousels(o))}else he.log("Similar products container not found")}else he.log("Room item not found for toggle button")}},{key:"toggleNotes",value:function(e){var t=e.closest(this.config.selectors.productItem);if(t){var o=t.querySelector(this.config.selectors.notesContainer);if(o){var a=e.classList.contains("expanded");he.log("Notes toggle clicked, current expanded state: ".concat(a));var i=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2")),he.log("Notes hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),i&&(i.classList.remove("dashicons-arrow-down-alt2"),i.classList.add("dashicons-arrow-up-alt2")),he.log("Notes shown"))}else he.log("Notes container not found")}else he.log("Product item not found for notes toggle button")}},{key:"initializeCarousels",value:function(){"function"==typeof window.initSuggestionsCarousels?(he.log("Initializing carousels in similar products container"),window.initSuggestionsCarousels()):"function"==typeof initSuggestionsCarousels?(he.log("Using local initSuggestionsCarousels function"),initSuggestionsCarousels()):he.log("Carousel initialization function not found",window.initSuggestionsCarousels)}},{key:"initializeAllCarousels",value:function(){"function"==typeof window.initSuggestionsCarousels?(he.log("Initializing all carousels"),window.initSuggestionsCarousels()):"function"==typeof initSuggestionsCarousels&&initSuggestionsCarousels()}},{key:"prepareIncludesToggle",value:function(){var e=this,t=document.querySelectorAll(".room-item");he.log("Found ".concat(t.length," room items to process for includes toggle")),t.forEach((function(t){if(!t.classList.contains("includes-toggle-processed")){var o=t.querySelector(e.config.selectors.productIncludes);if(o){he.log("Found includes section, processing",o),t.classList.add("has-includes");var a=t.querySelector(".includes-container");if(!a){if(he.log("Creating new includes container"),(a=document.createElement("div")).className="includes-container visible",o.parentNode!==a){var i=o.cloneNode(!0);a.appendChild(i),o.parentNode.removeChild(o)}t.appendChild(a)}var r=t.querySelector(".product-includes-toggle");if(r){r.classList.add("expanded");var n=r.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2"))}else he.log("Adding includes toggle button to item"),(r=document.createElement("button")).className="product-includes-toggle expanded",r.setAttribute("data-toggle-type","includes"),r.innerHTML="\n        ".concat(e.config.i18n.hideIncludes,'\n        <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n      '),t.insertBefore(r,a);a.style.display="block",a.classList.add("visible"),t.classList.add("includes-toggle-processed"),he.log("Item processed for includes toggle")}else he.log("No includes section found for item, skipping",t)}}))}},{key:"toggleIncludes",value:function(e){var t=e.closest(".room-item");if(t){var o=t.querySelector(".includes-container");if(o){var a=e.classList.contains("expanded");he.log("Includes toggle clicked, current expanded state: ".concat(a));var i=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2")),he.log("Includes hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),i&&(i.classList.remove("dashicons-arrow-down-alt2"),i.classList.add("dashicons-arrow-up-alt2")),he.log("Includes shown"))}else he.log("Includes container not found")}else he.log("Room item not found for includes toggle button")}}])}())({debug:(null===(pe=window.productEstimatorVars)||void 0===pe?void 0:pe.debug)||!1,i18n:{showProducts:a.ig.get("buttons.show_similar_products","Similar Products"),hideProducts:a.ig.get("buttons.hide_similar_products","Similar Products"),showNotes:a.ig.get("buttons.show_notes","Product Notes"),hideNotes:a.ig.get("buttons.hide_notes","Product Notes"),showIncludes:a.ig.get("buttons.show_includes","Product Includes"),hideIncludes:a.ig.get("buttons.hide_includes","Product Includes"),showSuggestions:a.ig.get("buttons.show_suggestions","Suggested Products"),hideSuggestions:a.ig.get("buttons.hide_suggestions","Suggested Products"),loading:a.ig.get("ui_elements.loading","Loading...")}}),fe=(0,a.h)("UIManager"),ye=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,i.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.estimatesList=null,this.carousels=[],this.productDetailsToggle=null,this.initializeCarousels=this.initializeCarousels.bind(this),this.bindSimilarProductsToggle=this.bindSimilarProductsToggle.bind(this),this.bindSuggestionsToggle=this.bindSuggestionsToggle.bind(this),this.bindProductDetailsToggles=this.bindProductDetailsToggles.bind(this),this.forceElementVisibility=this.forceElementVisibility.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){return this.estimatesList=this.modalManager.estimatesList,this.initializeProductDetailsToggle(),fe.log("UIManager initialized"),this}},{key:"initializeProductDetailsToggle",value:function(){this.productDetailsToggle=ve,fe.log("Product details toggle functionality initialized")}},{key:"onModalClosed",value:function(){fe.log("UIManager handling modal close event")}},{key:"initializeCarousels",value:function(){var e=this;fe.log("Initializing all carousels");var t=document.querySelectorAll(".suggestions-carousel");return this.carousels=[],t.forEach((function(t){if(!t.carouselInstance){var o=new ae(t);e.carousels.push(o)}})),this.carousels}},{key:"bindSimilarProductsToggle",value:function(){fe.log("Similar products toggle binding skipped - handled by RoomManager")}},{key:"toggleSimilarProducts",value:function(e){fe.log("toggleSimilarProducts called but is deprecated - should be handled by RoomManager")}},{key:"bindSuggestionsToggle",value:function(){var e,t=this;if(null!==(e=window.productEstimatorVars)&&void 0!==e&&null!==(e=e.featureSwitches)&&void 0!==e&&e.suggested_products_enabled){var o=document.querySelectorAll(".product-suggestions-toggle");fe.log("Found ".concat(o.length," suggestions toggle buttons to bind")),o.forEach((function(e){e._toggleBound||(e._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),t.toggleSuggestions(e)},e.addEventListener("click",e._toggleHandler),e._toggleBound=!0)})),fe.log("Suggestions toggle bound")}else fe.log("Suggestions feature is disabled, skipping toggle binding")}},{key:"toggleSuggestions",value:function(e){var t=e.closest(".accordion-content");if(t){var o=t.querySelector(".suggestions-container");if(o){var i=e.classList.contains("expanded");if(fe.log("Suggestions toggle clicked, current expanded state: ".concat(i)),i){o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),e.innerHTML="";var r=this.config.i18n||{};V.A.insert("toggle-button-show-template",{buttonText:r.showSuggestions||a.ig.get("buttons.show_suggestions","Show Suggestions")},e),fe.log("Suggestions hidden")}else{o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),e.innerHTML="";var n=this.config.i18n||{};V.A.insert("toggle-button-hide-template",{buttonText:n.hideSuggestions||a.ig.get("buttons.hide_suggestions","Hide Suggestions")},e),this.initializeCarouselInContainer(o),fe.log("Suggestions shown")}}else fe.log("Suggestions container not found")}else fe.log("Accordion content not found for toggle button")}},{key:"bindProductDetailsToggles",value:function(){this.productDetailsToggle?(this.productDetailsToggle.setup(),fe.log("Product details toggles bound via ProductDetailsToggle")):fe.warn("ProductDetailsToggle not initialized")}},{key:"createCarousel",value:function(e,t){if(fe.log("Creating carousel of type: ".concat(t)),!e)return fe.warn("Cannot create carousel - container not provided"),null;e.carouselInstance&&(fe.log("Container already has a carousel instance, destroying it first"),e.carouselInstance.destroy());var o=new ae(e);return fe.log("New carousel created",o),o}},{key:"initializeCarouselInContainer",value:function(e){if(e){fe.log("Initializing carousels in container");var t=e.querySelectorAll(".suggestions-carousel");fe.log("Found ".concat(t.length," carousel containers")),t.forEach((function(e){e.carouselInstance&&e.carouselInstance.destroy(),new ae(e)}))}else fe.warn("Cannot initialize carousels - container not provided")}},{key:"forceElementVisibility",value:function(e){if(!e)return null;try{e.classList.add("force-visible"),["hidden","hide","invisible","d-none","display-none"].forEach((function(t){e.classList.contains(t)&&e.classList.remove(t)})),e.classList.add("visible","d-block");for(var t=e.parentElement,o=new Set;t&&t!==document.body&&!o.has(t);)o.add(t),"none"===window.getComputedStyle(t).display&&t.classList.add("force-visible"),t=t.parentElement;fe.log("Element visibility forced using CSS classes")}catch(e){fe.error("Error forcing element visibility:",e)}return e}},{key:"showElement",value:function(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.forceElementVisibility(e):(e.classList.add("visible"),e.classList.remove("hidden"),e):null}},{key:"hideElement",value:function(e){return e?(e.classList.remove("visible","force-visible"),e.classList.add("hidden"),e):null}},{key:"toggleElement",value:function(e,t){return e?void 0===t?e.classList.contains("hidden")?this.showElement(e):this.hideElement(e):t?this.showElement(e):this.hideElement(e):null}}])}();const be=ye;var _e=(0,a.h)("ModalManager"),we=function(){return(0,r.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;(0,i.A)(this,e),this.config=Object.assign({debug:!1,selectors:{modalContainer:"#product-estimator-modal",estimatorButtons:".product-estimator-button, .single_add_to_estimator_button",modalOverlay:".product-estimator-modal-overlay",closeButton:".product-estimator-modal-close",contentContainer:".product-estimator-modal-form-container",loadingIndicator:".product-estimator-modal-loading",estimatesList:"#estimates",estimateSelection:"#estimate-selection-wrapper",roomSelection:"#room-selection-form-wrapper",newEstimateForm:"#new-estimate-form-wrapper",newRoomForm:"#new-room-form-wrapper"},i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.dataService=a,this.modal=null,this.overlay=null,this.closeButton=null,this.contentContainer=null,this.loadingIndicator=null,this.estimatesList=null,this.estimateSelection=null,this.estimateSelectionForm=null,this.roomSelectionForm=null,this.newEstimateForm=null,this.newRoomForm=null,this.isOpen=!1,this.currentView=null,this.currentProductId=null,this.initialized=!1,this.eventHandlers={},this.loadEstimateData=P,this.saveEstimateData=L,this.clearEstimateData=C,this.loadCustomerDetails=H,this.saveCustomerDetails=B,this.clearCustomerDetails=z,this.estimateManager=null,this.roomManager=null,this.productManager=null,this.formManager=null,this.uiManager=null,this.confirmationDialog=null,this.tooltip=null,this.estimateActions=null,this._modalClickHandler=this._modalClickHandler.bind(this),this.showLoading=this.showLoading.bind(this),this.hideLoading=this.hideLoading.bind(this),this.openModal=this.openModal.bind(this),this.closeModal=this.closeModal.bind(this),this.init()}),[{key:"init",value:function(){if(this.initialized)return _e.log("ModalManager already initialized"),this;_e.log("Initializing ModalManager");try{if(this.modal=document.querySelector(this.config.selectors.modalContainer),this.modal)_e.log("Found existing modal in DOM, initializing elements"),this.completeInitialization();else{if(_e.log("Modal element not found in DOM. Creating from template..."),this.modal=V.A.createModalContainer(),!this.modal)return _e.error("Failed to create modal from template"),this;_e.log("Modal created successfully from template"),this.completeInitialization()}this.initialized=!0,_e.log("ModalManager initialization completed successfully")}catch(e){_e.error("Error initializing ModalManager:",e)}return this}},{key:"completeInitialization",value:function(){var e=this;this.modal?(_e.log("Modal found, allowing time for DOM to fully update before initializing elements"),setTimeout((function(){e.initializeElements(),e.setupLoaderSafety(),e.initializeManagers(),e.bindEvents(),setTimeout((function(){e.ensureLoaderHidden()}),100),e.initialized=!0,_e.log("ModalManager initialization completed successfully")}),50)):_e.error("Cannot complete initialization - modal element not available")}},{key:"initializeElements",value:function(){_e.log("Initializing DOM elements");try{if(!this.modal)return void _e.error("Modal element not available for initializing elements");if(this.overlay=this.modal.querySelector(".product-estimator-modal-overlay"),this.closeButton=this.modal.querySelector(".product-estimator-modal-close"),this.contentContainer=this.modal.querySelector(".product-estimator-modal-form-container"),this.loadingIndicator=this.modal.querySelector(".product-estimator-modal-loading"),this.estimatesList=this.modal.querySelector("#estimates"),this.estimateSelection=this.modal.querySelector("#estimate-selection-wrapper"),this.estimateSelectionForm=this.modal.querySelector("#estimate-selection-form-wrapper"),this.roomSelectionForm=this.modal.querySelector("#room-selection-form-wrapper"),this.newEstimateForm=this.modal.querySelector("#new-estimate-form-wrapper"),this.newRoomForm=this.modal.querySelector("#new-room-form-wrapper"),_e.log("Container elements status:",{modal:this.modal?"found":"missing",contentContainer:this.contentContainer?"found":"missing",estimatesList:this.estimatesList?"found":"missing",estimateSelection:this.estimateSelection?"found":"missing",estimateSelectionForm:this.estimateSelectionForm?"found":"missing",roomSelectionForm:this.roomSelectionForm?"found":"missing",newEstimateForm:this.newEstimateForm?"found":"missing",newRoomForm:this.newRoomForm?"found":"missing"}),this.estimatesList||(_e.error("Critical: #estimates div not found in modal template!"),_e.log("Modal content structure:",this.modal.innerHTML.substring(0,500)+"...")),!this.loadingIndicator){_e.warn("Loading indicator not found, creating one");var e=document.createElement("div");e.className="product-estimator-modal-loading",V.A.insert("loading-placeholder-template",{loadingText:a.ig.get("ui.components.loading.general","Loading...")},e),this.modal.appendChild(e),this.loadingIndicator=e}_e.log("DOM elements initialized")}catch(e){_e.error("Error initializing DOM elements:",e)}}},{key:"initializeManagers",value:function(){_e.log("Initializing specialized managers"),this.estimateManager=new te(this.config,this.dataService,this),this.roomManager=new se(this.config,this.dataService,this),this.productManager=new ce(this.config,this.dataService,this),this.formManager=new ge(this.config,this.dataService,this),this.uiManager=new be(this.config,this.dataService,this),_e.log("Creating new ConfirmationDialog instance");try{this.confirmationDialog=new U.default,window.productEstimator||(window.productEstimator={}),window.productEstimator.dialog=this.confirmationDialog,_e.log("ConfirmationDialog instance created successfully and initialized")}catch(e){_e.error("Error creating ConfirmationDialog:",e)}_e.log("Initializing EstimateActions");try{this.estimateActions=new X({debug:this.config.debug,modalManager:this}),window.productEstimator.estimateActions=this.estimateActions,_e.log("EstimateActions initialized successfully")}catch(e){_e.error("Error initializing EstimateActions:",e)}_e.log("Creating ProductSelectionDialog instance");try{this.productSelectionDialog=new W(this,V.A),this.productManager&&(this.productManager.productSelectionDialog=this.productSelectionDialog),_e.log("ProductSelectionDialog instance created successfully")}catch(e){_e.error("Error creating ProductSelectionDialog:",e)}this.confirmationDialog?_e.log("ConfirmationDialog instance ready for use, elements will be created when needed"):_e.error("ConfirmationDialog instance was not created properly"),_e.log("Creating Tooltip instance");try{this.tooltip=new K(V.A),this.tooltip.init(),window.productEstimator||(window.productEstimator={}),window.productEstimator.tooltip=this.tooltip,_e.log("Tooltip instance created successfully and initialized")}catch(e){_e.error("Error creating Tooltip:",e)}this.estimateManager&&this.estimateManager.init(),this.roomManager&&this.roomManager.init(),this.productManager&&this.productManager.init(),this.formManager&&this.formManager.init(),this.uiManager&&this.uiManager.init(),_e.log("Specialized managers initialized")}},{key:"bindEvents",value:function(){var e=this;_e.log("Binding core modal events");try{this.modal&&this.modal.addEventListener("click",this._modalClickHandler),this.closeButton&&this.closeButton.addEventListener("click",(function(t){t.preventDefault(),e.closeModal()})),this.modal&&this.modal.addEventListener("click",(function(t){var o=t.target.closest(".replace-product-in-room");if(o){var i;if(t.preventDefault(),t.stopPropagation(),"true"===o.dataset.processing)return void _e.log("Replace button click ignored - already processing");o.dataset.processing="true";var r=o.dataset.productId,n=o.dataset.estimateId,s=o.dataset.roomId,l=o.dataset.replaceProductId;_e.log("Replace product button clicked",{productId:r,estimateId:n,roomId:s,replaceProductId:l});var d=e.dataService.getEstimate(n),c=null==d||null===(i=d.rooms)||void 0===i?void 0:i[s];e.productManager?e.productManager.handleProductVariationSelection(r,{action:"replace",estimateId:n,roomId:s,replaceProductId:l,room:c,button:o}).then((function(){_e.log("Product replacement completed successfully")})).catch((function(t){_e.error("Error handling product replacement:",t),"Variation selection cancelled"!==t.message&&e.confirmationDialog.show({title:a.ig.get("ui_elements.error_title","Error"),message:a.ig.get("errors.replace_product_error","Unable to replace product. Please try again."),type:"error",showCancel:!1,confirmText:a.ig.get("buttons.ok","OK")})})).finally((function(){o.dataset.processing="false"})):(_e.error("ProductManager not available for product replacement"),o.dataset.processing="false")}})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.isOpen&&e.closeModal()})),_e.log("Core modal events bound")}catch(e){_e.error("Error binding core modal events:",e)}}},{key:"_modalClickHandler",value:function(e){e.target===this.overlay&&this.closeModal()}},{key:"showLoading",value:function(){var e=this;if(!this.loadingIndicator){if(_e.warn("Loading indicator not available - creating one"),!this.modal)return void _e.error("Cannot create loading indicator - modal not available");var t=document.createElement("div");t.className="product-estimator-modal-loading",V.A.insert("loading-placeholder-template",{loadingText:a.ig.get("ui_elements.loading","Loading...")},t),this.modal.appendChild(t),this.loadingIndicator=t}try{this.loadingIndicator.classList.add("visible"),this.loadingIndicator.classList.add("d-flex"),l.emit("modal:loading:started",this.modal),this._loadingTimeout=setTimeout((function(){e.ensureLoaderHidden()}),1e4),this.loadingStartTime=Date.now()}catch(e){_e.error("Error showing loading indicator:",e)}}},{key:"hideLoading",value:function(){if(this.loadingStartTime=0,this.loadingIndicator)try{this.loadingIndicator.classList.remove("visible","d-flex"),this.loadingIndicator.classList.add("hidden"),l.emit("modal:loading:ended",this.modal),this._loadingTimeout&&(clearTimeout(this._loadingTimeout),this._loadingTimeout=null)}catch(e){_e.error("Error hiding loading indicator:",e)}else _e.warn("Loading indicator not available during hide operation")}},{key:"resetButtonState",value:function(){if(this._buttonConfig&&this._buttonConfig.button){var e=this._buttonConfig.button,t=e.dataset.originalText||e.textContent,o="true"===e.dataset.originalDisabled;e.classList.contains("product-estimator-category-button")&&(e.innerHTML=""),e.textContent=t,e.disabled=o,e.classList.remove("loading"),delete e.dataset.originalText,delete e.dataset.originalDisabled,this._buttonConfig=null}}},{key:"openModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(l.emit("modal:before:open",{productId:t,forceListView:o}),_e.log("MODAL OPEN CALLED WITH:",{productId:t,forceListView:o,typeOfProductId:(0,c.A)(t),hasButtonConfig:!!i}),this._buttonConfig=i,this._modalActionInProgress)_e.log("Modal action already in progress, ignoring open request");else{if(this._modalActionInProgress=!0,setTimeout((function(){e._modalActionInProgress=!1}),300),!this.modal)return _e.error("Cannot open modal - not found in DOM"),void this.showError(a.ig.get("errors.modal_not_found","Modal element not found"));try{if(t&&!o)return _e.log("Checking for product variations",{productId:t}),void this.dataService.getProductVariationData(t).then((function(i){i&&i.isVariable&&i.variations&&i.variations.length>0?(_e.log("Product has variations, showing selection dialog",i),e.productSelectionDialog?e.productSelectionDialog.show({product:{id:t,name:i.productName||a.ig.get("ui_elements.select_options","Select Options")},variations:i.variations,attributes:i.attributes,action:"add",onSelect:function(t){_e.log("Variation selected:",t),e.productSelectionDialog.hideDialog(),e.resetButtonState(),setTimeout((function(){e.proceedWithModalOpen(t.variationId||t.productId,o)}),150)},onCancel:function(){_e.log("Product selection cancelled"),e._modalActionInProgress=!1,e.resetButtonState()}}):(_e.error("ProductSelectionDialog not available"),e.proceedWithModalOpen(t,o))):(_e.log("Product has no variations, proceeding normally"),e.resetButtonState(),e.proceedWithModalOpen(t,o))})).catch((function(a){_e.error("Error checking product variations:",a),e.resetButtonState(),e.proceedWithModalOpen(t,o)}));this.proceedWithModalOpen(t,o)}catch(e){_e.error("Error opening modal:",e),this.hideLoading(),this.showError(a.ig.get("errors.modal_open_error","Error opening modal"))}}}},{key:"proceedWithModalOpen",value:function(e,t){var o=this;try{this.resetModalState(),this.currentProductId=e,e?this.modal.dataset.productId=e:delete this.modal.dataset.productId,this.showLoading(),this.modal.style.display="block",document.body.classList.add("modal-open"),this.isOpen=!0,l.emit("modal:opened",{productId:this.currentProductId,forceListView:t}),this.uiManager&&setTimeout((function(){o.uiManager.initializeCarousels()}),300),e&&!t?this.estimateManager?this.estimateManager.handleProductFlow(e):(_e.error("EstimateManager not available for handleProductFlow"),this.hideLoading()):this.estimateManager?this.estimateManager.showEstimatesList():(_e.error("EstimateManager not available for showEstimatesList"),this.hideLoading())}catch(e){_e.error("Error proceeding with modal open:",e),this.hideLoading(),this.showError(a.ig.get("errors.modal_open_error","Error opening modal"))}}},{key:"closeModal",value:function(){var e=this;if(this.isOpen)if(l.emit("modal:before:close",this.modal),this._modalActionInProgress)_e.log("Modal action already in progress, ignoring close request");else{this._modalActionInProgress=!0,setTimeout((function(){e._modalActionInProgress=!1}),300),_e.log("Closing modal");try{this.ensureLoaderHidden(),this.resetButtonState(),this.modal&&(this.modal.style.display="none",this.isOpen=!1),this.currentProductId=null,document.body.classList.remove("modal-open"),this.estimateManager&&this.estimateManager.onModalClosed(),this.roomManager&&this.roomManager.onModalClosed(),this.productManager&&this.productManager.onModalClosed(),this.formManager&&this.formManager.onModalClosed(),this.uiManager&&this.uiManager.onModalClosed(),l.emit("modal:closed",this.modal);var t=new CustomEvent("productEstimatorModalClosed");document.dispatchEvent(t)}catch(e){_e.error("Error closing modal:",e)}}}},{key:"showError",value:function(e){try{if(this.hideLoading(),this.modal&&V.A){var t=this.modal.querySelector(".product-estimator-modal-form-container");t?V.A.showMessage(e,"error",t):(_e.error("Form container not found for error display"),alert(e))}else alert(e)}catch(e){_e.error("Error showing error message:",e)}}},{key:"setupLoaderSafety",value:function(){var e=this;_e.log("Setting up loader safety mechanisms");try{var t=window.fetch;window.fetch=function(){return t.apply(void 0,arguments).catch((function(t){throw _e.warn("Fetch error triggered loader safety:",t.message),e.ensureLoaderHidden(),t}))},window.addEventListener("error",(function(t){_e.warn("Global error triggered loader safety:",t.message),e.ensureLoaderHidden()})),window.addEventListener("unhandledrejection",(function(t){_e.warn("Unhandled rejection triggered loader safety:",t.reason&&t.reason.message||"Unknown reason"),e.ensureLoaderHidden()})),this._safetyInterval=setInterval((function(){e.loadingStartTime&&Date.now()-e.loadingStartTime>15e3&&(_e.warn("Loading indicator visible for too long (15s), forcing hide"),e.ensureLoaderHidden())}),5e3),_e.log("Loader safety mechanisms installed")}catch(e){_e.error("Error setting up loader safety:",e)}}},{key:"ensureLoaderHidden",value:function(){if(this.loadingIndicator)try{this.loadingIndicator.classList.remove("visible","d-flex"),this.loadingIndicator.classList.add("hidden"),this.loadingStartTime=0,this._loadingTimeout&&(clearTimeout(this._loadingTimeout),this._loadingTimeout=null),l.emit("modal:loading:safety",this.modal),_e.log("Loading indicator forcibly hidden for safety")}catch(e){_e.error("Error hiding loading indicator:",e)}}},{key:"resetModalState",value:function(){var e=this;_e.log("Resetting modal state");try{var t=[this.estimatesList,this.estimateSelection,this.roomSelectionForm,this.newEstimateForm,this.newRoomForm];this.uiManager?t.forEach((function(t){t&&e.uiManager.hideElement(t)})):t.forEach((function(e){e&&(e.style.display="none")})),this.roomSelectionForm&&this.roomSelectionForm.removeAttribute("data-estimate-id"),this.newRoomForm&&(this.newRoomForm.removeAttribute("data-estimate-id"),this.newRoomForm.removeAttribute("data-product-id"))}catch(e){_e.error("Error resetting modal state:",e)}}},{key:"forceElementVisibility",value:function(e){return this.uiManager?this.uiManager.forceElementVisibility(e):e?(_e.log("Using fallback forceElementVisibility (UIManager not available)"),e.style.display="block",e):null}}])}();const Ee=we;var Se=(0,a.h)("VariationHandler");const Me=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,e),this.config=Object.assign({debug:!0,selectors:{variationsForm:".variations_form",estimatorButton:".single_add_to_estimator_button, .button.alt.open-estimator-modal, .product-estimator-button, [data-product-id]",variationIdInput:'input[name="variation_id"]'}},t),this.variationsForm=document.querySelector(this.config.selectors.variationsForm),this.estimatorButton=document.querySelector(this.config.selectors.estimatorButton),this.variationIdInput=this.variationsForm?this.variationsForm.querySelector(this.config.selectors.variationIdInput):null,this.variationsData=window.product_estimator_variations||{},this.currentVariationId=null,this.initialized=!1,this.eventHandlers={},this.variationsForm?this.init():Se.log("No variations form found, VariationHandler not initialized")}),[{key:"init",value:function(){if(this.initialized)return Se.log("VariationHandler already initialized"),this;if(Se.log("Initializing VariationHandler with variations data:",this.variationsData),Se.log("Estimator button found:",!!this.estimatorButton),this.estimatorButton){Se.log("Initial button data-product-id:",this.estimatorButton.dataset.productId);var e=this.estimatorButton.dataset.productId;e&&this.isParentEstimatorEnabled(e)&&(Se.log("Parent product has estimator enabled, ensuring button is visible"),this.estimatorButton.style.display="",this.estimatorButton.classList.remove("hidden"))}return this.bindEvents(),this.checkCurrentVariation(),this.initialized=!0,Se.log("VariationHandler initialized"),this.emit("initialized"),this}},{key:"ensureEstimatorButton",value:function(e){if(Se.log("Ensuring estimator button exists for variation: ".concat(e)),document.querySelector(this.config.selectors.estimatorButton))return Se.log("Estimator button already exists, updating visibility"),void this.updateEstimatorButton(!0,e);if(this.isEstimatorEnabled(e)){Se.log("Creating estimator button dynamically");var t=document.querySelector(".single_add_to_cart_button");if(t){var o=document.createElement("button");o.type="button",o.className="single_add_to_estimator_button button alt open-estimator-modal",o.dataset.productId=e,o.textContent="Add to Estimate",o.dataset.labelKey="add_to_estimate_single_product",t.insertAdjacentElement("afterend",o),Se.log("Estimator button created and inserted")}else Se.log("Cannot find add to cart button to insert after")}else Se.log("Estimator not enabled for this variation, not creating button")}},{key:"isParentEstimatorEnabled",value:function(){if(document.querySelector(".single_add_to_estimator_button"))return!0;var e=document.querySelector('input[name="_enable_estimator"], [data-enable-estimator]');return!!e&&("yes"===e.value||"yes"===e.dataset.enableEstimator)}},{key:"bindEvents",value:function(){var e=this;this.variationsForm&&(Se.log("Binding variation events"),this.variationsForm.addEventListener("found_variation",this.handleFoundVariation.bind(this)),this.variationsForm.addEventListener("reset_data",this.handleResetVariation.bind(this)),this.variationsForm.addEventListener("check_variations",this.handleCheckVariations.bind(this)),document.addEventListener("woocommerce_variation_has_changed",this.checkCurrentVariation.bind(this)),this.variationIdInput&&this.variationIdInput.addEventListener("change",(function(){var t=e.variationIdInput.value;if(t){Se.log("Variation ID input changed to: ".concat(t)),e.currentVariationId=t;var o=e.isEstimatorEnabled(t);e.updateEstimatorButton(o,t)}})),"undefined"!=typeof jQuery&&jQuery(this.variationsForm).on("change",'input[name="variation_id"]',(function(t){var o=t.target.value;if(o){Se.log("jQuery variation ID change detected: ".concat(o)),e.currentVariationId=o;var a=e.isEstimatorEnabled(o);e.updateEstimatorButton(a,o)}})))}},{key:"handleFoundVariation",value:function(e){var t=void 0!==e.detail?e.detail:e.target.variation;if(t&&t.variation_id){var o=t.variation_id;this.currentVariationId=o,Se.log("Found variation: ".concat(o));var a=this.isEstimatorEnabled(o);Se.log("Variation ".concat(o," has estimator enabled: ").concat(a)),this.ensureEstimatorButton(o),this.updateEstimatorButton(a,o),this.emit("variation:changed",{variationId:o,enableEstimator:a,variation:t})}else Se.log("Found variation event received but no valid variation data")}},{key:"handleResetVariation",value:function(){Se.log("Reset variation"),this.currentVariationId=null,this.updateEstimatorButton(!1),this.emit("variation:reset")}},{key:"handleCheckVariations",value:function(){Se.log("Check variations"),this.checkCurrentVariation()}},{key:"checkCurrentVariation",value:function(){if(this.variationsForm){var e=document.querySelectorAll(this.config.selectors.estimatorButton);Se.log("Found ".concat(e.length," estimator buttons during checkCurrentVariation")),e.length>1&&(Se.log("WARNING: Found multiple estimator buttons - this may cause issues. Check for duplicates."),e.forEach((function(e,t){Se.log("Button ".concat(t+1," HTML: ").concat(e.outerHTML))})));var t=this.getCurrentVariation();if(t){Se.log("Current variation detected: ".concat(t.variation_id)),this.currentVariationId=t.variation_id;var o=this.isEstimatorEnabled(t.variation_id);this.updateEstimatorButton(o,t.variation_id)}else Se.log("No current variation detected"),this.currentVariationId=null,this.updateEstimatorButton(this.isParentProductEstimatorEnabled())}}},{key:"isParentProductEstimatorEnabled",value:function(){return void 0===window.product_estimator_variations||!window.product_estimator_variations._parent_enabled||"yes"===window.product_estimator_variations._parent_enabled}},{key:"getCurrentVariation",value:function(){if(!this.variationsForm)return null;if(this.variationsForm.currentVariation)return this.variationsForm.currentVariation;var e=this.variationsForm.querySelector('input[name="variation_id"]');if(e&&e.value)return{variation_id:e.value};var t=this.variationsForm.dataset.productVariations;if(t)return{variation_id:t};if("undefined"!=typeof jQuery){var o=jQuery(this.variationsForm).find('input[name="variation_id"]').val();if(o)return{variation_id:o}}return null}},{key:"isEstimatorEnabled",value:function(e){if(!e)return!1;if(Se.log("Checking if estimator is enabled for variation: ".concat(e)),Se.log("Available variations data:",this.variationsData),this.variationsData[e]){var t="yes"===this.variationsData[e].enable_estimator;return Se.log("Found variation data, estimator enabled: ".concat(t)),t}var o=document.querySelector(".single_add_to_estimator_button[data-product-id]:not([data-variation-id])");if(o){var a=!o.classList.contains("hidden")&&"none"!==getComputedStyle(o).display;return Se.log("Using parent product as fallback, estimator enabled: ".concat(a)),a}return Se.log("No variation or parent data found, estimator disabled by default"),!1}},{key:"updateEstimatorButton",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=document.querySelector(".single_add_to_estimator_button");o?(Se.log("Updating button visibility: ".concat(e?"show":"hide",", variation ID: ").concat(t)),e?(o.style.display="",t&&(Se.log("Setting button data-product-id to variation ID: ".concat(t)),o.dataset.productId=t)):(o.style.display="none",Se.log("Hiding estimator button"))):Se.log("Estimator button not found")}},{key:"on",value:function(e,t){return this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t),this}},{key:"emit",value:function(e,t){return this.eventHandlers[e]&&this.eventHandlers[e].forEach((function(e){return e(t)})),this}}])}();function ke(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function Pe(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(o),!0).forEach((function(t){(0,u.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ke(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var Le=(0,a.h)("CustomerDetailsManager");const Ce=function(){return(0,r.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.A)(this,e),this.config=Object.assign({debug:!1,selectors:{editButton:"#edit-customer-details-btn",saveButton:"#save-customer-details-btn",cancelButton:"#cancel-edit-customer-details-btn",detailsContainer:".saved-customer-details",detailsHeader:".customer-details-header",editForm:".customer-details-edit-form",formContainer:".product-estimator-modal-form-container"},i18n:{}},t),this.dataService=o,this.modalManager=a,this.initialized=!1,this.eventHandlers={},!1!==t.autoInit&&this.init()}),[{key:"init",value:function(){return this.initialized?(Le.log("CustomerDetailsManager already initialized"),this):(this.bindEvents(),document.addEventListener("customer_details_updated",this.onCustomerDetailsUpdated.bind(this)),this.initialized=!0,Le.log("CustomerDetailsManager initialized"),this)}},{key:"onCustomerDetailsUpdated",value:function(e){e.detail&&e.detail.details&&(Le.log("Received customer_details_updated event",e.detail),this.updateDisplayedDetails(e.detail.details),this.checkAndUpdateEmailField(e.detail.details))}},{key:"checkAndUpdateEmailField",value:function(e){var t=e&&e.email&&""!==e.email.trim();Le.log("Checking for email field updates: hasEmail=".concat(t)),document.querySelectorAll(this.config.selectors.editForm).forEach((function(o){if(o.classList.contains("customer-details-edit-form")||o.closest(".saved-customer-details")||o.querySelector("#edit-customer-name")){var a=o.querySelector("#edit-customer-email");if(!a&&t){Le.log("Adding email field to edit form");var i=document.createElement("div");i.className="form-group";var r=document.createElement("label");r.setAttribute("for","edit-customer-email"),r.textContent="Email Address",(a=document.createElement("input")).type="email",a.id="edit-customer-email",a.name="edit_customer_email",a.value=e.email,i.appendChild(r),i.appendChild(a);var n=o.querySelector("#edit-customer-name");if(n){var s=n.closest(".form-group");s?s.parentNode.insertBefore(i,s.nextSibling):o.querySelector("h4").after(i)}}else a&&t&&(a.value=e.email);var l=o.querySelector("#edit-customer-name");l&&e.name&&(l.value=e.name);var d=o.querySelector("#edit-customer-phone");d&&e.phone&&(d.value=e.phone);var c=o.querySelector("#edit-customer-postcode");c&&e.postcode&&(c.value=e.postcode)}else Le.log("Skipping non-customer details form to prevent field synchronization issues")})),document.querySelectorAll("#new-estimate-form").forEach((function(e){if(e.setAttribute("data-has-email",t?"true":"false"),!e._fieldProtectionAdded){var o=e.querySelector("#customer-postcode"),a=e.querySelector("#estimate-name");if(o&&a){Le.log("Adding protection to prevent field value synchronization in estimate form");var i=a.value;o.addEventListener("input",(function(){a.value===o.value&&i!==o.value&&(Le.log("Preventing postcode-to-name field sync - restoring name field value"),a.value=i)})),a.addEventListener("change",(function(){i=a.value,Le.log("Name field changed by user, new value stored:",i)})),e._fieldProtectionAdded=!0}}}))}},{key:"bindEvents",value:function(){var e=document.querySelector(this.config.selectors.editButton),t=document.querySelector(this.config.selectors.saveButton),o=document.querySelector(this.config.selectors.cancelButton);e?(this.bindButtonWithHandler(e,"click",this.handleEditClick.bind(this)),t&&this.bindButtonWithHandler(t,"click",this.handleSaveClick.bind(this)),o&&this.bindButtonWithHandler(o,"click",this.handleCancelClick.bind(this))):Le.log("Edit button not found, skipping event binding")}},{key:"bindButtonWithHandler",value:function(e,t,o){if(e){var a="_".concat(t,"Handler");e[a]&&e.removeEventListener(t,e[a]),e[a]=o,e.addEventListener(t,o)}}},{key:"handleEditClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=document.querySelector(this.config.selectors.detailsContainer),o=document.querySelector(this.config.selectors.detailsHeader),a=document.querySelector(this.config.selectors.editForm);if(t&&(t.style.display="none"),o&&(o.style.display="none"),a){a.style.display="block";var i=this.getCustomerDetails(),r=[{id:"edit-customer-name",key:"name"},{id:"edit-customer-email",key:"email"},{id:"edit-customer-phone",key:"phone"},{id:"edit-customer-postcode",key:"postcode"}];if(r.forEach((function(e){var t=a.querySelector("#".concat(e.id));if(t){var o=t.closest(".form-group");o&&(i[e.key]||"postcode"===e.key?(o.style.display="block",t.value=i[e.key]||""):o.style.display="none")}})),0===r.filter((function(e){var t=a.querySelector("#".concat(e.id)),o=null==t?void 0:t.closest(".form-group");return o&&"none"!==o.style.display})).length||!Object.keys(i).some((function(e){return i[e]}))){var n=a.querySelector("#edit-customer-postcode");if(n){var s=n.closest(".form-group");s&&(s.style.display="block")}}}Le.log("Edit form displayed with populated values")}},{key:"handleCancelClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=document.querySelector(this.config.selectors.detailsContainer),o=document.querySelector(this.config.selectors.detailsHeader),a=document.querySelector(this.config.selectors.editForm);a&&(a.style.display="none"),t&&(t.style.display=""),o&&(o.style.display="flex"),Le.log("Edit form hidden")}},{key:"handleSaveClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=e.target,o=t.textContent;t.textContent=this.config.i18n&&this.config.i18n.saving||"Saving...",t.disabled=!0;var a={};[{id:"edit-customer-name",key:"name"},{id:"edit-customer-email",key:"email"},{id:"edit-customer-phone",key:"phone"},{id:"edit-customer-postcode",key:"postcode"}].forEach((function(e){var t=document.getElementById(e.id);if(t){var o=t.closest(".form-group");if(o&&"none"!==o.style.display){var i=t.value.trim();i&&(a[e.key]=i)}}}));try{B(a),Le.log("Customer details saved to localStorage:",a),this.handleSaveSuccess({success:!0},a),t.textContent=o,t.disabled=!1}catch(e){Le.error("Error saving to localStorage:",e),this.handleSaveError({message:"Could not save details locally. Please check your browser storage settings."}),t.textContent=o,t.disabled=!1}}},{key:"handleSaveSuccess",value:function(e,t){this.updateDisplayedDetails(t),this.checkAndUpdateEmailField(t),this.showMessage("success",e.message||"Details updated successfully!");var o=document.querySelector(this.config.selectors.detailsContainer),a=document.querySelector(this.config.selectors.detailsHeader),i=document.querySelector(this.config.selectors.editForm);i&&(i.style.display="none"),o&&(o.style.display=""),a&&(a.style.display="flex");var r=new CustomEvent("customer_details_updated",{bubbles:!0,detail:{details:t}});document.dispatchEvent(r),Le.log("Customer details updated successfully",e)}},{key:"handleSaveError",value:function(e){this.showMessage("error",e.message||"Error updating details. Please try again."),Le.log("Error saving customer details:",e)}},{key:"updateDisplayedDetails",value:function(e){var t=document.querySelectorAll(this.config.selectors.detailsContainer);t.length?(Le.log("Updating ".concat(t.length," customer details containers")),t.forEach((function(t){var o="";e.name&&""!==e.name.trim()&&(o+="<p><strong>NAME:</strong><br>".concat(e.name,"</p>")),e.email&&""!==e.email.trim()&&(o+="<p><strong>EMAIL:</strong><br>".concat(e.email,"</p>")),e.phone&&""!==e.phone.trim()&&(o+="<p><strong>PHONE:</strong><br>".concat(e.phone,"</p>")),e.postcode&&""!==e.postcode.trim()&&(o+="<p><strong>POSTCODE:</strong><br>".concat(e.postcode,"</p>")),t.innerHTML=o;var a=t.closest(".customer-details-display");a&&(a.classList.add("success"),setTimeout((function(){a.classList.remove("success")}),600))}))):Le.log("No customer details containers found for updating")}},{key:"showMessage",value:function(e,t){document.querySelectorAll(".modal-message").forEach((function(e){return e.remove()}));var o="error"===e?"modal-error-message":"modal-success-message",a=document.createElement("div");a.className="modal-message ".concat(o),a.textContent=t;var i=document.querySelector(this.config.selectors.formContainer);i&&(i.prepend(a),setTimeout((function(){a.remove()}),5e3))}},{key:"getCustomerDetails",value:function(){return H()}},{key:"hasPostcode",value:function(){var e=this.getCustomerDetails();return e.postcode&&""!==e.postcode.trim()}},{key:"updatePostcodeIfNew",value:function(e){if(!e||""===e.trim())return!1;var t=this.getCustomerDetails();if(!t.postcode||""===t.postcode.trim()||t.postcode!==e){Le.log("Updating customer postcode from:",t.postcode,"to:",e);var o=Pe(Pe({},t),{},{postcode:e});try{B(o),Le.log("Customer postcode saved to localStorage:",o)}catch(e){return Le.error("Failed to save customer postcode to localStorage:",e),!1}var a=new CustomEvent("customer_details_updated",{bubbles:!0,detail:{details:o}});return document.dispatchEvent(a),!0}return!1}}])}();var Ie=(0,a.h)("EstimatorCore"),Ae=function(){return(0,r.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,e),this.isActive=!0,this.config=Object.assign({debug:!1,selectors:{estimatorButtons:".product-estimator-button, .single_add_to_estimator_button, .open-estimator-modal",estimatorMenuButtons:".product-estimator-menu-item a, a.product-estimator-menu-item",modalContainer:"#product-estimator-modal"},autoInit:!0,i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.dataService=null,this.modalManager=null,this.variationHandler=null,this.customerDetailsManager=null,this.initialized=!1,this.eventHandlers={},this.config.autoInit&&this.init()}),[{key:"init",value:function(){var e=this;if(this.initialized)return Ie.log("already initialized - aborting"),this;if(window._productEstimatorInitialized&&window.productEstimator&&window.productEstimator.core)return Ie.log("detected as already initialized globally - aborting"),this.initialized=!0,this;Ie.log("Initializing EstimatorCore");try{if("undefined"==typeof jQuery)return Ie.error("jQuery is not loaded, cannot initialize EstimatorCore"),this;this.dataService||(this.dataService=new F({debug:this.config.debug})),Ie.log("%c=== PRODUCT ESTIMATOR INITIALIZATION START ===","background: #f0f0f0; color: #333; padding: 3px; border-radius: 3px;");var t=function(){e.modalManager?Ie.log("Components already initialized - skipping"):(e.modalManager=new Ee({debug:e.config.debug,selectors:e.config.selectors},e.dataService),e.customerDetailsManager=new Ce({debug:e.config.debug},e.dataService),e.isWooCommerceProductPage()&&(Ie.log("WooCommerce product page detected, initializing VariationHandler"),e.variationHandler=new Me({debug:e.config.debug})),e.bindGlobalEvents(),e.initialized=!0,Ie.log("initialized successfully"),e.config.debug&&l.setDebug(!0),e.emit("core:initialized"),Ie.log("%c=== PRODUCT ESTIMATOR INITIALIZATION COMPLETE ===","background: #f0f0f0; color: #333; padding: 3px; border-radius: 3px;"))};"complete"===document.readyState?t():window.addEventListener("load",t,{once:!0})}catch(e){Ie.error("EstimatorCore initialization error:",e)}return this}},{key:"bindGlobalEvents",value:function(){var e=this;try{this._clickHandler&&(document.removeEventListener("click",this._clickHandler),Ie.log("Removed existing click handler")),this._clickHandler=function(t){var o=t.target.closest(e.config.selectors.estimatorMenuButtons);if(o)return t.preventDefault(),t.stopPropagation(),Ie.log("Menu button clicked - opening modal in list view"),void(e.modalManager&&e.modalManager.openModal(null,!0));var a=t.target.closest(e.config.selectors.estimatorButtons);if(a&&!o){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var i=a.dataset.productId||null;if(Ie.log("PRODUCT BUTTON CLICKED:",{productId:i,buttonElement:a,dataAttribute:a.dataset}),a.classList.contains("loading"))return void Ie.log("Button already has loading state, skipping");var r=a.textContent,n=a.disabled;if(a.dataset.originalText=r,a.dataset.originalDisabled=n,a.disabled=!0,a.classList.add("loading"),a.classList.contains("product-estimator-category-button")){a.innerHTML="";var s=document.createElement("span");s.className="button-loading-spinner",s.innerHTML='<span class="dashicons dashicons-update-alt spinning"></span>',a.appendChild(s)}if(e.modalManager){Ie.log("OPENING MODAL WITH:",{productId:i,forceListView:!1});var l={originalButtonText:r,buttonWasDisabled:n,button:a};e.modalManager.openModal(i,!1,l)}}},document.addEventListener("click",this._clickHandler),this.emit("core:eventsbound")}catch(e){Ie.error("Error binding global events:",e)}}},{key:"closeModal",value:function(){this.modalManager&&this.modalManager.closeModal()}},{key:"isWooCommerceProductPage",value:function(){return document.body.classList.contains("single-product")||document.body.classList.contains("product-template-default")||!!document.querySelector(".product.type-product")}},{key:"on",value:function(e,t){return l.on(e,t),this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t),this}},{key:"emit",value:function(e,t){return l.emit(e,t),this.eventHandlers[e]&&this.eventHandlers[e].forEach((function(e){return e(t)})),this}},{key:"destroy",value:function(){this.isActive&&(Ie.log("Plugin destroying..."),(0,a.El)(),this.isActive=!1)}}])}();const De=new Ae({debug:!0}),Te=`<template id="additional-product-option-template"> <div class="additional-product-option-tile"> <img src="${new URL(o(201),o.b)}" alt="" class="tile-image product-img" data-alt-label="ui_elements.product_details"> <span class="tile-label product-name"></span> <div class="option-price product-price" data-prefix-label="ui_elements.single_price"></div> <button type="button" class="replace-product-in-room" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method="" data-replace-type="" data-label="buttons.select_additional_product" data-aria-label="buttons.select_additional_product" data-title-label="buttons.select_additional_product"> Select </button> </div> </template> `,qe=`<template id="similar-product-item-template"> <div class="suggestion-item similar-product-item" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method=""> <div class="suggestion-image"> <img src="${new URL(o(201),o.b)}" class="similar-product-thumbnail product-img" data-alt-label="ui_elements.similar_product_image" data-aria-label="ui_elements.similar_product_image"> <div class="no-image" style="display:none"></div> </div> <div class="suggestion-details"> <div class="suggestion-name product-name"></div> <div class="suggestion-price product-price" data-prefix-label="ui_elements.single_price"></div> <div class="suggestion-actions"> <button type="button" class="replace-product-in-room" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method="" data-label="buttons.replace_product" data-aria-label="buttons.replace_product" data-title-label="buttons.replace_product"> Replace </button> </div> </div> </div> </template> `,xe=`<template id="suggestion-item-template"> <div class="suggestion-item"> <div class="suggestion-image"> <img src="${new URL(o(201),o.b)}" class="suggestion-img product-img" data-alt-label="ui_elements.product_suggestion" data-aria-label="ui_elements.product_suggestion"> </div> <div class="suggestion-details"> <div class="suggestion-name product-name"></div> <div class="suggestion-price product-price" data-prefix-label="ui_elements.single_price"></div> <div class="suggestion-actions"> <button type="button" class="add-suggestion-to-room" data-product-id="" data-estimate-id="" data-room-id="" data-label="buttons.add_to_room" data-aria-label="buttons.add_to_room" data-title-label="buttons.add_to_room"> Add to Room </button> </div> </div> </div> </template> `,Re=`<template id="room-item-template"> <div class="accordion-item room-item" data-room-id="" data-estimate-id=""> <div class="accordion-header-wrapper"> <div class="accordion-header room-item-header"> <div class="room-image-wrapper"> <img class="primary-product-image product-thumbnail" src="${new URL(o(201),o.b)}" data-aria-label="ui_elements.primary_product" data-alt-label="ui_elements.primary_product" alt="Primary product" data-visible-if="has_primary_product"> </div> <div class="room-details-wrapper"> <div class="room-details"> <div class="room-name-wrapper"> <span class="room-name" data-prefix-label="ui_elements.room"></span> <span class="primary-product-name"></span> <span class="room-dimensions"></span> </div> <div class="room-price" data-prefix-label="ui_elements.products"></div> </div> <div class="price-graph-container"> <div class="price-graph-bar"> <div class="price-graph-range"></div> </div> <div class="price-graph-labels"></div> </div> </div> <div class="room-actions"> <button class="remove-room" data-estimate-id="" data-room-id="" data-title-label="buttons.remove_room" title="Remove Room" data-aria-label="buttons.remove_room"> <span class="dashicons dashicons-trash"></span> </button> </div> </div> </div> <div class="accordion-content"> <div class="room-empty-state" style="display:none"></div> <button class="product-includes-toggle expanded"> <span data-label="buttons.product_includes">Product Includes</span> <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span> </button> <div class="includes-container visible"> <div class="product-includes"> <div class="product-includes-items"></div> </div> <div class="price-notice" data-label="ui_elements.price_notice">Prices are subject to check measures without notice</div> <div class="additional-products-container" style="display:none"> <div class="additional-products-list"> </div> </div> </div> <button class="product-details-toggle similar-products-toggle expanded"> <span data-label="buttons.similar_products">Similar Products</span> <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span> </button> <div class="similar-products-container visible" data-room-id=""> <div class="product-similar-products"> <div class="suggestions-carousel similar-products-carousel"> <div class="suggestions-nav prev" data-aria-label="ui_elements.previous" data-title-label="ui_elements.previous" aria-label="Previous" title="Previous"> <span class="dashicons dashicons-arrow-left-alt2"></span> </div> <div class="suggestions-container similar-products-list"> </div> <div class="suggestions-nav next" data-aria-label="ui_elements.next" data-title-label="ui_elements.next" aria-label="Next" title="Next"> <span class="dashicons dashicons-arrow-right-alt2"></span> </div> </div> </div> </div> <div class="product-suggestions" style="display:none"> <button class="product-suggestions-toggle"> <span data-label="buttons.suggested_products">Suggested Products</span> <span class="toggle-icon dashicons dashicons-arrow-down-alt2"></span> </button> <div class="suggestions-container-wrapper"> <div class="suggestions-carousel"> <div class="suggestions-nav prev" data-aria-label="ui_elements.previous_suggestions" data-title-label="ui_elements.previous_suggestions" aria-label="Previous Suggestions" title="Previous Suggestions">&#10094;</div> <div class="suggestions-container"> </div> <div class="suggestions-nav next" data-aria-label="ui_elements.next_suggestions" data-title-label="ui_elements.next_suggestions" aria-label="Next Suggestions" title="Next Suggestions">&#10095;</div> </div> </div> </div> </div> </div> </template>`;var Oe=(0,a.h)("TemplateLoader"),Fe={"room-item-template":Re,"estimate-item-template":'<template id="estimate-item-template"> <div class="estimate-section collapsed" data-estimate-id=""> <div class="estimate-header"> <h3 class="estimate-name" data-prefix-label="ui_elements.estimate"> <div class="price-graph-container"> <div class="price-range-title"> <span class="price-title name" data-prefix-label="ui_elements.estimate"></span> <span class="estimate-price min_total max_total"></span> </div> <div class="price-graph-bar"> <div class="price-graph-range"></div> </div> <div class="price-graph-labels"></div> </div> </h3> <button class="remove-estimate" data-estimate-id="" data-title-label="buttons.delete_estimate" data-aria-label="buttons.delete_estimate" title="Delete Estimate" aria-label="Delete Estimate"> <span class="dashicons dashicons-trash"></span> </button> </div> <div class="estimate-content"> <div id="rooms"> <div class="room-header"> <h4 data-label="ui_elements.rooms_heading">Rooms</h4> <button class="add-room" data-estimate-id="" data-label="buttons.add_new_room">Add New Room</button> </div> <div class="rooms-container"></div> </div> </div> <div class="estimate-actions"> <ul> <li> <a class="print-estimate" data-estimate-id="" data-title-label="buttons.print_estimate" title="Print Estimate"> <span class="dashicons dashicons-pdf"></span> <span data-label="buttons.print_estimate">Print estimate</span> </a> </li> <li> <a class="request-contact-estimate" data-estimate-id="" data-title-label="buttons.request_contact" title="Request contact from store"> <span class="dashicons dashicons-businessperson"></span> <span data-label="buttons.request_contact">Request contact from store</span> </a> </li> <li> <a class="request-a-copy" data-estimate-id="" data-title-label="buttons.request_copy" title="Request a copy"> <span class="dashicons dashicons-email"></span> <span data-label="buttons.request_copy">Request a copy</span> </a> </li> </ul> </div> </div> </template> ',"suggestion-item-template":xe,"note-item-template":'<template id="note-item-template"> <div class="include-item note-item"> <span class="product-includes-icon"> <span class="dashicons dashicons-sticky" data-title-label="ui_elements.notes_heading" data-aria-label="ui_elements.notes_heading"> </span> </span> <div class="include-item-note"> <p class="note-text"></p> </div> </div> </template> ',"include-item-template":'<template id="include-item-template"> <div class="include-item" data-product-id=""> <span class="product-includes-icon"> <span class="dashicons dashicons-plus-alt"></span> </span> <span class="include-item-name product-name"></span> <span class="pe-info-button" data-tooltip-type="rich" data-tooltip-position="right" data-title-label="ui_elements.product_details" data-tooltip-title="Product Details" data-aria-label="ui_elements.view_details" aria-label="View Details" data-label="buttons.view_details"></span> <div class="include-item-prices"> <div class="include-item-total-price product-price" data-prefix-label="ui_elements.single_price"> </div> </div> <button class="remove-product" data-estimate-id="" data-room-id="" data-product-id="" data-title-label="buttons.remove_product" data-aria-label="buttons.remove_product"> <span class="dashicons dashicons-trash"></span> <span class="remove-text" data-label="buttons.remove">Remove</span> </button> </div> </template> ',"similar-product-item-template":qe,"additional-product-option-template":Te,"additional-products-section-template":'<template id="additional-products-section-template"> <div class="additional-products-section"> <div class="additional-products-header"> <h3 class="additional-product-title" data-label="ui_elements.additional_products">Additional Products</h3> <p class="additional-product-description"></p> </div> <div class="additional-products-list"> </div> </div> </template>',"select-option-template":'<template id="select-option-template"> <option value="{{value}}" data-label="{{labelKey}}">{{text}}</option> </template>',"loading-placeholder-template":'<template id="loading-placeholder-template"> <div class="loading-spinner"></div> <div class="loading-text" data-label="ui.components.loading.general">{{loadingText}}</div> </template>',"room-actions-footer-template":'<template id="room-actions-footer-template"> <div class="room-actions-footer"> <button type="button" class="add-product-button button button-small button-primary" data-label="buttons.add_product">Add Product</button> </div> </template> ',"rooms-container-template":'<template id="rooms-container-template"> <div class="estimate-rooms-container"> </div> </template>',"new-estimate-form-template":'<template id="new-estimate-form-template"> <div id="new-estimate-form-wrapper"> <h2 data-label="ui_elements.create_new_estimate">Create New Estimate</h2> <form id="new-estimate-form" method="post" data-has-email="false"> <div class="form-group"> <label for="estimate-name" data-label="forms.estimate_name">Estimate Name</label> <input type="text" id="estimate-name" name="estimate_name" data-placeholder-label="forms.placeholder_estimate_name" placeholder="e.g. Home Renovation" required> </div> <div class="customer-details-section"> <h4 data-label="ui_elements.your_details">Your Details</h4> <div class="form-group"> <label for="customer-postcode" data-label="forms.customer_postcode">Postcode</label> <input type="text" id="customer-postcode" name="customer_postcode" data-placeholder-label="forms.placeholder_postcode" placeholder="Your postcode" required> </div> </div> <div class="button-group"> <button type="submit" class="submit-btn create-estimate-btn" data-label="buttons.create_estimate">Create Estimate</button> <button type="button" class="cancel-btn" data-form-type="estimate" data-label="buttons.cancel">Cancel</button> </div> </form> <div class="customer-details-display" style="display:none"> <div class="customer-details-header"> <h4 data-label="ui_elements.saved_details">Your Saved Details</h4> <div class="customer-details-actions"> <button type="button" class="edit-customer-details" id="edit-customer-details-btn" data-label="buttons.edit">Edit</button> </div> </div> <div class="customer-details-content saved-customer-details"> </div> <div class="customer-details-edit-form" style="display:none"> <h4 data-label="ui_elements.edit_your_details">Edit Your Details</h4> <form id="customer-details-edit-form"> <div class="form-group"> <label for="edit-customer-name" data-label="forms.customer_name">Name</label> <input type="text" id="edit-customer-name" name="customer_name" data-placeholder-label="forms.placeholder_name" placeholder="Your name"> </div> <div class="form-group"> <label for="edit-customer-email" data-label="forms.customer_email">Email</label> <input type="email" id="edit-customer-email" name="customer_email" data-placeholder-label="forms.placeholder_email" placeholder="Your email"> </div> <div class="form-group"> <label for="edit-customer-phone" data-label="forms.customer_phone">Phone</label> <input type="tel" id="edit-customer-phone" name="customer_phone" data-placeholder-label="forms.placeholder_phone" placeholder="Your phone"> </div> <div class="form-group"> <label for="edit-customer-postcode" data-label="forms.customer_postcode">Postcode</label> <input type="text" id="edit-customer-postcode" name="customer_postcode" data-placeholder-label="forms.placeholder_postcode" placeholder="Your postcode"> </div> <div class="customer-details-edit-actions"> <button type="button" class="save-customer-details" id="save-customer-details-btn" data-label="buttons.save_changes">Save Changes</button> <button type="button" class="cancel-edit-customer-details" id="cancel-edit-customer-details-btn" data-label="buttons.cancel">Cancel</button> </div> </form> </div> </div> </div> </template>',"new-room-form-template":'<template id="new-room-form-template"> <div id="new-room-form-wrapper"> <h2 data-label="buttons.add_new_room">Add New Room</h2> <form id="new-room-form" method="post" data-estimate-id="" data-product-id=""> <div class="form-group"> <label for="room-name" data-label="forms.room_name">Room Name</label> <input type="text" id="room-name" name="room_name" data-placeholder-label="forms.placeholder_room_name" placeholder="e.g. Living Room" required> </div> <div class="inline-group"> <div class="form-group"> <label for="room-width" data-label="forms.room_width">Width (m)</label> <input type="number" id="room-width" name="room_width" data-placeholder-label="forms.placeholder_width" placeholder="Width" required step="0.01" min="0.1"> </div> <div class="form-group"> <label for="room-length" data-label="forms.room_length">Length (m)</label> <input type="number" id="room-length" name="room_length" data-placeholder-label="forms.placeholder_length" placeholder="Length" required step="0.01" min="0.1"> </div> </div> <div class="button-group"> <button type="submit" class="submit-btn" data-label="buttons.add_room">Add Room</button> <button type="button" class="cancel-btn" data-form-type="room" data-label="buttons.cancel">Cancel</button> </div> </form> </div> </template> ',"room-selection-form-template":'<template id="room-selection-form-template"> <h2 data-label="forms.select_room">Select a Room</h2> <form id="room-selection-form"> <div class="form-group"> <label for="room-dropdown" data-label="forms.choose_room">Choose a room:</label> <select id="room-dropdown" name="room_id" required> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn" data-label="buttons.add_product_to_room">Add Product to Room</button> <button type="button" class="button cancel-btn back-btn" data-target="estimate-selection" data-label="buttons.back">Back</button> <button type="button" class="button add-room" id="add-new-room-from-selection" data-estimate-id="" data-label="buttons.add_new_room">Add New Room</button> </div> </form> </template> ',"estimate-selection-template":'<template id="estimate-selection-template"> <div id="estimate-selection-wrapper"> <div id="estimate-selection-form-wrapper"> <h2 data-label="forms.select_estimate">Select an Estimate</h2> <form id="estimate-selection-form"> <div class="form-group"> <label for="estimate-dropdown" data-label="forms.choose_estimate">Choose an estimate:</label> <select id="estimate-dropdown" name="estimate_id" required> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn" data-label="buttons.continue">Continue</button> <button type="button" class="button cancel-btn" id="create-estimate-btn" data-label="buttons.create_new_estimate"> Create New Estimate </button> </div> </form> </div> <div id="room-selection-form-wrapper" style="display:none"> <h2 data-label="forms.select_room">Select a Room</h2> <form id="room-selection-form"> <div class="form-group"> <label for="room-dropdown" data-label="forms.choose_room">Choose a room:</label> <select id="room-dropdown" name="room_id" required> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn" data-label="buttons.add_product_to_room">Add Product to Room</button> <button type="button" class="button cancel-btn back-btn" data-target="estimate-selection" data-label="buttons.back">Back</button> <button type="button" class="button add-room" id="add-new-room-from-selection" data-estimate="" data-label="buttons.add_new_room">Add New Room</button> </div> </form> </div> </div> </template> ',"estimates-empty-template":'<template id="estimates-empty-template"> <div class="no-estimates"> <p data-label="ui_elements.no_estimates">You don\'t have any estimates yet.</p> <button id="create-estimate-btn" class="button" data-label="buttons.create_new_estimate">Create New Estimate</button> </div> </template>',"rooms-empty-template":'<template id="rooms-empty-template"> <div class="no-rooms"> <p data-label="ui_elements.no_rooms">You don\'t have any rooms in this estimate.</p> </div> </template>',"products-empty-template":'<template id="products-empty-template"> <div class="products"> <p data-label="ui_elements.no_products">You don\'t have any products in this room.</p> </div> </template>',"room-error-template":'<template id="room-error-template"> <div class="error-state"> <p data-label="messages.room_load_error">Error loading rooms. Please try again.</p> </div> </template>',"product-error-template":'<template id="product-error-template"> <div class="error-state"> <p data-label="messages.product_load_error">Error loading products. Please try again.</p> </div> </template>',"form-error-template":'<template id="form-error-template"> <div class="form-errors error-message"> <p data-label="messages.form_error">An error occurred with the form submission. Please try again.</p> </div> </template>',"modal-messages-template":'<template id="modal-messages-template"> <div class="modal-message modal-success-message"> <div class="message-content"></div> </div> <div class="modal-message modal-error-message"> <div class="message-content"></div> </div> </template> ',"modal-container-template":'<template id="modal-container-template"> <div id="product-estimator-modal" class="product-estimator-modal"> <div class="product-estimator-modal-overlay"></div> <div class="product-estimator-modal-container"> <button class="product-estimator-modal-close" aria-label="Close" data-label="ui_elements.close"> <span aria-hidden="true">&times;</span> </button> <div class="product-estimator-modal-header"> <h2 data-label="ui_elements.modal_header_title">Product Estimator</h2> </div> <div class="product-estimator-modal-form-container"> <div id="estimates"></div> <div id="estimate-selection-wrapper" style="display:none"></div> <div id="room-selection-form-wrapper" style="display:none"></div> <div id="new-estimate-form-wrapper" style="display:none"></div> <div id="new-room-form-wrapper" style="display:none"></div> </div> <div class="product-estimator-modal-loading" style="display:none"> <div class="loading-spinner"></div> <div class="loading-text" data-label="ui_elements.loading">Loading...</div> </div> </div> </div> </template>',"confirmation-dialog-template":'<template id="confirmation-dialog-template"> <div class="pe-dialog-backdrop"> <div class="pe-confirmation-dialog" role="dialog" aria-modal="true"> <div class="dialog-content"> <div class="pe-dialog-header"> <h3 class="pe-dialog-title" data-label="dialogs.titles.confirmation">Confirm Action</h3> <button type="button" class="pe-dialog-close" aria-label="Close" data-aria-label="ui.general.close"> <span aria-hidden="true">&times;</span> </button> </div> <div class="pe-dialog-body"> <p class="pe-dialog-message" data-label="dialogs.messages.confirm_action">Are you sure you want to proceed?</p> </div> <div class="pe-dialog-footer pe-dialog-buttons"> <button type="button" class="pe-dialog-btn pe-dialog-cancel" data-label="actions.core.cancel">Cancel</button> <button type="button" class="pe-dialog-btn pe-dialog-confirm" data-label="actions.core.confirm">Confirm</button> </div> </div> </div> </div> </template>',"product-selection-template":'<template id="product-selection-template"> <div class="pe-dialog-backdrop" style="display:none"> <div class="pe-dialog pe-product-selection-dialog"> <div class="pe-dialog-header"> <h3 class="pe-dialog-title" data-label="dialogs.titles.product_selection">Select Product Options</h3> <button class="pe-dialog-close" aria-label="Close" data-aria-label="ui.general.close">&times;</button> </div> <div class="pe-dialog-body"> <div class="pe-dialog-product-name"></div> <div class="pe-dialog-variations"> <p class="pe-dialog-message" data-label="dialogs.messages.select_options">Please select your options below:</p> <div class="pe-variation-options"> </div> </div> </div> <div class="pe-dialog-footer"> <button class="pe-dialog-cancel" data-label="actions.core.cancel">Cancel</button> <button class="pe-dialog-confirm" disabled="disabled" data-label="actions.product.add_to_estimate">Add to Estimate</button> </div> </div> </div> </template>',"variation-option-template":'<template id="variation-option-template"> <div class="pe-variation-group" data-attribute-name="{{attributeName}}"> <label class="pe-variation-label" data-label="ui.components.variations.attribute_label">{{attributeLabel}}</label> <div class="pe-variation-swatches" data-aria-label="ui.components.variations.select_option"> </div> </div> </template>',"variation-swatch-template":'<template id="variation-swatch-template"> <button class="pe-variation-swatch{{selected}}" data-attribute-name="{{attributeName}}" data-value="{{value}}" data-type="{{type}}"> <span class="pe-swatch-content"> </span> <span class="pe-swatch-label">{{label}}</span> </button> </template>',"toggle-button-hide-template":'<template id="toggle-button-hide-template"> <span data-label="ui.components.toggles.hide_details">{{buttonText}}</span> <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span> </template>',"toggle-button-show-template":'<template id="toggle-button-show-template"> <span data-label="ui.components.toggles.show_details">{{buttonText}}</span> <span class="toggle-icon dashicons dashicons-arrow-down-alt2"></span> </template>',tooltip:'<template id="tooltip-template"> <div class="pe-tooltip" role="tooltip"> <div class="pe-tooltip-content"></div> <div class="pe-tooltip-arrow"></div> </div> </template>',"tooltip-rich":'<template id="tooltip-rich-template"> <div class="pe-tooltip pe-tooltip-rich" role="tooltip"> <div class="pe-tooltip-header"> <h4 class="pe-tooltip-title"></h4> <button class="pe-tooltip-close" data-aria-label="ui_elements.close_tooltip" aria-label="Close tooltip"> <span class="dashicons dashicons-no-alt"></span> </button> </div> <div class="pe-tooltip-content"> <div class="pe-tooltip-notes"> <h5 class="pe-tooltip-section-title" data-label="ui_elements.notes_heading">Notes</h5> <div class="pe-tooltip-notes-content"></div> </div> <div class="pe-tooltip-details"> <h5 class="pe-tooltip-section-title" data-label="ui_elements.details_heading">Details</h5> <div class="pe-tooltip-details-content"></div> </div> </div> </div> </template> ',"dialog-form-fields-template":'<template id="dialog-form-fields-template"> <div class="pe-dialog-content-form"> <p class="dialog-instruction">{instruction}</p> <div class="form-fields-container"> </div> <div class="pe-dialog-validation-error" style="display:none"></div> </div> </template>',"dialog-form-field-template":'<template id="dialog-form-field-template"> <div class="pe-dialog-form-group"> <label for="customer-{{fieldName}}-input" class="pe-dialog-label">{{fieldLabel}}:</label> <input type="{{fieldType}}" id="customer-{{fieldName}}-input" class="pe-dialog-input" value="{{fieldValue}}" placeholder="{{fieldLabel}}" required> </div> </template>',"dialog-content-form-template":'<template id="dialog-content-form-template"> <div class="pe-dialog-form"> <p class="pe-dialog-instruction">{{instruction}}</p> <div class="pe-dialog-form-fields"></div> <div class="pe-dialog-validation-error" style="display:none"></div> </div> </template>',"dialog-contact-selection-template":'<template id="dialog-contact-selection-template"> <div class="pe-dialog-contact-selection"> <p class="pe-dialog-instruction">{{message}}</p> <div class="pe-dialog-button-group"> <button type="button" class="pe-dialog-btn pe-dialog-choice pe-dialog-email-choice">{{emailButtonText}}</button> <button type="button" class="pe-dialog-btn pe-dialog-choice pe-dialog-phone-choice">{{phoneButtonText}}</button> </div> </div> </template>'};Oe.group("Initializing templates"),Oe.log("Registering templates:",Object.keys(Fe)),Object.entries(Fe).forEach((function(e){var t=(0,n.A)(e,2),o=t[0],a=t[1];a&&""!==a.trim()?(Oe.log("Registering template: ".concat(o," (").concat(a.length," characters)")),V.A.registerTemplate(o,a)):Oe.warn("Template ".concat(o," has empty HTML content!"))})),Oe.log("Initialized template engine with ".concat(Object.keys(Fe).length," templates")),Oe.groupEnd(),V.A;var Ne=(0,a.h)("FrontEndIndex");function je(){if(Ne.log("Product Estimator initialization check..."),window._productEstimatorInitialized)Ne.log("Product Estimator already initialized globally, aborting");else{if(window.productEstimator&&window.productEstimator.initialized)return Ne.log("Product Estimator initialized property found, aborting"),void(window._productEstimatorInitialized=!0);window._productEstimatorInitialized=!0,Ne.log("Product Estimator initializing for the first time...");try{Be?Ne.log("Global event handlers already added, skipping"):(Ne.log("Setting up global event handlers..."),window._productEstimatorCloseHandler=function(e){if(e.target.closest(".product-estimator-modal-close")||e.target.classList.contains("product-estimator-modal-overlay")){Ne.log("Global close handler triggered");var t=document.querySelector("#product-estimator-modal");t&&(t.style.display="none",document.body.classList.remove("modal-open"),window.productEstimator&&window.productEstimator.core&&window.productEstimator.core.closeModal())}},document.removeEventListener("click",window._productEstimatorCloseHandler),document.addEventListener("click",window._productEstimatorCloseHandler),Be=!0,Ne.log("Global event handlers added")),"undefined"!=typeof jQuery?(window.productEstimator=window.productEstimator||{},window.productEstimator.jQuery=jQuery):Ne.warn("jQuery not detected, some features may not work");var e=function(){var e=new URLSearchParams(window.location.search);if(e.has("product_estimator_debug")){var t="false"!==e.get("product_estimator_debug");return t?localStorage.setItem("product_estimator_debug","true"):localStorage.removeItem("product_estimator_debug"),t}return"true"===localStorage.getItem("product_estimator_debug")}();"complete"===document.readyState?setTimeout((function(){return He(e)}),10):setTimeout((function(){return He(e)}),500)}catch(e){Ne.error("Error in Product Estimator initialization:",e)}}}function He(e){try{if(window.productEstimator&&window.productEstimator.initialized)return void Ne.log("Product Estimator core already initialized, skipping");Ne.log("Initializing EstimatorCore..."),De.init({debug:e}),window.productEstimator=window.productEstimator||{},window.productEstimator.initialized=!0,window.productEstimator.core=De,window.productEstimator.dialog=new U.default,window.productEstimator.detailsToggle=ve,function(){try{document.addEventListener("click",(function(e){e.target.closest(".accordion-header")&&setTimeout((function(){ve&&"function"==typeof ve.setup&&(Ne.log("Accordion clicked, reinitializing product details toggle"),ve.setup())}),300)})),document.body.addEventListener("click",(function(e){if(e.target.closest(".product-details-toggle")){var t=e.target.closest(".product-details-toggle"),o=t.closest(".product-item");if(!o)return;var a=t.classList.contains("expanded"),i=o.querySelector(".similar-products-container");if(!i)return;if(a){t.classList.remove("expanded"),i.style.display="none",i.classList.remove("visible");var r=t.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2"))}else{t.classList.add("expanded"),i.style.display="block",i.classList.add("visible");var n=t.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-notes-toggle")){var s=e.target.closest(".product-notes-toggle"),l=s.closest(".product-item");if(!l)return;var d=s.classList.contains("expanded"),c=l.querySelector(".notes-container");if(!c)return;if(d){s.classList.remove("expanded"),c.style.display="none",c.classList.remove("visible");var u=s.querySelector(".toggle-icon");u&&(u.classList.remove("dashicons-arrow-up-alt2"),u.classList.add("dashicons-arrow-down-alt2"))}else{s.classList.add("expanded"),c.style.display="block",c.classList.add("visible");var m=s.querySelector(".toggle-icon");m&&(m.classList.remove("dashicons-arrow-down-alt2"),m.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-includes-toggle")){var g=e.target.closest(".product-includes-toggle"),p=g.closest(".product-item");if(!p)return;var h=g.classList.contains("expanded"),v=p.querySelector(".includes-container");if(!v)return;if(h){g.classList.remove("expanded"),v.style.display="none",v.classList.remove("visible");var f=g.querySelector(".toggle-icon");f&&(f.classList.remove("dashicons-arrow-up-alt2"),f.classList.add("dashicons-arrow-down-alt2"))}else{g.classList.add("expanded"),v.style.display="block",v.classList.add("visible");var y=g.querySelector(".toggle-icon");y&&(y.classList.remove("dashicons-arrow-down-alt2"),y.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-suggestions-toggle")){var b=e.target.closest(".product-suggestions-toggle"),_=b.closest(".accordion-content");if(!_)return;var w=b.classList.contains("expanded"),E=_.querySelector(".suggestions-container");if(!E)return;if(w){b.classList.remove("expanded"),E.style.display="none",E.classList.remove("visible");var S=b.querySelector(".toggle-icon");S&&(S.classList.remove("dashicons-arrow-up-alt2"),S.classList.add("dashicons-arrow-down-alt2"))}else{b.classList.add("expanded"),E.style.display="block",E.classList.add("visible");var M=b.querySelector(".toggle-icon");M&&(M.classList.remove("dashicons-arrow-down-alt2"),M.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}})),Ne.log("[ProductDetailsToggle] initialization complete")}catch(e){Ne.error("Error initializing ProductDetailsToggle:",e)}}(),Ne.log("Product Estimator initialized".concat(e?" (debug mode)":"")),document.dispatchEvent(new CustomEvent("product_estimator_initialized"))}catch(e){Ne.error("Error during EstimatorCore initialization:",e)}}window._productEstimatorInitialized=window._productEstimatorInitialized||!1,window._setupInitDone||(window._setupInitDone=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",je,{once:!0}):je());var Be=!1;(0,a.h)("ProductEstimatorFrontend").log("Product Estimator Frontend initialized")},981:(e,t,o)=>{o.d(t,{A:()=>c});var a=o(284),i=o(296),r=o(29),n=o(901),s=o(418),l=o(191),d=(0,s.h)("TemplateEngine");const c=new(function(){return(0,n.A)((function e(){(0,r.A)(this,e),this.templates={},this.templateElements={},this.initialized=!1}),[{key:"init",value:function(){var e=this;return this.initialized?(d.log("[init] Already initialized."),this):(d.log("[init] Initializing TemplateEngine. Templates to process:",Object.keys(this.templates)),Object.entries(this.templates).forEach((function(t){var o=(0,i.A)(t,2),a=o[0],r=o[1];try{var n=document.createElement("div");n.innerHTML=r;var s=n.querySelector("template");if(s)e.templateElements[a]=s,d.log('[init] Template element found in HTML for ID: "'.concat(a,'"'));else{d.error('[init] UNEXPECTED: templateElement was null/undefined for ID: "'.concat(a,'". Creating nested template. Original HTML likely already contained a <template> tag.'));var l=document.createElement("template");l.id=a,l.innerHTML=r,e.templateElements[a]=l,d.log('[init] Created new template element for ID: "'.concat(a,'" (HTML was likely raw, not wrapped in <template>)'))}if(e.templateElements[a]){var c=e.templateElements[a].content||e.templateElements[a];d.log('[init] TemplateElement for "'.concat(a,'" created. Inner HTML starts with:'),((null==c?void 0:c.innerHTML)||"No innerHTML or content").substring(0,200)+"...")}else d.error('[init] Failed to assign template element for ID: "'.concat(a,'"'))}catch(e){d.error('[init] Error processing template HTML for ID "'.concat(a,'":'),e)}})),d.log("[init] TemplateEngine initialized with ".concat(Object.keys(this.templateElements).length," template elements")),this.initialized=!0,this)}},{key:"registerTemplate",value:function(e,t){return"string"!=typeof t||""===t.trim()?(d.warn('[registerTemplate] Cannot register empty or non-string HTML for template "'.concat(e,'".')),this):(this.templates[e]=t,this.initialized=!1,d.log('[registerTemplate] Registered template "'.concat(e,'". HTML starts with:'),t.substring(0,200)+"..."),this)}},{key:"getTemplate",value:function(e){this.initialized||(d.warn("[getTemplate] TemplateEngine not initialized yet. Calling init()."),this.init());var t=this.templateElements[e]||null;return t||d.error('[getTemplate] Template element not found for ID: "'.concat(e,'".')),t}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!o)try{var a=(new Error).stack.split("\n").find((function(e){return e.includes(".js:")&&!e.includes("TemplateEngine.js")}));if(a){var i=a.match(/\/([^/]+\.js):/);o=i?i[1]:"unknown"}else o="unknown"}catch(e){o="unknown"}this.trackTemplateUsage(e,o);var r,n=this.getTemplate(e);if(!n)return d.error('[create] Cannot create element. Template element not found for ID: "'.concat(e,'"')),document.createDocumentFragment();if(d.log('[DEBUG][TemplateEngine.create] Found template element for "'.concat(e,'":'),n),d.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" direct innerHTML (first 200 chars):'),n.innerHTML.substring(0,200)),n.content){d.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" has .content property:'),n.content),d.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" .content.childNodes count:'),n.content.childNodes.length);for(var s=n.content.childNodes,l=0;l<Math.min(s.length,3);l++){var c=s[l],u=c.textContent?c.textContent.trim().substring(0,50):"[No textContent]";d.log("[DEBUG][TemplateEngine.create] Node[".concat(l,"] type: ").concat(c.nodeType,", name: ").concat(c.nodeName,", text: ").concat(u,"..."))}var m=n.content.firstElementChild;d.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" .content.firstElementChild:'),m)}else d.error('[DEBUG][TemplateEngine.create] CRITICAL: Template "'.concat(e,'" DOES NOT HAVE a .content property!'));try{if(!n.content)return d.error('[create] Cannot clone template content for ID: "'.concat(e,'" - .content is missing.')),document.createDocumentFragment();if(!(r=n.content.cloneNode(!0)))return d.error('[create] Failed to clone template content for ID: "'.concat(e,'". cloneNode returned null/undefined.')),document.createDocumentFragment();d.log('[create] Cloned template content for "'.concat(e,'". Result is a DocumentFragment.'));var g=document.createElement("div");g.appendChild(r.cloneNode(!0)),d.log('[DEBUG][TemplateEngine.create] Cloned fragment structure for "'.concat(e,'" (first 200 chars): ').concat(g.innerHTML.substring(0,200),"..."))}catch(t){return d.error('[create] Error during template.content.cloneNode(true) for ID "'.concat(e,'":'),t),document.createDocumentFragment()}try{this.populateElement(r,t),d.log('[create] Populated fragment for "'.concat(e,'".'))}catch(t){d.error('[create] Error populating fragment for ID "'.concat(e,'":'),t)}return this.processLabels(r),r}},{key:"processHandlebars",value:function(e,t){return e&&"string"==typeof e?e.replace(/\{\{(\w+)\}\}/g,(function(e,o){return void 0!==t[o]?t[o]:e})):e}},{key:"processLabels",value:function(e){var t=e.querySelectorAll("[data-label]");d.log("Processing ".concat(t.length," label elements in template")),t.forEach((function(e){var t,o=e.dataset.label,a=e.textContent,i=e.dataset.labelTarget||null,r=e.dataset.labelParams;if(r)try{var n=JSON.parse(r);t=l.i.format(o,n,a)}catch(e){d.warn("Invalid label params for ".concat(o,":"),e),t=l.i.get(o,a)}else t=l.i.get(o,a);i?e.setAttribute(i,t):e.textContent=t})),e.querySelectorAll("[data-aria-label]").forEach((function(e){var t=e.dataset.ariaLabel,o=e.getAttribute("aria-label")||"",a=l.i.get(t,o);e.setAttribute("aria-label",a),e.removeAttribute("data-aria-label")})),e.querySelectorAll("[data-title-label]").forEach((function(e){var t=e.dataset.titleLabel,o=e.getAttribute("title")||"",a=l.i.get(t,o);e.setAttribute("title",a),e.removeAttribute("data-title-label")})),e.querySelectorAll("[data-placeholder-label]").forEach((function(e){var t=e.dataset.placeholderLabel,o=e.getAttribute("placeholder")||"",a=l.i.get(t,o);e.setAttribute("placeholder",a),e.removeAttribute("data-placeholder-label")}))}},{key:"_processElementHandlebars",value:function(e,t){var o=this,a=function(e){if(e.nodeType===Node.ELEMENT_NODE){if(e.hasAttributes()&&Array.from(e.attributes).forEach((function(e){e.value.includes("{{")&&(e.value=o.processHandlebars(e.value,t))})),1===e.childNodes.length&&e.firstChild.nodeType===Node.TEXT_NODE){var i=e.textContent;i.includes("{{")&&(e.textContent=o.processHandlebars(i,t))}Array.from(e.childNodes).forEach((function(e){a(e)}))}};e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(e.childNodes).forEach((function(e){a(e)})):a(e),d.log("[_processElementHandlebars] Processed handlebars placeholders in element")}},{key:"populateElement",value:function(e,t){var o=this;if(this._processElementHandlebars(e,t),Object.entries(t).forEach((function(o){var r=(0,i.A)(o,2),n=r[0],s=r[1];if("object"!==(0,a.A)(s)&&!Array.isArray(s)){if(e.querySelectorAll(".".concat(n)).forEach((function(e){"IMG"===e.tagName&&"image"===n?(e.src=s||"",t.name&&(e.alt=t.name)):"INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName?e.value=s:e.textContent=s})),"name"===n&&e.querySelectorAll(".suggestion-name").forEach((function(e){e.textContent=s})),"image"===n&&e.querySelectorAll("img.similar-product-thumbnail").forEach((function(e){var o;e.src=s||"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.alt=t.name||"Similar Product Image";var a=null===(o=e.closest(".suggestion-image"))||void 0===o?void 0:o.querySelector(".no-image");s&&""!==s.trim()?(e.style.display="",a&&(a.style.display="none")):(e.style.display="none",a&&(a.style.display=""))})),"primary_product_image"===n){var l=e.querySelectorAll("img.primary-product-image");d.log("Found primary-product-image elements:",l.length,"with value:",s),l.forEach((function(e){e.src=s||"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.alt="Primary product",d.log("Set image src to:",e.src)}))}e.querySelectorAll("[data-".concat(n,"]")).forEach((function(e){e.setAttribute("data-".concat(n),s)}))}})),(void 0!==t.product_index||void 0!==t.product_id)&&e.querySelectorAll(".remove-product").forEach((function(e){void 0!==t.product_index&&(e.dataset.productIndex=t.product_index),void 0!==t.product_id&&(e.dataset.productId=t.product_id),void 0!==t.estimate_id&&(e.dataset.estimateId=t.estimate_id),void 0!==t.room_id&&(e.dataset.roomId=t.room_id),d.log("Setting removal button data attributes: estimate=".concat(t.estimate_id,", room=").concat(t.room_id,", product_index=").concat(t.product_index,", product_id=").concat(t.product_id))})),t.estimate_id&&e.querySelectorAll("[data-estimate-id]").forEach((function(e){e.setAttribute("data-estimate-id",t.estimate_id)})),t.room_id&&e.querySelectorAll("[data-room-id]").forEach((function(e){e.setAttribute("data-room-id",t.room_id)})),(t.name||t.room_name)&&e.querySelectorAll(".room-name").forEach((function(e){e.textContent=t.name||t.room_name||"Unnamed Room"})),t.id||t.product_id){var r=t.product_id||t.id;e.querySelectorAll("[data-product-id]").forEach((function(e){e.setAttribute("data-product-id",r)})),e.classList&&["product-item","similar-item","suggestion-item","include-item"].some((function(t){return e.classList.contains(t)}))&&e.setAttribute("data-product-id",r),d.log("Set data-product-id=".concat(r," on product element(s) in template"))}if(void 0!==t.product_index&&(e.querySelectorAll("[data-product-index]").forEach((function(e){e.setAttribute("data-product-index",t.product_index)})),e.classList&&e.classList.contains("product-item")&&e.setAttribute("data-product-index",t.product_index)),t.image&&e.querySelectorAll("img.product-thumbnail, img.product-img").forEach((function(e){e.src=t.image,e.alt=t.name||"Product"})),void 0!==t.min_total&&void 0!==t.max_total&&e.querySelectorAll(".estimate-price").forEach((function(e){e.textContent="".concat(s.GP.formatPrice(t.min_total)," - ").concat(s.GP.formatPrice(t.max_total))})),void 0!==t.min_price_total&&void 0!==t.max_price_total&&e.querySelectorAll(".product-price").forEach((function(e){e.textContent="".concat(s.GP.formatPrice(t.min_price_total)," - ").concat(s.GP.formatPrice(t.max_price_total))})),void 0!==t.min_price_total&&void 0!==t.max_price_total&&e.querySelectorAll(".suggestion-price").forEach((function(e){t.min_price_total===t.max_price_total?e.textContent=void 0!==s.GP&&s.GP.formatPrice?s.GP.formatPrice(t.min_price_total):t.min_price_total:e.textContent="".concat(void 0!==s.GP&&s.GP.formatPrice?s.GP.formatPrice(t.min_price_total):t.min_price_total," - ").concat(void 0!==s.GP&&s.GP.formatPrice?s.GP.formatPrice(t.max_price_total):t.max_price_total)})),t.name&&e.querySelectorAll(".price-title, .product-name").forEach((function(e){e.textContent=t.name})),Object.entries(t).forEach((function(t){var a=(0,i.A)(t,2),r=a[0],n=a[1];if(Array.isArray(n)&&n.length>0){var s=e.querySelector(".".concat(r))||e.querySelector(".".concat(r,"-container"))||e.querySelector(".".concat(r,"-items"));if(s&&n[0].template){var l=n[0].template;n.forEach((function(e){var t=o.create(l,e);s.appendChild(t)}))}}})),t.additional_notes){var n=e.querySelector(".notes-container"),l=e.querySelector(".product-notes-items");if(n&&l){l.innerHTML="";var c=[];Array.isArray(t.additional_notes)?c=t.additional_notes:"object"===(0,a.A)(t.additional_notes)&&(c=Object.values(t.additional_notes));var u=c.filter((function(e){return e&&(e.note_text||e.text)&&""!==(e.note_text||e.text).trim()}));if(u.length>0)n.style.display="block",n.classList.add("visible"),u.forEach((function(e){if(o.getTemplate("note-item-template")){var t=o.create("note-item-template",{}),a=t.querySelector(".note-text");a&&(a.textContent=e.note_text||e.text||""),l.appendChild(t)}}));else{n.style.display="none",n.classList.remove("visible");var m=e.querySelector(".product-notes-toggle");m&&(m.style.display="none")}}}if(t.similar_products){var g=e.querySelector(".similar-products-container"),p=e.querySelector(".similar-products-list");if(g&&p){p.innerHTML="";var h=[];Array.isArray(t.similar_products)?h=t.similar_products:"object"===(0,a.A)(t.similar_products)&&(h=Object.values(t.similar_products));var v=h.filter((function(e){return e&&e.id}));if(v.length>0){g.dataset.productId=t.id||t.product_id||"";var f=e.querySelector(".similar-products-toggle");f&&(f.style.display="block"),v.forEach((function(e){if(o.getTemplate("similar-product-item-template")){var a={id:e.id,product_id:e.id,name:e.name||"Similar Product",image:e.image||"",min_price_total:e.min_price_total,max_price_total:e.max_price_total,pricing_method:e.pricing_method||"sqm",estimate_id:t.estimate_id||"",room_id:t.room_id||"",replace_product_id:t.id||t.product_id||""};d.log("Rendering similar product with data:",a);var i=o.create("similar-product-item-template",a);p.appendChild(i)}}))}else{var y=e.querySelector(".similar-products-toggle");y&&(y.style.display="none")}}}if(void 0!==t.replace_product_id){var b=e.querySelector(".replace-product-in-room");b&&(b.dataset.replaceProductId=t.replace_product_id,d.log("TemplateEngine: Set data-replace-product-id on button to: ".concat(t.replace_product_id)))}if(void 0!==t.pricing_method){var _=e.querySelector(".replace-product-in-room");_&&(_.dataset.pricingMethod=t.pricing_method,d.log("TemplateEngine: Set data-pricing-method on button to: ".concat(t.pricing_method)))}e.querySelectorAll("[data-visible-if]").forEach((function(e){var o=e.getAttribute("data-visible-if");if(o){var a=!!t[o];e.style.display=a?"":"none"}}))}},{key:"insert",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"append",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!i)try{var r=(new Error).stack.split("\n").find((function(e){return e.includes(".js:")&&!e.includes("TemplateEngine.js")}));if(r){var n=r.match(/\/([^/]+\.js):/);i=n?n[1]:"unknown"}else i="unknown"}catch(e){i="unknown"}var s=this.create(e,t,i);if("string"==typeof o&&(o=document.querySelector(o)),!o)return d.error('[insert] Container not found for template: "'.concat(e,'"')),null;try{switch(a){case"prepend":o.prepend(s);break;case"before":o.parentNode.insertBefore(s,o);break;case"after":o.parentNode.insertBefore(s,o.nextSibling);break;case"replace":d.warn('[insert] "replace" position used for template "'.concat(e,"\". Replacing container with fragment's children.")),o.parentNode.replaceChild(s,o);break;default:o.appendChild(s)}return d.log('[insert] Inserted template "'.concat(e,'" into container. Position: ').concat(a)),s}catch(t){return d.error('[insert] Error inserting template "'.concat(e,'" into container. Position: ').concat(a),t),null}}},{key:"showMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".product-estimator-modal-form-container";if(document.querySelectorAll(".modal-message").forEach((function(e){return e.remove()})),!this.getTemplate("modal-messages-template")){var a=document.createElement("div");return a.className="modal-message modal-".concat(t,"-message"),a.textContent=e,"string"==typeof o&&(o=document.querySelector(o)),void(o&&(o.prepend(a),setTimeout((function(){a.parentNode&&a.remove()}),5e3)))}var i=document.createElement("div");i.className="modal-message modal-".concat(t,"-message"),i.innerHTML='<div class="message-content">'.concat(e,"</div>"),"string"==typeof o&&(o=document.querySelector(o)),o&&(o.prepend(i),setTimeout((function(){i.parentNode&&i.remove()}),5e3))}},{key:"createModalContainer",value:function(){d.log("Creating modal container from template");try{var e,t,o,a=document.querySelector("#product-estimator-modal");if(a)return d.log("Modal container already exists in DOM"),a;var i=this.getTemplate("modal-container-template");if(!i)return d.error("Modal container template not found"),null;if(d.group("Debug: Template Creation"),d.log("Template id:","modal-container-template"),d.log("Template found:",!!i),d.log("Template outerHTML:",i.outerHTML),i.content){d.log("Template has content property with:",i.content.childNodes.length,"child nodes"),Array.from(i.content.childNodes).slice(0,3).forEach((function(e,t){d.log("Node[".concat(t,"]:"),e.nodeType,e.nodeName)}));var r=document.createElement("div");r.appendChild(i.content.cloneNode(!0)),d.log("Template content inner HTML:",r.innerHTML.substring(0,500)+"..."),d.log("Template contains #estimates:",!!r.querySelector("#estimates")),d.log("Template contains #estimate-selection-wrapper:",!!r.querySelector("#estimate-selection-wrapper")),d.log("Template contains #room-selection-form-wrapper:",!!r.querySelector("#room-selection-form-wrapper"))}d.groupEnd();var n=this.create("modal-container-template",{title:(null===(e=window.productEstimatorVars)||void 0===e||null===(e=e.i18n)||void 0===e?void 0:e.productEstimator)||"Product Estimator",close:(null===(t=window.productEstimatorVars)||void 0===t||null===(t=t.i18n)||void 0===t?void 0:t.close)||"Close",loading:(null===(o=window.productEstimatorVars)||void 0===o||null===(o=o.i18n)||void 0===o?void 0:o.loading)||"Loading..."});if(n){d.log("Created fragment structure for modal:",n.childNodes.length,"child nodes at root level");var s=document.createElement("div");s.appendChild(n.cloneNode(!0)),d.log("Fragment content before appending to DOM:",s.innerHTML.substring(0,300)+"..."),d.log("Fragment contains #estimates:",!!s.querySelector("#estimates")),d.log("Fragment contains form-container:",!!s.querySelector(".product-estimator-modal-form-container"))}document.body.appendChild(n),d.log("Modal fragment appended to document body");var l=document.querySelector("#product-estimator-modal");if(d.log("DOM after fragment append - modal found:",!!l),l){var c={modal:!!l,container:!!l.querySelector(".product-estimator-modal-container"),formContainer:!!l.querySelector(".product-estimator-modal-form-container"),estimates:!!l.querySelector("#estimates"),estimateSelection:!!l.querySelector("#estimate-selection-wrapper"),roomSelection:!!l.querySelector("#room-selection-form-wrapper"),newEstimate:!!l.querySelector("#new-estimate-form-wrapper"),newRoom:!!l.querySelector("#new-room-form-wrapper")};if(d.log("Modal element created with child elements status:",c),d.log("Modal HTML structure:",l.outerHTML.substring(0,500)+"..."),!c.estimates){d.error("Critical element #estimates missing in created modal!");var u=l.querySelector(".product-estimator-modal-form-container");u&&d.log("Form container exists but missing #estimates. Form container HTML:",u.innerHTML)}}return l?(d.log("Modal container created and added to DOM"),l):(d.error("Failed to find modal element after creating it"),null)}catch(e){return d.error("Error creating modal container:",e),null}}},{key:"debugTemplates",value:function(){d.group("TemplateEngine Debug"),d.log("Registered template IDs:",Object.keys(this.templates)),d.log("Template elements:",Object.keys(this.templateElements)),Object.entries(this.templateElements).forEach((function(e){var t=(0,i.A)(e,2),o=t[0],a=t[1];d.log("Template ".concat(o,":"),a),a.content?d.log("- Has content: ".concat(a.content.childNodes.length," child nodes")):d.warn("- No content for template ".concat(o))})),d.groupEnd()}},{key:"debugNoteData",value:function(e,t){d.log("Note data processing:",{hasNotes:!(!t.additional_notes||!Array.isArray(t.additional_notes)),notesCount:t.additional_notes?t.additional_notes.length:0,notesContainer:e.querySelector(".notes-container")?"found":"missing",notesItems:e.querySelector(".product-notes-items")?"found":"missing",noteTemplate:this.getTemplate("note-item-template")?"found":"missing",firstNote:t.additional_notes&&t.additional_notes.length>0?t.additional_notes[0]:null})}},{key:"verifyTemplates",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d.group("Template Verification");var o={registered:Object.keys(this.templates).length,created:Object.keys(this.templateElements).length,missing:[],empty:[],critical:{total:t.length,missing:[]}};return d.log("Registered templates:",Object.keys(this.templates)),d.log("Template elements:",Object.keys(this.templateElements)),Object.keys(this.templates).forEach((function(a){e.templates[a]&&""!==e.templates[a].trim()||(d.warn('Template "'.concat(a,'" has empty HTML content')),o.empty.push(a)),e.templateElements[a]||(d.warn('Template element for "'.concat(a,'" was not created')),o.missing.push(a),t.includes(a)&&(d.error('CRITICAL: Required template "'.concat(a,'" is missing!')),o.critical.missing.push(a)))})),d.log("Template verification results:",{registered:o.registered,created:o.created,missingCount:o.missing.length,emptyCount:o.empty.length,criticalMissingCount:o.critical.missing.length}),o.critical.missing.length>0&&d.error("Critical templates are missing, application may not function correctly:",o.critical.missing),d.groupEnd(),o}},{key:"trackTemplateUsage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";this._templateUsage||(this._templateUsage={}),this._templateUsage[e]||(this._templateUsage[e]=new Set),this._templateUsage[e].add(t)}},{key:"getTemplateUsageStats",value:function(){var e=this;if(!this._templateUsage)return{};var t={};return Object.keys(this._templateUsage).forEach((function(o){t[o]=Array.from(e._templateUsage[o])})),t}},{key:"logTemplateUsage",value:function(){d.group("Template Usage Statistics");var e=this.getTemplateUsageStats(),t=Object.keys(e);if(0===t.length)return d.log("No template usage data recorded"),void d.groupEnd();d.log("Usage data for ".concat(t.length," templates:")),t.forEach((function(t){var o=e[t];d.log('- "'.concat(t,'" used in: ').concat(o.join(", ")))}));var o=Object.keys(this.templates).filter((function(t){return!e[t]}));o.length>0&&d.warn("Found ".concat(o.length," potentially unused templates:"),o),d.groupEnd()}}])}())}},o={};function a(e){var i=o[e];if(void 0!==i)return i.exports;var r=o[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=(t,o,i,r)=>{if(!o){var n=1/0;for(c=0;c<e.length;c++){for(var[o,i,r]=e[c],s=!0,l=0;l<o.length;l++)(!1&r||n>=r)&&Object.keys(a.O).every((e=>a.O[e](o[l])))?o.splice(l--,1):(s=!1,r<n&&(n=r));if(s){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[o,i,r]},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{a.b=document.baseURI||self.location.href;var e={945:0};a.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[n,s,l]=o,d=0;if(n.some((t=>0!==e[t]))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(l)var c=l(a)}for(t&&t(o);d<n.length;d++)r=n[d],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},o=self.webpackChunkproduct_estimator=self.webpackChunkproduct_estimator||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var i=a.O(void 0,[76],(()=>a(911)));i=a.O(i)})();
//# sourceMappingURL=product-estimator.bundle.js.map