(()=>{"use strict";var e,t={201:e=>{e.exports="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},344:(e,t,o)=>{var a={};o.r(a),o.d(a,{currency:()=>m,debounce:()=>p,formatDate:()=>y,formatPrice:()=>g,formatPriceRange:()=>h,objectToQueryString:()=>b,sanitizeHTML:()=>f,throttle:()=>v,truncateText:()=>w});var r=o(284),i=o(296),n=o(467),s=o(16);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=Array(t);o<t;o++)a[o]=e[o];return a}s.h("UtilsAjax");var c=o(690);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,n.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"USD";(null==e||isNaN(e))&&(e=0);var a="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat(t,{style:"currency",currency:o}).format(a)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(null==e)return"".concat(t,"0.00");var a="string"==typeof e?parseFloat(e):e;return isNaN(a)?"".concat(t,"0.00"):t+a.toFixed(o)}function h(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"$",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=null==e?0:"string"==typeof e?parseFloat(e.replace(/[^0-9.-]+/g,"")):e,i=null==t?0:"string"==typeof t?parseFloat(t.replace(/[^0-9.-]+/g,"")):t;return isNaN(r)&&isNaN(i)?"".concat(g(0,o,a)):isNaN(r)?g(i,o,a):isNaN(i)||r===i?g(r,o,a):"".concat(g(r,o,a)," - ").concat(g(i,o,a))}function p(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];var n=this;clearTimeout(t),t=setTimeout((function(){return e.apply(n,r)}),o)}}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,o=0;return function(){var a=Date.now();if(a-o>=t){o=a;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return e.apply(this,i)}}}function f(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=u(u({},{year:"numeric",month:"short",day:"numeric"}),t),a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?"Invalid date":new Intl.DateTimeFormat(navigator.language,o).format(a)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e?e.length<=t?e:e.substring(0,t-o.length)+o:""}function b(e){return Object.entries(e).filter((function(e){var t=(0,i.A)(e,2);return null!=(t[0],t[1])})).map((function(e){var t=(0,i.A)(e,2),o=t[0],a=t[1];return Array.isArray(a)?a.map((function(e){return"".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(e))})).join("&"):"".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(a))})).join("&")}s.Rm,s.R8,s.z3;var E=s.h,S=s.El;c.n,c.SL,c.kp,c.LF,c.ai,c.eV,c.WH,c.Nz,c.L$;var _=o(29),M=o(901),k=o(145),L=o(800);function P(e){return function(e){if(Array.isArray(e))return(0,k.A)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,L.A)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var C=E("AjaxService"),I=function(){return(0,M.A)((function e(){var t,o,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,_.A)(this,e),window._ajaxServiceInstance)return C.log("Using existing AjaxService instance"),window._ajaxServiceInstance;this.config=Object.assign({debug:!1,ajaxUrl:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.ajax_url)||"/wp-admin/admin-ajax.php",nonce:(null===(o=window.productEstimatorVars)||void 0===o?void 0:o.nonce)||"",i18n:(null===(a=window.productEstimatorVars)||void 0===a?void 0:a.i18n)||{}},r),this.cache={productUpgrades:{},productData:{},similarProducts:{},suggestions:{},estimatesData:null,rooms:{}},window._ajaxServiceLogged||(C.log("AjaxService initialized"),window._ajaxServiceLogged=!0),window._ajaxServiceInstance=this}),[{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return C.log("Making request to '".concat(e,"'"),t),this.config.debug&&C.log("Request details:",{url:this.config.ajaxUrl,action:e,nonce:this.config.nonce,data:t}),function(e){var t,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)||(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.nonce)||"",s=new FormData;return s.append("action",e),s.append("nonce",n),Object.entries(a).forEach((function(e){var t=(0,i.A)(e,2),o=t[0],a=t[1];null!=a&&("object"===(0,r.A)(a)?s.append(o,JSON.stringify(a)):s.append(o,a))})),fetch((null===(o=window.productEstimatorVars)||void 0===o?void 0:o.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",credentials:"same-origin",body:s}).then((function(e){if(!e.ok)throw new Error("Network response was not ok: ".concat(e.status));return e.json()})).then((function(e){if(e.success)return e.data;var t,o=new Error((null===(t=e.data)||void 0===t?void 0:t.message)||"Unknown error");throw o.data=e.data,o}))}(e,t,this.config.nonce).catch((function(t){C.error("Request '".concat(e,"' error:"),t);var a=new Error("AJAX request failed: ".concat(t.message));if(a.originalError=t,a.action=e,o)return C.warn("AJAX request to '".concat(e,"' failed but continuing with fallback data.")),{success:!0,data:{},isFallback:!0};throw a}))}},{key:"formatFormData",value:function(e){return function(e){if("string"==typeof e)return e;if(e instanceof FormData){var t,o=new URLSearchParams,a=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return l(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==o.return||o.return()}finally{if(s)throw i}}}}(e.entries());try{for(a.s();!(t=a.n()).done;){var r=(0,i.A)(t.value,2),n=r[0],s=r[1];o.append(n,s)}}catch(e){a.e(e)}finally{a.f()}return o.toString()}return new URLSearchParams(e).toString()}(e)}},{key:"getProductUpgrades",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="".concat(e.product_id,"_").concat(e.estimate_id,"_").concat(e.room_id,"_").concat(e.upgrade_type);return!o&&this.cache.productUpgrades[a]?(C.log("Returning cached product upgrades for key ".concat(a)),Promise.resolve(this.cache.productUpgrades[a])):this._request("get_product_upgrades",e).then((function(e){return e&&e.upgrades&&(t.cache.productUpgrades[a]=e),e})).catch((function(e){throw delete t.cache.productUpgrades[a],e}))}},{key:"getProductDataForStorage",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="data_".concat(e.product_id,"_").concat(e.room_width||0,"_").concat(e.room_length||0);return!o&&this.cache.productData[a]?(C.log("Returning cached product data for key ".concat(a)),Promise.resolve(this.cache.productData[a])):this._request("get_product_data_for_storage",e).then((function(e){return e&&e.product_data&&(t.cache.productData[a]=e),e})).catch((function(e){throw delete t.cache.productData[a],e}))}},{key:"addProductToRoom",value:function(e){var t=this;return this._request("add_product_to_room",e).then((function(e){return t.invalidateCache("suggestions"),e}))}},{key:"replaceProductInRoom",value:function(e){var t=this;return this._request("replace_product_in_room",e).then((function(e){return t.invalidateCache("suggestions"),t.invalidateCache("productData"),e}))}},{key:"getSimilarProducts",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="similar_".concat(e.product_id,"_area_").concat(e.room_area);return!o&&this.cache.similarProducts[a]?(C.log("Returning cached similar products for key ".concat(a)),Promise.resolve(this.cache.similarProducts[a])):this._request("get_similar_products",e).then((function(e){return e&&Array.isArray(e.products)&&(t.cache.similarProducts[a]=e),e})).catch((function(e){throw delete t.cache.similarProducts[a],e}))}},{key:"addNewEstimate",value:function(e){var t=this;return this._request("add_new_estimate",e).then((function(e){return t.invalidateCache("estimatesData"),e}))}},{key:"addNewRoom",value:function(e){var t=this;return this._request("add_new_room",e).then((function(e){return t.invalidateCache("rooms"),e}))}},{key:"fetchSuggestionsForModifiedRoom",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="suggestions_".concat(e.estimate_id,"_").concat(e.room_id,"_").concat(e.room_product_ids_for_suggestions);return!o&&this.cache.suggestions[a]?(C.log("Returning cached suggestions for key ".concat(a)),Promise.resolve(this.cache.suggestions[a])):this._request("fetch_suggestions_for_modified_room",e).then((function(e){return e&&Array.isArray(e.updated_suggestions)&&(t.cache.suggestions[a]=e),e})).catch((function(e){throw delete t.cache.suggestions[a],e}))}},{key:"removeProductFromRoom",value:function(e){var t=this;return this._request("remove_product_from_room",e).then((function(e){return t.invalidateCache("suggestions"),e}))}},{key:"removeRoom",value:function(e){var t=this;return this._request("remove_room",e).then((function(e){return t.invalidateCache("rooms"),t.invalidateCache("suggestions"),e}))}},{key:"removeEstimate",value:function(e){var t=this;return this._request("remove_estimate",e).then((function(e){return t.invalidateCache(),e}))}},{key:"getVariationEstimator",value:function(e){return this._request("get_variation_estimator",e)}},{key:"invalidateCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Object.prototype.hasOwnProperty.call(this.cache,e)?(C.log("Invalidating ".concat(e," cache")),"object"===(0,r.A)(this.cache[e])?this.cache[e]={}:this.cache[e]=null):(C.log("Invalidating all caches"),this.cache={productUpgrades:{},productData:{},similarProducts:{},suggestions:{},estimatesData:null,rooms:{}})}}])}();const D=I;var q="productEstimatorEstimateData",A=E("EstimateStorage");function x(){try{var e=localStorage.getItem(q);if(e){var t=JSON.parse(e);return A.log("loadEstimateData - Data loaded:",t),t}var o=sessionStorage.getItem(q);return o?JSON.parse(o):{}}catch(e){return A.error("Error loading estimate data from localStorage:",e),{}}}function T(e){try{localStorage.setItem(q,JSON.stringify(e))}catch(t){A.warn("localStorage not available, using sessionStorage:",t);try{sessionStorage.setItem(q,JSON.stringify(e))}catch(e){A.error("sessionStorage not available:",e)}}}function R(){try{localStorage.removeItem(q)}catch(e){A.warn("localStorage not available:",e)}try{sessionStorage.removeItem(q)}catch(e){A.warn("sessionStorage not available:",e)}}function F(e,t,o){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return A.log("[addSuggestionsToRoom] Suggestions feature is disabled. Returning null for room ".concat(o,".")),Promise.resolve(null);var a=x();if(!(a.estimates&&a.estimates[t]&&a.estimates[t].rooms&&a.estimates[t].rooms[o]))return null;var r=a.estimates[t].rooms[o];return Array.isArray(e)?(r.product_suggestions=e,T(a),r.product_suggestions):(A.error("Error: suggestedProducts must be an array."),null)}function N(e,t,o){var a=x();if(!(a.estimates&&a.estimates[e]&&a.estimates[e].rooms&&a.estimates[e].rooms[t]))return A.error("Estimate or Room not found. E: ".concat(e,", R: ").concat(t)),!1;var r=a.estimates[e].rooms[t];return Array.isArray(r.products)||(r.products=[]),Array.isArray(r.product_suggestions)||(r.product_suggestions=[]),r.products.find((function(e){return e.id===o.id}))?(A.warn(" Product with ID ".concat(o.id," already exists in room ").concat(t,". Aborting add to room.products.")),!1):(r.products.push(o),T(a),A.log(" Product ".concat(o.id," added to room ").concat(t,". products:"),r.products),!0)}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=Array(t);o<t;o++)a[o]=e[o];return a}function O(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function j(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?O(Object(o),!0).forEach((function(t){(0,n.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var B=E("DataService"),z=function(){return(0,M.A)((function e(){var t,o,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,_.A)(this,e),window._dataServiceInstance)return B.log("Using existing DataService instance"),window._dataServiceInstance;this.config=Object.assign({debug:!1,ajaxUrl:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.ajax_url)||"/wp-admin/admin-ajax.php",nonce:(null===(o=window.productEstimatorVars)||void 0===o?void 0:o.nonce)||"",i18n:(null===(a=window.productEstimatorVars)||void 0===a?void 0:a.i18n)||{}},r),this.ajaxService=new D({debug:this.config.debug,ajaxUrl:this.config.ajaxUrl,nonce:this.config.nonce}),this.cache={estimatesData:null,estimatesList:null,rooms:{},similarProducts:{}},window._dataServiceLogged||(B.log("DataService initialized"),window._dataServiceLogged=!0),window._dataServiceInstance=this}),[{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B.log("[DEPRECATED] Using generic request method for '".concat(e,"'. Consider using dedicated action methods."),t),this.ajaxService._request(e,t)}},{key:"checkEstimatesExist",value:function(){var e=this;return new Promise((function(t){var o=e.loadEstimateData?e.loadEstimateData():x(),a=o&&o.estimates&&Object.keys(o.estimates).length>0;B.log("Checking localStorage for estimates: ".concat(a?"Found":"None found")),t(a)}))}},{key:"getProductUpgrades",value:function(e,t,o,a,r){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return B.log("[DataService.getProductUpgrades] DEBUG: Called with productId: ".concat(e,", estimateId: ").concat(t,", roomId: ").concat(o,", roomArea: ").concat(a,", upgradeType: ").concat(r,", bypassCache: ").concat(i)),this.ajaxService.getProductUpgrades({product_id:e,estimate_id:t,room_id:o,room_area:a,upgrade_type:r},i).then((function(e){return B.log("[DataService.getProductUpgrades] DEBUG: Response from ajaxService.getProductUpgrades:",e),e&&Array.isArray(e.upgrades)?e.upgrades:(B.warn("[getProductUpgrades] DEBUG: get_product_upgrades did not return expected data structure.",e),[])})).catch((function(e){throw B.error("[getProductUpgrades] DEBUG: Error fetching product upgrades:",e),e}))}},{key:"getEstimatesData",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.cache.estimatesData)return B.log("Returning cached estimates data from localStorage."),Promise.resolve(this.cache.estimatesData);B.log("Loading estimates data from localStorage.");var e=x(),t=e&&e.estimates?Object.values(e.estimates):[];return this.cache.estimatesData=t,Promise.resolve(t)}},{key:"getRoomsForEstimate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o="estimate_".concat(e);if(!t&&this.cache.rooms[o])return B.log("Returning cached rooms for estimate ".concat(e," from localStorage.")),Promise.resolve(this.cache.rooms[o]);B.log("Loading rooms for estimate ".concat(e," from localStorage."));var a=x(),r=a&&a.estimates?a.estimates[e]:null,i=[],n=!1;r&&r.rooms?(n=(i=(i=Object.values(r.rooms)).map((function(e){var t=parseFloat(e.width)||0,o=parseFloat(e.length)||0;return j(j({},e),{},{dimensions:"".concat(t," x ").concat(o)})}))).length>0,B.log("Found ".concat(i.length," rooms for estimate ").concat(e," in localStorage."))):B.log("Estimate ".concat(e," not found or has no rooms in localStorage."));var s={has_rooms:n,rooms:i};return this.cache.rooms[o]=s,Promise.resolve(s)}},{key:"addProductToRoom",value:function(e,t){var o,a,r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.log("DataService: Adding product to room (localStorage first)",{roomId:e,productId:t,estimateId:i});var n=x(),s=n.estimates?n.estimates[i]:null,l=s&&s.rooms?s.rooms[e]:null,c=null,d=null;if(l){if(c=l.width,d=l.length,l.products&&l.products.find((function(e){return String(e.id)===String(t)})))return B.warn("DataService: Product ID ".concat(t," already exists in room ").concat(e," locally. Aborting.")),Promise.reject({message:this.config.i18n.product_already_exists||"This product already exists in the selected room.",data:{duplicate:!0,estimate_id:i,room_id:e}})}else B.warn("DataService: Room ID ".concat(e," not found in local storage for estimate ").concat(i,". Room dimensions will be null for product data fetch."));var u=null!==(o=null==l||null===(a=l.products)||void 0===a?void 0:a.map((function(e){return e.id})))&&void 0!==o?o:[],m=P(new Set([].concat(P(u),[String(t)]))),g=this.ajaxService.getProductDataForStorage({product_id:String(t),room_width:c,room_length:d,room_products:m}).then((function(o){if(B.log("DataService: Fetched comprehensive product data response:",o),!o){var a="Failed to get comprehensive product data from server - null/undefined response.";return B.error(a),{success:!1,error:new Error(a),critical:!0}}if(!o.product_data){var r="Failed to get comprehensive product data from server - missing product_data property.";return B.error(r,o),{success:!1,error:new Error(r),critical:!0}}if(!0===o.isFallback){var n="Unable to get product data from server for product ID ".concat(t,". This is a required server request.");return B.error(n),{success:!1,error:new Error(n),critical:!0}}var s=o.product_data,l=[];if(Array.isArray(s.similar_products)||(s.similar_products=[]),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var c=o.room_suggested_products||s.room_suggested_products||[];Array.isArray(c)&&(l=c),B.log("DataService: Suggestions enabled. Processed room suggestions to be stored:",l)}else B.log("DataService: Suggestions feature disabled. Not processing room suggestions from response.");Object.prototype.hasOwnProperty.call(s,"room_suggested_products")&&delete s.room_suggested_products,B.log("DataService: Comprehensive product data to be stored (similar_products processed):",s);try{if(N(i,e,s)){var d,u;B.log("Product ID ".concat(t," (with its similar products) successfully added to room ").concat(e," in localStorage.")),window.productEstimatorVars.featureSwitches.suggested_products_enabled?(F(l,i,e),B.log("Room suggestions updated in localStorage for room ".concat(e,"."))):(F([],i,e),B.log("Suggestions cleared for room ".concat(e," as feature is disabled.")));var m=x();return{success:!0,estimateData:m,estimateId:i,roomId:e,productData:s,estimate_totals:(null===(d=m.estimates)||void 0===d||null===(d=d[i])||void 0===d?void 0:d.totals)||{min_total:0,max_total:0},room_totals:(null===(u=m.estimates)||void 0===u||null===(u=u[i])||void 0===u||null===(u=u.rooms)||void 0===u||null===(u=u[e])||void 0===u?void 0:u.totals)||{min_total:0,max_total:0}}}return B.warn("DataService: Failed to add product ID ".concat(t," to room ").concat(e," in localStorage via addProductToRoomStorage.")),{success:!1,error:new Error("Failed to add to local storage (product might exist or storage function failed).")}}catch(o){return B.error("DataService: Error adding comprehensive product ID ".concat(t," to room ").concat(e," in localStorage:"),o),{success:!1,error:o}}})).catch((function(e){return B.error("Error fetching comprehensive product data or processing local storage for addProductToRoom:",e),{success:!1,error:e}}));return g.then((function(o){if(!o.success){if(o.critical){var a,n=(null===(a=o.error)||void 0===a?void 0:a.message)||"Critical error: Unable to add product to room.";throw B.error("CRITICAL ERROR:",n),"function"==typeof window.productEstimatorShowError?window.productEstimatorShowError(n):"function"==typeof window.alert&&window.alert("Error: ".concat(n)),new Error(n)}return B.warn("Local storage update failed, skipping asynchronous server request for adding product to session."),Promise.resolve({server_request_skipped:!0,local_error:o.error})}B.log("DataService: Local storage update successful, sending asynchronous server request for adding product to session.");var s={room_id:String(e),product_id:String(t)};return null!==i&&(s.estimate_id=String(i)),r.ajaxService.addProductToRoom(s).catch((function(e){return B.error("Error sending product to server, but continuing with local data:",e),B.warn("Product added to local storage only. Changes may not persist between sessions."),{server_request_skipped:!0,error_message:e.message}}))})).then((function(e){e&&!e.server_request_skipped?(B.log("DataService: Asynchronous server-side product add (to session) successful:",e),r.invalidateCache()):e&&e.server_request_skipped&&B.warn("Using local data only - server sync skipped or failed")})).catch((function(e){throw B.error("Error in product-to-room process:",e),e})),g}},{key:"replaceProductInRoom",value:function(e,t,o,a,i){var n,s,l=this,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"main";B.log("DataService: Initiating product replacement (localStorage first)",{estimateId:e,roomId:t,oldProductId:o,newProductId:a,parentProductId:i,replaceType:c});var d=null===(n=x().estimates)||void 0===n?void 0:n[e],u=null==d||null===(s=d.rooms)||void 0===s?void 0:s[t],m=null==u?void 0:u.width,g=null==u?void 0:u.length,h=[];if(u&&Array.isArray(u.products)){h=u.products.map((function(e){return String(e.id)}));var p=String(o),v=h.indexOf(p);v>-1?h.splice(v,1,String(a)):h.push(String(a))}else h.push(String(a));h=P(new Set(h));var f=this.ajaxService.getProductDataForStorage({product_id:String(a),room_width:m,room_length:g,room_products:h}).then((function(n){if(B.log("DataService: Fetched comprehensive product data for storage (for local replacement):",n),!n||!n.product_data)throw new Error("Failed to fetch complete product data for local replacement.");var s=n.product_data,l=[];if(Array.isArray(s.similar_products)||(s.similar_products=[]),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var d=n.room_suggested_products||s.room_suggested_products||[];Array.isArray(d)&&(l=d),B.log("DataService: Suggestions enabled. Processed room suggestions to be stored for replacement:",l)}else B.log("DataService: Suggestions feature disabled. Not processing room suggestions from response for replacement.");if(Object.prototype.hasOwnProperty.call(s,"room_suggested_products")&&delete s.room_suggested_products,B.log("DataService: New product data for replacement (similar_products processed):",s),function(e,t,o,a,i){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"main",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=x();if(!(l.estimates&&l.estimates[e]&&l.estimates[e].rooms&&l.estimates[e].rooms[t]))return A.warn("Estimate or room not found in storedData."),!1;var c=l.estimates[e].rooms[t];if(A.log("Debugging: State of room.products:",c.products,"(Type: ".concat((0,r.A)(c.products),")"),"(Is Array: ".concat(Array.isArray(c.products),")")),!c.products)return!1;if(A.log("Debugging: Value of replaceType before check:",n,"(Type: ".concat((0,r.A)(n),")")),"additional_products"===n&&null!==s){A.log("Starting outer loop for main products...");for(var d=null,u=0;u<c.products.length;u++){var m=c.products[u];if(m.id==s){d=m,A.log("Found parent product:",d);break}}if(d&&d.additional_products&&Array.isArray(d.additional_products)){A.log("Searching additional products for parent product ID: ".concat(s));for(var g=0;g<d.additional_products.length;g++){var h=d.additional_products[g];if(h.id==o||h.replacement_chain&&h.replacement_chain.includes(o))return A.log("  Match found for oldProductId ".concat(o," under parent ").concat(s,"! Replacing...")),h.replacement_chain||(h.replacement_chain=[]),h.replacement_chain.includes(h.id)||h.replacement_chain.push(h.id),i.replacement_chain=h.replacement_chain,c.products.find((function(e){return e.id==s})).additional_products[g]=i,T(l),!0}A.warn("Additional product with oldProductId ".concat(o," not found under parent product ID ").concat(s,"."))}else A.warn("Parent product with ID ".concat(s," not found or has no additional products."));return A.warn("Additional product with oldProductId ".concat(o," not found in any additional_products array.")),!1}if("main"===n){for(var p=!1,v=-1,f=0;f<c.products.length;f++)if(c.products[f].id==o){p=!0,v=f;break}return!!(p&&v>=0)&&(c.products.splice(v,1),c.products.push(i),T(l),!0)}return!1}(e,t,o,a,s,c,i)){var u,m;B.log("Product replacement (old ID ".concat(o," -> new ID ").concat(a,") successful in localStorage for room ").concat(t,".")),window.productEstimatorVars.featureSwitches.suggested_products_enabled?(F(l,e,t),B.log("Room suggestions updated in localStorage for room ".concat(t," after product replacement."))):(F([],e,t),B.log("Suggestions cleared for room ".concat(t," as feature is disabled (during product replacement).")));var g=x(),h=null===(u=g.estimates)||void 0===u?void 0:u[e],p=null==h||null===(m=h.rooms)||void 0===m?void 0:m[t];return{success:!0,estimateData:g,estimateId:e,roomId:t,oldProductId:o,newProductId:a,productData:s,estimate_totals:(null==h?void 0:h.totals)||{min_total:0,max_total:0},room_totals:(null==p?void 0:p.totals)||{min_total:0,max_total:0}}}throw new Error("Failed to replace product in local storage. Original product not found or storage function failed.")})).catch((function(e){throw B.error("Error during fetch or local storage replacement attempt:",e),e}));return f.then((function(r){if(r.success){B.log("DataService: Local storage replacement successful, sending asynchronous server request for session update.");var n={estimate_id:String(e),room_id:String(t),product_id:String(a),replace_product_id:String(o),replace_type:c};return null!=i&&(n.parent_product_id=String(i)),l.ajaxService.replaceProductInRoom(n)}})).then((function(e){e&&(B.log("DataService: Asynchronous server-side product replacement (session) successful:",e),l.invalidateCache())})).catch((function(e){B.error("Asynchronous server-side product replacement (session) failed:",e)})),f}},{key:"getSimilarProducts",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];B.log("Attempting to get similar products for product ID: ".concat(e,", area: ").concat(t,". Cache bypass: ").concat(o));var a={product_id:e,room_area:t};return this.ajaxService.getSimilarProducts(a,o).then((function(e){return e&&Array.isArray(e.products)?e.products:(B.warn("get_similar_products did not return expected data structure (expected { products: [...] })",e),[])})).catch((function(e){throw B.error("Error fetching similar products:",e),e}))}},{key:"addNewEstimate",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a={form_data:this.formatFormData(e)};o&&(a.product_id=o);var r=e instanceof FormData?e.get("estimate_name"):e.estimate_name||"Unnamed Estimate",i=x().estimates||{},n=Object.keys(i).length,s=function(e){var t=x();t.estimates||(t.estimates={});var o=e.id;return o||(o="estimate_".concat(Date.now())),t.estimates[o]=e,T(t),o}({id:String(n),name:r,rooms:{}});return B.log("Client-side estimate saved to localStorage with sequential ID: ".concat(s)),this.ajaxService.addNewEstimate(a).then((function(e){B.log("DataService: Server-side estimate creation successful:",e),t.invalidateCache()})).catch((function(e){B.error("Server-side estimate creation failed:",e)})),Promise.resolve({estimate_id:s})}},{key:"addNewRoom",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return B.log("DataService: Adding new room",{estimateId:t,productId:a,formData:e instanceof FormData?Object.fromEntries(e):e}),new Promise((function(r,i){var n=x(),s=n.estimates?n.estimates[t]:null;if(!s){var l="Estimate with ID ".concat(t," not found in local storage. Cannot add room.");B.error("DataService: ".concat(l));var c={form_data:o.formatFormData(e),estimate_id:String(t)};return a&&(c.product_id=String(a)),o.ajaxService.addNewRoom(c).then((function(e){return B.log("DataService: Server add_new_room (after local estimate not found) response:",e)})).catch((function(e){return B.error("Server add_new_room (after local estimate not found) failed:",e)})),void i(new Error(l))}var d=String(Object.keys(s.rooms||{}).length),u=parseFloat(e instanceof FormData?e.get("room_width"):e.room_width)||0,m=parseFloat(e instanceof FormData?e.get("room_length"):e.room_length)||0,g={id:d,name:e instanceof FormData?e.get("room_name")||"Unnamed Room":e.room_name||"Unnamed Room",width:u,length:m,products:[],min_total:0,max_total:0};(function(e,t){var o=x();if(!o.estimates||!o.estimates[e])return!1;var a=o.estimates[e];a.rooms||(a.rooms={});var r=t.id;r||(r="room_".concat(Date.now())),a.rooms[r]=t,T(o)})(t,g),B.log("Room ID ".concat(g.id," (empty) added to localStorage for estimate ").concat(t));var h={form_data:o.formatFormData(e),estimate_id:String(t)};a&&(h.product_id=String(a)),o.ajaxService.addNewRoom(h).then((function(e){B.log("DataService: Server-side room creation successful (potentially with product):",e),o.invalidateCache()})).catch((function(e){B.error("Server-side room creation failed:",e)})),a?(B.log("DataService: Product ID ".concat(a," provided for new room ").concat(d,". Fetching product data and managing suggestions.")),o.ajaxService.getProductDataForStorage({product_id:String(a),room_width:u,room_length:m,room_products:[String(a)]}).then((function(e){if(B.log("DataService: Fetched comprehensive product data for new room product:",e),!e||!e.product_data){var o="Failed to get comprehensive product data for new room product.";return B.warn("DataService: ".concat(o)),void r(j(j({room_id:d,estimate_id:t},g),{},{product_added_successfully:!1,error:o}))}var n=e.product_data,s=[];if(Array.isArray(n.similar_products)||(n.similar_products=[]),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var l=e.room_suggested_products||n.room_suggested_products||[];Array.isArray(l)&&(s=l),B.log("DataService: Suggestions enabled. Processed room suggestions for new room:",s)}else B.log("DataService: Suggestions feature disabled. Not processing room suggestions for new room.");Object.prototype.hasOwnProperty.call(n,"room_suggested_products")&&delete n.room_suggested_products,B.log("DataService: Comprehensive product data for new room (similar_products processed):",n);try{if(N(t,d,n)){var c,u;B.log("Product ID ".concat(a," successfully added to new room ").concat(d," in localStorage.")),window.productEstimatorVars.featureSwitches.suggested_products_enabled?(F(s,t,d),B.log("Suggestions updated for new room ".concat(d," in localStorage."))):(F([],t,d),B.log("Suggestions cleared for new room ".concat(d," as feature is disabled.")));var m=null===(c=x().estimates)||void 0===c?void 0:c[t],h=null==m||null===(u=m.rooms)||void 0===u?void 0:u[d];r(j(j({room_id:d,estimate_id:t},h||g),{},{product_data:n,product_added_successfully:!0}))}else{var p="Failed to add product ID ".concat(a," to new room ").concat(d," via addProductToRoomStorage.");B.warn("DataService: ".concat(p)),r(j(j({room_id:d,estimate_id:t},g),{},{product_added_successfully:!1,error:p}))}}catch(e){var v="Error adding product ID ".concat(a," to new room ").concat(d," in localStorage: ").concat(e.message);B.error("DataService: ".concat(v),e),i(new Error(v))}})).catch((function(e){var t="DataService: Error fetching product data for new room (product ID ".concat(a,"): ").concat(e.message);B.error(t,e),i(new Error(t))}))):(B.log("No product ID provided for new room ".concat(d,". Resolving with basic room data.")),r(j(j({room_id:d,estimate_id:t},g),{},{product_added_successfully:null})))}))}},{key:"removeProductFromRoom",value:function(e,t,o,a){var r=this;return B.log("[removeProductFromRoom] Initiating product removal process",{estimateId:e,roomId:t,productIndex:o,productId:a}),new Promise((function(i,n){var s,l,c=null===(s=x().estimates)||void 0===s?void 0:s[e],d=null==c||null===(l=c.rooms)||void 0===l?void 0:l[t];if(!d||!Array.isArray(d.products)){var u="Room or products array not found in localStorage for product removal.";return B.log("[removeProductFromRoom] Error: ".concat(u)),void n(new Error(u))}d.products.find((function(e){return String(e.id)===String(a)}))||B.log("[removeProductFromRoom] Warning: Product with ID ".concat(a," not found in room ").concat(t," (localStorage) before attempting removal logic."));var m=d.products.filter((function(e){return String(e.id)!==String(a)})).map((function(e){return e.id})),g=function(s){var l,c,d=!1,u=null;try{(d=function(e,t,o,a){var r=x();if(!(r.estimates&&r.estimates[e]&&r.estimates[e].rooms&&r.estimates[e].rooms[t]&&Array.isArray(r.estimates[e].rooms[t].products)))return A.warn("[removeProductFromRoom] Attempted to remove product: Path to products array is invalid or products array is missing.",{estimateId:e,roomId:t,receivedProductId:a}),!1;var i=r.estimates[e].rooms[t].products,n=i.findIndex((function(e){return String(e.id)===String(a)}));return-1===n?(A.warn("[removeProductFromRoom] Product with ID '".concat(a,"' not found in room '").concat(t,"' for estimate '").concat(e,"'. Cannot remove.")),!1):(i.splice(n,1),T(r),A.log("[removeProductFromRoom] Product with ID '".concat(a,"' successfully removed from localStorage for room '").concat(t,"', estimate '").concat(e,"'.")),!0)}(e,t,0,a))?B.log("[removeProductFromRoom] Product ID ".concat(a," reported as removed from localStorage by EstimateStorage.")):(u=new Error("Failed to remove product ID ".concat(a," from localStorage (EstimateStorage.removeProductFromRoom returned false).")),B.log("[removeProductFromRoom] Warning: ".concat(u.message)))}catch(e){u=new Error("Error during localStorage product removal for ID ".concat(a,": ").concat(e.message)),B.log("[removeProductFromRoom] Error: ".concat(u.message),e)}if(!u||d){var m=null===(l=x().estimates)||void 0===l?void 0:l[e],g=null==m||null===(c=m.rooms)||void 0===c?void 0:c[t],h=d?"Product removed locally. ":"Product local removal status uncertain (check logs). ";switch(s){case"updated":h+="Suggestions updated.";break;case"update_failed":h+="Suggestion update failed (see logs).";break;case"cleared_due_to_disabled":h+="Suggestions cleared (feature disabled).";break;default:h+="Suggestions not managed (feature disabled)."}i({success:!0,message:h,estimateId:e,roomId:t,productId:a,estimate_totals:(null==m?void 0:m.totals)||{min_total:0,max_total:0},room_totals:(null==g?void 0:g.totals)||{min_total:0,max_total:0}}),B.log("[removeProductFromRoom] Initiating asynchronous server call to remove_product_from_room."),r.ajaxService.removeProductFromRoom({estimate_id:e,room_id:t,product_index:o,product_id:a}).then((function(e){B.log("[removeProductFromRoom] Async server product removal successful:",e),r.invalidateCache()})).catch((function(e){B.log("[removeProductFromRoom] Async server product removal failed:",e)}))}else n(u)};window.productEstimatorVars.featureSwitches.suggested_products_enabled?(B.log("[removeProductFromRoom] Suggestions enabled. Fetching updated suggestions for room based on post-deletion state."),r.ajaxService.fetchSuggestionsForModifiedRoom({estimate_id:e,room_id:t,room_product_ids_for_suggestions:JSON.stringify(m)}).then((function(o){B.log("[removeProductFromRoom] Successfully fetched updated suggestions:",o),o&&Array.isArray(o.updated_suggestions)?(F(o.updated_suggestions,e,t),B.log("[removeProductFromRoom] Suggestions updated in localStorage."),g("updated")):(B.log("[removeProductFromRoom] No updated_suggestions array received or invalid format. Clearing local suggestions."),F([],e,t),g("update_failed"))})).catch((function(o){B.error("[removeProductFromRoom] Error fetching suggestions:",o,". Proceeding with product removal without suggestion update."),F([],e,t),B.log("[removeProductFromRoom] Cleared local suggestions due to fetch error."),g("update_failed")}))):(B.log("[removeProductFromRoom] Suggestions disabled. Skipping suggestion fetch/update."),F([],e,t),B.log("[removeProductFromRoom] Cleared local suggestions as feature is disabled."),g("cleared_due_to_disabled"))}))}},{key:"removeRoom",value:function(e,t){var o=this;B.log("DataService: Removing room",{estimateId:e,roomId:t});try{!function(e,t){var o=x();return!!(o.estimates&&o.estimates[e]&&o.estimates[e].rooms&&o.estimates[e].rooms[t])&&(delete o.estimates[e].rooms[t],T(o),!0)}(e,t)?B.warn("Room ID ".concat(t," not found in localStorage for estimate ").concat(e," during removal attempt.")):B.log("Room ID ".concat(t," successfully removed from localStorage for estimate ").concat(e))}catch(e){B.error("Error removing room ID ".concat(t," from localStorage:"),e)}var a={estimate_id:String(e),room_id:String(t)};return this.ajaxService.removeRoom(a).then((function(e){B.log("DataService: Server-side room removal successful:",e),o.invalidateCache()})).catch((function(e){B.error("Server-side room removal failed:",e)})),Promise.resolve({success:!0})}},{key:"removeEstimate",value:function(e){var t=this;B.log("DataService: Removing estimate ".concat(e));try{!function(e){var t=x();return!(!t.estimates||!t.estimates[e]||(delete t.estimates[e],T(t),0))}(e)?B.warn("Estimate ID ".concat(e," not found in localStorage during removal attempt.")):B.log("Estimate ID ".concat(e," successfully removed from localStorage."))}catch(t){B.error("Error removing estimate ID ".concat(e," from localStorage:"),t)}return this.ajaxService.removeEstimate({estimate_id:e}).then((function(o){B.log("DataService: Server-side estimate removal successful: ".concat(e),o),t.invalidateCache()})).catch((function(t){B.error("DataService: Server-side estimate removal failed: ".concat(e),t)})),Promise.resolve({success:!0})}},{key:"getSuggestedProducts",value:function(e,t){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return B.log("[getSuggestedProducts] Suggestions feature is disabled. Returning null for room ".concat(t,".")),Promise.resolve(null);B.log("Getting suggested products for room ".concat(t," in estimate ").concat(e," from localStorage."));var o=function(e,t){if(!window.productEstimatorVars.featureSwitches.suggested_products_enabled)return A.log("[getSuggestionsForRoom] Suggestions feature is disabled. Returning null for room ".concat(t,".")),Promise.resolve(null);var o=x();return o.estimates&&o.estimates[e]&&o.estimates[e].rooms&&o.estimates[e].rooms[t]&&o.estimates[e].rooms[t].product_suggestions||null}(e,t);return o?(B.log("Found suggestions for room ".concat(t,":"),o),Promise.resolve(o)):(B.log("No suggestions found for room ".concat(t," in localStorage.")),Promise.resolve(null))}},{key:"getVariationEstimator",value:function(e){return this.ajaxService.getVariationEstimator({variation_id:e})}},{key:"formatFormData",value:function(e){if("string"==typeof e)return e;if(e instanceof FormData){var t,o=new URLSearchParams,a=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return H(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?H(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==o.return||o.return()}finally{if(s)throw i}}}}(e.entries());try{for(a.s();!(t=a.n()).done;){var r=(0,i.A)(t.value,2),n=r[0],s=r[1];o.append(n,s)}}catch(e){a.e(e)}finally{a.f()}return o.toString()}return new URLSearchParams(e).toString()}},{key:"invalidateCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;B.log("Invalidating caches"),e?Object.prototype.hasOwnProperty.call(this.cache,e)&&("object"===(0,r.A)(this.cache[e])?this.cache[e]={}:this.cache[e]=null):(this.cache.estimatesData=null,this.cache.estimatesList=null,this.cache.rooms={}),this.ajaxService.invalidateCache(e)}}])}();const V=z;var U="productEstimatorCustomerData",W=E("CustomerStorage");function G(){try{var e=localStorage.getItem(U);if(e)return JSON.parse(e);var t=sessionStorage.getItem(U);return t?JSON.parse(t):{}}catch(e){return W.error("Error loading customer details:",e),{}}}function J(e){try{localStorage.setItem(U,JSON.stringify(e))}catch(t){W.warn("localStorage not available, using sessionStorage:",t);try{sessionStorage.setItem(U,JSON.stringify(e))}catch(e){W.error("sessionStorage not available:",e)}}}function Q(){try{localStorage.removeItem(U)}catch(e){W.warn("localStorage not available:",e)}try{sessionStorage.removeItem(U)}catch(e){W.warn("sessionStorage not available:",e)}}var K=E("TemplateEngine"),$=function(){return(0,M.A)((function e(){(0,_.A)(this,e),this.templates={},this.templateElements={},this.initialized=!1}),[{key:"init",value:function(){var e=this;return this.initialized?(K.log("[init] Already initialized."),this):(K.log("[init] Initializing TemplateEngine. Templates to process:",Object.keys(this.templates)),Object.entries(this.templates).forEach((function(t){var o=(0,i.A)(t,2),a=o[0],r=o[1];try{var n=document.createElement("div");n.innerHTML=r;var s=n.querySelector("template");if(s)e.templateElements[a]=s,K.log('[init] Template element found in HTML for ID: "'.concat(a,'"'));else{K.error('[init] UNEXPECTED: templateElement was null/undefined for ID: "'.concat(a,'". Creating nested template. Original HTML likely already contained a <template> tag.'));var l=document.createElement("template");l.id=a,l.innerHTML=r,e.templateElements[a]=l,K.log('[init] Created new template element for ID: "'.concat(a,'" (HTML was likely raw, not wrapped in <template>)'))}if(e.templateElements[a]){var c=e.templateElements[a].content||e.templateElements[a];if(K.log('[init] TemplateElement for "'.concat(a,'" created. Inner HTML starts with:'),((null==c?void 0:c.innerHTML)||"No innerHTML or content").substring(0,200)+"..."),"room-item-template"===a){var d=document.createElement("div");null!=c&&c.innerHTML?d.innerHTML=c.innerHTML:Array.from((null==c?void 0:c.childNodes)||[]).forEach((function(e){return d.appendChild(e.cloneNode(!0))})),K.log('[init] Checking "'.concat(a,'" content for .product-list:'),d.querySelector(".product-list")?"Found":"Not Found"),d.querySelector(".product-list")||K.error('[init] CRITICAL: .product-list not found in "'.concat(a,'" template element content after creation.'))}}else K.error('[init] Failed to assign template element for ID: "'.concat(a,'"'))}catch(e){K.error('[init] Error processing template HTML for ID "'.concat(a,'":'),e)}})),K.log("[init] TemplateEngine initialized with ".concat(Object.keys(this.templateElements).length," template elements")),this.initialized=!0,this)}},{key:"registerTemplate",value:function(e,t){return"string"!=typeof t||""===t.trim()?(K.warn('[registerTemplate] Cannot register empty or non-string HTML for template "'.concat(e,'".')),this):(this.templates[e]=t,this.initialized=!1,K.log('[registerTemplate] Registered template "'.concat(e,'". HTML starts with:'),t.substring(0,200)+"..."),this)}},{key:"getTemplate",value:function(e){this.initialized||(K.warn("[getTemplate] TemplateEngine not initialized yet. Calling init()."),this.init());var t=this.templateElements[e]||null;return t||K.error('[getTemplate] Template element not found for ID: "'.concat(e,'".')),t}},{key:"create",value:function(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.getTemplate(e);if(!a)return K.error('[create] Cannot create element. Template element not found for ID: "'.concat(e,'"')),document.createDocumentFragment();if(K.log('[DEBUG][TemplateEngine.create] Found template element for "'.concat(e,'":'),a),K.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" direct innerHTML (first 200 chars):'),a.innerHTML.substring(0,200)),a.content){K.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" has .content property:'),a.content),K.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" .content.childNodes count:'),a.content.childNodes.length);for(var r=a.content.childNodes,i=0;i<Math.min(r.length,3);i++){var n=r[i],s=n.textContent?n.textContent.trim().substring(0,50):"[No textContent]";K.log("[DEBUG][TemplateEngine.create] Node[".concat(i,"] type: ").concat(n.nodeType,", name: ").concat(n.nodeName,", text: ").concat(s,"..."))}var l=a.content.firstElementChild;K.log('[DEBUG][TemplateEngine.create] Template "'.concat(e,'" .content.firstElementChild:'),l)}else K.error('[DEBUG][TemplateEngine.create] CRITICAL: Template "'.concat(e,'" DOES NOT HAVE a .content property!'));try{if(!a.content)return K.error('[create] Cannot clone template content for ID: "'.concat(e,'" - .content is missing.')),document.createDocumentFragment();if(!(t=a.content.cloneNode(!0)))return K.error('[create] Failed to clone template content for ID: "'.concat(e,'". cloneNode returned null/undefined.')),document.createDocumentFragment();K.log('[create] Cloned template content for "'.concat(e,'". Result is a DocumentFragment.'));var c=document.createElement("div");c.appendChild(t.cloneNode(!0)),K.log('[DEBUG][TemplateEngine.create] Cloned fragment structure for "'.concat(e,'" (first 200 chars): ').concat(c.innerHTML.substring(0,200),"..."))}catch(t){return K.error('[create] Error during template.content.cloneNode(true) for ID "'.concat(e,'":'),t),document.createDocumentFragment()}try{this.populateElement(t,o),K.log('[create] Populated fragment for "'.concat(e,'".'))}catch(t){K.error('[create] Error populating fragment for ID "'.concat(e,'":'),t)}if("room-item-template"===e){var d=t.querySelector(".product-list");K.log('[create] Created fragment for "'.concat(e,'". Checking for .product-list before returning:'),d?"Found":"Not Found"),d||K.error('[create] CRITICAL: .product-list not found in "'.concat(e,'" fragment before returning. This fragment will not render products correctly.'))}return t}},{key:"populateElement",value:function(e,t){var o=this;if(Object.entries(t).forEach((function(o){var a=(0,i.A)(o,2),n=a[0],s=a[1];"object"===(0,r.A)(s)||Array.isArray(s)||(e.querySelectorAll(".".concat(n)).forEach((function(e){"IMG"===e.tagName&&"image"===n?(e.src=s||"",t.name&&(e.alt=t.name)):"INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName?e.value=s:e.textContent=s})),"name"===n&&e.querySelectorAll(".suggestion-name").forEach((function(e){e.textContent=s})),"image"===n&&e.querySelectorAll("img.similar-product-thumbnail").forEach((function(e){var o;e.src=s||"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.alt=t.name||"Similar Product Image";var a=null===(o=e.closest(".suggestion-image"))||void 0===o?void 0:o.querySelector(".no-image");s&&""!==s.trim()?(e.style.display="",a&&(a.style.display="none")):(e.style.display="none",a&&(a.style.display=""))})),e.querySelectorAll("[data-".concat(n,"]")).forEach((function(e){e.setAttribute("data-".concat(n),s)})))})),void 0!==t.product_index&&e.querySelectorAll(".remove-product").forEach((function(e){e.dataset.productIndex=t.product_index,void 0!==t.estimate_id&&(e.dataset.estimateId=t.estimate_id),void 0!==t.room_id&&(e.dataset.roomId=t.room_id),K.log("Setting removal button data attributes: estimate=".concat(t.estimate_id,", room=").concat(t.room_id,", product=").concat(t.product_index))})),t.estimate_id&&e.querySelectorAll("[data-estimate-id]").forEach((function(e){e.setAttribute("data-estimate-id",t.estimate_id)})),t.room_id&&e.querySelectorAll("[data-room-id]").forEach((function(e){e.setAttribute("data-room-id",t.room_id)})),(t.name||t.room_name)&&e.querySelectorAll(".room-name").forEach((function(e){e.textContent=t.name||t.room_name||"Unnamed Room"})),t.id?(e.querySelectorAll("[data-product-id]").forEach((function(e){e.setAttribute("data-product-id",t.id)})),e.classList&&e.classList.contains("product-item")&&e.setAttribute("data-product-id",t.id)):t.product_id&&e.querySelectorAll("[data-product-id]").forEach((function(e){e.setAttribute("data-product-id",t.product_id)})),void 0!==t.product_index&&(e.querySelectorAll("[data-product-index]").forEach((function(e){e.setAttribute("data-product-index",t.product_index)})),e.classList&&e.classList.contains("product-item")&&e.setAttribute("data-product-index",t.product_index)),t.image&&e.querySelectorAll("img.product-thumbnail, img.product-img").forEach((function(e){e.src=t.image,e.alt=t.name||"Product"})),void 0!==t.min_total&&void 0!==t.max_total&&e.querySelectorAll(".estimate-price").forEach((function(e){e.textContent="".concat(g(t.min_total)," - ").concat(g(t.max_total))})),void 0!==t.min_price_total&&void 0!==t.max_price_total&&e.querySelectorAll(".product-price").forEach((function(e){e.textContent="".concat(g(t.min_price_total)," - ").concat(g(t.max_price_total))})),void 0!==t.min_price_total&&void 0!==t.max_price_total&&e.querySelectorAll(".suggestion-price").forEach((function(e){t.min_price_total===t.max_price_total?e.textContent=g?g(t.min_price_total):t.min_price_total:e.textContent="".concat(g?g(t.min_price_total):t.min_price_total," - ").concat(g?g(t.max_price_total):t.max_price_total)})),t.name&&e.querySelectorAll(".price-title, .product-name").forEach((function(e){e.textContent=t.name})),Object.entries(t).forEach((function(t){var a=(0,i.A)(t,2),r=a[0],n=a[1];if(Array.isArray(n)&&n.length>0){var s=e.querySelector(".".concat(r))||e.querySelector(".".concat(r,"-container"))||e.querySelector(".".concat(r,"-items"));if(s&&n[0].template){var l=n[0].template;n.forEach((function(e){var t=o.create(l,e);s.appendChild(t)}))}}})),t.additional_products){var a=e.querySelector(".includes-container"),n=e.querySelector(".product-includes-items");if(a&&n){n.innerHTML="";var s=Array.isArray(t.additional_products)?t.additional_products.filter((function(e){return e&&e.id})):[];if(s.length>0){a.style.display="block",a.classList.add("visible"),s.forEach((function(e){if(o.getTemplate("include-item-template")){var t={product_id:e.id,include_item_name:e.name||"Additional Product"};void 0!==e.min_price_total&&void 0!==e.max_price_total&&(t.include_item_total_price=g(e.min_price_total)+" - "+g(e.max_price_total),e.total_price=g(e.min_price_total)+" - "+g(e.max_price_total)),K.log("include item product:: ",e);var a=o.create("include-item-template",t),r=a.querySelector(".include-item-name");r&&(r.textContent=e.name||"");var i=a.querySelector(".include-item-total-price");i&&(i.textContent=e.total_price||""),n.appendChild(a)}}));var l=e.querySelector(".product-includes-toggle");l&&(l.style.display="")}else{a.style.display="none",a.classList.remove("visible");var c=e.querySelector(".product-includes-toggle");c&&(c.style.display="none")}}}if(t.additional_notes&&Array.isArray(t.additional_notes)){var d=e.querySelector(".notes-container"),u=e.querySelector(".product-notes-items");if(d&&u){u.innerHTML="";var m=t.additional_notes.filter((function(e){return e&&(e.note_text||e.text)&&""!==(e.note_text||e.text).trim()}));if(m.length>0)d.style.display="block",d.classList.add("visible"),m.forEach((function(e){if(o.getTemplate("note-item-template")){var t=o.create("note-item-template",{}),a=t.querySelector(".note-text");a&&(a.textContent=e.note_text||e.text||""),u.appendChild(t)}}));else{d.style.display="none",d.classList.remove("visible");var h=e.querySelector(".product-notes-toggle");h&&(h.style.display="none")}}}if(void 0!==t.replace_product_id){var p=e.querySelector(".replace-product-in-room");p&&(p.dataset.replaceProductId=t.replace_product_id,K.log("TemplateEngine: Set data-replace-product-id on button to: ".concat(t.replace_product_id)))}if(void 0!==t.pricing_method){var v=e.querySelector(".replace-product-in-room");v&&(v.dataset.pricingMethod=t.pricing_method,K.log("TemplateEngine: Set data-pricing-method on button to: ".concat(t.pricing_method)))}}},{key:"insert",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"append",r=this.create(e,t);if("string"==typeof o&&(o=document.querySelector(o)),!o)return K.error('[insert] Container not found for template: "'.concat(e,'"')),null;try{switch(a){case"prepend":o.prepend(r);break;case"before":o.parentNode.insertBefore(r,o);break;case"after":o.parentNode.insertBefore(r,o.nextSibling);break;case"replace":K.warn('[insert] "replace" position used for template "'.concat(e,"\". Replacing container with fragment's children.")),o.parentNode.replaceChild(r,o);break;default:o.appendChild(r)}return K.log('[insert] Inserted template "'.concat(e,'" into container. Position: ').concat(a)),r}catch(t){return K.error('[insert] Error inserting template "'.concat(e,'" into container. Position: ').concat(a),t),null}}},{key:"showMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".product-estimator-modal-form-container";if(document.querySelectorAll(".modal-message").forEach((function(e){return e.remove()})),!this.getTemplate("modal-messages-template")){var a=document.createElement("div");return a.className="modal-message modal-".concat(t,"-message"),a.textContent=e,"string"==typeof o&&(o=document.querySelector(o)),void(o&&(o.prepend(a),setTimeout((function(){a.parentNode&&a.remove()}),5e3)))}var r=document.createElement("div");r.className="modal-message modal-".concat(t,"-message"),r.innerHTML='<div class="message-content">'.concat(e,"</div>"),"string"==typeof o&&(o=document.querySelector(o)),o&&(o.prepend(r),setTimeout((function(){r.parentNode&&r.remove()}),5e3))}},{key:"createModalContainer",value:function(){K.log("Creating modal container from template");try{var e,t,o,a=document.querySelector("#product-estimator-modal");if(a)return K.log("Modal container already exists in DOM"),a;var r=this.getTemplate("modal-container-template");if(!r)return K.error("Modal container template not found"),null;if(K.group("Debug: Template Creation"),K.log("Template id:","modal-container-template"),K.log("Template found:",!!r),K.log("Template outerHTML:",r.outerHTML),r.content){K.log("Template has content property with:",r.content.childNodes.length,"child nodes"),Array.from(r.content.childNodes).slice(0,3).forEach((function(e,t){K.log("Node[".concat(t,"]:"),e.nodeType,e.nodeName)}));var i=document.createElement("div");i.appendChild(r.content.cloneNode(!0)),K.log("Template content inner HTML:",i.innerHTML.substring(0,500)+"..."),K.log("Template contains #estimates:",!!i.querySelector("#estimates")),K.log("Template contains #estimate-selection-wrapper:",!!i.querySelector("#estimate-selection-wrapper")),K.log("Template contains #room-selection-form-wrapper:",!!i.querySelector("#room-selection-form-wrapper"))}K.groupEnd();var n=this.create("modal-container-template",{title:(null===(e=window.productEstimatorVars)||void 0===e||null===(e=e.i18n)||void 0===e?void 0:e.productEstimator)||"Product Estimator",close:(null===(t=window.productEstimatorVars)||void 0===t||null===(t=t.i18n)||void 0===t?void 0:t.close)||"Close",loading:(null===(o=window.productEstimatorVars)||void 0===o||null===(o=o.i18n)||void 0===o?void 0:o.loading)||"Loading..."});if(n){K.log("Created fragment structure for modal:",n.childNodes.length,"child nodes at root level");var s=document.createElement("div");s.appendChild(n.cloneNode(!0)),K.log("Fragment content before appending to DOM:",s.innerHTML.substring(0,300)+"..."),K.log("Fragment contains #estimates:",!!s.querySelector("#estimates")),K.log("Fragment contains form-container:",!!s.querySelector(".product-estimator-modal-form-container"))}document.body.appendChild(n),K.log("Modal fragment appended to document body");var l=document.querySelector("#product-estimator-modal");if(K.log("DOM after fragment append - modal found:",!!l),l){var c={modal:!!l,container:!!l.querySelector(".product-estimator-modal-container"),formContainer:!!l.querySelector(".product-estimator-modal-form-container"),estimates:!!l.querySelector("#estimates"),estimateSelection:!!l.querySelector("#estimate-selection-wrapper"),roomSelection:!!l.querySelector("#room-selection-form-wrapper"),newEstimate:!!l.querySelector("#new-estimate-form-wrapper"),newRoom:!!l.querySelector("#new-room-form-wrapper")};if(K.log("Modal element created with child elements status:",c),K.log("Modal HTML structure:",l.outerHTML.substring(0,500)+"..."),!c.estimates){K.error("Critical element #estimates missing in created modal!");var d=l.querySelector(".product-estimator-modal-form-container");d&&K.log("Form container exists but missing #estimates. Form container HTML:",d.innerHTML)}}return l?(K.log("Modal container created and added to DOM"),l):(K.error("Failed to find modal element after creating it"),null)}catch(e){return K.error("Error creating modal container:",e),null}}},{key:"debugTemplates",value:function(){K.group("TemplateEngine Debug"),K.log("Registered template IDs:",Object.keys(this.templates)),K.log("Template elements:",Object.keys(this.templateElements)),Object.entries(this.templateElements).forEach((function(e){var t=(0,i.A)(e,2),o=t[0],a=t[1];K.log("Template ".concat(o,":"),a),a.content?K.log("- Has content: ".concat(a.content.childNodes.length," child nodes")):K.warn("- No content for template ".concat(o))})),K.groupEnd()}},{key:"debugNoteData",value:function(e,t){K.log("Note data processing:",{hasNotes:!(!t.additional_notes||!Array.isArray(t.additional_notes)),notesCount:t.additional_notes?t.additional_notes.length:0,notesContainer:e.querySelector(".notes-container")?"found":"missing",notesItems:e.querySelector(".product-notes-items")?"found":"missing",noteTemplate:this.getTemplate("note-item-template")?"found":"missing",firstNote:t.additional_notes&&t.additional_notes.length>0?t.additional_notes[0]:null})}},{key:"verifyTemplates",value:function(){K.group("Template Verification"),K.log("Registered templates:",Object.keys(this.templates)),K.log("Template elements:",Object.keys(this.templateElements)),this.templates["note-item-template"]?K.log("Note template HTML:",this.templates["note-item-template"].substring(0,100)+"..."):K.warn("Note template not registered!"),this.templateElements["note-item-template"]?K.log("Note template element exists"):K.warn("Note template element not created!"),K.groupEnd()}}])}();const Y=new $;function X(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function Z(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?X(Object(o),!0).forEach((function(t){(0,n.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):X(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var ee=E("ConfirmationDialog"),te=function(){return(0,M.A)((function e(){(0,_.A)(this,e),this.dialog=null,this.backdropElement=null,this.initialized=!1,this.callbacks={confirm:null,cancel:null},this.init()}),[{key:"init",value:function(){this.initialized||(this.createDialogElements(),this.bindEvents(),this.initialized=!0,productEstimatorVars&&productEstimatorVars.debug&&ee.log("Initialized"))}},{key:"createDialogElements",value:function(){this.backdropElement=document.createElement("div"),this.backdropElement.className="pe-dialog-backdrop",this.dialog=document.createElement("div"),this.dialog.className="pe-confirmation-dialog",this.dialog.setAttribute("role","dialog"),this.dialog.setAttribute("aria-modal","true"),this.dialog.innerHTML='\n    <div class="dialog-content">\n      <div class="pe-dialog-header">\n        <h3 class="pe-dialog-title">Confirm Action</h3>\n        <button type="button" class="pe-dialog-close" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="pe-dialog-body">\n        <p class="pe-dialog-message">Are you sure you want to proceed?</p>\n      </div>\n      <div class="pe-dialog-footer">\n        <button type="button" class="pe-dialog-btn pe-dialog-cancel">Cancel</button>\n        <button type="button" class="pe-dialog-btn pe-dialog-confirm">Confirm</button>\n      </div>\n    </div>\n  ';var e=document.querySelector(".pe-dialog-backdrop"),t=document.querySelector(".pe-confirmation-dialog");e&&e.remove(),t&&t.remove(),document.body.appendChild(this.backdropElement),document.body.appendChild(this.dialog)}},{key:"bindEvents",value:function(){var e=this,t=this.dialog.querySelector(".pe-dialog-close"),o=this.dialog.querySelector(".pe-dialog-cancel"),a=this.dialog.querySelector(".pe-dialog-confirm");t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel()})),o.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel()})),a.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.confirm&&e.callbacks.confirm()})),this.backdropElement.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),t.target===e.backdropElement&&(e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel())})),this.dialog.addEventListener("click",(function(e){e.stopPropagation()})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.isVisible()&&(t.preventDefault(),t.stopPropagation(),e.hide(),"function"==typeof e.callbacks.cancel&&e.callbacks.cancel())}))}},{key:"show",value:function(){var e,t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(null===(e=window.productEstimatorVars)||void 0===e?void 0:e.i18n)||{},r=Z(Z({},{title:"Confirm Action",message:"Are you sure you want to proceed?",type:"",confirmText:a.confirm||"Confirm",cancelText:a.cancel||"Cancel",onConfirm:null,onCancel:null,action:"delete",showCancel:!0}),o);null!==o.cancelText&&!1!==o.cancelText||(r.showCancel=!1),this.callbacks.confirm=r.onConfirm,this.callbacks.cancel=r.onCancel;var i=this.dialog.querySelector(".pe-dialog-title"),n=this.dialog.querySelector(".pe-dialog-message"),s=this.dialog.querySelector(".pe-dialog-confirm"),l=this.dialog.querySelector(".pe-dialog-cancel");i&&(i.textContent=r.title),n&&(n.textContent=r.message),s&&(s.textContent=r.confirmText),l&&(r.showCancel?(l.style.display="",l.textContent=r.cancelText):(l.style.display="none",s&&(s.style.width="100%"))),this.dialog.classList.remove("pe-dialog-type-product","pe-dialog-type-room","pe-dialog-type-estimate","pe-dialog-notification"),P(this.dialog.classList).forEach((function(e){/^pe-dialog-action-/.test(e)&&t.dialog.classList.remove(e)})),r.type&&this.dialog.classList.add("pe-dialog-type-".concat(r.type)),r.action&&this.dialog.classList.add("pe-dialog-action-".concat(r.action)),r.showCancel||"estimate"!==r.type||this.dialog.classList.add("pe-dialog-notification"),this.backdropElement&&(this.backdropElement.style.display="block"),this.dialog&&(this.dialog.style.display="block"),this.dialog&&this.dialog.classList.add("active"),setTimeout((function(){var e=r.showCancel?t.dialog.querySelector(".pe-dialog-cancel"):t.dialog.querySelector(".pe-dialog-confirm");e&&e.focus()}),100)}},{key:"hide",value:function(){this.backdropElement&&(this.backdropElement.style.display="none"),this.dialog&&(this.dialog.classList.remove("active"),this.dialog.style.display="none")}},{key:"isVisible",value:function(){return this.dialog&&"block"===this.dialog.style.display}}])}();const oe=te;var ae=E("EstimateManager");const re=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,_.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.estimatesList=null,this.estimateSelection=null,this.newEstimateForm=null,this.currentProductId=null,this.handleProductFlow=this.handleProductFlow.bind(this),this.showEstimatesList=this.showEstimatesList.bind(this),this.loadEstimatesList=this.loadEstimatesList.bind(this),this.showNewEstimateForm=this.showNewEstimateForm.bind(this),this.handleEstimateRemoval=this.handleEstimateRemoval.bind(this),this.updateEstimate=this.updateEstimate.bind(this),this.bindEstimateSelectionFormEvents=this.bindEstimateSelectionFormEvents.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){this.estimatesList=this.modalManager.estimatesList,this.estimateSelection=this.modalManager.estimateSelection,this.newEstimateForm=this.modalManager.newEstimateForm,this.bindEvents(),ae.log("EstimateManager initialized")}},{key:"bindEvents",value:function(){ae.log("EstimateManager events bound")}},{key:"hideAllSections",value:function(){var e=this;ae.log("Hiding all sections"),[this.modalManager.estimatesList,this.modalManager.estimateSelection,this.modalManager.roomSelectionForm,this.modalManager.newEstimateForm,this.modalManager.newRoomForm].forEach((function(t){t&&e.modalManager.uiManager?e.modalManager.uiManager.hideElement(t):t&&(t.style.display="none")}))}},{key:"handleProductFlow",value:function(e){var t=this;ae.log("Handling product flow with ID:",e),this.currentProductId=e,this.modalManager.showLoading(),this.dataService.checkEstimatesExist().then((function(o){ae.log("Has estimates check result:",o),o?(ae.log("Estimates found, showing estimate selection."),t.showEstimateSelection(e)):(ae.log("No estimates found, showing new estimate form."),t.showNewEstimateForm(e))})).catch((function(e){ae.error("Error checking estimates:",e),t.modalManager.contentContainer&&Y.showMessage("Error checking estimates. Please try again.","error",t.modalManager.contentContainer),t.modalManager.hideLoading()}))}},{key:"showEstimateSelection",value:function(e){ae.log("Showing estimate selection with product ID:",e),this.modalManager.contentContainer;var t=this.modalManager.estimateSelection;if(this.hideAllSections(),!t)return ae.error("Estimate selection wrapper not found in modal"),this.modalManager.hideLoading(),void this.modalManager.showError("Modal structure incomplete. Please contact support.");this.modalManager.forceElementVisibility(t);try{t.innerHTML="",Y.insert("estimate-selection-template",{},t),ae.log("Estimate selection template inserted into wrapper.");var o=t.querySelector("#estimate-selection-form-wrapper");if(o){this.modalManager.forceElementVisibility(o);var a=o.querySelector("form");a?(ae.log("Estimate selection form element found after template insertion, populating dropdown and binding events."),this.loadEstimatesData(a,e),this.bindEstimateSelectionFormEvents(a,e)):(ae.error("Form element not found inside the template after insertion!"),this.modalManager.showError("Error rendering form template. Please try again."),this.modalManager.hideLoading())}else ae.error("Estimate selection form wrapper not found in template!"),this.modalManager.showError("Modal structure incomplete. Please contact support."),this.modalManager.hideLoading()}catch(e){ae.error("Error inserting estimate selection template:",e),this.modalManager.showError("Error loading selection form template. Please try again."),this.modalManager.hideLoading()}}},{key:"loadEstimatesData",value:function(e,t){var o=this;ae.log("Loading estimates data for selection form");var a=e.querySelector("select");if(!a)return ae.error("Select element not found in form"),void this.modalManager.hideLoading();e.dataset.productId=t,this.dataService.getEstimatesData().then((function(t){a.innerHTML="";var r=document.createElement("option");if(r.value="",r.textContent="-- Select an estimate --",a.appendChild(r),t&&t.length>0){t.forEach((function(e){var t=document.createElement("option");t.value=e.id,t.textContent=e.name||"Estimate #".concat(e.id),a.appendChild(t)})),a.disabled=!1;var i=e.querySelector('button[type="submit"]');i&&(i.disabled=!1)}else{var n=document.createElement("option");n.value="",n.textContent="No estimates available",a.appendChild(n),a.disabled=!0;var s=e.querySelector('button[type="submit"]');s&&(s.disabled=!0)}o.modalManager.hideLoading()})).catch((function(e){ae.error("Error loading estimates:",e),o.modalManager.showError("Error loading estimates. Please try again."),o.modalManager.hideLoading()}))}},{key:"bindEstimateSelectionFormEvents",value:function(e,t){var o=this;if(ae.log("Binding events to estimate selection form"),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(a){a.preventDefault(),o.modalManager.showLoading();var r=e.querySelector("select").value;if(!r)return o.modalManager.showError("Please select an estimate."),void o.modalManager.hideLoading();o.modalManager.roomManager?o.modalManager.roomManager.showRoomSelectionForm(r,t):(ae.error("RoomManager not available for showRoomSelectionForm"),o.modalManager.hideLoading())},e.addEventListener("submit",e._submitHandler);var a=e.querySelector("#create-estimate-btn");a&&(a._clickHandler&&a.removeEventListener("click",a._clickHandler),a._clickHandler=function(e){e.preventDefault(),o.showNewEstimateForm(t)},a.addEventListener("click",a._clickHandler));var r=e.querySelector(".cancel-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.modalManager.closeModal()},r.addEventListener("click",r._clickHandler))}else ae.error("Form element not available for binding events")}},{key:"showEstimatesList",value:function(){var e=this;ae.log("Showing estimates list view");var t=this.modalManager.estimatesList;if(!t)return ae.error("Estimates list container not found in modal"),this.modalManager.hideLoading(),void this.modalManager.showError("Modal structure incomplete. Please contact support.");this.hideAllSections(),this.modalManager.forceElementVisibility(t),this.loadEstimatesList().then((function(){e.bindEstimateListEventHandlers()})).catch((function(o){ae.error("Error loading estimates list:",o),t?Y.showMessage("Error loading estimates. Please try again.","error",t):e.modalManager.showError("Error loading estimates. Please try again.")})).finally((function(){e.modalManager.hideLoading()}))}},{key:"bindEstimateListEventHandlers",value:function(){var e=this;ae.log("Binding event handlers to estimates list");var t=this.modalManager.estimatesList;t?(t._clickHandler&&(ae.log("Removing existing click handler from estimates list"),t.removeEventListener("click",t._clickHandler)),ae.log("Adding click handler to estimates list"),t._clickHandler=function(t){if(t.target.closest("#create-estimate-btn"))return t.preventDefault(),console.log("Create New Estimate button clicked"),void e.showNewEstimateForm();var o=t.target.closest(".remove-estimate");if(o){t.preventDefault(),t.stopPropagation();var a=o.getAttribute("data-estimate-id");if(a)ae.log("Handling estimate removal from button click, ID:",a),e.handleEstimateRemoval(a);else{var r=o.closest(".estimate-section");if(r&&r.dataset.estimateId){var i=r.dataset.estimateId;ae.log("Handling estimate removal from section, ID:",i),e.handleEstimateRemoval(i)}else ae.error("Could not find estimate ID for removal")}}else if(t.target.closest(".print-estimate")){t.preventDefault();var n=t.target.closest(".print-estimate").dataset.estimateId;n&&ae.log("Print estimate clicked for ID:",n)}else if(t.target.closest(".request-contact-estimate")){t.preventDefault();var s=t.target.closest(".request-contact-estimate").dataset.estimateId;s&&ae.log("Request contact clicked for ID:",s)}else if(t.target.closest(".request-a-copy")){t.preventDefault();var l=t.target.closest(".request-a-copy").dataset.estimateId;l&&ae.log("Request copy clicked for ID:",l)}else if(t.target.closest(".add-room")){t.preventDefault();var c=t.target.closest(".add-room").dataset.estimateId;c&&(ae.log("Add room clicked for estimate ID:",c),e.modalManager.roomManager&&e.modalManager.roomManager.showNewRoomForm(c))}else if(t.target.closest(".estimate-header")){if(t.target.closest("button")||t.target.closest("a")||t.target.closest(".remove-estimate"))return;ae.log("Toggling estimate accordion");var d=t.target.closest(".estimate-header").closest(".estimate-section"),u=d.querySelector(".estimate-content");u&&(d.classList.contains("expanded")?(d.classList.remove("expanded"),d.classList.add("collapsed"),u.style.display="none"):(d.classList.remove("collapsed"),d.classList.add("expanded"),u.style.display="block",d.dataset.estimateId&&!u.dataset.loaded&&(u.dataset.loaded="true",e.modalManager.roomManager&&e.modalManager.roomManager.loadRoomsForEstimate(d.dataset.estimateId,u))))}},ae.log("Attaching click event listener to estimates list"),t.addEventListener("click",t._clickHandler)):ae.error("Estimates list container not found for binding events")}},{key:"loadEstimatesList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ae.log("Loading estimates list",{expandRoomId:t,expandEstimateId:o});var a=this.modalManager.estimatesList;return a?(this.modalManager.showLoading(),this.dataService.getEstimatesData().then((function(r){if(a.innerHTML="",r&&0!==r.length){if(r.forEach((function(e){var t={id:e.id,name:e.name||"Estimate #".concat(e.id),min_total:e.min_total||0,max_total:e.max_total||0};Y.insert("estimate-item-template",t,a);var o=a.querySelectorAll(".estimate-section"),r=o[o.length-1];if(r){r.setAttribute("data-estimate-id",e.id);var i=r.querySelector(".remove-estimate");i?(i.setAttribute("data-estimate-id",e.id),console.log("Set data-estimate-id on remove button:",i)):console.warn("Remove button not found in estimate element"),r.querySelectorAll("[data-estimate-id]").forEach((function(t){t.setAttribute("data-estimate-id",e.id)}));var n=r.querySelector(".add-room");n&&n.setAttribute("data-estimate-id",e.id),r.querySelectorAll(".estimate-actions a").forEach((function(t){t.setAttribute("data-estimate-id",e.id)}))}})),o){var i=a.querySelector('.estimate-section[data-estimate-id="'.concat(o,'"]'));if(i){var n=i.querySelector(".estimate-header"),s=i.querySelector(".estimate-content");n&&s&&(i.classList.remove("collapsed"),i.classList.add("expanded"),s.style.display="block",s.dataset.loaded="true",e.modalManager.roomManager&&e.modalManager.roomManager.loadRoomsForEstimate(o,s,t))}}}else Y.insert("estimates-empty-template",{},a);return r})).finally((function(){e.modalManager.hideLoading()}))):Promise.reject(new Error("Estimates list container not found"))}},{key:"showNewEstimateForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ae.log("Showing new estimate form",{productId:e});var t=this.modalManager.newEstimateForm;if(!t)return ae.error("New estimate form container not found in modal"),this.modalManager.showError("Modal structure incomplete. Please contact support."),void this.modalManager.hideLoading();this.hideAllSections(),this.modalManager.forceElementVisibility(t),this.modalManager.showLoading();try{t.innerHTML="",Y.insert("new-estimate-form-template",{},t),ae.log("New estimate form template inserted into wrapper.");var o=t.querySelector("form");o?(e?o.dataset.productId=e:delete o.dataset.productId,this.modalManager.formManager?this.modalManager.formManager.bindNewEstimateFormEvents(o,e):ae.error("FormManager not available for bindNewEstimateFormEvents"),this.modalManager.hideLoading()):(ae.error("Form element not found inside the template after insertion!"),this.modalManager.showError("Error rendering form template. Please try again."),this.modalManager.hideLoading())}catch(e){ae.error("Error inserting new estimate form template:",e),this.modalManager.showError("Error loading form template. Please try again."),this.modalManager.hideLoading()}}},{key:"handleEstimateRemoval",value:function(e){var t=this;ae.log("Handling estimate removal for ID:",e),this.modalManager&&this.modalManager.confirmationDialog?this.modalManager.confirmationDialog.show({title:"Remove Estimate",message:"Are you sure you want to remove this estimate? This action cannot be undone.",type:"estimate",action:"delete",showCancel:!0,confirmText:"Delete",cancelText:"Cancel",onConfirm:function(){t.modalManager.showLoading(),t.dataService.removeEstimate(e).then((function(){return t.loadEstimatesList()})).catch((function(e){ae.error("Error removing estimate:",e),t.modalManager.showError("Error removing estimate. Please try again.")})).finally((function(){t.modalManager.hideLoading()}))},onCancel:function(){ae.log("Estimate removal cancelled by user")}}):(ae.error("ConfirmationDialog not available for confirm operation"),this.modalManager.showLoading(),this.dataService.removeEstimate(e).then((function(){return t.loadEstimatesList()})).catch((function(e){ae.error("Error removing estimate:",e),t.modalManager.showError("Error removing estimate. Please try again.")})).finally((function(){t.modalManager.hideLoading()})))}},{key:"updateEstimate",value:function(e,t){var o=this;return ae.log("Updating estimate",{estimateId:e,updateData:t}),this.modalManager.showLoading(),this.dataService.updateEstimate(e,t).then((function(t){return ae.log("Estimate updated successfully:",t),o.loadEstimatesList(null,e)})).catch((function(e){throw ae.error("Error updating estimate:",e),o.modalManager.showError("Error updating estimate. Please try again."),e})).finally((function(){o.modalManager.hideLoading()}))}},{key:"onModalClosed",value:function(){ae.log("EstimateManager: Modal closed"),this.currentProductId=null}}])}();var ie=E("RoomManager");const ne=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,_.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.newRoomForm=null,this.roomSelectionForm=null,this.currentEstimateId=null,this.currentProductId=null,this.showRoomSelectionForm=this.showRoomSelectionForm.bind(this),this.loadRoomsForEstimate=this.loadRoomsForEstimate.bind(this),this.showNewRoomForm=this.showNewRoomForm.bind(this),this.bindNewRoomFormEvents=this.bindNewRoomFormEvents.bind(this),this.handleRoomRemoval=this.handleRoomRemoval.bind(this),this.updateRoomTotals=this.updateRoomTotals.bind(this),this.renderRoom=this.renderRoom.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){this.newRoomForm=this.modalManager.newRoomForm,this.roomSelectionForm=this.modalManager.roomSelectionForm,this.bindEvents(),ie.log("RoomManager initialized")}},{key:"bindEvents",value:function(){ie.log("RoomManager events bound")}},{key:"showRoomSelectionForm",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ie.log("Showing room selection form",{estimateId:e,productId:o}),this.currentEstimateId=e,this.currentProductId=o;var a=this.modalManager.roomSelectionForm;if(!a)return ie.error("Room selection form container not found in modal"),this.modalManager.showError("Modal structure incomplete. Please contact support."),void this.modalManager.hideLoading();this.modalManager.estimateManager&&this.modalManager.estimateManager.hideAllSections&&this.modalManager.estimateManager.hideAllSections(),this.modalManager.forceElementVisibility(a),this.modalManager.showLoading(),this.dataService.getEstimate(e).then((function(r){if(!r)throw new Error("Estimate with ID ".concat(e," not found"));try{a.innerHTML="",Y.insert("room-selection-form-template",{estimateName:r.name||"Estimate #".concat(r.id)},a),ie.log("Room selection form template inserted into wrapper.");var i=a.querySelector("form");i?(i.dataset.estimateId=e,o?i.dataset.productId=o:delete i.dataset.productId,t.loadRoomsForSelection(e,i).then((function(){t.bindRoomSelectionFormEvents(i,e,o),t.modalManager.hideLoading()})).catch((function(e){ie.error("Error loading rooms for selection:",e),t.modalManager.showError("Error loading rooms. Please try again."),t.modalManager.hideLoading()}))):(ie.error("Form element not found inside the template after insertion!"),t.modalManager.showError("Error rendering form template. Please try again."),t.modalManager.hideLoading())}catch(e){ie.error("Error inserting room selection form template:",e),t.modalManager.showError("Error loading form template. Please try again."),t.modalManager.hideLoading()}})).catch((function(e){ie.error("Error fetching estimate details:",e),t.modalManager.showError("Error loading estimate details. Please try again."),t.modalManager.hideLoading()}))}},{key:"loadRoomsForSelection",value:function(e,t){ie.log("Loading rooms for selection form",{estimateId:e});var o=t.querySelector("select");return o?this.dataService.getRoomsForEstimate(e).then((function(e){o.innerHTML="";var a=document.createElement("option");if(a.value="",a.textContent="-- Select a room --",o.appendChild(a),e&&e.length>0){e.forEach((function(e){var t=document.createElement("option");t.value=e.id,t.textContent=e.name||"Room #".concat(e.id),o.appendChild(t)})),o.disabled=!1;var r=t.querySelector('button[type="submit"]');r&&(r.disabled=!1)}else{var i=document.createElement("option");i.value="",i.textContent="No rooms available",o.appendChild(i),o.disabled=!0}return e})):Promise.reject(new Error("Select element not found in form"))}},{key:"bindRoomSelectionFormEvents",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ie.log("Binding events to room selection form",{estimateId:t,productId:a}),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(r){r.preventDefault(),o.modalManager.showLoading();var i=e.querySelector("select").value;if(!i)return o.modalManager.showError("Please select a room or create a new one."),void o.modalManager.hideLoading();a?o.modalManager.productManager?o.modalManager.productManager.addProductToRoom(t,i,a).then((function(){o.modalManager.hideLoading(),o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:"Product Added",message:"The product has been added to the selected room.",type:"product",action:"success",showCancel:!1,confirmText:"OK",onConfirm:function(){o.modalManager.closeModal()}}):(ie.log("Product has been added to the selected room."),o.modalManager.closeModal())})).catch((function(e){ie.error("Error adding product to room:",e),o.modalManager.showError("Error adding product to room. Please try again."),o.modalManager.hideLoading()})):(ie.error("ProductManager not available for addProductToRoom"),o.modalManager.hideLoading()):(o.modalManager.hideLoading(),o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList(i,t):o.modalManager.closeModal())},e.addEventListener("submit",e._submitHandler);var r=e.querySelector(".create-new-room-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.showNewRoomForm(t,a)},r.addEventListener("click",r._clickHandler));var i=e.querySelector(".cancel-button");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),a&&o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(a):o.modalManager.closeModal()},i.addEventListener("click",i._clickHandler));var n=e.querySelector(".back-button");n&&(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimateSelection(a):o.modalManager.closeModal()},n.addEventListener("click",n._clickHandler))}else ie.error("Form element not available for binding events")}},{key:"loadRoomsForEstimate",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ie.log("Loading rooms for estimate",{estimateId:e,expandRoomId:a}),!t)return Promise.reject(new Error("Container not provided for loading rooms"));var r=t.querySelector(".loading-placeholder");r&&(r.style.display="block");var i=t.querySelector(".estimate-rooms-container");return i||((i=document.createElement("div")).className="estimate-rooms-container",t.appendChild(i)),this.dataService.getRoomsForEstimate(e).then((function(t){if(i.innerHTML="",t&&0!==t.length){var n=t.map((function(t){var r=a===t.id;return o.renderRoom(t,t.id,e,i,r)}));return Promise.all(n)}return Y.insert("rooms-empty-template",{},i),r&&(r.style.display="none"),t})).catch((function(e){throw ie.error("Error loading rooms for estimate:",e),Y.insert("room-error-template",{},i),r&&(r.style.display="none"),e}))}},{key:"renderRoom",value:function(e,t,o,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(ie.log("Rendering room",{roomId:t,estimateId:o,expand:r}),!a)return Promise.reject(new Error("Container not provided for rendering room"));var i={roomId:t,estimateId:o,roomName:e.name||"Room #".concat(t),roomTotal:m(e.total||0),isExpanded:r},n=document.createElement("div");Y.insert("room-item-template",i,n);var s=n.firstElementChild;s.classList.add("room-item");var l=s.querySelector(".accordion-header-wrapper");l&&r&&l.classList.add("expanded");var c=s.querySelector(".accordion-content");c&&(c.style.display=r?"block":"none");var d=s.querySelector(".room-name");d&&(d.textContent=i.roomName);var u=s.querySelector(".room-price");u&&(u.textContent=i.roomTotal);var g=s.querySelector(".product-list");if(g){var h=document.createElement("div");h.className="loading-placeholder",h.textContent="Loading products...",g.appendChild(h)}if(a.appendChild(s),this.bindRoomEvents(s,o,t),r&&"block"===s.querySelector(".room-content").style.display){var p=s.querySelector(".room-products-container");if(this.modalManager.productManager)return this.modalManager.productManager.loadProductsForRoom(o,t,p)}return Promise.resolve(s)}},{key:"bindRoomEvents",value:function(e,t,o){var a=this;if(ie.log("Binding events to room element",{estimateId:t,roomId:o}),e){var r=e.querySelector(".accordion-header");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(i){if(!i.target.closest("button:not(.accordion-header)")){var n=r.closest(".accordion-header-wrapper"),s=e.querySelector(".accordion-content");if(s&&n)if(n.classList.contains("expanded"))n.classList.remove("expanded"),s.style.display="none";else{n.classList.add("expanded"),s.style.display="block";var l=s.querySelector(".product-list");l&&!l.dataset.loaded&&(l.dataset.loaded="true",a.modalManager.productManager&&a.modalManager.productManager.loadProductsForRoom(t,o,l))}}},r.addEventListener("click",r._clickHandler));var i=e.querySelector(".remove-room");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),a.handleRoomRemoval(t,o)},i.addEventListener("click",i._clickHandler));var n=e.querySelector(".add-product-button");if(!n){var s=e.querySelector(".product-list");if(s&&s.parentElement){(n=document.createElement("button")).className="add-product-button button button-small button-primary",n.textContent="Add Product";var l=document.createElement("div");l.className="room-actions-footer",l.appendChild(n),s.parentElement.appendChild(l)}}n&&(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),a.modalManager.productManager?a.modalManager.productManager.showProductSelection(t,o):ie.error("ProductManager not available for showProductSelection")},n.addEventListener("click",n._clickHandler))}else ie.error("Room element not available for binding events")}},{key:"showNewRoomForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ie.log("Showing new room form",{estimateId:e,productId:t}),this.currentEstimateId=e,this.currentProductId=t;var o=this.modalManager.newRoomForm;if(!o)return ie.error("New room form container not found in modal"),this.modalManager.showError("Modal structure incomplete. Please contact support."),void this.modalManager.hideLoading();this.modalManager.estimateManager&&this.modalManager.estimateManager.hideAllSections&&this.modalManager.estimateManager.hideAllSections(),this.modalManager.forceElementVisibility(o),this.modalManager.showLoading();try{o.innerHTML="",Y.insert("new-room-form-template",{},o),ie.log("New room form template inserted into wrapper.");var a=o.querySelector("form");a?(a.dataset.estimateId=e,t?a.dataset.productId=t:delete a.dataset.productId,this.modalManager.formManager?this.modalManager.formManager.bindNewRoomFormEvents(a,e,t):this.bindNewRoomFormEvents(a,e,t),this.modalManager.hideLoading()):(ie.error("Form element not found inside the template after insertion!"),this.modalManager.showError("Error rendering form template. Please try again."),this.modalManager.hideLoading())}catch(e){ie.error("Error inserting new room form template:",e),this.modalManager.showError("Error loading form template. Please try again."),this.modalManager.hideLoading()}}},{key:"bindNewRoomFormEvents",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ie.log("Binding events to new room form",{estimateId:t,productId:a}),e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(r){r.preventDefault(),o.modalManager.showLoading();var i=new FormData(e),n=i.get("room_name"),s=i.get("room_width"),l=i.get("room_length");return n?s&&l?void o.dataService.addNewRoom({room_name:n,room_width:s,room_length:l},t).then((function(e){if(ie.log("Room created successfully:",e),a){if(o.modalManager.productManager)return o.modalManager.productManager.addProductToRoom(t,e.id,a).then((function(){o.modalManager.hideLoading(),o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:"Room Created",message:"The room has been created and the product has been added.",type:"room",action:"success",showCancel:!1,confirmText:"OK",onConfirm:function(){o.modalManager.closeModal()}}):(ie.log("Room created and product added successfully."),o.modalManager.closeModal())}));ie.error("ProductManager not available for addProductToRoom"),o.modalManager.hideLoading(),o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:"Room Created",message:"The room has been created.",type:"room",action:"success",showCancel:!1,confirmText:"OK",onConfirm:function(){o.modalManager.closeModal()}}):(ie.log("Room created successfully."),o.modalManager.closeModal())}else o.modalManager.hideLoading(),o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList(e.id,t):o.modalManager&&o.modalManager.confirmationDialog?o.modalManager.confirmationDialog.show({title:"Room Created",message:"The room has been created.",type:"room",action:"success",showCancel:!1,confirmText:"OK",onConfirm:function(){o.modalManager.closeModal()}}):(ie.log("Room created successfully."),o.modalManager.closeModal())})).catch((function(e){ie.error("Error creating room:",e),o.modalManager.showError("Error creating room. Please try again."),o.modalManager.hideLoading()})):(o.modalManager.showError("Please enter room dimensions."),void o.modalManager.hideLoading()):(o.modalManager.showError("Please enter a room name."),void o.modalManager.hideLoading())},e.addEventListener("submit",e._submitHandler);var r=e.querySelector(".cancel-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.showRoomSelectionForm(t,a)},r.addEventListener("click",r._clickHandler));var i=e.querySelector(".back-button");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),o.showRoomSelectionForm(t,a)},i.addEventListener("click",i._clickHandler))}else ie.error("Form element not available for binding events")}},{key:"handleRoomRemoval",value:function(e,t){var o=this;ie.log("Handling room removal",{estimateId:e,roomId:t}),window.productEstimator&&window.productEstimator.dialog?window.productEstimator.dialog.confirm("Remove Room","Are you sure you want to remove this room? All products in this room will also be removed. This action cannot be undone.",(function(){o.modalManager.showLoading(),o.dataService.removeRoom(e,t).then((function(){ie.log("Room removed successfully");var a=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));a&&a.remove(),o.dataService.getEstimate(e).then((function(t){var o=document.querySelector('.estimate-item[data-estimate-id="'.concat(e,'"]'));if(o){var a=o.querySelector(".estimate-total-value");a&&(a.textContent=m(t.total||0))}})).catch((function(e){ie.error("Error updating estimate totals after room removal:",e)})).finally((function(){o.modalManager.hideLoading()}))})).catch((function(e){ie.error("Error removing room:",e),o.modalManager.showError("Error removing room. Please try again."),o.modalManager.hideLoading()}))}),(function(){ie.log("Room removal cancelled by user")})):confirm("Are you sure you want to remove this room? All products in this room will also be removed. This action cannot be undone.")&&(this.modalManager.showLoading(),this.dataService.removeRoom(e,t).then((function(){ie.log("Room removed successfully");var a=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));a&&a.remove(),o.dataService.getEstimate(e).then((function(t){var o=document.querySelector('.estimate-item[data-estimate-id="'.concat(e,'"]'));if(o){var a=o.querySelector(".estimate-total-value");a&&(a.textContent=m(t.total||0))}})).catch((function(e){ie.error("Error updating estimate totals after room removal:",e)})).finally((function(){o.modalManager.hideLoading()}))})).catch((function(e){ie.error("Error removing room:",e),o.modalManager.showError("Error removing room. Please try again."),o.modalManager.hideLoading()})))}},{key:"updateRoomTotals",value:function(e,t,o){ie.log("Updating room totals",{estimateId:e,roomId:t,totals:o});var a=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(a){var r=a.querySelector(".room-price");r&&(r.textContent=m(o.total||0)),this.dataService.getEstimate(e).then((function(t){var o=document.querySelector('.estimate-item[data-estimate-id="'.concat(e,'"]'));if(o){var a=o.querySelector(".estimate-total-value");a&&(a.textContent=m(t.total||0))}})).catch((function(e){ie.error("Error updating estimate totals:",e)}))}else ie.error("Room element not found for updating totals")}},{key:"onModalClosed",value:function(){ie.log("RoomManager: Modal closed"),this.currentEstimateId=null,this.currentProductId=null}}])}();var se=E("ProductManager");const le=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,_.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.currentRoomId=null,this.currentEstimateId=null,this.currentProductId=null,this.loadProductsForRoom=this.loadProductsForRoom.bind(this),this.showProductSelection=this.showProductSelection.bind(this),this.addProductToRoom=this.addProductToRoom.bind(this),this.handleProductRemoval=this.handleProductRemoval.bind(this),this.renderProduct=this.renderProduct.bind(this),this.handleVariationSelection=this.handleVariationSelection.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){this.bindEvents(),se.log("ProductManager initialized")}},{key:"bindEvents",value:function(){se.log("ProductManager events bound")}},{key:"loadProductsForRoom",value:function(e,t,o){var a=this;if(se.log("Loading products for room",{estimateId:e,roomId:t}),!o)return Promise.reject(new Error("Container not provided for loading products"));var r=o.querySelector(".loading-placeholder");return r&&(r.style.display="block"),this.dataService.getProductsForRoom(e,t).then((function(i){if(r&&r.parentNode===o?(o.innerHTML="",o.appendChild(r)):o.innerHTML="",o.dataset.loaded="true",i&&0!==i.length){var n=document.createElement("div");n.className="room-products-list",o.appendChild(n),i.forEach((function(o,r){a.renderProduct(o,r,t,e,n)}))}else Y.insert("products-empty-template",{},o);return r&&(r.style.display="none"),i})).catch((function(e){throw se.error("Error loading products for room:",e),Y.insert("product-error-template",{},o),e}))}},{key:"showProductSelection",value:function(e,t){var o=this;se.log("Showing product selection",{estimateId:e,roomId:t}),this.currentRoomId=t,this.currentEstimateId=e;var a=prompt("Enter a product ID to add:");a&&this.addProductToRoom(e,t,a).then((function(){if(o.modalManager){var a=o.modalManager.confirmationDialog;a?a.show({title:"Success",message:"Product added successfully!",type:"product",action:"add",showCancel:!1,confirmText:"OK"}):(se.warn("ConfirmationDialog not available, using console log instead"),se.log("Product added successfully!"))}var r=document.querySelector('.room-item[data-room-id="'.concat(t,'"][data-estimate-id="').concat(e,'"]'));if(r){var i=r.querySelector(".room-products-container");i&&(delete i.dataset.loaded,o.loadProductsForRoom(e,t,i))}})).catch((function(e){if(se.error("Error adding product to room:",e),o.modalManager){var t=o.modalManager.confirmationDialog;t?t.show({title:"Error",message:"Error adding product. Please try again.",type:"product",action:"error",showCancel:!1,confirmText:"OK"}):(se.warn("ConfirmationDialog not available, using console log instead"),se.error("Error adding product. Please try again."))}}))}},{key:"addProductToRoom",value:function(e,t,o){var a=this;if(se.log("Adding product to room",{estimateId:e,roomId:t,productId:o}),!o){var r="Product ID is required to add a product to a room";return se.error(r),Promise.reject(new Error(r))}this.modalManager&&this.modalManager.showLoading();var i=String(o);return this.dataService.addProductToRoom(e,t,i).then((function(o){return se.log("Product added successfully:",o),a.modalManager&&a.modalManager.roomManager&&a.modalManager.roomManager.updateRoomTotals(e,t,{total:o.roomTotal}),a.modalManager&&a.modalManager.hideLoading(),o})).catch((function(e){throw se.error("Error adding product to room:",e),a.modalManager&&a.modalManager.hideLoading(),e}))}},{key:"renderProduct",value:function(e,t,o,a,r){if(se.log("Rendering product",{index:t,roomId:o,estimateId:a,product:e}),!r)return se.error("Container not provided for rendering product"),null;var i=m(e.price||0),n={productId:e.id,productIndex:t,roomId:o,estimateId:a,productName:e.name||"Product",productPrice:i,productSku:e.sku||"",productDescription:e.description||""},s=document.createElement("div");Y.insert("product-item-template",n,s);var l=s.firstElementChild;l.dataset.productId=e.id,l.dataset.productIndex=t,l.dataset.roomId=o,l.dataset.estimateId=a;var c=l.querySelector(".price-title");c&&(c.textContent=n.productName);var d=l.querySelector(".product-price");if(d&&(d.textContent=n.productPrice),e.variations&&e.variations.length>0){var u=document.createElement("div");u.className="product-variations";var g=document.createElement("label");g.setAttribute("for","variation-".concat(o,"-").concat(e.id,"-").concat(t)),g.textContent="Options:",u.appendChild(g);var h=document.createElement("select");h.id="variation-".concat(o,"-").concat(e.id,"-").concat(t),h.className="variation-select";var p=document.createElement("option");p.value="",p.textContent="Select an option",h.appendChild(p),e.variations.forEach((function(t){var o=document.createElement("option");o.value=t.id,o.textContent="".concat(t.name," (").concat(m(t.price||0),")"),t.id===e.selectedVariation&&(o.selected=!0),h.appendChild(o)})),u.appendChild(h);var v=l.querySelector(".includes-container");v?l.insertBefore(u,v.nextSibling):l.appendChild(u)}return r.appendChild(l),this.bindProductEvents(l,e,t,o,a),l}},{key:"bindProductEvents",value:function(e,t,o,a,r){var i=this;if(se.log("Binding events to product element",{index:o,roomId:a,estimateId:r}),e){var n=e.querySelector(".remove-product");n&&(n._clickHandler&&n.removeEventListener("click",n._clickHandler),n._clickHandler=function(e){e.preventDefault(),e.stopPropagation(),i.handleProductRemoval(r,a,o,t.id)},n.addEventListener("click",n._clickHandler));var s=e.querySelector(".variation-select");s&&(s._changeHandler&&s.removeEventListener("change",s._changeHandler),s._changeHandler=function(n){var s=n.target.value;i.handleVariationSelection(s,e,r,a,o,t.id)},s.addEventListener("change",s._changeHandler))}else se.error("Product element not available for binding events")}},{key:"handleProductRemoval",value:function(e,t,o,a){var r=this;se.log("Handling product removal",{estimateId:e,roomId:t,productIndex:o,productId:a}),window.productEstimator&&window.productEstimator.dialog?window.productEstimator.dialog.confirm("Remove Product","Are you sure you want to remove this product from the room?",(function(){r.modalManager&&r.modalManager.showLoading(),r.dataService.removeProductFromRoom(e,t,o).then((function(a){se.log("Product removed successfully:",a);var i=document.querySelector('.product-item[data-product-index="'.concat(o,'"][data-room-id="').concat(t,'"][data-estimate-id="').concat(e,'"]'));i&&i.remove(),r.modalManager&&r.modalManager.roomManager&&r.modalManager.roomManager.updateRoomTotals(e,t,{total:a.roomTotal}),r.modalManager&&r.modalManager.hideLoading()})).catch((function(e){if(se.error("Error removing product:",e),r.modalManager){r.modalManager.hideLoading();var t=r.modalManager.confirmationDialog;t?t.show({title:"Error",message:"Error removing product. Please try again.",type:"product",action:"error",showCancel:!1,confirmText:"OK"}):r.modalManager.showError("Error removing product. Please try again.")}else se.error("Error removing product. Please try again.")}))}),(function(){se.log("Product removal cancelled by user")})):confirm("Are you sure you want to remove this product from the room?")&&(this.modalManager&&this.modalManager.showLoading(),this.dataService.removeProductFromRoom(e,t,o).then((function(a){se.log("Product removed successfully:",a);var i=document.querySelector('.product-item[data-product-index="'.concat(o,'"][data-room-id="').concat(t,'"][data-estimate-id="').concat(e,'"]'));i&&i.remove(),r.modalManager&&r.modalManager.roomManager&&r.modalManager.roomManager.updateRoomTotals(e,t,{total:a.roomTotal}),r.modalManager&&r.modalManager.hideLoading()})).catch((function(e){se.error("Error removing product:",e),r.modalManager?(r.modalManager.showError("Error removing product. Please try again."),r.modalManager.hideLoading()):alert("Error removing product. Please try again.")})))}},{key:"handleVariationSelection",value:function(e,t,o,a,r,i){var n=this;se.log("Handling variation selection",{variationId:e,estimateId:o,roomId:a,productIndex:r,productId:i}),t?(this.modalManager&&this.modalManager.showLoading(),this.dataService.updateProductVariation(o,a,r,e).then((function(e){se.log("Variation updated successfully:",e);var r=t.querySelector(".product-price");r&&e.updatedProduct&&(r.textContent=m(e.updatedProduct.price||0)),n.modalManager&&n.modalManager.roomManager&&n.modalManager.roomManager.updateRoomTotals(o,a,{total:e.roomTotal}),n.modalManager&&n.modalManager.hideLoading()})).catch((function(e){se.error("Error updating variation:",e);var i=t.querySelector(".variation-select");if(i&&n.dataService.getProductsForRoom(o,a).then((function(e){var t=e[r];t&&t.selectedVariation?i.value=t.selectedVariation:i.value=""})).catch((function(){i.value=""})),n.modalManager){n.modalManager.hideLoading();var s=n.modalManager.confirmationDialog;s?s.show({title:"Error",message:"Error updating variation. Please try again.",type:"product",action:"error",showCancel:!1,confirmText:"OK"}):n.modalManager.showError("Error updating variation. Please try again.")}else se.error("Error updating variation. Please try again.")}))):se.error("Product element not provided for variation selection")}},{key:"onModalClosed",value:function(){se.log("ProductManager: Modal closed"),this.currentRoomId=null,this.currentEstimateId=null,this.currentProductId=null}}])}();var ce=E("FormManager");const de=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,_.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.currentForm=null,this.bindNewEstimateFormEvents=this.bindNewEstimateFormEvents.bind(this),this.bindNewRoomFormEvents=this.bindNewRoomFormEvents.bind(this),this.loadEstimateSelectionForm=this.loadEstimateSelectionForm.bind(this),this.cancelForm=this.cancelForm.bind(this),this.validateForm=this.validateForm.bind(this),this.showError=this.showError.bind(this),this.clearErrors=this.clearErrors.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){ce.log("FormManager initialized")}},{key:"bindNewEstimateFormEvents",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(ce.log("Binding events to new estimate form",{productId:o}),e){this.currentForm=e,o?e.dataset.productId=o:delete e.dataset.productId,e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(a){if(a.preventDefault(),t.clearErrors(e),t.validateForm(e)){t.modalManager&&t.modalManager.showLoading();var r=new FormData(e).get("estimate_name");t.dataService.addNewEstimate({estimate_name:r}).then((function(e){if(ce.log("Estimate created successfully:",e),o){var a=e.estimate_id;if(!a)return ce.error("No estimate ID returned from server. Cannot create room."),t.modalManager.hideLoading(),void t.showSuccessMessage("Estimate created successfully, but there was an error adding a room.");t.modalManager&&t.modalManager.roomManager?(ce.log("Transitioning to new room form with estimate ID:",a),t.modalManager.roomManager.showNewRoomForm(a,o)):(ce.error("RoomManager not available for showNewRoomForm"),t.modalManager&&t.modalManager.hideLoading(),t.showSuccessMessage("Estimate created successfully."))}else{var r=e.estimate_id;if(!r)return ce.error("No estimate ID returned from server. Cannot show estimate."),t.modalManager.hideLoading(),void t.showSuccessMessage("Estimate created successfully.");t.modalManager&&t.modalManager.estimateManager?(ce.log("Transitioning to estimates list with estimate ID:",r),t.modalManager.estimateManager.showEstimatesList(null,r)):(t.modalManager&&t.modalManager.hideLoading(),t.showSuccessMessage("Estimate created successfully."))}})).catch((function(o){ce.error("Error creating estimate:",o),t.showError(e,"Error creating estimate. Please try again."),t.modalManager&&t.modalManager.hideLoading()}))}},e.addEventListener("submit",e._submitHandler);var a=e.querySelector(".cancel-button");a&&(a._clickHandler&&a.removeEventListener("click",a._clickHandler),a._clickHandler=function(e){e.preventDefault(),t.cancelForm("estimate")},a.addEventListener("click",a._clickHandler))}else ce.error("Form element not available for binding events")}},{key:"bindNewRoomFormEvents",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ce.log("Binding events to new room form",{estimateId:t,productId:a}),e){this.currentForm=e,e.dataset.estimateId=t,a?e.dataset.productId=a:delete e.dataset.productId,e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=function(t){if(t.preventDefault(),o.clearErrors(e),o.validateForm(e)){o.modalManager&&o.modalManager.showLoading();var r=new FormData(e),i=r.get("room_name"),n=r.get("room_width"),s=r.get("room_length"),l=e.dataset.estimateId;if(!l)return o.showError(e,"No estimate ID found. Please try again."),void o.modalManager.hideLoading();o.dataService.addNewRoom({room_name:i,room_width:n,room_length:s},l).then((function(e){ce.log("Room created successfully:",e),a?o.modalManager&&o.modalManager.productManager?o.modalManager.productManager.addProductToRoom(l,e.id,a).then((function(){o.modalManager&&o.modalManager.hideLoading(),o.showSuccessMessage("Room created and product added successfully!")})).catch((function(e){ce.error("Error adding product to room:",e),o.modalManager&&o.modalManager.hideLoading(),o.showSuccessMessage("Room created successfully, but product could not be added.")})):(ce.error("ProductManager not available for addProductToRoom"),o.modalManager&&o.modalManager.hideLoading(),o.showSuccessMessage("Room created successfully.")):o.modalManager&&o.modalManager.estimateManager?o.modalManager.estimateManager.showEstimatesList(e.id,l):(o.modalManager&&o.modalManager.hideLoading(),o.showSuccessMessage("Room created successfully."))})).catch((function(t){ce.error("Error creating room:",t),o.showError(e,"Error creating room. Please try again."),o.modalManager&&o.modalManager.hideLoading()}))}},e.addEventListener("submit",e._submitHandler);var r=e.querySelector(".cancel-button");r&&(r._clickHandler&&r.removeEventListener("click",r._clickHandler),r._clickHandler=function(e){e.preventDefault(),o.cancelForm("room",t,a)},r.addEventListener("click",r._clickHandler));var i=e.querySelector(".back-button");i&&(i._clickHandler&&i.removeEventListener("click",i._clickHandler),i._clickHandler=function(e){e.preventDefault(),o.modalManager&&o.modalManager.roomManager?o.modalManager.roomManager.showRoomSelectionForm(t,a):o.modalManager&&o.modalManager.closeModal()},i.addEventListener("click",i._clickHandler))}else ce.error("Form element not available for binding events")}},{key:"loadEstimateSelectionForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ce.log("Loading estimate selection form",{productId:e}),this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimateSelection(e):ce.error("EstimateManager not available for showEstimateSelection")}},{key:"cancelForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(ce.log("Cancelling form",{formType:e,estimateId:t,productId:o}),e){case"estimate":o&&this.modalManager&&this.modalManager.estimateManager?this.modalManager.estimateManager.showEstimateSelection(o):this.modalManager&&this.modalManager.closeModal();break;case"room":t&&this.modalManager&&this.modalManager.roomManager?this.modalManager.roomManager.showRoomSelectionForm(t,o):this.modalManager&&this.modalManager.closeModal();break;default:this.modalManager&&this.modalManager.closeModal()}}},{key:"validateForm",value:function(e){var t=this;if(ce.log("Validating form",e),!e)return ce.error("Form not provided for validation"),!1;this.clearErrors(e);var o=!0;return e.querySelectorAll("[required]").forEach((function(a){a.value.trim()||(t.showError(e,"".concat(a.name," is required."),a),o=!1)})),o}},{key:"showError",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(ce.log("Showing error",{message:t,field:o}),e){var a=e.querySelector(".form-errors");if(a){var r=a.querySelector("p");if(r)r.textContent=t;else{var i=document.createElement("p");i.textContent=t,a.appendChild(i)}}else{var n=document.createElement("div");Y.insert("form-error-template",{errorMessage:t},n),a=n.firstElementChild,e.insertBefore(a,e.firstChild)}if(o){o.classList.add("error-field"),o.setAttribute("aria-invalid","true");var s=o.closest(".form-group");s&&s.classList.add("has-error"),o.focus()}}else ce.error("Form not provided for showing error")}},{key:"clearErrors",value:function(e){if(ce.log("Clearing errors from form"),e){var t=e.querySelector(".form-errors");t&&t.remove(),e.querySelectorAll(".error-field").forEach((function(e){e.classList.remove("error-field"),e.removeAttribute("aria-invalid");var t=e.closest(".form-group");t&&t.classList.remove("has-error")})),e.querySelectorAll(".has-error").forEach((function(e){e.classList.remove("has-error")}))}else ce.error("Form not provided for clearing errors")}},{key:"showSuccessMessage",value:function(e){var t=this;ce.log("Showing success message",{message:e}),this.modalManager&&this.modalManager.confirmationDialog?this.modalManager.confirmationDialog.show({title:"Success",message:e,type:"estimate",action:"success",showCancel:!1,confirmText:"OK",onConfirm:function(){t.modalManager&&t.modalManager.closeModal()}}):(ce.log("Success: ".concat(e)),this.modalManager&&this.modalManager.closeModal())}},{key:"onModalClosed",value:function(){ce.log("FormManager: Modal closed"),this.currentForm=null}}])}();var ue,me,ge,he,pe,ve,fe=E("SuggestionsCarousel"),ye=function(){return(0,M.A)((function e(t){(0,_.A)(this,e),this.id="carousel_"+Math.random().toString(36).substr(2,9),this.container=t,this.itemsContainer=t.querySelector(".suggestions-container"),this.items=t.querySelectorAll(".suggestion-item"),this.prevBtn=t.querySelector(".suggestions-nav.prev"),this.nextBtn=t.querySelector(".suggestions-nav.next"),this.isSimilarProducts=t.classList.contains("similar-products-carousel"),this.itemsContainer&&this.items.length?(t.carouselInstance=this,this.isSimilarProducts?(this.itemWidth=130,this.itemGap=5):(this.itemWidth=200,this.itemGap=15),this.visibleItems=this.calculateVisibleItems(),this.currentPosition=0,this.maxPosition=Math.max(0,this.items.length-this.visibleItems),this.setContainerSize(),this.bindEvents(),this.updateButtons()):fe.warn("[".concat(this.id,"] Carousel missing items container or has no items"))}),[{key:"getContainerWidth",value:function(){if(this.isSimilarProducts){var e=this.container.closest(".product-item");if(e)return e.offsetWidth-10}return this.container.offsetWidth}},{key:"setContainerSize",value:function(){if(this.isSimilarProducts){var e=this.container.closest(".product-item");if(e){var t=e.offsetWidth;this.container.style.maxWidth="".concat(t-10,"px")}Array.from(this.items).forEach((function(e){e.style.flexShrink="0",e.style.flexGrow="0"})),this.itemsContainer.style.gap="".concat(this.itemGap,"px")}}},{key:"calculateVisibleItems",value:function(){var e=this.getContainerWidth()-50,t=(this.isSimilarProducts?130:this.itemWidth)+(this.isSimilarProducts?5:this.itemGap);return Math.max(1,Math.floor(e/t))}},{key:"bindEvents",value:function(){var e=this;this.handlePrevClick=this.handlePrevClick.bind(this),this.handleNextClick=this.handleNextClick.bind(this),this.handleResize=this.handleResize.bind(this),this.prevBtn&&(this.prevBtn.removeEventListener("click",this.handlePrevClick),this.prevBtn.addEventListener("click",this.handlePrevClick)),this.nextBtn&&(this.nextBtn.removeEventListener("click",this.handleNextClick),this.nextBtn.addEventListener("click",this.handleNextClick)),this.resizeTimeout=null,window.addEventListener("resize",(function(){clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(e.handleResize,150)}))}},{key:"handlePrevClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.currentPosition>0&&(this.currentPosition--,this.updatePosition(),this.updateButtons())}},{key:"handleNextClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.currentPosition<this.maxPosition&&(this.currentPosition++,this.updatePosition(),this.updateButtons())}},{key:"handleResize",value:function(){this.setContainerSize(),this.visibleItems=this.calculateVisibleItems(),this.maxPosition=Math.max(0,this.items.length-this.visibleItems),this.currentPosition>this.maxPosition&&(this.currentPosition=this.maxPosition),this.updatePosition(),this.updateButtons()}},{key:"getAvailableWidth",value:function(){var e=this.container.clientWidth-50;if(this.isSimilarProducts){var t=this.container.closest(".product-item");if(t){var o=window.getComputedStyle(t),a=t.clientWidth-(parseFloat(o.paddingLeft)+parseFloat(o.paddingRight));e=Math.min(e,a)}}else{var r=this.container.closest(".accordion-content");if(r){var i=r.clientWidth-30;e=Math.min(e,i)}}return Math.max(e,100)}},{key:"updatePosition",value:function(){if(this.itemsContainer){var e=this.itemWidth+this.itemGap,t=-this.currentPosition*e;this.itemsContainer.style.transition="transform 0.3s ease",this.itemsContainer.style.transform="translateX(".concat(t,"px)")}}},{key:"updateButtons",value:function(){this.prevBtn&&(this.currentPosition<=0?(this.prevBtn.classList.add("disabled"),this.prevBtn.setAttribute("aria-disabled","true")):(this.prevBtn.classList.remove("disabled"),this.prevBtn.removeAttribute("aria-disabled"))),this.nextBtn&&(this.currentPosition>=this.maxPosition?(this.nextBtn.classList.add("disabled"),this.nextBtn.setAttribute("aria-disabled","true")):(this.nextBtn.classList.remove("disabled"),this.nextBtn.removeAttribute("aria-disabled")))}},{key:"destroy",value:function(){this.prevBtn&&this.prevBtn.removeEventListener("click",this.handlePrevClick),this.nextBtn&&this.nextBtn.removeEventListener("click",this.handleNextClick),window.removeEventListener("resize",this.handleResize),this.container&&delete this.container.carouselInstance}}])}();function we(){var e=document.querySelectorAll(".suggestions-carousel");e.forEach((function(e){e.carouselInstance&&e.carouselInstance.destroy()}));var t=[];return e.forEach((function(e){var o=new ye(e);t.push(o)})),t}function be(e){setTimeout((function(){var t=e.currentTarget.closest(".accordion-item");if(t){var o=t.querySelector(".accordion-content");o&&"none"!==window.getComputedStyle(o).display&&o.querySelectorAll(".suggestions-carousel").forEach((function(e){e.carouselInstance&&e.carouselInstance.destroy(),new ye(e)}))}}),300)}document.addEventListener("DOMContentLoaded",(function(){we(),document.querySelectorAll(".accordion-header").forEach((function(e){e.removeEventListener("click",be),e.addEventListener("click",be)}))}));var Ee=E("ProductDetailsToggle"),Se=new(function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,_.A)(this,e),this.config=Object.assign({debug:!1,selectors:{productToggleButton:".product-details-toggle",notesToggleButton:".product-notes-toggle",includesToggleButton:".product-includes-toggle",productItem:".product-item",similarProductsContainer:".similar-products-container",productIncludes:".product-includes",similarProducts:".product-similar-products",productNotes:".product-notes",notesContainer:".notes-container",includesContainer:".includes-container",suggestionsContainer:".suggestions-container"},i18n:{showProducts:"Similar Products",hideProducts:"Similar Products",showNotes:"Product Notes",hideNotes:"Product Notes",showIncludes:"Product Includes",hideIncludes:"Product Includes",showSuggestions:"Suggested Products",hideSuggestions:"Suggested Products",loading:"Loading..."}},t),this.initialized=!1,this.init()}),[{key:"init",value:function(){var e=this;this.initialized?Ee.log("Already initialized, skipping"):("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return e.setup()})):this.setup(),document.addEventListener("product_estimator_modal_loaded",(function(){Ee.log("Modal content loaded, initializing toggles"),e.setup()})),this.setupMutationObserver(),this.initialized=!0,Ee.log("ProductDetailsToggle initialized"))}},{key:"prepareSuggestionsToggle",value:function(){var e=this;if(window.productEstimatorVars.featureSwitches.suggested_products_enabled){var t=document.querySelectorAll(this.config.selectors.accordionContent);Ee.log("Found ".concat(t.length," accordion content elements to process for suggestions toggle")),t.forEach((function(t){if(!t.classList.contains("suggestions-toggle-processed")){var o=t.querySelector(e.config.selectors.productSuggestions);if(o){Ee.log("Found suggestions section, processing",o),t.classList.add("has-suggestions");var a=t.querySelector(e.config.selectors.suggestionsContainer);if(!a){if(Ee.log("Creating new suggestions container"),(a=document.createElement("div")).className="suggestions-container visible",o.parentNode!==a){var r=o.cloneNode(!0);a.appendChild(r),o.parentNode.removeChild(o)}t.appendChild(a)}var i=t.querySelector(e.config.selectors.suggestionsToggleButton);i||(Ee.log("Adding suggestions toggle button to accordion content"),(i=document.createElement("button")).className="product-suggestions-toggle expanded",i.setAttribute("data-toggle-type","suggestions"),i.innerHTML="\n        ".concat(e.config.i18n.hideSuggestions,'\n        <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n      '),t.insertBefore(i,a)),a.style.display="block",a.classList.add("visible"),t.classList.add("suggestions-toggle-processed"),Ee.log("Accordion content processed for suggestions toggle")}else Ee.log("No suggestions section found for accordion content, skipping",t)}}))}}},{key:"setupMutationObserver",value:function(){var e=this;new MutationObserver((function(t){var o=!1;t.forEach((function(t){t.addedNodes.length&&Array.from(t.addedNodes).forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&(t.matches(e.config.selectors.productItem)||t.matches(e.config.selectors.productToggleButton)||t.matches(e.config.selectors.notesToggleButton)||t.querySelector(e.config.selectors.productItem)||t.querySelector(e.config.selectors.productToggleButton)||t.querySelector(e.config.selectors.notesToggleButton))&&(o=!0)}))})),o&&(Ee.log("New toggle-related content detected, re-initializing"),setTimeout((function(){return e.setup()}),100))})).observe(document.body,{childList:!0,subtree:!0}),Ee.log("Mutation observer set up")}},{key:"setup",value:function(){Ee.log("Setting up product details toggles"),this.prepareProductsToggle(),this.prepareNotesToggle(),this.prepareIncludesToggle(),this.prepareSuggestionsToggle(),this.bindEvents(),this.initializeAllCarousels()}},{key:"prepareProductsToggle",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.productItem);Ee.log("Found ".concat(t.length," product items to process for similar products toggle")),t.forEach((function(t){t.classList.contains("products-toggle-processed")||(t.querySelector(e.config.selectors.similarProducts)?(t.classList.add("has-similar-products"),t.classList.add("products-toggle-processed"),Ee.log("Product item processed for similar products toggle (visibility managed elsewhere).")):t.classList.add("products-toggle-processed"))}))}},{key:"prepareNotesToggle",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.productItem);Ee.log("Found ".concat(t.length," product items to process for notes toggle")),t.forEach((function(t){if(!t.classList.contains("notes-toggle-processed")){var o=t.querySelector(e.config.selectors.productNotes);if(o){var a=!1,r=o.querySelectorAll(".product-note-item");if(r&&r.length>0&&(a=!0),t.dataset.additionalNotes)try{var i=JSON.parse(t.dataset.additionalNotes);Array.isArray(i)&&i.length>0&&i.some((function(e){return e&&(e.note_text||e.text)}))&&(a=!0)}catch(e){}if(o.querySelector(".product-notes-items")&&""!==o.querySelector(".product-notes-items").textContent.trim()&&(a=!0),!a){Ee.log("No valid notes found for product, skipping",t),t.classList.add("notes-toggle-processed");var n=t.querySelector(e.config.selectors.notesToggleButton),s=t.querySelector(e.config.selectors.notesContainer);return n&&(n.style.display="none"),void(s&&(s.style.display="none"))}Ee.log("Found notes section with content, processing",o),t.classList.add("has-notes");var l=t.querySelector(e.config.selectors.notesContainer);if(!l){if(Ee.log("Creating new notes container"),(l=document.createElement("div")).className="notes-container visible",o.parentNode!==l){var c=o.cloneNode(!0);l.appendChild(c),o.parentNode.removeChild(o)}t.appendChild(l)}var d=t.querySelector(e.config.selectors.notesToggleButton);if(d){d.classList.add("expanded");var u=d.querySelector(".toggle-icon");u&&(u.classList.remove("dashicons-arrow-down-alt2"),u.classList.add("dashicons-arrow-up-alt2"))}else Ee.log("Adding notes toggle button to product item"),(d=document.createElement("button")).className="product-notes-toggle expanded",d.setAttribute("data-toggle-type","notes"),d.innerHTML="\n      ".concat(e.config.i18n.hideNotes,'\n      <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n    '),t.insertBefore(d,l);l.style.display="block",l.classList.add("visible"),t.classList.add("notes-toggle-processed"),Ee.log("Product item processed for notes toggle")}else Ee.log("No notes section found for product item, skipping",t)}}))}},{key:"bindEvents",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.productToggleButton);Ee.log("Found ".concat(t.length," similar products toggle buttons to bind")),t.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleSimilarProducts(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)}));var o=document.querySelectorAll(this.config.selectors.notesToggleButton);Ee.log("Found ".concat(o.length," notes toggle buttons to bind")),o.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleNotes(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)}));var a=document.querySelectorAll(this.config.selectors.includesToggleButton);if(Ee.log("Found ".concat(a.length," includes toggle buttons to bind")),a.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleIncludes(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)})),window.productEstimatorVars.featureSwitches.suggested_products_enabled){var r=document.querySelectorAll(this.config.selectors.suggestionsToggleButton);Ee.log("Found ".concat(r.length," suggestions toggle buttons to bind")),r.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleSuggestions(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)}))}Ee.log("All toggle events bound")}},{key:"toggleSuggestions",value:function(e){var t=e.closest(this.config.selectors.accordionContent);if(t){var o=t.querySelector(this.config.selectors.suggestionsContainer);if(o){var a=e.classList.contains("expanded");if(Ee.log("Suggestions toggle clicked, current expanded state: ".concat(a)),a){o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded");var r=e.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),e.innerHTML=e.innerHTML.replace(this.config.i18n.hideSuggestions,this.config.i18n.showSuggestions),Ee.log("Suggestions hidden")}else{o.classList.add("visible"),o.style.display="block",e.classList.add("expanded");var i=e.querySelector(".toggle-icon");i&&(i.classList.remove("dashicons-arrow-down-alt2"),i.classList.add("dashicons-arrow-up-alt2")),e.innerHTML=e.innerHTML.replace(this.config.i18n.showSuggestions,this.config.i18n.hideSuggestions),this.initializeCarousels(o),Ee.log("Suggestions shown")}}else Ee.log("Suggestions container not found")}else Ee.log("Accordion content not found for toggle button")}},{key:"toggleSimilarProducts",value:function(e){var t=e.closest(this.config.selectors.productItem);if(t){var o=t.querySelector(this.config.selectors.similarProductsContainer);if(o){var a=e.classList.contains("expanded");Ee.log("Similar products toggle clicked, current expanded state: ".concat(a));var r=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),Ee.log("Similar products hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),Ee.log("Similar products shown"),this.initializeCarousels(o))}else Ee.log("Similar products container not found")}else Ee.log("Product item not found for toggle button")}},{key:"toggleNotes",value:function(e){var t=e.closest(this.config.selectors.productItem);if(t){var o=t.querySelector(this.config.selectors.notesContainer);if(o){var a=e.classList.contains("expanded");Ee.log("Notes toggle clicked, current expanded state: ".concat(a));var r=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),Ee.log("Notes hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),Ee.log("Notes shown"))}else Ee.log("Notes container not found")}else Ee.log("Product item not found for notes toggle button")}},{key:"initializeCarousels",value:function(){"function"==typeof window.initSuggestionsCarousels?(Ee.log("Initializing carousels in similar products container"),window.initSuggestionsCarousels()):"function"==typeof initSuggestionsCarousels?(Ee.log("Using local initSuggestionsCarousels function"),initSuggestionsCarousels()):Ee.log("Carousel initialization function not found",window.initSuggestionsCarousels)}},{key:"initializeAllCarousels",value:function(){"function"==typeof window.initSuggestionsCarousels?(Ee.log("Initializing all carousels"),window.initSuggestionsCarousels()):"function"==typeof initSuggestionsCarousels&&initSuggestionsCarousels()}},{key:"prepareIncludesToggle",value:function(){var e=this,t=document.querySelectorAll(this.config.selectors.productItem);Ee.log("Found ".concat(t.length," product items to process for includes toggle")),t.forEach((function(t){if(!t.classList.contains("includes-toggle-processed")){var o=t.querySelector(e.config.selectors.productIncludes);if(o){Ee.log("Found includes section, processing",o),t.classList.add("has-includes");var a=t.querySelector(".includes-container");if(!a){if(Ee.log("Creating new includes container"),(a=document.createElement("div")).className="includes-container visible",o.parentNode!==a){var r=o.cloneNode(!0);a.appendChild(r),o.parentNode.removeChild(o)}t.appendChild(a)}var i=t.querySelector(".product-includes-toggle");if(i){i.classList.add("expanded");var n=i.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2"))}else Ee.log("Adding includes toggle button to product item"),(i=document.createElement("button")).className="product-includes-toggle expanded",i.setAttribute("data-toggle-type","includes"),i.innerHTML="\n        ".concat(e.config.i18n.hideIncludes||"Product Includes",'\n        <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span>\n      '),t.insertBefore(i,a);a.style.display="block",a.classList.add("visible"),t.classList.add("includes-toggle-processed"),Ee.log("Product item processed for includes toggle")}else Ee.log("No includes section found for product item, skipping",t)}}))}},{key:"toggleIncludes",value:function(e){var t=e.closest(this.config.selectors.productItem);if(t){var o=t.querySelector(".includes-container");if(o){var a=e.classList.contains("expanded");Ee.log("Includes toggle clicked, current expanded state: ".concat(a));var r=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),Ee.log("Includes hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),Ee.log("Includes shown"))}else Ee.log("Includes container not found")}else Ee.log("Product item not found for includes toggle button")}}])}())({debug:(null===(ue=window.productEstimatorVars)||void 0===ue?void 0:ue.debug)||!1,i18n:{showProducts:(null===(me=window.productEstimatorVars)||void 0===me||null===(me=me.i18n)||void 0===me?void 0:me.showSimilarProducts)||"Similar Products",hideProducts:(null===(ge=window.productEstimatorVars)||void 0===ge||null===(ge=ge.i18n)||void 0===ge?void 0:ge.hideSimilarProducts)||"Similar Products",showNotes:(null===(he=window.productEstimatorVars)||void 0===he||null===(he=he.i18n)||void 0===he?void 0:he.showNotes)||"Product Notes",hideNotes:(null===(pe=window.productEstimatorVars)||void 0===pe||null===(pe=pe.i18n)||void 0===pe?void 0:pe.hideNotes)||"Product Notes",loading:(null===(ve=window.productEstimatorVars)||void 0===ve||null===(ve=ve.i18n)||void 0===ve?void 0:ve.loading)||"Loading..."}}),_e=E("UIManager"),Me=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;(0,_.A)(this,e),this.config=t,this.dataService=o,this.modalManager=a,this.estimatesList=null,this.carousels=[],this.productDetailsToggle=null,this.initializeCarousels=this.initializeCarousels.bind(this),this.bindSimilarProductsToggle=this.bindSimilarProductsToggle.bind(this),this.bindSuggestionsToggle=this.bindSuggestionsToggle.bind(this),this.bindProductDetailsToggles=this.bindProductDetailsToggles.bind(this),this.forceElementVisibility=this.forceElementVisibility.bind(this),this.onModalClosed=this.onModalClosed.bind(this)}),[{key:"init",value:function(){return this.estimatesList=this.modalManager.estimatesList,this.initializeProductDetailsToggle(),_e.log("UIManager initialized"),this}},{key:"initializeProductDetailsToggle",value:function(){this.productDetailsToggle=Se,_e.log("Product details toggle functionality initialized")}},{key:"onModalClosed",value:function(){_e.log("UIManager handling modal close event")}},{key:"initializeCarousels",value:function(){return _e.log("Initializing all carousels"),this.carousels=we(),this.carousels}},{key:"bindSimilarProductsToggle",value:function(){var e=this,t=document.querySelectorAll(".product-details-toggle");_e.log("Found ".concat(t.length," similar products toggle buttons to bind")),t.forEach((function(t){t._toggleBound||(t._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),e.toggleSimilarProducts(t)},t.addEventListener("click",t._toggleHandler),t._toggleBound=!0)})),_e.log("Similar products toggle bound")}},{key:"toggleSimilarProducts",value:function(e){var t=e.closest(".product-item");if(t){var o=t.querySelector(".similar-products-container");if(o){var a=e.classList.contains("expanded");_e.log("Similar products toggle clicked, current expanded state: ".concat(a));var r=e.querySelector(".toggle-icon");a?(o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded"),r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2")),_e.log("Similar products hidden")):(o.classList.add("visible"),o.style.display="block",e.classList.add("expanded"),r&&(r.classList.remove("dashicons-arrow-down-alt2"),r.classList.add("dashicons-arrow-up-alt2")),_e.log("Similar products shown"),this.initializeCarouselInContainer(o))}else _e.log("Similar products container not found")}else _e.log("Product item not found for toggle button")}},{key:"bindSuggestionsToggle",value:function(){var e,t=this;if(null!==(e=window.productEstimatorVars)&&void 0!==e&&null!==(e=e.featureSwitches)&&void 0!==e&&e.suggested_products_enabled){var o=document.querySelectorAll(".product-suggestions-toggle");_e.log("Found ".concat(o.length," suggestions toggle buttons to bind")),o.forEach((function(e){e._toggleBound||(e._toggleHandler=function(o){o.preventDefault(),o.stopPropagation(),t.toggleSuggestions(e)},e.addEventListener("click",e._toggleHandler),e._toggleBound=!0)})),_e.log("Suggestions toggle bound")}else _e.log("Suggestions feature is disabled, skipping toggle binding")}},{key:"toggleSuggestions",value:function(e){var t=e.closest(".accordion-content");if(t){var o=t.querySelector(".suggestions-container");if(o){var a=e.classList.contains("expanded");if(_e.log("Suggestions toggle clicked, current expanded state: ".concat(a)),a){o.classList.remove("visible"),o.style.display="none",e.classList.remove("expanded");var r=e.querySelector(".toggle-icon");r&&(r.classList.remove("dashicons-arrow-up-alt2"),r.classList.add("dashicons-arrow-down-alt2"));var i=this.config.i18n||{};i.showSuggestions&&(e.innerHTML="",Y.insert("toggle-button-show-template",{buttonText:i.showSuggestions||"Show Suggestions"},e)),_e.log("Suggestions hidden")}else{o.classList.add("visible"),o.style.display="block",e.classList.add("expanded");var n=e.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2"));var s=this.config.i18n||{};s.hideSuggestions&&(e.innerHTML="",Y.insert("toggle-button-hide-template",{buttonText:s.hideSuggestions||"Hide Suggestions"},e)),this.initializeCarouselInContainer(o),_e.log("Suggestions shown")}}else _e.log("Suggestions container not found")}else _e.log("Accordion content not found for toggle button")}},{key:"bindProductDetailsToggles",value:function(){this.productDetailsToggle?(this.productDetailsToggle.setup(),_e.log("Product details toggles bound via ProductDetailsToggle")):_e.warn("ProductDetailsToggle not initialized")}},{key:"createCarousel",value:function(e,t){if(_e.log("Creating carousel of type: ".concat(t)),!e)return _e.warn("Cannot create carousel - container not provided"),null;e.carouselInstance&&(_e.log("Container already has a carousel instance, destroying it first"),e.carouselInstance.destroy());var o=new ye(e);return _e.log("New carousel created",o),o}},{key:"initializeCarouselInContainer",value:function(e){if(e){_e.log("Initializing carousels in container");var t=e.querySelectorAll(".suggestions-carousel");_e.log("Found ".concat(t.length," carousel containers")),t.forEach((function(e){e.carouselInstance&&e.carouselInstance.destroy(),new ye(e)}))}else _e.warn("Cannot initialize carousels - container not provided")}},{key:"forceElementVisibility",value:function(e){if(!e)return null;try{e.style.cssText+="display: block !important; visibility: visible !important; opacity: 1 !important; height: auto !important;",["hidden","hide","invisible","d-none","display-none"].forEach((function(t){e.classList.contains(t)&&e.classList.remove(t)})),e.classList.add("visible","d-block");for(var t=e.parentElement,o=new Set;t&&t!==document.body&&!o.has(t);)o.add(t),"none"===window.getComputedStyle(t).display&&(t.style.cssText+="display: block !important;"),t=t.parentElement;"undefined"!=typeof jQuery&&jQuery(e).show()}catch(e){_e.error("Error forcing element visibility:",e)}return e}},{key:"showElement",value:function(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.forceElementVisibility(e):(e.style.display="block",e):null}},{key:"hideElement",value:function(e){return e?(e.style.display="none",e):null}},{key:"toggleElement",value:function(e,t){return e?(void 0===t?"none"===window.getComputedStyle(e).display?e.style.display="block":e.style.display="none":e.style.display=t?"block":"none",e):null}}])}();const ke=Me;var Le=E("ModalManager"),Pe=function(){return(0,M.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;(0,_.A)(this,e),this.config=Object.assign({debug:!1,selectors:{modalContainer:"#product-estimator-modal",estimatorButtons:".product-estimator-button, .single_add_to_estimator_button",modalOverlay:".product-estimator-modal-overlay",closeButton:".product-estimator-modal-close",contentContainer:".product-estimator-modal-form-container",loadingIndicator:".product-estimator-modal-loading",estimatesList:"#estimates",estimateSelection:"#estimate-selection-wrapper",roomSelection:"#room-selection-form-wrapper",newEstimateForm:"#new-estimate-form-wrapper",newRoomForm:"#new-room-form-wrapper"},i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.dataService=a,this.modal=null,this.overlay=null,this.closeButton=null,this.contentContainer=null,this.loadingIndicator=null,this.estimatesList=null,this.estimateSelection=null,this.estimateSelectionForm=null,this.roomSelectionForm=null,this.newEstimateForm=null,this.newRoomForm=null,this.isOpen=!1,this.currentView=null,this.currentProductId=null,this.initialized=!1,this.eventHandlers={},this.loadEstimateData=x,this.saveEstimateData=T,this.clearEstimateData=R,this.loadCustomerDetails=G,this.saveCustomerDetails=J,this.clearCustomerDetails=Q,this.estimateManager=null,this.roomManager=null,this.productManager=null,this.formManager=null,this.uiManager=null,this.confirmationDialog=null,this._modalClickHandler=this._modalClickHandler.bind(this),this.showLoading=this.showLoading.bind(this),this.hideLoading=this.hideLoading.bind(this),this.openModal=this.openModal.bind(this),this.closeModal=this.closeModal.bind(this),this.init()}),[{key:"init",value:function(){if(this.initialized)return Le.log("ModalManager already initialized"),this;Le.log("Initializing ModalManager");try{if(this.modal=document.querySelector(this.config.selectors.modalContainer),this.modal)Le.log("Found existing modal in DOM, initializing elements"),this.completeInitialization();else{if(Le.log("Modal element not found in DOM. Creating from template..."),this.modal=Y.createModalContainer(),!this.modal)return Le.error("Failed to create modal from template"),this;Le.log("Modal created successfully from template"),this.completeInitialization()}this.initialized=!0,Le.log("ModalManager initialization completed successfully")}catch(e){Le.error("Error initializing ModalManager:",e)}return this}},{key:"completeInitialization",value:function(){var e=this;this.modal?(Le.log("Modal found, allowing time for DOM to fully update before initializing elements"),setTimeout((function(){e.initializeElements(),e.setupLoaderSafety(),e.initializeManagers(),e.bindEvents(),setTimeout((function(){e.ensureLoaderHidden()}),100),e.initialized=!0,Le.log("ModalManager initialization completed successfully")}),50)):Le.error("Cannot complete initialization - modal element not available")}},{key:"initializeElements",value:function(){Le.log("Initializing DOM elements");try{if(!this.modal)return void Le.error("Modal element not available for initializing elements");this.overlay=this.modal.querySelector(".product-estimator-modal-overlay"),this.closeButton=this.modal.querySelector(".product-estimator-modal-close"),this.contentContainer=this.modal.querySelector(".product-estimator-modal-form-container"),this.loadingIndicator=this.modal.querySelector(".product-estimator-modal-loading"),this.estimatesList=this.modal.querySelector("#estimates"),this.estimateSelection=this.modal.querySelector("#estimate-selection-wrapper"),this.estimateSelectionForm=this.modal.querySelector("#estimate-selection-form-wrapper"),this.roomSelectionForm=this.modal.querySelector("#room-selection-form-wrapper"),this.newEstimateForm=this.modal.querySelector("#new-estimate-form-wrapper"),this.newRoomForm=this.modal.querySelector("#new-room-form-wrapper"),Le.log("Container elements status:",{modal:this.modal?"found":"missing",contentContainer:this.contentContainer?"found":"missing",estimatesList:this.estimatesList?"found":"missing",estimateSelection:this.estimateSelection?"found":"missing",estimateSelectionForm:this.estimateSelectionForm?"found":"missing",roomSelectionForm:this.roomSelectionForm?"found":"missing",newEstimateForm:this.newEstimateForm?"found":"missing",newRoomForm:this.newRoomForm?"found":"missing"}),this.estimatesList||(Le.error("Critical: #estimates div not found in modal template!"),Le.log("Modal content structure:",this.modal.innerHTML.substring(0,500)+"...")),this.loadingIndicator||(Le.warn("Loading indicator not found, creating one"),this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="product-estimator-modal-loading",this.loadingIndicator.innerHTML='\n          <div class="loading-spinner"></div>\n          <div class="loading-text">'.concat(this.config.i18n.loading||"Loading...","</div>\n        "),this.modal.appendChild(this.loadingIndicator)),Le.log("DOM elements initialized")}catch(e){Le.error("Error initializing DOM elements:",e)}}},{key:"initializeManagers",value:function(){Le.log("Initializing specialized managers"),this.estimateManager=new re(this.config,this.dataService,this),this.roomManager=new ne(this.config,this.dataService,this),this.productManager=new le(this.config,this.dataService,this),this.formManager=new de(this.config,this.dataService,this),this.uiManager=new ke(this.config,this.dataService,this),window.productEstimator&&window.productEstimator.dialog?(Le.log("Using global ConfirmationDialog instance"),this.confirmationDialog=window.productEstimator.dialog):(Le.log("Creating new ConfirmationDialog instance"),this.confirmationDialog=new oe,window.productEstimator&&(window.productEstimator.dialog=this.confirmationDialog)),this.estimateManager&&this.estimateManager.init(),this.roomManager&&this.roomManager.init(),this.productManager&&this.productManager.init(),this.formManager&&this.formManager.init(),this.uiManager&&this.uiManager.init(),Le.log("Specialized managers initialized")}},{key:"bindEvents",value:function(){var e=this;Le.log("Binding core modal events");try{this.modal&&this.modal.addEventListener("click",this._modalClickHandler),this.closeButton&&this.closeButton.addEventListener("click",(function(t){t.preventDefault(),e.closeModal()})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.isOpen&&e.closeModal()})),Le.log("Core modal events bound")}catch(e){Le.error("Error binding core modal events:",e)}}},{key:"_modalClickHandler",value:function(e){e.target===this.overlay&&this.closeModal()}},{key:"showLoading",value:function(){var e=this;if(!this.loadingIndicator){if(Le.warn("Loading indicator not available - creating one"),!this.modal)return void Le.error("Cannot create loading indicator - modal not available");var t=document.createElement("div");t.className="product-estimator-modal-loading",t.style.display="flex",t.innerHTML='\n          <div class="loading-spinner"></div>\n          <div class="loading-text">'.concat(this.config.i18n.loading||"Loading...","</div>\n        "),this.modal.appendChild(t),this.loadingIndicator=t}try{this.loadingIndicator.style.display="flex",this._loadingTimeout=setTimeout((function(){e.ensureLoaderHidden()}),1e4),this.loadingStartTime=Date.now()}catch(e){Le.error("Error showing loading indicator:",e)}}},{key:"hideLoading",value:function(){if(this.loadingStartTime=0,this.loadingIndicator)try{this.loadingIndicator.style.display="none",this._loadingTimeout&&(clearTimeout(this._loadingTimeout),this._loadingTimeout=null)}catch(e){Le.error("Error hiding loading indicator:",e)}else Le.warn("Loading indicator not available during hide operation")}},{key:"openModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Le.log("MODAL OPEN CALLED WITH:",{productId:t,forceListView:o,typeOfProductId:(0,r.A)(t)}),this._modalActionInProgress)Le.log("Modal action already in progress, ignoring open request");else{if(this._modalActionInProgress=!0,setTimeout((function(){e._modalActionInProgress=!1}),300),!this.modal)return Le.error("Cannot open modal - not found in DOM"),void this.showError("Modal element not found. Please contact support.");try{this.resetModalState(),this.currentProductId=t,t?this.modal.dataset.productId=t:delete this.modal.dataset.productId,this.showLoading(),this.modal.style.display="block",document.body.classList.add("modal-open"),this.isOpen=!0,this.uiManager&&setTimeout((function(){e.uiManager.initializeCarousels()}),300),t&&!o?this.estimateManager?this.estimateManager.handleProductFlow(t):(Le.error("EstimateManager not available for handleProductFlow"),this.hideLoading()):this.estimateManager?this.estimateManager.showEstimatesList():(Le.error("EstimateManager not available for showEstimatesList"),this.hideLoading())}catch(e){Le.error("Error opening modal:",e),this.hideLoading(),this.showError("An error occurred opening the modal. Please try again.")}}}},{key:"closeModal",value:function(){var e=this;if(this.isOpen)if(this._modalActionInProgress)Le.log("Modal action already in progress, ignoring close request");else{this._modalActionInProgress=!0,setTimeout((function(){e._modalActionInProgress=!1}),300),Le.log("Closing modal");try{this.ensureLoaderHidden(),this.modal&&(this.modal.style.display="none",this.isOpen=!1),this.currentProductId=null,document.body.classList.remove("modal-open"),this.estimateManager&&this.estimateManager.onModalClosed(),this.roomManager&&this.roomManager.onModalClosed(),this.productManager&&this.productManager.onModalClosed(),this.formManager&&this.formManager.onModalClosed(),this.uiManager&&this.uiManager.onModalClosed();var t=new CustomEvent("productEstimatorModalClosed");document.dispatchEvent(t)}catch(e){Le.error("Error closing modal:",e)}}}},{key:"showError",value:function(e){try{if(this.hideLoading(),this.modal&&Y){var t=this.modal.querySelector(".product-estimator-modal-form-container");t?Y.showMessage(e,"error",t):(Le.error("Form container not found for error display"),alert(e))}else alert(e)}catch(e){Le.error("Error showing error message:",e)}}},{key:"setupLoaderSafety",value:function(){var e=this;Le.log("Setting up loader safety mechanisms");try{var t=window.fetch;window.fetch=function(){return t.apply(void 0,arguments).catch((function(t){throw Le.warn("Fetch error triggered loader safety:",t.message),e.ensureLoaderHidden(),t}))},window.addEventListener("error",(function(t){Le.warn("Global error triggered loader safety:",t.message),e.ensureLoaderHidden()})),window.addEventListener("unhandledrejection",(function(t){Le.warn("Unhandled rejection triggered loader safety:",t.reason&&t.reason.message||"Unknown reason"),e.ensureLoaderHidden()})),this._safetyInterval=setInterval((function(){e.loadingStartTime&&Date.now()-e.loadingStartTime>15e3&&(Le.warn("Loading indicator visible for too long (15s), forcing hide"),e.ensureLoaderHidden())}),5e3),Le.log("Loader safety mechanisms installed")}catch(e){Le.error("Error setting up loader safety:",e)}}},{key:"ensureLoaderHidden",value:function(){if(this.loadingIndicator)try{this.loadingIndicator.style.display="none",this.loadingStartTime=0,this._loadingTimeout&&(clearTimeout(this._loadingTimeout),this._loadingTimeout=null),Le.log("Loading indicator forcibly hidden for safety")}catch(e){Le.error("Error hiding loading indicator:",e)}}},{key:"resetModalState",value:function(){var e=this;Le.log("Resetting modal state");try{var t=[this.estimatesList,this.estimateSelection,this.roomSelectionForm,this.newEstimateForm,this.newRoomForm];this.uiManager?t.forEach((function(t){t&&e.uiManager.hideElement(t)})):t.forEach((function(e){e&&(e.style.display="none")})),this.roomSelectionForm&&this.roomSelectionForm.removeAttribute("data-estimate-id"),this.newRoomForm&&(this.newRoomForm.removeAttribute("data-estimate-id"),this.newRoomForm.removeAttribute("data-product-id"))}catch(e){Le.error("Error resetting modal state:",e)}}},{key:"forceElementVisibility",value:function(e){return this.uiManager?this.uiManager.forceElementVisibility(e):e?(Le.log("Using fallback forceElementVisibility (UIManager not available)"),e.style.display="block",e):null}}])}();const Ce=Pe;var Ie=E("VariationHandler");const De=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,_.A)(this,e),this.config=Object.assign({debug:!0,selectors:{variationsForm:".variations_form",estimatorButton:".single_add_to_estimator_button, .button.alt.open-estimator-modal, .product-estimator-button, [data-product-id]",variationIdInput:'input[name="variation_id"]'}},t),this.variationsForm=document.querySelector(this.config.selectors.variationsForm),this.estimatorButton=document.querySelector(this.config.selectors.estimatorButton),this.variationIdInput=this.variationsForm?this.variationsForm.querySelector(this.config.selectors.variationIdInput):null,this.variationsData=window.product_estimator_variations||{},this.currentVariationId=null,this.initialized=!1,this.eventHandlers={},this.variationsForm?this.init():Ie.log("No variations form found, VariationHandler not initialized")}),[{key:"init",value:function(){if(this.initialized)return Ie.log("VariationHandler already initialized"),this;if(Ie.log("Initializing VariationHandler with variations data:",this.variationsData),Ie.log("Estimator button found:",!!this.estimatorButton),this.estimatorButton){Ie.log("Initial button data-product-id:",this.estimatorButton.dataset.productId);var e=this.estimatorButton.dataset.productId;e&&this.isParentEstimatorEnabled(e)&&(Ie.log("Parent product has estimator enabled, ensuring button is visible"),this.estimatorButton.style.display="",this.estimatorButton.classList.remove("hidden"))}return this.bindEvents(),this.checkCurrentVariation(),this.initialized=!0,Ie.log("VariationHandler initialized"),this.emit("initialized"),this}},{key:"ensureEstimatorButton",value:function(e){if(Ie.log("Ensuring estimator button exists for variation: ".concat(e)),document.querySelector(this.config.selectors.estimatorButton))return Ie.log("Estimator button already exists, updating visibility"),void this.updateEstimatorButton(!0,e);if(this.isEstimatorEnabled(e)){Ie.log("Creating estimator button dynamically");var t=document.querySelector(".single_add_to_cart_button");if(t){var o=document.createElement("button");o.type="button",o.className="single_add_to_estimator_button button alt open-estimator-modal",o.dataset.productId=e,o.textContent="Add to Estimate",t.insertAdjacentElement("afterend",o),Ie.log("Estimator button created and inserted")}else Ie.log("Cannot find add to cart button to insert after")}else Ie.log("Estimator not enabled for this variation, not creating button")}},{key:"isParentEstimatorEnabled",value:function(){if(document.querySelector(".single_add_to_estimator_button"))return!0;var e=document.querySelector('input[name="_enable_estimator"], [data-enable-estimator]');return!!e&&("yes"===e.value||"yes"===e.dataset.enableEstimator)}},{key:"bindEvents",value:function(){var e=this;this.variationsForm&&(Ie.log("Binding variation events"),this.variationsForm.addEventListener("found_variation",this.handleFoundVariation.bind(this)),this.variationsForm.addEventListener("reset_data",this.handleResetVariation.bind(this)),this.variationsForm.addEventListener("check_variations",this.handleCheckVariations.bind(this)),document.addEventListener("woocommerce_variation_has_changed",this.checkCurrentVariation.bind(this)),this.variationIdInput&&this.variationIdInput.addEventListener("change",(function(){var t=e.variationIdInput.value;if(t){Ie.log("Variation ID input changed to: ".concat(t)),e.currentVariationId=t;var o=e.isEstimatorEnabled(t);e.updateEstimatorButton(o,t)}})),"undefined"!=typeof jQuery&&jQuery(this.variationsForm).on("change",'input[name="variation_id"]',(function(t){var o=t.target.value;if(o){Ie.log("jQuery variation ID change detected: ".concat(o)),e.currentVariationId=o;var a=e.isEstimatorEnabled(o);e.updateEstimatorButton(a,o)}})))}},{key:"handleFoundVariation",value:function(e){var t=void 0!==e.detail?e.detail:e.target.variation;if(t&&t.variation_id){var o=t.variation_id;this.currentVariationId=o,Ie.log("Found variation: ".concat(o));var a=this.isEstimatorEnabled(o);Ie.log("Variation ".concat(o," has estimator enabled: ").concat(a)),this.ensureEstimatorButton(o),this.updateEstimatorButton(a,o),this.emit("variation:changed",{variationId:o,enableEstimator:a,variation:t})}else Ie.log("Found variation event received but no valid variation data")}},{key:"handleResetVariation",value:function(){Ie.log("Reset variation"),this.currentVariationId=null,this.updateEstimatorButton(!1),this.emit("variation:reset")}},{key:"handleCheckVariations",value:function(){Ie.log("Check variations"),this.checkCurrentVariation()}},{key:"checkCurrentVariation",value:function(){if(this.variationsForm){var e=document.querySelectorAll(this.config.selectors.estimatorButton);Ie.log("Found ".concat(e.length," estimator buttons during checkCurrentVariation")),e.length>1&&(Ie.log("WARNING: Found multiple estimator buttons - this may cause issues. Check for duplicates."),e.forEach((function(e,t){Ie.log("Button ".concat(t+1," HTML: ").concat(e.outerHTML))})));var t=this.getCurrentVariation();if(t){Ie.log("Current variation detected: ".concat(t.variation_id)),this.currentVariationId=t.variation_id;var o=this.isEstimatorEnabled(t.variation_id);this.updateEstimatorButton(o,t.variation_id)}else Ie.log("No current variation detected"),this.currentVariationId=null,this.updateEstimatorButton(this.isParentProductEstimatorEnabled())}}},{key:"isParentProductEstimatorEnabled",value:function(){return void 0===window.product_estimator_variations||!window.product_estimator_variations._parent_enabled||"yes"===window.product_estimator_variations._parent_enabled}},{key:"getCurrentVariation",value:function(){if(!this.variationsForm)return null;if(this.variationsForm.currentVariation)return this.variationsForm.currentVariation;var e=this.variationsForm.querySelector('input[name="variation_id"]');if(e&&e.value)return{variation_id:e.value};var t=this.variationsForm.dataset.productVariations;if(t)return{variation_id:t};if("undefined"!=typeof jQuery){var o=jQuery(this.variationsForm).find('input[name="variation_id"]').val();if(o)return{variation_id:o}}return null}},{key:"isEstimatorEnabled",value:function(e){if(!e)return!1;if(Ie.log("Checking if estimator is enabled for variation: ".concat(e)),Ie.log("Available variations data:",this.variationsData),this.variationsData[e]){var t="yes"===this.variationsData[e].enable_estimator;return Ie.log("Found variation data, estimator enabled: ".concat(t)),t}var o=document.querySelector(".single_add_to_estimator_button[data-product-id]:not([data-variation-id])");if(o){var a=!o.classList.contains("hidden")&&"none"!==getComputedStyle(o).display;return Ie.log("Using parent product as fallback, estimator enabled: ".concat(a)),a}return Ie.log("No variation or parent data found, estimator disabled by default"),!1}},{key:"updateEstimatorButton",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=document.querySelector(".single_add_to_estimator_button");o?(Ie.log("Updating button visibility: ".concat(e?"show":"hide",", variation ID: ").concat(t)),e?(o.style.display="",t&&(Ie.log("Setting button data-product-id to variation ID: ".concat(t)),o.dataset.productId=t)):(o.style.display="none",Ie.log("Hiding estimator button"))):Ie.log("Estimator button not found")}},{key:"on",value:function(e,t){return this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t),this}},{key:"emit",value:function(e,t){return this.eventHandlers[e]&&this.eventHandlers[e].forEach((function(e){return e(t)})),this}}])}();var qe=E("CustomerDetailsManager"),Ae=function(){return(0,M.A)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;(0,_.A)(this,e),this.config=Object.assign({debug:!1,selectors:{editButton:"#edit-customer-details-btn",deleteButton:"#delete-customer-details-btn",saveButton:"#save-customer-details-btn",cancelButton:"#cancel-edit-customer-details-btn",detailsContainer:".saved-customer-details",detailsHeader:".customer-details-header",editForm:".customer-details-edit-form",formContainer:".product-estimator-modal-form-container"},i18n:{}},t),this.dataService=o,this.initialized=!1,this.eventHandlers={},!1!==t.autoInit&&this.init()}),[{key:"init",value:function(){return this.initialized?(qe.log("CustomerDetailsManager already initialized"),this):(this.bindEvents(),document.addEventListener("customer_details_updated",this.onCustomerDetailsUpdated.bind(this)),this.initialized=!0,qe.log("CustomerDetailsManager initialized"),this)}},{key:"onCustomerDetailsUpdated",value:function(e){e.detail&&e.detail.details&&(qe.log("Received customer_details_updated event",e.detail),this.updateDisplayedDetails(e.detail.details),this.checkAndUpdateEmailField(e.detail.details))}},{key:"checkAndUpdateEmailField",value:function(e){var t=e&&e.email&&""!==e.email.trim();qe.log("Checking for email field updates: hasEmail=".concat(t)),document.querySelectorAll(this.config.selectors.editForm).forEach((function(o){var a=o.querySelector("#edit-customer-email");if(!a&&t){qe.log("Adding email field to edit form");var r=document.createElement("div");r.className="form-group";var i=document.createElement("label");i.setAttribute("for","edit-customer-email"),i.textContent="Email Address",(a=document.createElement("input")).type="email",a.id="edit-customer-email",a.name="edit_customer_email",a.value=e.email,r.appendChild(i),r.appendChild(a);var n=o.querySelector("#edit-customer-name");if(n){var s=n.closest(".form-group");s?s.parentNode.insertBefore(r,s.nextSibling):o.querySelector("h4").after(r)}}else a&&t&&(a.value=e.email);var l=o.querySelector("#edit-customer-name");l&&e.name&&(l.value=e.name);var c=o.querySelector("#edit-customer-phone");c&&e.phone&&(c.value=e.phone);var d=o.querySelector("#edit-customer-postcode");d&&e.postcode&&(d.value=e.postcode)})),document.querySelectorAll("#new-estimate-form").forEach((function(e){e.setAttribute("data-has-email",t?"true":"false")}))}},{key:"bindEvents",value:function(){var e=document.querySelector(this.config.selectors.editButton),t=document.querySelector(this.config.selectors.deleteButton),o=document.querySelector(this.config.selectors.saveButton),a=document.querySelector(this.config.selectors.cancelButton);e?(this.bindButtonWithHandler(e,"click",this.handleEditClick.bind(this)),t&&this.bindButtonWithHandler(t,"click",this.handleDeleteClick.bind(this)),o&&this.bindButtonWithHandler(o,"click",this.handleSaveClick.bind(this)),a&&this.bindButtonWithHandler(a,"click",this.handleCancelClick.bind(this))):qe.log("Edit button not found, skipping event binding")}},{key:"bindButtonWithHandler",value:function(e,t,o){if(e){var a="_".concat(t,"Handler");e[a]&&e.removeEventListener(t,e[a]),e[a]=o,e.addEventListener(t,o)}}},{key:"handleEditClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=document.querySelector(this.config.selectors.detailsContainer),o=document.querySelector(this.config.selectors.detailsHeader),a=document.querySelector(this.config.selectors.editForm);t&&(t.style.display="none"),o&&(o.style.display="none"),a&&(a.style.display="block"),qe.log("Edit form displayed")}},{key:"handleCancelClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=document.querySelector(this.config.selectors.detailsContainer),o=document.querySelector(this.config.selectors.detailsHeader),a=document.querySelector(this.config.selectors.editForm);a&&(a.style.display="none"),t&&(t.style.display="block"),o&&(o.style.display="flex"),qe.log("Edit form hidden")}},{key:"handleSaveClick",value:function(e){var t,o,a=this;e.preventDefault(),e.stopPropagation();var r=e.target,i=r.textContent;r.textContent=this.config.i18n&&this.config.i18n.saving||"Saving...",r.disabled=!0;var n={name:(null===(t=document.getElementById("edit-customer-name"))||void 0===t?void 0:t.value)||"",postcode:(null===(o=document.getElementById("edit-customer-postcode"))||void 0===o?void 0:o.value)||""},s=document.getElementById("edit-customer-email");s&&(n.email=s.value||"");var l=document.getElementById("edit-customer-phone");l&&(n.phone=l.value||"");try{J(n),qe.log("Customer details saved to localStorage:",n),this.dataService.request("update_customer_details",{details:JSON.stringify(n)}).then((function(e){qe.log("Customer details updated on server successfully:",e),a.handleSaveSuccess(e,n)})).catch((function(e){a.handleSaveError(e)})).finally((function(){r.textContent=i,r.disabled=!1}))}catch(e){qe.log("Error saving to localStorage using imported function:",e),this.showError("Could not save details locally."),this.dataService.request("update_customer_details",{details:JSON.stringify(n)}).then((function(e){qe.log("Customer details updated on server successfully (after local storage error):",e),a.handleSaveSuccess(e,n)})).catch((function(e){a.handleSaveError(e)})).finally((function(){r.textContent=i,r.disabled=!1}))}}},{key:"handleSaveSuccess",value:function(e,t){this.updateDisplayedDetails(t),this.checkAndUpdateEmailField(t),this.showMessage("success",e.message||"Details updated successfully!");var o=document.querySelector(this.config.selectors.detailsContainer),a=document.querySelector(this.config.selectors.detailsHeader),r=document.querySelector(this.config.selectors.editForm);r&&(r.style.display="none"),o&&(o.style.display="block"),a&&(a.style.display="flex");var i=new CustomEvent("customer_details_updated",{bubbles:!0,detail:{details:t}});document.dispatchEvent(i),qe.log("Customer details updated successfully",e)}},{key:"handleSaveError",value:function(e){this.showMessage("error",e.message||"Error updating details. Please try again."),qe.log("Error saving customer details:",e)}},{key:"handleDeleteClick",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),window.productEstimator&&window.productEstimator.dialog?window.productEstimator.dialog.show({title:this.config.i18n&&this.config.i18n.delete_customer_details||"Delete Customer Details",message:this.config.i18n&&this.config.i18n.confirm_delete_details||"Are you sure you want to delete your saved details?",confirmText:this.config.i18n&&this.config.i18n.delete||"Delete",action:"delete",cancelText:this.config.i18n.cancel||"Cancel",onConfirm:function(){t.deleteCustomerDetails()}}):confirm(this.config.i18n.confirm_delete_details||"Are you sure you want to delete your saved details?")&&this.deleteCustomerDetails()}},{key:"deleteCustomerDetails",value:function(){var e,t,o=this,a=document.querySelector(".customer-details-confirmation");a&&a.classList.add("loading");try{Q(),qe.log("Customer details removed from localStorage using imported function"),this.handleDeleteSuccess({message:"Details deleted successfully from local storage"},a)}catch(e){qe.log("localStorage error on delete using imported function",e)}this.dataService&&"function"==typeof this.dataService.request?this.dataService.request("delete_customer_details").then((function(e){o.handleDeleteSuccess(e,a)})).catch((function(e){o.handleDeleteError(e,a)})):fetch((null===(e=window.productEstimatorVars)||void 0===e?void 0:e.ajax_url)||"/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"delete_customer_details",nonce:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.nonce)||""})}).then((function(e){return e.json()})).then((function(e){var t;e.success?o.handleDeleteSuccess(e.data,a):o.handleDeleteError(new Error((null===(t=e.data)||void 0===t?void 0:t.message)||"Error deleting details"),a)})).catch((function(e){o.handleDeleteError(e,a)}))}},{key:"handleDeleteSuccess",value:function(e,t){if(t&&e.html){var o=document.createElement("div");o.innerHTML=e.html,t.parentNode.replaceChild(o.firstElementChild,t)}this.showMessage("success",e.message||"Details deleted successfully!");var a=document.querySelector("#new-estimate-form");a&&a.setAttribute("data-has-email","false");var r=new CustomEvent("customer_details_deleted",{bubbles:!0});document.dispatchEvent(r),qe.log("Customer details deleted")}},{key:"handleDeleteError",value:function(e,t){this.showMessage("error",e.message||"Error deleting details!"),qe.log("Error deleting details:",e),t&&t.classList.remove("loading")}},{key:"updateDisplayedDetails",value:function(e){var t=document.querySelectorAll(this.config.selectors.detailsContainer);t.length?(qe.log("Updating ".concat(t.length," customer details containers")),t.forEach((function(t){var o="<p>";e.name&&""!==e.name.trim()&&(o+="<strong>".concat(e.name,"</strong><br>")),e.email&&""!==e.email.trim()&&(o+="".concat(e.email,"<br>")),e.phone&&""!==e.phone.trim()&&(o+="".concat(e.phone,"<br>")),o+=e.postcode||"",o+="</p>",t.innerHTML=o}))):qe.log("No customer details containers found for updating")}},{key:"showMessage",value:function(e,t){document.querySelectorAll(".modal-message").forEach((function(e){return e.remove()}));var o="error"===e?"modal-error-message":"modal-success-message",a=document.createElement("div");a.className="modal-message ".concat(o),a.textContent=t;var r=document.querySelector(this.config.selectors.formContainer);r&&(r.prepend(a),setTimeout((function(){a.remove()}),5e3))}}])}();const xe=Ae;var Te=E("EstimatorCore"),Re=function(){return(0,M.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,_.A)(this,e),this.isActive=!0,this.config=Object.assign({debug:!1,selectors:{estimatorButtons:".product-estimator-button, .single_add_to_estimator_button, .open-estimator-modal",estimatorMenuButtons:".product-estimator-menu-item a, a.product-estimator-menu-item",modalContainer:"#product-estimator-modal"},autoInit:!0,i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.dataService=null,this.modalManager=null,this.variationHandler=null,this.customerDetailsManager=null,this.initialized=!1,this.eventHandlers={},this.config.autoInit&&this.init()}),[{key:"init",value:function(){var e=this;if(this.initialized)return Te.log("already initialized - aborting"),this;if(window._productEstimatorInitialized&&window.productEstimator&&window.productEstimator.core)return Te.log("detected as already initialized globally - aborting"),this.initialized=!0,this;Te.log("Initializing EstimatorCore");try{if("undefined"==typeof jQuery)return Te.error("jQuery is not loaded, cannot initialize EstimatorCore"),this;this.dataService||(this.dataService=new V({debug:this.config.debug})),Te.log("%c=== PRODUCT ESTIMATOR INITIALIZATION START ===","background: #f0f0f0; color: #333; padding: 3px; border-radius: 3px;");var t=function(){e.modalManager?Te.log("Components already initialized - skipping"):(e.modalManager=new Ce({debug:e.config.debug,selectors:e.config.selectors},e.dataService),e.customerDetailsManager=new xe({debug:e.config.debug},e.dataService),e.isWooCommerceProductPage()&&(Te.log("WooCommerce product page detected, initializing VariationHandler"),e.variationHandler=new De({debug:e.config.debug})),e.bindGlobalEvents(),e.initialized=!0,Te.log("initialized successfully"),e.emit("core:initialized"),Te.log("%c=== PRODUCT ESTIMATOR INITIALIZATION COMPLETE ===","background: #f0f0f0; color: #333; padding: 3px; border-radius: 3px;"))};"complete"===document.readyState?t():window.addEventListener("load",t,{once:!0})}catch(e){Te.error("EstimatorCore initialization error:",e)}return this}},{key:"bindGlobalEvents",value:function(){var e=this;try{this._clickHandler&&document.removeEventListener("click",this._clickHandler),this._clickHandler=function(t){var o=t.target.closest(e.config.selectors.estimatorMenuButtons);if(o)return t.preventDefault(),t.stopPropagation(),Te.log("Menu button clicked - opening modal in list view"),void(e.modalManager&&e.modalManager.openModal(null,!0));var a=t.target.closest(e.config.selectors.estimatorButtons);if(a&&!o){t.preventDefault(),t.stopPropagation();var r=a.dataset.productId||null;Te.log("PRODUCT BUTTON CLICKED:",{productId:r,buttonElement:a,dataAttribute:a.dataset}),e.modalManager&&(Te.log("OPENING MODAL WITH:",{productId:r,forceListView:!1}),e.modalManager.openModal(r,!1))}},document.addEventListener("click",this._clickHandler),this.emit("core:eventsbound")}catch(e){Te.error("Error binding global events:",e)}}},{key:"closeModal",value:function(){this.modalManager&&this.modalManager.closeModal()}},{key:"isWooCommerceProductPage",value:function(){return document.body.classList.contains("single-product")||document.body.classList.contains("product-template-default")||!!document.querySelector(".product.type-product")}},{key:"on",value:function(e,t){return this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t),this}},{key:"emit",value:function(e,t){return this.eventHandlers[e]&&this.eventHandlers[e].forEach((function(e){return e(t)})),this}},{key:"destroy",value:function(){this.isActive&&(Te.log("Plugin destroying..."),S(),this.isActive=!1)}}])}();const Fe=new Re({debug:!0});function Ne(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}var He=E("PrintEstimate"),Oe=function(){return(0,M.A)((function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,_.A)(this,e),this.config=Object.assign({debug:!1,selectors:{printButton:".print-estimate, .print-estimate-pdf",requestContactButton:".request-contact-estimate",requestCopyButton:".request-a-copy",scheduleDesignerButton:".schedule-designer-estimate"},i18n:(null===(t=window.productEstimatorVars)||void 0===t?void 0:t.i18n)||{}},o),this.initialized=!1,this.processing=!1,!1!==o.autoInit&&this.init()}),[{key:"init",value:function(){return this.initialized?(this.log("PrintEstimate already initialized"),this):(this.bindEvents(),this.initialized=!0,this.log("PrintEstimate initialized"),this)}},{key:"bindEvents",value:function(){var e=this;document.addEventListener("click",(function(t){var o=t.target.closest(e.config.selectors.printButton);if(o&&!e.processing)if(t.preventDefault(),e.processing=!0,e.setButtonLoading(o,!0),o.classList.contains("print-estimate-pdf")){var a=o.dataset.estimateId;e.checkCustomerDetails(a).then((function(t){var r=[];if(t.name&&""!==t.name.trim()||r.push("name"),t.email&&""!==t.email.trim()||r.push("email"),0===r.length){var i=o.getAttribute("href");i&&"#"!==i&&"javascript:void(0)"!==i?window.open(i,"_blank"):e.getSecurePdfUrl(a).then((function(e){window.open(e,"_blank")})).catch((function(){e.showError("Error generating PDF URL. Please try again.")}))}else e.showCustomerDetailsPrompt(a,o,"print")})).catch((function(){e.showError("Error checking customer details. Please try again.")})).finally((function(){}))}else e.handlePrintEstimate(o);var r=t.target.closest(e.config.selectors.requestCopyButton);if(r&&!e.processing){t.preventDefault(),e.processing=!0,e.setButtonLoading(r,!0);var i=r.dataset.estimateId;e.showContactSelectionPrompt(i,r,"request_copy")}var n=t.target.closest(e.config.selectors.requestContactButton);if(n&&!e.processing){t.preventDefault(),e.processing=!0,e.setButtonLoading(n,!0);var s=n.dataset.estimateId;e.showContactSelectionPrompt(s,n,"request_contact")}}))}},{key:"handlePrintEstimate",value:function(e){var t=this,o=e.dataset.estimateId;if(!o)return this.showError("No estimate ID provided"),this.setButtonLoading(e,!1),void(this.processing=!1);this.log("Print estimate requested for estimate ID: ".concat(o)),this.checkCustomerDetails(o).then((function(a){var r=[];return a.name&&""!==a.name.trim()||r.push("name"),a.email&&""!==a.email.trim()||r.push("email"),0===r.length?t.storeEstimate(o).then((function(e){if(e&&e.estimate_id)return t.getSecurePdfUrl(e.estimate_id);throw new Error("Failed to store estimate")})).then((function(o){t.setButtonLoading(e,!1),t.processing=!1,window.open(o,"_blank")})):(t.showCustomerDetailsPrompt(o,e,"print"),Promise.reject(new Error("missing_customer_details")))})).catch((function(o){"missing_customer_details"!==o.message&&(t.showError("Error generating PDF. Please try again."),t.setButtonLoading(e,!1),t.processing=!1)}))}},{key:"showCustomerDetailsPrompt",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"print";this.checkCustomerDetails(e).then((function(r){var i=o.getMissingFields(r,a);if(0!==i.length){var s=o.createPromptModalHtml(i,a,r),l=document.createElement("div");l.className="email-prompt-modal",l.innerHTML=s,document.body.appendChild(l);var c=l.querySelector(".cancel-email-btn"),d=l.querySelector(".submit-email-btn"),u=l.querySelector(".email-validation-message");c.addEventListener("click",(function(){l.remove(),o.setButtonLoading(t,!1),o.processing=!1})),d.addEventListener("click",(function(){var s=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(o),!0).forEach((function(t){(0,n.A)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ne(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},r),c=!0;i.forEach((function(e){var t=l.querySelector("#customer-".concat(e,"-input")),a=t?t.value.trim():"";return a?"email"!==e||o.validateEmail(a)?"phone"!==e||o.validatePhone(a)?void(s[e]=a):(u.textContent="Please enter a valid phone number",void(c=!1)):(u.textContent="Please enter a valid email address",void(c=!1)):(u.textContent="".concat(o.getFieldLabel(e)," is required"),void(c=!1))})),c&&(d.disabled=!0,d.textContent="Saving...",o.updateCustomerDetails(e,s).then((function(){l.remove(),o.setButtonLoading(t,!0),o.processing=!0,o.continueWithAction(a,e,t,s)})).catch((function(){u.textContent="Error saving details. Please try again.",d.disabled=!1,d.textContent="Continue"})))})),setTimeout((function(){var e=l.querySelector("input");e&&(e.focus(),l.querySelectorAll("input").forEach((function(e){e.addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),d.click())}))})))}),100)}else o.continueWithAction(a,e,t,r)})).catch((function(){o.showError("Error checking customer details. Please try again."),o.setButtonLoading(t,!1),o.processing=!1}))}},{key:"getMissingFields",value:function(e,t){var o={print:["name","email"],request_copy_email:["name","email"],request_copy_sms:["name","phone"],request_contact_email:["name","email"],request_contact_phone:["name","phone"]};return(o[t]||o.print).filter((function(t){return!e||!e[t]||""===e[t].trim()}))}},{key:"getFieldLabel",value:function(e){return{name:"Full Name",email:"Email Address",phone:"Phone Number"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}},{key:"createPromptModalHtml",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="Additional information is required to continue.";"request_copy_email"===t?r="An email address is required to send your estimate copy.":"request_copy_sms"===t?r="A phone number is required to send your estimate via SMS.":"request_contact_email"===t?r="Your details are required for our store to contact you via email.":"request_contact_phone"===t?r="Your details are required for our store to contact you via phone.":e.includes("email")&&!e.includes("name")&&(r="An email address is required to view your estimate.");var i='\n      <div class="email-prompt-overlay"></div>\n      <div class="email-prompt-container">\n        <div class="email-prompt-header">\n          <h3>'.concat("Please Complete Your Details",'</h3>\n        </div>\n        <div class="email-prompt-body">\n          <p>').concat(r,"</p>\n    ");return e.forEach((function(e){var t=o.getFieldLabel(e),r=a[e]||"",n="email"===e?"email":"phone"===e?"tel":"text";i+='\n        <div class="form-group">\n          <label for="customer-'.concat(e,'-input">').concat(t,':</label>\n          <input type="').concat(n,'" id="customer-').concat(e,'-input" value="').concat(r,'" required>\n        </div>\n      ')})),i+='\n          <div class="email-validation-message"></div>\n        </div>\n        <div class="email-prompt-footer">\n          <button type="button" class="button cancel-email-btn">Cancel</button>\n          <button type="button" class="button submit-email-btn">Continue</button>\n        </div>\n      </div>\n    '}},{key:"validateEmail",value:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},{key:"validatePhone",value:function(e){return/^[\d\s()+]{8,}$/.test(e)}},{key:"continueWithAction",value:function(e,t,o,a){var r=this;switch(e){case"print":this.handlePrintEstimate(o);break;case"request_copy_email":this.requestCopyEstimate(t,o).then((function(){r.showMessage("Estimate has been emailed to ".concat(a.email),"success",(function(){r.setButtonLoading(o,!1),r.processing=!1}))})).catch((function(){r.showError("Error sending estimate copy. Please try again."),r.setButtonLoading(o,!1),r.processing=!1}));break;case"request_copy_sms":this.showMessage("SMS option coming soon.","success"),this.setButtonLoading(o,!1),this.processing=!1;break;case"request_contact_email":this.requestStoreContact(t,"email",o,a);break;case"request_contact_phone":this.requestStoreContact(t,"phone",o,a)}}},{key:"showContactSelectionPrompt",value:function(e,t){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"request_copy",r="How would you like to receive your estimate?",i="Please choose how you'd prefer to receive your estimate:",n="Email",s="SMS";"request_contact"===a&&(r="How would you like to be contacted?",i="Please choose how you'd prefer our store to contact you:",n="Email",s="Phone");var l='\n    <div class="email-prompt-overlay"></div>\n    <div class="email-prompt-container">\n      <div class="email-prompt-header">\n        <h3>'.concat(r,'</h3>\n      </div>\n      <div class="email-prompt-body">\n        <p>').concat(i,'</p>\n      </div>\n      <div class="email-prompt-footer">\n        <button type="button" class="button cancel-email-btn">Cancel</button>\n        <button type="button" class="button submit-email-btn email-choice">').concat(n,'</button>\n        <button type="button" class="button submit-email-btn sms-choice">').concat(s,"</button>\n      </div>\n    </div>\n  "),c=document.createElement("div");c.className="email-prompt-modal",c.innerHTML=l,document.body.appendChild(c);var d=c.querySelector(".cancel-email-btn"),u=c.querySelector(".email-choice"),m=c.querySelector(".sms-choice");d.addEventListener("click",(function(){o.setButtonLoading(t,!1),o.processing=!1,c.remove()})),u.addEventListener("click",(function(){c.remove();var r="request_contact"===a?"request_contact_email":"request_copy_email";o.checkCustomerDetails(e).then((function(i){var n=[];i.name&&""!==i.name.trim()||n.push("name"),i.email&&""!==i.email.trim()||n.push("email"),0===n.length?"request_contact"===a?o.requestStoreContact(e,"email",t,i):o.requestCopyEstimate(e,t).then((function(){o.showMessage("Estimate has been emailed to ".concat(i.email),"success",(function(){o.setButtonLoading(t,!1),o.processing=!1}))})).catch((function(){o.showError("Error sending estimate copy. Please try again."),o.setButtonLoading(t,!1),o.processing=!1})):o.showCustomerDetailsPrompt(e,t,r)})).catch((function(){o.showError("Error checking customer details. Please try again."),o.setButtonLoading(t,!1),o.processing=!1}))})),m.addEventListener("click",(function(){c.remove();var r="request_contact"===a?"request_contact_phone":"request_copy_sms";o.checkCustomerDetails(e).then((function(i){var n=[];i.name&&""!==i.name.trim()||n.push("name"),i.phone&&""!==i.phone.trim()||n.push("phone"),0===n.length?"request_contact"===a?o.requestStoreContact(e,"phone",t,i):(o.showMessage("SMS option coming soon.","success"),o.setButtonLoading(t,!1),o.processing=!1):o.showCustomerDetailsPrompt(e,t,r)})).catch((function(){o.showError("Error checking customer details. Please try again."),o.setButtonLoading(t,!1),o.processing=!1}))}))}},{key:"requestStoreContact",value:function(e,t,o,a){var r=this;this.storeEstimate(e).then((function(o){if(!o||!o.estimate_id)throw new Error("Failed to store estimate");var i={action:"request_store_contact",nonce:productEstimatorVars.nonce,estimate_id:e,contact_method:t,customer_details:JSON.stringify(a)};return r.log("Sending store contact request with data:",i),fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(i)})})).then((function(e){return e.json()})).then((function(e){if(e.success){r.log("Store contact request successful:",e.data);var o;o="email"===t?"Your request has been sent. Our store will contact you at ".concat(a.email," shortly."):"Your request has been sent. Our store will call you at ".concat(a.phone," shortly."),r.showMessage(o,"success")}else{var i;r.log("Store contact request failed:",e.data),r.showError((null===(i=e.data)||void 0===i?void 0:i.message)||"Error sending contact request. Please try again.")}})).catch((function(e){r.log("Error in requestStoreContact:",e),r.showError("Error sending contact request. Please try again.")})).finally((function(){r.setButtonLoading(o,!1),r.processing=!1}))}},{key:"checkCustomerDetails",value:function(e){var t=this;return new Promise((function(o,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"check_customer_details",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var r;e.success?(t.log("Customer details check result:",e.data),o(e.data.customer_details||{})):a(new Error((null===(r=e.data)||void 0===r?void 0:r.message)||"Error checking customer details"))})).catch((function(e){t.log("Error checking customer details:",e),a(e)}))}))}},{key:"updateCustomerDetails",value:function(e,t){return new Promise((function(o,a){t.postcode||(t.postcode="0000"),fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"update_customer_details",nonce:productEstimatorVars.nonce,details:JSON.stringify(t)})}).then((function(e){return e.json()})).then((function(o){var a;if(!o.success)throw new Error((null===(a=o.data)||void 0===a?void 0:a.message)||"Error updating customer details");var r=new CustomEvent("customer_details_updated",{bubbles:!0,detail:{details:t}});return document.dispatchEvent(r),fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"store_single_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})})})).then((function(e){return e.json()})).then((function(e){var t;if(!e.success)throw He.error("Error storing estimate:",e),new Error((null===(t=e.data)||void 0===t?void 0:t.message)||"Error storing estimate");o(e.data)})).catch((function(e){He.error("Error in updateCustomerDetails:",e),a(e)}))}))}},{key:"storeEstimate",value:function(e){var t=this;return new Promise((function(o,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"store_single_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var r;e.success?(t.log("Estimate stored successfully",e.data),o(e.data)):a(new Error((null===(r=e.data)||void 0===r?void 0:r.message)||"Error storing estimate"))})).catch((function(e){t.log("Error storing estimate:",e),a(e)}))}))}},{key:"getSecurePdfUrl",value:function(e){var t=this;return new Promise((function(o,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_secure_pdf_url",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var r;e.success&&e.data.url?(t.log("Received secure PDF URL:",e.data),o(e.data.url)):a(new Error((null===(r=e.data)||void 0===r?void 0:r.message)||"Failed to get secure PDF URL"))})).catch((function(e){t.log("Error getting secure PDF URL:",e),a(e)}))}))}},{key:"requestCopyEstimate",value:function(e,t){var o=this;return this.checkCustomerDetails(e).then((function(t){return t.email?o.storeEstimate(e).then((function(t){if(!t||!t.estimate_id)throw new Error("Failed to store estimate");return new Promise((function(t,a){fetch(productEstimatorVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"request_copy_estimate",nonce:productEstimatorVars.nonce,estimate_id:e})}).then((function(e){return e.json()})).then((function(e){var o,r;e.success?t(e.data):"no_email"===(null===(o=e.data)||void 0===o?void 0:o.code)?a(new Error("no_email")):a(new Error((null===(r=e.data)||void 0===r?void 0:r.message)||"Error requesting estimate copy"))})).catch((function(e){o.log("Error requesting estimate copy:",e),a(e)}))}))})):Promise.reject(new Error("no_email"))}))}},{key:"setButtonLoading",value:function(e,t){if(e){var o=e.dataset.originalText||e.textContent;t?(e.dataset.originalText||(e.dataset.originalText=e.textContent),e.classList.add("loading"),e.innerHTML='<span class="loading-dots">Processing...</span>',e.disabled=!0):(e.classList.remove("loading"),e.textContent=o,e.disabled=!1)}}},{key:"showMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;window.productEstimator&&window.productEstimator.dialog?window.productEstimator.dialog.show({title:"Estimate Sent",message:e,type:"estimate",action:"confirm",confirmText:"OK",cancelText:null,onConfirm:function(){"function"==typeof t&&t()}}):(alert(e),"function"==typeof t&&t())}},{key:"showError",value:function(e){window.productEstimator&&window.productEstimator.core&&"function"==typeof window.productEstimator.core.showError?window.productEstimator.core.showError(e):alert(e)}},{key:"log",value:function(){this.config.debug&&He.log.apply(He,arguments)}}])}();const je=Oe,Be=`<template id="product-item-template"> <div class="product-item" data-product-index="" data-product-id=""> <div class="product-wrapper"> <img src="${new URL(o(201),o.b)}" alt="Product" class="product-thumbnail"> <div class="product-details-wrapper"> <div class="product-details"> <div class="price-graph-container"> <div class="price-range-title"> <span class="price-title"></span> <span class="price-dimensions"></span> <span class="product-price"></span> </div> <div class="price-graph-bar"> <div class="price-graph-range"></div> </div> <div class="price-graph-labels"></div> </div> <button class="remove-product" data-estimate-id="" data-room-id="" data-product-index="" data-product-id=""> <span class="dashicons dashicons-trash"></span> </button> </div> </div> </div> <button class="product-includes-toggle expanded"> <span>Product Includes</span> <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span> </button> <div class="includes-container visible"> <div class="product-includes"> <div class="product-includes-items"></div> </div> </div> <button class="product-notes-toggle expanded"> <span>Product Notes</span> <span class="toggle-icon dashicons dashicons-arrow-up-alt2"></span> </button> <div class="notes-container visible"> <div class="product-notes"> <div class="product-notes-items"></div> </div> </div> <div class="product-upgrades-container" style="display:none"> <button class="product-details-toggle product-upgrades-toggle"> <span>Product Upgrades</span> <span class="toggle-icon dashicons dashicons-arrow-down-alt2"></span> </button> <div class="product-upgrades"> <div class="product-upgrades-list"></div> </div> </div> <button class="product-details-toggle similar-products-toggle"> <span>Similar Products</span> <span class="toggle-icon dashicons dashicons-arrow-down-alt2"></span> </button> <div class="similar-products-container" style="display:none" data-product-id=""> <div class="product-similar-products"> <div class="suggestions-carousel similar-products-carousel"> <div class="suggestions-nav prev" aria-label="Previous"> <span class="dashicons dashicons-arrow-left-alt2"></span> </div> <div class="suggestions-container similar-products-list"> </div> <div class="suggestions-nav next" aria-label="Next"> <span class="dashicons dashicons-arrow-right-alt2"></span> </div> </div> </div> </div> </div> </template> `,ze=`<template id="suggestion-item-template"> <div class="suggestion-item"> <div class="suggestion-image"> <img src="${new URL(o(201),o.b)}" alt="" class="suggestion-img product-img"> </div> <div class="suggestion-details"> <div class="suggestion-name product-name"></div> <div class="suggestion-price product-price"></div> <div class="suggestion-actions"> <button type="button" class="add-suggestion-to-room" data-product-id="" data-estimate-id="" data-room-id=""> Add </button> </div> </div> </div> </template> `,Ve=`<template id="similar-product-item-template"> <div class="suggestion-item similar-product-item" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method=""> <div class="suggestion-image"> <img src="${new URL(o(201),o.b)}" alt="Similar Product Image" class="similar-product-thumbnail product-img"> <div class="no-image" style="display:none"></div> </div> <div class="suggestion-details"> <div class="suggestion-name product-name"></div> <div class="suggestion-price product-price"></div> <div class="suggestion-actions"> <button type="button" class="replace-product-in-room" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method=""> Replace </button> </div> </div> </div> </template> `,Ue=`<template id="product-upgrade-item-template"> <div class="upgrade-tile"> <img src="${new URL(o(201),o.b)}" alt="" class="tile-image product-img"> <span class="tile-label product-name"></span> <div class="upgrade-price product-price"></div> <button type="button" class="replace-product-in-room" data-product-id="" data-estimate-id="" data-room-id="" data-replace-product-id="" data-pricing-method="" data-replace-type=""> Upgrade </button> </div> </template> `;var We=E("TemplateLoader"),Ge={"product-item-template":Be,"room-item-template":'<template id="room-item-template"> <div class="accordion-item" data-room-id="" data-estimate-id=""> <div class="accordion-header-wrapper"> <button class="accordion-header"> <div class="price-graph-container"> <div class="price-range-title"> <span class="price-title room-name"></span> <span class="price-dimensions"></span> <span class="room-price"></span> </div> <div class="price-graph-bar"> <div class="price-graph-range"></div> </div> <div class="price-graph-labels"></div> </div> </button> <button class="remove-room" data-estimate-id="" data-room-id="" title="Remove Room"> <span class="dashicons dashicons-trash"></span> </button> </div> <div class="accordion-content"> <div class="room-products"> <h5>Products</h5> <div class="product-list"></div> </div> <div class="product-suggestions" style="display:none"> <button class="product-suggestions-toggle"> Suggested Products <span class="toggle-icon dashicons dashicons-arrow-down-alt2"></span> </button> <div class="suggestions-container-wrapper"> <div class="suggestions-carousel"> <div class="suggestions-nav prev" aria-label="Previous Suggestions">&#10094;</div> <div class="suggestions-container"> </div> <div class="suggestions-nav next" aria-label="Next Suggestions">&#10095;</div> </div> </div> </div> </div> </div> </template> ',"estimate-item-template":'<template id="estimate-item-template"> <div class="estimate-section collapsed" data-estimate-id=""> <div class="estimate-header"> <h3 class="estimate-name"> <div class="price-graph-container"> <div class="price-range-title"> <span class="price-title name"></span> <span class="estimate-price min_total max_total"></span> </div> <div class="price-graph-bar"> <div class="price-graph-range"></div> </div> <div class="price-graph-labels"></div> </div> </h3> <button class="remove-estimate" data-estimate-id="" title="Delete Estimate"> <span class="dashicons dashicons-trash"></span> </button> </div> <div class="estimate-content"> <div id="rooms"> <div class="room-header"> <h4>Rooms</h4> <button class="add-room" data-estimate-id="">Add New Room</button> </div> <div class="rooms-container"></div> </div> </div> <div class="estimate-actions"> <ul> <li> <a class="print-estimate" data-estimate-id="" title="Print Estimate"> <span class="dashicons dashicons-pdf"></span> Print estimate </a> </li> <li> <a class="request-contact-estimate" data-estimate-id="" title="Request contact from store"> <span class="dashicons dashicons-businessperson"></span> Request contact from store </a> </li> <li> <a class="request-a-copy" data-estimate-id="" title="Request a copy"> <span class="dashicons dashicons-email"></span> Request a copy </a> </li> </ul> </div> </div> </template> ',"suggestion-item-template":ze,"note-item-template":'<template id="note-item-template"> <div class="include-item note-item"> <span class="product-includes-icon"> <span class="dashicons dashicons-sticky"></span> </span> <div class="include-item-note"> <p class="note-text">r</p> </div> </div> </template> ',"include-item-template":'<template id="include-item-template"> <div class="include-item" data-product-id=""> <span class="product-includes-icon"> <span class="dashicons dashicons-plus-alt"></span> </span> <div class="include-item-name product-name"></div> <div class="include-item-prices"> <div class="include-item-total-price product-price"> </div> </div> <div class="product-upgrades-container" style="display:none"> <div class="product-upgrades-list"> </div> </div> </div> </template> ',"similar-product-item-template":Ve,"product-upgrade-item-template":Ue,"new-estimate-form-template":'<template id="new-estimate-form-template"> <div id="new-estimate-form-wrapper"> <h2>Create New Estimate</h2> <form id="new-estimate-form" method="post" data-has-email="false"> <div class="form-group"> <label for="estimate-name">Estimate Name</label> <input type="text" id="estimate-name" name="estimate_name" placeholder="e.g. Home Renovation" required> </div> <div class="customer-details-section"> <h4>Your Details</h4> <div class="form-group"> <label for="customer-postcode">Postcode</label> <input type="text" id="customer-postcode" name="customer_postcode" placeholder="Your postcode" required> </div> </div> <div class="button-group"> <button type="submit" class="submit-btn">Create Estimate</button> <button type="button" class="cancel-btn" data-form-type="estimate">Cancel</button> </div> </form> </div> </template> ',"new-room-form-template":'<template id="new-room-form-template"> <div id="new-room-form-wrapper"> <h2>Add New Room</h2> <form id="new-room-form" method="post" data-estimate-id="" data-product-id=""> <div class="form-group"> <label for="room-name">Room Name</label> <input type="text" id="room-name" name="room_name" placeholder="e.g. Living Room" required> </div> <div class="inline-group"> <div class="form-group"> <label for="room-width">Width (m)</label> <input type="number" id="room-width" name="room_width" placeholder="Width" required step="0.01" min="0.1"> </div> <div class="form-group"> <label for="room-length">Length (m)</label> <input type="number" id="room-length" name="room_length" placeholder="Length" required step="0.01" min="0.1"> </div> </div> <div class="button-group"> <button type="submit" class="submit-btn">Add Room</button> <button type="button" class="cancel-btn" data-form-type="room">Cancel</button> </div> </form> </div> </template> ',"room-selection-form-template":'<template id="room-selection-form-template"> <h2>Select a Room</h2> <form id="room-selection-form"> <div class="form-group"> <label for="room-dropdown">Choose a room:</label> <select id="room-dropdown" name="room_id" required> <option value="">-- Select a Room --</option> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn">Add Product to Room</button> <button type="button" class="button cancel-btn back-btn" data-target="estimate-selection">Back</button> <button type="button" class="button add-room" id="add-new-room-from-selection" data-estimate-id="">Add New Room</button> </div> </form> </template> ',"estimate-selection-template":'<template id="estimate-selection-template"> <div id="estimate-selection-wrapper"> <div id="estimate-selection-form-wrapper"> <h2>Select an Estimate</h2> <form id="estimate-selection-form"> <div class="form-group"> <label for="estimate-dropdown">Choose an estimate:</label> <select id="estimate-dropdown" name="estimate_id" required> <option value="">-- Select an Estimate --</option> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn">Continue</button> <button type="button" class="button cancel-btn" id="create-estimate-btn"> Create New Estimate </button> </div> </form> </div> <div id="room-selection-form-wrapper" style="display:none"> <h2>Select a Room</h2> <form id="room-selection-form"> <div class="form-group"> <label for="room-dropdown">Choose a room:</label> <select id="room-dropdown" name="room_id" required> <option value="">-- Select a Room --</option> </select> </div> <div class="form-actions"> <button type="submit" class="button submit-btn">Add Product to Room</button> <button type="button" class="button cancel-btn back-btn" data-target="estimate-selection">Back</button> <button type="button" class="button add-room" id="add-new-room-from-selection" data-estimate="">Add New Room</button> </div> </form> </div> </div> </template> ',"estimates-empty-template":'<template id="estimates-empty-template"> <div class="no-estimates"> <p>You don\'t have any estimates yet.</p> <button id="create-estimate-btn" class="button">Create New Estimate</button> </div> </template> ',"rooms-empty-template":'<template id="rooms-empty-template"> <div class="no-rooms"> <p>You don\'t have any rooms in this estimate.</p> </div> </template> ',"products-empty-template":'<template id="products-empty-template"> <div class="products"> <p>You don\'t have any products in this room.</p> </div> </template> ',"modal-messages-template":'<template id="modal-messages-template"> <div class="modal-message modal-success-message"> <div class="message-content"></div> </div> <div class="modal-message modal-error-message"> <div class="message-content"></div> </div> </template> ',"modal-container-template":'<template id="modal-container-template"> <div id="product-estimator-modal" class="product-estimator-modal"> <div class="product-estimator-modal-overlay"></div> <div class="product-estimator-modal-container"> <button class="product-estimator-modal-close" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> <div class="product-estimator-modal-header"> <h2>Product Estimator</h2> </div> <div class="product-estimator-modal-form-container"> <div id="estimates"></div> <div id="estimate-selection-wrapper" style="display:none"></div> <div id="room-selection-form-wrapper" style="display:none"></div> <div id="new-estimate-form-wrapper" style="display:none"></div> <div id="new-room-form-wrapper" style="display:none"></div> </div> <div class="product-estimator-modal-loading" style="display:none"> <div class="loading-spinner"></div> <div class="loading-text">Loading...</div> </div> </div> </div> </template>'};We.group("Initializing templates"),We.log("Registering templates:",Object.keys(Ge)),Object.entries(Ge).forEach((function(e){var t=(0,i.A)(e,2),o=t[0],a=t[1];a&&""!==a.trim()?(We.log("Registering template: ".concat(o," (").concat(a.length," characters)")),Y.registerTemplate(o,a)):We.warn("Template ".concat(o," has empty HTML content!"))})),We.log("Initialized template engine with ".concat(Object.keys(Ge).length," templates")),We.groupEnd();var Je=E("FrontEndIndex");function Qe(){if(Je.log("Product Estimator initialization check..."),window._productEstimatorInitialized)Je.log("Product Estimator already initialized globally, aborting");else{if(window.productEstimator&&window.productEstimator.initialized)return Je.log("Product Estimator initialized property found, aborting"),void(window._productEstimatorInitialized=!0);window._productEstimatorInitialized=!0,Je.log("Product Estimator initializing for the first time...");try{$e?Je.log("Global event handlers already added, skipping"):(Je.log("Setting up global event handlers..."),window._productEstimatorCloseHandler=function(e){if(e.target.closest(".product-estimator-modal-close")||e.target.classList.contains("product-estimator-modal-overlay")){Je.log("Global close handler triggered");var t=document.querySelector("#product-estimator-modal");t&&(t.style.display="none",document.body.classList.remove("modal-open"),window.productEstimator&&window.productEstimator.core&&window.productEstimator.core.closeModal())}},document.removeEventListener("click",window._productEstimatorCloseHandler),document.addEventListener("click",window._productEstimatorCloseHandler),$e=!0,Je.log("Global event handlers added")),"undefined"!=typeof jQuery?(window.productEstimator=window.productEstimator||{},window.productEstimator.jQuery=jQuery):Je.warn("jQuery not detected, some features may not work");var e=function(){var e=new URLSearchParams(window.location.search);if(e.has("product_estimator_debug")){var t="false"!==e.get("product_estimator_debug");return t?localStorage.setItem("product_estimator_debug","true"):localStorage.removeItem("product_estimator_debug"),t}return"true"===localStorage.getItem("product_estimator_debug")}();"complete"===document.readyState?setTimeout((function(){return Ke(e)}),10):setTimeout((function(){return Ke(e)}),500)}catch(e){Je.error("Error in Product Estimator initialization:",e)}}}function Ke(e){try{if(window.productEstimator&&window.productEstimator.initialized)return void Je.log("Product Estimator core already initialized, skipping");Je.log("Initializing EstimatorCore..."),Fe.init({debug:e}),window.productEstimator=window.productEstimator||{},window.productEstimator.initialized=!0,window.productEstimator.core=Fe,window.productEstimator.dialog=new oe;var t=window.productEstimator.core.dataService;if(!t)return void Je.error("[DataService] instance not found on EstimatorCore. Cannot initialize PrintEstimate.");window.productEstimator.printEstimate=new je({debug:e},t),window.productEstimator.detailsToggle=Se,window.initSuggestionsCarousels=we,function(){try{document.addEventListener("click",(function(e){e.target.closest(".accordion-header")&&setTimeout((function(){Se&&"function"==typeof Se.setup&&(Je.log("Accordion clicked, reinitializing product details toggle"),Se.setup()),we()}),300)})),document.body.addEventListener("click",(function(e){if(e.target.closest(".product-details-toggle")){var t=e.target.closest(".product-details-toggle"),o=t.closest(".product-item");if(!o)return;var a=t.classList.contains("expanded"),r=o.querySelector(".similar-products-container");if(!r)return;if(a){t.classList.remove("expanded"),r.style.display="none",r.classList.remove("visible");var i=t.querySelector(".toggle-icon");i&&(i.classList.remove("dashicons-arrow-up-alt2"),i.classList.add("dashicons-arrow-down-alt2"))}else{t.classList.add("expanded"),r.style.display="block",r.classList.add("visible");var n=t.querySelector(".toggle-icon");n&&(n.classList.remove("dashicons-arrow-down-alt2"),n.classList.add("dashicons-arrow-up-alt2")),we()}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-notes-toggle")){var s=e.target.closest(".product-notes-toggle"),l=s.closest(".product-item");if(!l)return;var c=s.classList.contains("expanded"),d=l.querySelector(".notes-container");if(!d)return;if(c){s.classList.remove("expanded"),d.style.display="none",d.classList.remove("visible");var u=s.querySelector(".toggle-icon");u&&(u.classList.remove("dashicons-arrow-up-alt2"),u.classList.add("dashicons-arrow-down-alt2"))}else{s.classList.add("expanded"),d.style.display="block",d.classList.add("visible");var m=s.querySelector(".toggle-icon");m&&(m.classList.remove("dashicons-arrow-down-alt2"),m.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-includes-toggle")){var g=e.target.closest(".product-includes-toggle"),h=g.closest(".product-item");if(!h)return;var p=g.classList.contains("expanded"),v=h.querySelector(".includes-container");if(!v)return;if(p){g.classList.remove("expanded"),v.style.display="none",v.classList.remove("visible");var f=g.querySelector(".toggle-icon");f&&(f.classList.remove("dashicons-arrow-up-alt2"),f.classList.add("dashicons-arrow-down-alt2"))}else{g.classList.add("expanded"),v.style.display="block",v.classList.add("visible");var y=g.querySelector(".toggle-icon");y&&(y.classList.remove("dashicons-arrow-down-alt2"),y.classList.add("dashicons-arrow-up-alt2"))}e.preventDefault(),e.stopPropagation()}if(e.target.closest(".product-suggestions-toggle")){var w=e.target.closest(".product-suggestions-toggle"),b=w.closest(".accordion-content");if(!b)return;var E=w.classList.contains("expanded"),S=b.querySelector(".suggestions-container");if(!S)return;if(E){w.classList.remove("expanded"),S.style.display="none",S.classList.remove("visible");var _=w.querySelector(".toggle-icon");_&&(_.classList.remove("dashicons-arrow-up-alt2"),_.classList.add("dashicons-arrow-down-alt2"))}else{w.classList.add("expanded"),S.style.display="block",S.classList.add("visible");var M=w.querySelector(".toggle-icon");M&&(M.classList.remove("dashicons-arrow-down-alt2"),M.classList.add("dashicons-arrow-up-alt2")),we()}e.preventDefault(),e.stopPropagation()}})),Je.log("[ProductDetailsToggle] initialization complete")}catch(e){Je.error("Error initializing ProductDetailsToggle:",e)}}(),Je.log("Product Estimator initialized".concat(e?" (debug mode)":"")),document.dispatchEvent(new CustomEvent("product_estimator_initialized"))}catch(e){Je.error("Error during EstimatorCore initialization:",e)}}window._productEstimatorInitialized=window._productEstimatorInitialized||!1,window._setupInitDone||(window._setupInitDone=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Qe,{once:!0}):Qe());var $e=!1;E("ProductEstimatorFrontend").log("Product Estimator Frontend initialized")}},o={};function a(e){var r=o[e];if(void 0!==r)return r.exports;var i=o[e]={exports:{}};return t[e](i,i.exports,a),i.exports}a.m=t,e=[],a.O=(t,o,r,i)=>{if(!o){var n=1/0;for(d=0;d<e.length;d++){for(var[o,r,i]=e[d],s=!0,l=0;l<o.length;l++)(!1&i||n>=i)&&Object.keys(a.O).every((e=>a.O[e](o[l])))?o.splice(l--,1):(s=!1,i<n&&(n=i));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,r,i]},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{a.b=document.baseURI||self.location.href;var e={945:0};a.O.j=t=>0===e[t];var t=(t,o)=>{var r,i,[n,s,l]=o,c=0;if(n.some((t=>0!==e[t]))){for(r in s)a.o(s,r)&&(a.m[r]=s[r]);if(l)var d=l(a)}for(t&&t(o);c<n.length;c++)i=n[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(d)},o=self.webpackChunkproduct_estimator=self.webpackChunkproduct_estimator||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var r=a.O(void 0,[76],(()=>a(344)));r=a.O(r)})();
//# sourceMappingURL=product-estimator.bundle.js.map