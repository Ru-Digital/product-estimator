<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Customer Postcode Management</title>
    <script>
        // Mock the window.productEstimator object structure
        window.productEstimator = {
            core: {
                customerDetailsManager: {
                    hasPostcode: function() {
                        const data = JSON.parse(localStorage.getItem('productEstimatorCustomerData') || '{}');
                        return data.postcode && data.postcode.trim() !== '';
                    },
                    updatePostcodeIfNew: function(postcode) {
                        console.log('Updating postcode:', postcode);
                        const data = JSON.parse(localStorage.getItem('productEstimatorCustomerData') || '{}');
                        if (!data.postcode || data.postcode !== postcode) {
                            data.postcode = postcode;
                            localStorage.setItem('productEstimatorCustomerData', JSON.stringify(data));
                            document.dispatchEvent(new CustomEvent('customer_details_updated', {
                                bubbles: true,
                                detail: { details: data }
                            }));
                            return true;
                        }
                        return false;
                    },
                    getCustomerDetails: function() {
                        return JSON.parse(localStorage.getItem('productEstimatorCustomerData') || '{}');
                    }
                }
            }
        };

        function checkPostcode() {
            const hasPostcode = window.productEstimator.core.customerDetailsManager.hasPostcode();
            document.getElementById('result').innerHTML = 'Has postcode: ' + hasPostcode;
            
            const details = window.productEstimator.core.customerDetailsManager.getCustomerDetails();
            document.getElementById('current').innerHTML = 'Current data: ' + JSON.stringify(details, null, 2);
        }

        function updatePostcode() {
            const postcode = document.getElementById('postcode').value;
            const updated = window.productEstimator.core.customerDetailsManager.updatePostcodeIfNew(postcode);
            checkPostcode();
            document.getElementById('update-result').innerHTML = 'Updated: ' + updated;
        }

        function clearData() {
            localStorage.removeItem('productEstimatorCustomerData');
            checkPostcode();
            document.getElementById('update-result').innerHTML = 'Data cleared';
        }

        document.addEventListener('customer_details_updated', function(event) {
            console.log('Customer details updated event:', event.detail);
            checkPostcode();
        });
    </script>
</head>
<body>
    <h1>Test Customer Postcode Management</h1>
    
    <div>
        <button onclick="checkPostcode()">Check Postcode</button>
        <button onclick="clearData()">Clear All Data</button>
    </div>
    
    <div>
        <h3>Update Postcode:</h3>
        <input type="text" id="postcode" placeholder="Enter postcode">
        <button onclick="updatePostcode()">Update Postcode</button>
    </div>
    
    <h3>Results:</h3>
    <div id="result"></div>
    <div id="update-result"></div>
    
    <h3>Current Customer Data:</h3>
    <pre id="current"></pre>
    
    <script>
        // Initialize on load
        window.addEventListener('load', checkPostcode);
    </script>
</body>
</html>
</content>
</invoke>