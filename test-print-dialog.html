<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Print Dialog</title>
    <link rel="stylesheet" href="public/css/product-estimator-frontend-bundled.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-button {
            padding: 10px 20px;
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px;
        }
        .log-output {
            background: #f0f0f0;
            padding: 10px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Test Print Dialog</h1>
    
    <button class="test-button print-estimate" data-estimate-id="test-123">Test Print Button</button>
    <button class="test-button" onclick="clearLocalStorage()">Clear localStorage</button>
    <button class="test-button" onclick="checkLocalStorage()">Check localStorage</button>
    
    <div class="log-output" id="log-output"></div>

    <!-- Include jQuery first -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        // Set debug mode
        localStorage.setItem('product_estimator_debug', 'true');
        
        // Mock WordPress globals
        window.productEstimatorVars = {
            ajax_url: '/wp-admin/admin-ajax.php',
            nonce: 'test-nonce',
            i18n: {
                errors: {
                    generic: 'An error occurred'
                }
            }
        };
        
        // Override console.log to show in our output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logDiv = document.getElementById('log-output');
            logDiv.textContent += Array.from(args).map(arg => {
                if (typeof arg === 'object') {
                    return JSON.stringify(arg, null, 2);
                }
                return String(arg);
            }).join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        function clearLocalStorage() {
            localStorage.removeItem('productEstimatorCustomerData');
            console.log('localStorage cleared');
        }
        
        function checkLocalStorage() {
            const data = localStorage.getItem('productEstimatorCustomerData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    console.log('localStorage data:', parsed);
                } catch (e) {
                    console.log('localStorage raw data:', data);
                }
            } else {
                console.log('No data in localStorage');
            }
        }
        
        // Add delay before loading the script
        setTimeout(() => {
            console.log('Starting to load product-estimator.bundle.js...');
            const script = document.createElement('script');
            script.src = 'public/js/product-estimator.bundle.js';
            script.onload = () => {
                console.log('Script loaded');
                
                // Add another delay to ensure initialization
                setTimeout(() => {
                    console.log('Checking for window.productEstimator...');
                    console.log('window.productEstimator:', window.productEstimator);
                    
                    if (window.productEstimator && window.productEstimator.dialog) {
                        console.log('Dialog is available!');
                        
                        // Test dialog directly
                        document.getElementById('test-dialog').onclick = () => {
                            console.log('Testing dialog directly...');
                            window.productEstimator.dialog.show({
                                title: 'Test Dialog',
                                message: 'This is a test dialog',
                                confirmText: 'OK',
                                onConfirm: () => console.log('Dialog confirmed')
                            });
                        };
                    } else {
                        console.error('Dialog not available');
                    }
                }, 1000);
            };
            script.onerror = (err) => {
                console.error('Failed to load script:', err);
            };
            document.body.appendChild(script);
        }, 500);
    </script>
    
    <button id="test-dialog" class="test-button">Test Dialog Directly</button>
</body>
</html>